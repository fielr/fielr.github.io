{"version":3,"file":"wce.js","sources":["../src/util/logger.ts","../src/util/utils.ts","../src/util/constants.ts","../src/util/modding.ts","../src/functions/appendSocketListenersToInit.ts","../src/functions/hookBCXAPI.ts","../src/util/localization.ts","../src/functions/forcedClubSlave.ts","../src/functions/hiddenMessageHandler.ts","../src/util/hooks.ts","../src/functions/toySync.ts","../src/functions/extendedWardrobe.ts","../src/functions/customContentDomainCheck.js","../src/functions/chatAugments.js","../src/functions/antiGarbling.ts","../src/util/settings.ts","../src/util/functionHashes.ts","../src/functions/functionIntegrityCheck.ts","../src/functions/wceStyles.ts","../src/functions/commonPatches.ts","../src/functions/beepImprovements.js","../src/functions/commands.ts","../src/functions/settingsPage.ts","../src/functions/lockpickHelp.js","../src/functions/automaticReconnect.js","../src/functions/layeringMenu.ts","../src/functions/cacheClearer.ts","../src/functions/chatRoomOverlay.ts","../src/functions/privateWardrobe.js","../src/util/expressions.ts","../src/functions/automaticExpressions.js","../src/functions/alternateArousal.js","../src/functions/autoGhostBroadcast.ts","../src/functions/blindWithoutGlasses.ts","../src/functions/friendPresenceNotifications.js","../src/functions/itemAntiCheat.js","../src/functions/leashFix.ts","../src/functions/instantMessenger.js","../src/functions/discreetMode.js","../src/functions/autoStruggle.js","../src/functions/leashAlways.ts","../src/functions/pastProfiles.js","../src/functions/pendingMessages.js","../src/functions/hideHiddenItemsIcon.ts","../src/functions/richOnlineProfile.js","../src/functions/crafting.ts","../src/functions/numericArousalMeters.ts","../src/functions/nicknames.ts","../src/functions/shareAddons.ts","../src/functions/confirmLeave.js","../src/functions/chatRoomWhisperFixes.ts","../src/functions/allowCustomEffects.js","../src/registerFunctions.ts","../src/index.ts"],"sourcesContent":["type LogLevel = \"error\" | \"warn\" | \"info\" | \"debug\";\r\n\r\nexport const pastLogs: { level: LogLevel; message: string }[] = Array.from({ length: 100 });\r\n\r\nexport function pushLog(level: LogLevel, ...args: unknown[]): void {\r\n  pastLogs.shift();\r\n  pastLogs.push({\r\n    level,\r\n    message: args.map((v) => {\r\n      if (typeof v === \"string\") {\r\n        return v;\r\n      }\r\n      if (v instanceof Error) {\r\n        return v.stack;\r\n      }\r\n      try {\r\n        return JSON.stringify(v);\r\n      } catch {\r\n        // eslint-disable-next-line @typescript-eslint/no-base-to-string\r\n        return v?.toString();\r\n      }\r\n    }).join(\", \"),\r\n  });\r\n}\r\n\r\nexport function debug(...args: unknown[]): void {\r\n  console.debug(\"WCE\", `${globalThis.FBC_VERSION}:`, ...args);\r\n  pushLog(\"debug\", ...args);\r\n}\r\n\r\nexport function logInfo(...args: unknown[]): void {\r\n  console.info(\"WCE\", `${globalThis.FBC_VERSION}:`, ...args);\r\n  pushLog(\"info\", ...args);\r\n}\r\n\r\nexport function logWarn(...args: unknown[]): void {\r\n  console.warn(\"WCE\", `${globalThis.FBC_VERSION}:`, ...args);\r\n  pushLog(\"warn\", ...args);\r\n}\r\n\r\nexport function logError(...args: unknown[]): void {\r\n  console.error(\"WCE\", `${globalThis.FBC_VERSION}:`, ...args);\r\n  pushLog(\"error\", ...args);\r\n}\r\n","import { logWarn, logError } from \"./logger\";\r\n\r\ninterface ServerBeep {\r\n  Timer: number;\r\n  MemberNumber?: number;\r\n  Message: string;\r\n  ChatRoomName?: string;\r\n  IsMail?: boolean;\r\n  ClickAction?: \"FriendList\";\r\n}\r\n\r\nexport function sleep(ms: number): Promise<number> {\r\n  // eslint-disable-next-line no-promise-executor-return\r\n  return new Promise(resolve => window.setTimeout(resolve, ms));\r\n}\r\n\r\nexport async function waitFor(func: () => boolean, cancelFunc: () => boolean = () => false): Promise<boolean> {\r\n  while (!func()) {\r\n    if (cancelFunc()) {\r\n      return false;\r\n    }\r\n    // eslint-disable-next-line no-await-in-loop\r\n    await sleep(10);\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isString(s: unknown): s is string {\r\n  return typeof s === \"string\";\r\n}\r\n\r\nexport function isNonNullObject(o: unknown): o is Record<string, unknown> {\r\n  return !!o && typeof o === \"object\" && !Array.isArray(o);\r\n}\r\n\r\nexport function isChatMessage(m: unknown): m is ServerChatRoomMessage {\r\n  return (\r\n    isNonNullObject(m) &&\r\n    typeof m.Type === \"string\" &&\r\n    typeof m.Content === \"string\"\r\n  );\r\n}\r\n\r\nexport function isCharacter(c: unknown): c is Character {\r\n  return isNonNullObject(c) && typeof c.IsPlayer === \"function\";\r\n}\r\n\r\nexport function isStringOrStringArray(c: unknown): c is (string | string[]) {\r\n  return isString(c) || (Array.isArray(c) && c.every(isString));\r\n}\r\n\r\nexport function isWardrobe(o: unknown): o is ItemBundle[][] {\r\n  return Array.isArray(o) && o.every(b => isItemBundleArray(b) || b === null);\r\n}\r\n\r\nfunction isItemBundle(o: unknown): o is ItemBundle {\r\n  return (\r\n    isNonNullObject(o) &&\r\n    typeof o.Name === \"string\" &&\r\n    typeof o.Group === \"string\"\r\n  );\r\n}\r\n\r\nfunction isItemBundleArray(o: unknown): o is ItemBundle[] {\r\n  return Array.isArray(o) && o.every(isItemBundle);\r\n}\r\n\r\nexport function mustNum(id: number, def: number = -Number.MAX_SAFE_INTEGER): number {\r\n  return id ?? def;\r\n}\r\n\r\nexport function deepCopy<T>(o: T): T {\r\n  return structuredClone(o);\r\n}\r\n\r\nexport function objEntries<T>(obj: T): [keyof T, T[keyof T]][] {\r\n  if (!isNonNullObject(obj)) {\r\n    return [];\r\n  }\r\n  return Object.entries(obj) as [keyof T, T[keyof T]][];\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-parameters\r\nexport function parseJSON<T>(jsonString: string | null): T {\r\n  if (jsonString === null) {\r\n    return null;\r\n  }\r\n  try {\r\n    return JSON.parse(jsonString) as T;\r\n  } catch (e) {\r\n    logError(\"parsing JSON\", e);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function drawTextFitLeft(text: string, x: number, y: number, width: number, color: string, backColor?: string): void {\r\n  const ctx = window.MainCanvas.getContext(\"2d\");\r\n  if (!ctx) {\r\n    throw new Error(\"could not get canvas 2d context\");\r\n  }\r\n  const bk = ctx.textAlign;\r\n  ctx.textAlign = \"left\";\r\n  DrawTextFit(text, x, y, width, color, backColor);\r\n  ctx.textAlign = bk;\r\n}\r\n\r\nexport function drawTooltip(x: number, y: number, width: number, text: string, align: CanvasTextAlign): void {\r\n  const canvas = window.MainCanvas.getContext(\"2d\");\r\n  if (!canvas) {\r\n    throw new Error(\"could not get canvas 2d context\");\r\n  }\r\n  const bak = canvas.textAlign;\r\n  canvas.textAlign = align;\r\n  DrawRect(x, y, width, 65, \"#FFFF88\");\r\n  DrawEmptyRect(x, y, width, 65, \"black\", 2);\r\n  DrawTextFit(text, align === \"left\" ? x + 3 : x + width / 2, y + 33, width - 6, \"black\");\r\n  canvas.textAlign = bak;\r\n}\r\n\r\nexport function fbcChatNotify(node: HTMLElement | HTMLElement[] | string): void {\r\n  const div = document.createElement(\"div\");\r\n  div.setAttribute(\"class\", \"ChatMessage bce-notification\");\r\n  div.setAttribute(\"data-time\", ChatRoomCurrentTime());\r\n  div.setAttribute(\"data-sender\", Player.MemberNumber?.toString());\r\n  if (typeof node === \"string\") {\r\n    div.appendChild(document.createTextNode(node));\r\n  } else if (Array.isArray(node)) {\r\n    div.append(...node);\r\n  } else {\r\n    div.appendChild(node);\r\n  }\r\n\r\n  ChatRoomAppendChat(div);\r\n}\r\n\r\nexport async function fbcNotify(text: string, duration = 5000, properties: Partial<ServerBeep> = {}) {\r\n  await waitFor(() => !!Player && new Date(ServerBeep?.Timer || 0) < new Date());\r\n\r\n  ServerBeep = {\r\n    Timer: Date.now() + duration,\r\n    Message: text,\r\n    ...properties,\r\n  };\r\n}\r\n\r\nexport function fbcSendAction(text: string): void {\r\n  ServerSend(\"ChatRoomChat\", {\r\n    Content: \"Beep\",\r\n    Type: \"Action\",\r\n    Dictionary: [\r\n      // EN\r\n      { Tag: \"Beep\", Text: \"msg\" },\r\n      // CN\r\n      { Tag: \"发送私聊\", Text: \"msg\" },\r\n      // DE\r\n      { Tag: \"Biep\", Text: \"msg\" },\r\n      // FR\r\n      { Tag: \"Sonner\", Text: \"msg\" },\r\n      // Message itself\r\n      { Tag: \"msg\", Text: text },\r\n    ],\r\n  });\r\n}\r\n\r\nexport function addCustomEffect(effect: EffectName): boolean {\r\n  let updated = false;\r\n  const pronouns = Player.Appearance.find(a => a.Asset.Group.Name === \"Pronouns\");\r\n  if (!pronouns) {\r\n    logWarn(\"Could not find pronouns asset.\");\r\n    return updated;\r\n  }\r\n  if (!pronouns.Property) {\r\n    pronouns.Property = { Effect: [effect] };\r\n    updated = true;\r\n  } else if (!pronouns.Property.Effect) {\r\n    pronouns.Property.Effect = [effect];\r\n    updated = true;\r\n  } else if (!pronouns.Property.Effect.includes(effect)) {\r\n    pronouns.Property.Effect.push(effect);\r\n    updated = true;\r\n  }\r\n  if (updated && ServerPlayerIsInChatRoom()) {\r\n    ChatRoomCharacterUpdate(Player);\r\n  }\r\n  return updated;\r\n}\r\n\r\nexport function removeCustomEffect(effect: EffectName): boolean {\r\n  const pronouns = Player.Appearance.find(a => a.Asset.Group.Name === \"Pronouns\");\r\n  let updated = false;\r\n  if (pronouns?.Property?.Effect?.includes(effect)) {\r\n    pronouns.Property.Effect = pronouns.Property.Effect.filter(e => e !== effect);\r\n    updated = true;\r\n  }\r\n  if (updated && ServerPlayerIsInChatRoom()) {\r\n    ChatRoomCharacterUpdate(Player);\r\n  }\r\n  return updated;\r\n}\r\n\r\nexport function enableLeashing(): void {\r\n  addCustomEffect(\"Leash\");\r\n}\r\n\r\nexport function disableLeashing(): void {\r\n  removeCustomEffect(\"Leash\");\r\n}\r\n","export const FBC_VERSION = \"6.3.5\";\r\nexport const settingsVersion = 63.2;\r\nexport const SUPPORTED_GAME_VERSIONS = [\"R109\", \"R110\"];\r\n\r\nexport const fbcChangelog = `WCE v6.3.5\r\n* BC R110 compatibility and other fixes\r\n* for a full changelog visit our new website: https://wce-docs.vercel.app/blog\r\n\r\nWCE v6.3\r\n* configure layer hiding in layering menus\r\n\r\nWCE v6.2\r\n* WCE 6.2 is a fork of the old FBC 5.8 and tries to bring all it's amazing features back\r\n* new Anti Garble system, layering improvements, local wardrobe and other fixes and improvements\r\n* please recheck your WCE settings, because many things have changed\r\n`;\r\n\r\n// export const DISCORD_INVITE_URL = \"https://discord.gg/SHJMjEh9VH\";\r\nexport const WEBSITE_URL = \"https://wce-docs.vercel.app\";\r\n\r\nexport const BCE_COLOR_ADJUSTMENTS_CLASS_NAME = \"bce-colors\";\r\nexport const BCE_LICENSE = \"https://github.com/KittenApps/WCE/blob/main/LICENSE\";\r\nexport const BCE_MAX_AROUSAL = 99.6;\r\nexport const BCE_MSG = \"BCEMsg\";\r\nexport const DARK_INPUT_CLASS = \"bce-dark-input\";\r\nexport const DEFAULT_WARDROBE_SIZE = 24;\r\nexport const EXPANDED_WARDROBE_SIZE = 96;\r\nexport const LOCAL_WARDROBE_SIZE = EXPANDED_WARDROBE_SIZE * 4;\r\nexport const HIDDEN = \"Hidden\";\r\nexport const MESSAGE_TYPES = Object.freeze({\r\n  Activity: \"Activity\",\r\n  ArousalSync: \"ArousalSync\",\r\n  Hello: \"Hello\",\r\n});\r\nexport const WHISPER_CLASS = \"bce-whisper-input\";\r\n","import { logWarn } from \"./logger\";\r\nimport { SUPPORTED_GAME_VERSIONS, FBC_VERSION } from \"./constants\";\r\nimport type { ModSDKModAPI } from \"bondage-club-mod-sdk\";\r\n\r\nexport const deviatingHashes: string[] = [];\r\nexport const skippedFunctionality: string[] = [];\r\nexport const HOOK_PRIORITIES = {\r\n  Top: 11,\r\n  OverrideBehaviour: 10,\r\n  ModifyBehaviourHigh: 6,\r\n  ModifyBehaviourMedium: 5,\r\n  ModifyBehaviourLow: 4,\r\n  AddBehaviour: 3,\r\n  Observe: 0,\r\n} as const;\r\n\r\nexport const SDK: ModSDKModAPI = bcModSdk.registerMod(\r\n  {\r\n    name: \"WCE\",\r\n    version: FBC_VERSION,\r\n    fullName: \"Wholesome Club Extensions\",\r\n    repository: \"https://github.com/KittenApps/WCE.git\",\r\n  },\r\n  { allowReplace: false }\r\n);\r\n\r\nexport function patchFunction(functionName: string, patches: Record<string, string>, affectedFunctionality: string): void {\r\n  // Guard against patching a function that has been modified by another addon not using the shared SDK on supported versions.\r\n  if (deviatingHashes.includes(functionName) && SUPPORTED_GAME_VERSIONS.includes(GameVersion)) {\r\n    logWarn(\r\n      `Attempted patching of ${functionName} despite detected deviation. Impact may be: ${affectedFunctionality}\\n\\nSee /wcedebug in a chatroom for more information or copy(await fbcDebug()) in console.`\r\n    );\r\n    skippedFunctionality.push(affectedFunctionality);\r\n  }\r\n  SDK.patchFunction(functionName, patches);\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\n\r\ninterface SocketReservedEvents {\r\n  connect: () => void;\r\n  connect_error: (err: Error) => void;\r\n  disconnect: (reason: \"io server disconnect\" | \"io client disconnect\" | \"ping timeout\" | \"transport close\" | \"transport error\") => void;\r\n}\r\ntype EventNames<Map> = keyof Map & (string | symbol);\r\ntype ReservedOrUserEventNames<ReservedEventsMap, UserEvents> = EventNames<ReservedEventsMap> | EventNames<UserEvents>;\r\n\r\nconst listeners: [ReservedOrUserEventNames<SocketReservedEvents, ServerToClientEvents>, (...args: unknown[]) => unknown][] = [];\r\n\r\nexport function registerSocketListener(event: ReservedOrUserEventNames<SocketReservedEvents, ServerToClientEvents>, cb: (...args: unknown[]) => unknown) {\r\n  if (!listeners.some(l => l[1] === cb)) {\r\n    listeners.push([event, cb]);\r\n    return ServerSocket.on(event, cb);\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default function appendSocketListenersToInit(): void {\r\n  // This will be called after reconnect, but not during initial load\r\n  SDK.hookFunction(\r\n    \"ServerInit\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      for (const [event, cb] of listeners) {\r\n        ServerSocket.on(event, cb);\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n}\r\n","/* eslint-disable camelcase */\r\nimport { waitFor } from \"../util/utils\";\r\nimport type { BCX_ModAPI } from \"../../types/bcxExternalInterface\";\r\n\r\nexport let BCX: BCX_ModAPI = null;\r\n\r\nexport default async function hookBCXAPI(): Promise<void> {\r\n  await waitFor(() => !!window.bcx);\r\n  BCX = window.bcx?.getModApi(\"WCE\") ?? null;\r\n}\r\n","export function displayText(original: string, replacements: Record<string, string> = {}): string {\r\n  const translations: Readonly<Record<string, Record<string, string>>> = Object.freeze({\r\n    CN: {\r\n      \"Automatic Arousal Expressions (Replaces Vanilla)\": \"自动欲望表情 (替换原版)\",\r\n      \"Activity Expressions\": \"活动表示\",\r\n      \"Alternate Arousal (Replaces Vanilla, requires hybrid/locked arousal meter)\":\r\n        \"另一种欲望 (替换原版, 需要混合或锁定欲望条)\",\r\n      \"Alternative speech stutter\": \"另一种言语不清\",\r\n      \"Extended wardrobe slots (96)\": \"扩展衣柜保存槽 (96个)\",\r\n      \"Replace wardrobe list with character previews\": \"使用角色预览替换衣柜保存列表\",\r\n      \"Clear Drawing Cache Hourly\": \"每小时清除绘图缓存\",\r\n      \"Instant messenger\": \"即时通讯\",\r\n      \"Chat Links and Embeds\": \"聊天链接和嵌入\",\r\n      \"Use Ctrl+Enter to OOC\": \"使用Ctrl+Enter进行OOC发言\",\r\n      \"Use italics for input when whispering\": \"悄悄话使用斜体字\",\r\n      \"Improve colors for readability\": \"改善颜色以提高可读性\",\r\n      \"Show friend presence notifications\": \"显示好友在线通知\",\r\n      \"Understand All Gagged and when Deafened\": \"在被堵住嘴和被堵住耳朵时可以听懂所有发言\",\r\n      \"Reveal Lockpicking Order Based on Skill\": \"根据技能显示撬锁/开锁顺序\",\r\n      \"Allow layering menus while bound\": \"允许在捆绑时用分层菜单\",\r\n      \"Limited gag anti-cheat: cloth-gag equivalent garbling\": \"有限的堵嘴反作弊: 和布堵嘴相同的乱码\",\r\n      \"Full gag anti-cheat: use equipped gags to determine garbling\": \"完整的堵嘴反作弊: 使用当前装备的堵嘴来确定乱码\",\r\n      \"Extra gag anti-cheat: even more garbling for the most extreme gags\":\r\n        \"扩展的堵嘴反作弊: 对于使用最极端的堵嘴更加混乱\",\r\n      \"Require glasses to see\": \"需要眼镜才能看清\",\r\n      \"Automatic Relogin on Disconnect\": \"断线后自动重连\",\r\n      \"Show gag cheat and anti-cheat options in chat\": \"在聊天室里显示堵嘴作弊和反作弊选项\",\r\n      \"Automatically ghost+blocklist unnaturally new users\": \"自动对不自然的用户无视并添加黑名单\",\r\n      \"Confirm leaving the game\": \"离开游戏前需要确认\",\r\n      \"Discreet mode (disable drawing)\": \"谨慎模式 (禁用绘图)\",\r\n      \"Make automatic progress while struggling\": \"在挣扎时自动增加进度\",\r\n      \"Allow leashing without wearing a leashable item (requires leasher to have WCE too)\":\r\n        \"允许在不佩戴牵引绳的情况下也可以进行牵引（需要牵引者也安装有WCE）\",\r\n      \"Enable buttplug.io (requires refresh)\": \"启用buttplug.io（需要刷新网页)\",\r\n      \"This page allows configuration of the synchronization of bluetooth connected toys.\":\r\n        \"此页面允许配置将BC震动器状态同步到蓝牙连接的玩具\",\r\n      \"Save & browse seen profiles (requires refresh)\": \"保存并浏览已知的个人资料 (需要刷新)\",\r\n      \"Chat & Social\": \"聊天 & 社交\",\r\n      \"Activities & Arousal\": \"活动 & 欲望\",\r\n      \"Appearance & Wardrobe\": \"外观 & 衣柜\",\r\n      \"Immersion & Anti-Cheat\": \"沉浸体验 & 反作弊\",\r\n      Performance: \"表现\",\r\n      Misc: \"杂项\",\r\n      Cheats: \"作弊\",\r\n      ah: \"啊\",\r\n      aah: \"啊❤\",\r\n      mnm: \"唔姆\",\r\n      nn: \"嗯啊\",\r\n      mnh: \"嗯哈\",\r\n      mngh: \"唔啊\",\r\n      haa: \"哈啊\",\r\n      nng: \"嗯嗯❤\",\r\n      mnng: \"唔啊❤\",\r\n      \"FBC Developer\": \"FBC 开发者\",\r\n      \"WCE Developer\": \"WCE 开发者\",\r\n      Incompatibility: \"不兼容\",\r\n      \"Show recent WCE changelog\": \"显示最近的WCE更新日志\",\r\n      \"Include binds?\": \"包括束缚？\",\r\n      \"Include locks?\": \"包括锁？\",\r\n      \"Include height, body type, hair, etc?\": \"包括身高，体型，头发等？\",\r\n      \"Copy the looks string below\": \"复制下面的外观字符串\",\r\n      \"Paste your looks here\": \"在这里粘贴你的外观\",\r\n      \"No looks string provided\": \"没有提供外观字符串\",\r\n      \"Applied looks\": \"应用外观\",\r\n      \"Could not parse looks\": \"无法解析外观\",\r\n      \"[membernumber] [message]: beep someone\": \"[用户编号] [消息]: 发送beep\",\r\n      \"Wholesome Club Extensions (WCE) Settings\": \"Wholesome Club Extensions (WCE)设置\",\r\n      \"Join Discord\": \"加入Discord\",\r\n      License: \"授权\",\r\n      Information: \"信息\",\r\n      \"Still connecting or connection failed...\": \"正在连接或连接失败...\",\r\n      Scan: \"搜索\",\r\n      \"Device Name\": \"设备名称\",\r\n      \"Synchronized Slot\": \"同步栏位\",\r\n      \"Click on a setting to see its description\": \"点击设置以查看其描述\",\r\n      \"WCE Settings\": \"WCE设置\",\r\n      \"Saved Logins (WCE)\": \"已保存的登录 (WCE)\",\r\n      \"Save (WCE)\": \"保存 (WCE)\",\r\n      \"Reconnected!\": \"重新连接！\",\r\n      ERROR: \"错误\",\r\n      \"Reset all expressions\": \"重置所有表情\",\r\n      \"['list' or name of emote]: run an animation\": \"['list' 或 表情名称]: 运行一个动画\",\r\n      \"['list' or list of poses]: set your pose\": \"['list' 或 姿势列表]: 设置你的姿势\",\r\n      \"Load without body parts\": \"加载时不包括身体部位\",\r\n      \"Exclude body parts\": \"排除身体部位\",\r\n      Gagging: \"堵嘴\",\r\n      \"Antigarble anti-cheat strength\": \"反堵嘴反作弊强度\",\r\n      \"Understand: Yes\": \"理解: 是\",\r\n      \"Understand gagspeak: No\": \"理解堵嘴说话: 否\",\r\n      \"Understand gagspeak: Yes\": \"理解堵嘴说话: 是\",\r\n      \"Having recovered your glasses you can see again!\": \"找回了你的眼镜，你可以看见了！\",\r\n      \"Having lost your glasses your eyesight is impaired!\": \"失去了你的眼镜，你的视力受损了！\",\r\n      \"([WCE] Force them to become a Club Slave.)\": \"([WCE] 强制他们成为俱乐部奴隶。)\",\r\n      \"(She will become a Club Slave for the next hour.)\": \"(她将成为俱乐部奴隶，持续一个小时。)\",\r\n      \"Search for a friend\": \"搜索好友\",\r\n      \"Sending beeps is currently restricted by BCX rules\": \"发送beep目前受到BCX规则的限制\",\r\n      Online: \"在线\",\r\n      Offline: \"离线\",\r\n      \"Instant Messenger (Disabled by BCX)\": \"即时通讯器 (被BCX禁用)\",\r\n      \"Instant Messenger\": \"即时通讯器\",\r\n      \"WCE Changelog\": \"WCE更新日志\",\r\n      \"Trust this session\": \"信任此会话\",\r\n      \"(embed)\": \"(嵌入)\",\r\n      \"(This origin is trusted by authors of WCE)\": \"(此来源已被WCE作者信任)\",\r\n      \"Deny for session\": \"拒绝此会话\",\r\n      \"Allow for session\": \"允许此会话\",\r\n      OnlineChat: \"在线聊天\",\r\n      \"Scans for connected buttplug.io toys\": \"扫描已连接的buttplug.io玩具\",\r\n      \"buttplug.io is not connected\": \"buttplug.io未连接\",\r\n      \"Scanning stopped\": \"扫描停止\",\r\n      \"Scanning for toys\": \"扫描玩具\",\r\n      \"Last seen: \": \"最后在线: \",\r\n      \"No profile found\": \"未找到个人资料\",\r\n      Open: \"打开\",\r\n      \"Saved Profiles\": \"已保存的个人资料\",\r\n      \"Personal notes (only you can read these):\": \"个人笔记 (只有你可以读到):\",\r\n      \"[WCE] Notes\": \"[WCE] 笔记\",\r\n      \"Toggle Editing Mode\": \"切换编辑模式\",\r\n      \"Paste the craft here\": \"在这里粘贴制作物品\",\r\n      \"Copy the craft here\": \"在这里复制制作物品\",\r\n      Import: \"导入\",\r\n      Export: \"导出\",\r\n      \"Description:\": \"描述:\",\r\n      \"Animation Engine\": \"动画引擎\",\r\n      \"Show numeric arousal meter\": \"显示欲望条数值\",\r\n      \"Show friends going offline too\": \"显示朋友离线通知\",\r\n      \"Show friend presence notifications in chat, when possible\": \"在聊天室里显示好友在线通知\",\r\n      \"Show sent messages while waiting for server\": \"在等待服务器时显示已发送的消息\",\r\n      \"Show whisper button on chat messages (requires refresh)\": \"在聊天消息上显示悄悄话按钮 （需要刷新网页)\",\r\n      \"Rich online profile\": \"丰富的在线个人资料\",\r\n      \"Allow IMs to bypass BCX beep restrictions\": \"允许即时通讯绕过BCX beep限制\",\r\n      \"Hide the hidden items icon\": \"不显示隐藏的物品图标\",\r\n      \"Enable anti-cheat\": \"启用反作弊\",\r\n      \"Blacklist detected cheaters automatically\": \"自动将检测到的作弊者加入黑名单\",\r\n      \"Enable uwall anti-cheat\": \"启用uwall反作弊\",\r\n      \"Prompt before loading content from a 3rd party domain\": \"在加载第三方域名的内容前提示\",\r\n      \"Share Addons\": \"分享插件设置\",\r\n      \"Buttplug Devices\": \"Buttplug设备\",\r\n    },\r\n  });\r\n\r\n  let text = translations[TranslationLanguage]?.[original] ?? original;\r\n  for (const [key, val] of Object.entries(replacements)) {\r\n    while (text.includes(key)) {\r\n      text = text.replace(key, val);\r\n    }\r\n  }\r\n  return text;\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { BCX } from \"./hookBCXAPI\";\r\nimport { waitFor, isCharacter, fbcSendAction } from \"../util/utils\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { logError } from \"../util/logger\";\r\nimport { HIDDEN, BCE_MSG, MESSAGE_TYPES, FBC_VERSION } from \"../util/constants\";\r\n\r\ndeclare global {\r\n  interface DialogLine {\r\n    FBC: boolean;\r\n  }\r\n}\r\n\r\nexport async function bceStartClubSlave(): Promise<void> {\r\n  if (BCX?.getRuleState(\"block_club_slave_work\")?.isEnforced) {\r\n    fbcSendAction(displayText(\"BCX rules forbid $PlayerName from becoming a Club Slave.\", { $PlayerName: CharacterNickname(Player) }));\r\n    return;\r\n  }\r\n\r\n  fbcSendAction(\r\n    displayText(\"$PlayerName gets grabbed by two maids and escorted to management to serve as a Club Slave.\", { $PlayerName: CharacterNickname(Player) })\r\n  );\r\n\r\n  if (!ChatRoomData) {\r\n    logError(\"ChatRoomData is null in bceStartClubSlave. Was it called outside a chat room?\");\r\n    return;\r\n  }\r\n\r\n  const room = ChatRoomData.Name;\r\n  ChatRoomLeave(false);\r\n  ChatRoomLeashPlayer = null;\r\n  CommonSetScreen(\"Room\", \"Management\");\r\n\r\n  await waitFor(() => !!ManagementMistress);\r\n  if (!ManagementMistress) {\r\n    throw new Error(\"ManagementMistress is missing\");\r\n  }\r\n\r\n  PoseSetActive(Player, \"Kneel\", false);\r\n\r\n  ManagementMistress.Stage = \"320\";\r\n  ManagementMistress.CurrentDialog = displayText(\r\n    \"(You get grabbed by a pair of maids and brought to management.) Your owner wants you to be a Club Slave. Now strip.\"\r\n  );\r\n  CharacterSetCurrent(ManagementMistress);\r\n\r\n  await waitFor(() => CurrentScreen !== \"Management\" || !CurrentCharacter);\r\n\r\n  bceGotoRoom(room);\r\n}\r\n\r\nexport function bceGotoRoom(roomName: string): void {\r\n  ChatRoomJoinLeash = roomName;\r\n  DialogLeave();\r\n  if (CurrentScreen === \"ChatRoom\") ChatRoomLeave(false);\r\n  if (roomName) {\r\n    ChatRoomStart(\"X\", \"\", null, null, \"Introduction\", BackgroundsTagList);\r\n  } else {\r\n    ChatRoomSetLastChatRoom(null);\r\n    CommonSetScreen(\"Room\", \"MainHall\");\r\n  }\r\n}\r\n\r\nexport default async function forcedClubSlave(): Promise<void> {\r\n  async function patchDialog(): Promise<void> {\r\n    await waitFor(() =>\r\n      !!CommonCSVCache[\"Screens/Online/ChatRoom/Dialog_Online.csv\"] &&\r\n      CommonCSVCache[\"Screens/Online/ChatRoom/Dialog_Online.csv\"].length > 150\r\n    );\r\n\r\n    const clubSlaveDialog = [\r\n      [\r\n        \"160\",\r\n        \"100\",\r\n        displayText(\"([WCE] Force them to become a Club Slave.)\"),\r\n        displayText(\"(She will become a Club Slave for the next hour.)\"),\r\n        \"bceSendToClubSlavery()\",\r\n        \"bceCanSendToClubSlavery()\",\r\n      ],\r\n      [\r\n        \"160\",\r\n        \"160\",\r\n        displayText(\"([WCE] Force them to become a Club Slave.)\"),\r\n        displayText(\"(Requires both to use compatible versions of WCE and the target to not already be a club slave.)\"),\r\n        \"\",\r\n        \"!bceCanSendToClubSlavery()\",\r\n      ],\r\n    ];\r\n\r\n    const idx = CommonCSVCache[\"Screens/Online/ChatRoom/Dialog_Online.csv\"].findIndex(v => v[0] === \"160\") + 1;\r\n    CommonCSVCache[\"Screens/Online/ChatRoom/Dialog_Online.csv\"].splice(idx, 0, ...clubSlaveDialog);\r\n\r\n    function appendDialog(C: Character): void {\r\n      if (!C.Dialog || C.Dialog.some(v => v.FBC)) {\r\n        return;\r\n      }\r\n      C.Dialog.splice(\r\n        idx,\r\n        0,\r\n        ...clubSlaveDialog.map(v => ({\r\n          Stage: v[0],\r\n          NextStage: v[1],\r\n          Option: v[2],\r\n          Result: v[3],\r\n          Function: v[4] === \"\" ? null : `ChatRoom${v[4]}`,\r\n          Prerequisite: v[5],\r\n          Group: null,\r\n          Trait: null,\r\n          FBC: true,\r\n        }))\r\n      );\r\n    }\r\n\r\n    for (const c of ChatRoomCharacter.filter(cc => !cc.IsPlayer() && cc.IsOnline())) {\r\n      appendDialog(c);\r\n    }\r\n\r\n    SDK.hookFunction(\r\n      \"CharacterBuildDialog\",\r\n      HOOK_PRIORITIES.AddBehaviour,\r\n      (args, next) => {\r\n        const ret = next(args);\r\n        const [C] = args;\r\n        if (isCharacter(C) && C.IsOnline()) {\r\n          appendDialog(C);\r\n        }\r\n        return ret;\r\n      }\r\n    );\r\n  }\r\n\r\n  const patch = patchDialog();\r\n\r\n  function bceSendToClubSlavery(): void {\r\n    const message: ServerChatRoomMessage = {\r\n      Type: HIDDEN,\r\n      Content: BCE_MSG,\r\n      Sender: Player.MemberNumber,\r\n      Dictionary: [\r\n        {\r\n          // @ts-ignore - cannot extend valid dictionary entries to add our type to it, but this is possible within the game's wire format\r\n          message: {\r\n            type: MESSAGE_TYPES.Activity,\r\n            version: FBC_VERSION,\r\n            activity: \"ClubSlavery\",\r\n          },\r\n        },\r\n      ],\r\n    };\r\n    ServerSend(\"ChatRoomChat\", message);\r\n    DialogLeave();\r\n  }\r\n\r\n  function bceCanSendToClubSlavery(): boolean {\r\n    const C = CurrentCharacter;\r\n    if (!C) {\r\n      return false;\r\n    }\r\n    return C.BCECapabilities?.includes(\"clubslave\") && !C.Appearance.some(a => a.Asset.Name === \"ClubSlaveCollar\");\r\n  }\r\n\r\n  globalThis.bceGotoRoom = bceGotoRoom;\r\n  globalThis.ChatRoombceSendToClubSlavery = bceSendToClubSlavery;\r\n  globalThis.ChatRoombceCanSendToClubSlavery = bceCanSendToClubSlavery;\r\n\r\n  await patch;\r\n}\r\n","import { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { waitFor } from \"../util/utils\";\r\nimport { debug, logWarn } from \"../util/logger\";\r\nimport { fbcSettings, settingsLoaded } from \"../util/settings\";\r\nimport { HIDDEN, BCE_MSG, MESSAGE_TYPES, FBC_VERSION } from \"../util/constants\";\r\nimport { bceStartClubSlave } from \"./forcedClubSlave\";\r\n\r\ntype BCECapabilities = \"clubslave\" | \"layeringHide\" | \"preventLayeringByOthers\";\r\ndeclare global {\r\n  interface Character {\r\n    FBC: string;\r\n    FBCOtherAddons?: readonly import(\"bondage-club-mod-sdk\").ModSDKModInfo[];\r\n    BCEArousal: boolean;\r\n    BCECapabilities: readonly BCECapabilities[];\r\n    BCEArousalProgress: number;\r\n    BCEEnjoyment: number;\r\n    FBCNoteExists: boolean;\r\n    BCESeen: number;\r\n  }\r\n}\r\ninterface FBCDictionaryEntry {\r\n  Tag?: string;\r\n  message?: BCEMessage;\r\n  MemberNumber?: number;\r\n  Text?: string;\r\n  TargetCharacter?: number;\r\n  SourceCharacter?: number;\r\n}\r\ninterface BCEMessage {\r\n  type: string;\r\n  version: string;\r\n  capabilities?: readonly BCECapabilities[];\r\n  alternateArousal?: boolean;\r\n  replyRequested?: boolean;\r\n  progress?: number;\r\n  enjoyment?: number;\r\n  activity?: \"ClubSlavery\";\r\n  otherAddons?: readonly import(\"bondage-club-mod-sdk\").ModSDKModInfo[];\r\n}\r\n\r\nexport function sendHello(target: number | null = null, requestReply = false): void {\r\n  if (!settingsLoaded()) return; // Don't send hello until settings are loaded\r\n  if (!ServerIsConnected || !ServerPlayerIsInChatRoom()) return; // Don't send hello if not in chat room\r\n\r\n  const capabilities: BCECapabilities[] = [\"clubslave\", \"layeringHide\"];\r\n  if (fbcSettings.preventLayeringByOthers) capabilities.push(\"preventLayeringByOthers\");\r\n  const message: ServerChatRoomMessage = {\r\n    Type: HIDDEN,\r\n    Content: BCE_MSG,\r\n    Sender: Player.MemberNumber,\r\n    Dictionary: [],\r\n  };\r\n  const fbcMessage: FBCDictionaryEntry = {\r\n    message: {\r\n      type: MESSAGE_TYPES.Hello,\r\n      version: FBC_VERSION,\r\n      alternateArousal: !!fbcSettings.alternateArousal,\r\n      replyRequested: requestReply,\r\n      capabilities,\r\n    },\r\n  };\r\n  if (target) {\r\n    message.Target = target;\r\n  }\r\n  if (fbcSettings.alternateArousal) {\r\n    fbcMessage.message.progress = Player.BCEArousalProgress || Player.ArousalSettings?.Progress || 0;\r\n    fbcMessage.message.enjoyment = Player.BCEEnjoyment || 1;\r\n  }\r\n  if (fbcSettings.shareAddons) {\r\n    fbcMessage.message.otherAddons = bcModSdk.getModsInfo();\r\n  }\r\n\r\n  // @ts-ignore - cannot extend valid dictionary entries to add our type to it, but this is possible within the game's wire format\r\n  message.Dictionary.push(fbcMessage);\r\n  ServerSend(\"ChatRoomChat\", message);\r\n}\r\n\r\nexport default async function hiddenMessageHandler(): Promise<void> {\r\n  await waitFor(() => ServerSocket && ServerIsConnected);\r\n\r\n  function parseBCEMessage(data: ServerChatRoomMessage): Partial<BCEMessage> {\r\n    let message: Partial<BCEMessage> = {};\r\n    if (Array.isArray(data.Dictionary)) {\r\n      const dicts: FBCDictionaryEntry[] = data.Dictionary as FBCDictionaryEntry[];\r\n      message = dicts?.find(t => t.message)?.message || message;\r\n    } else {\r\n      const dict: FBCDictionaryEntry = data.Dictionary;\r\n      message = dict?.message || message;\r\n    }\r\n    return message;\r\n  }\r\n\r\n  function processBCEMessage(sender: Character, message: Partial<BCEMessage>, deferred = false): void {\r\n    debug(\"Processing BCE message\", sender, message, deferred ? \"(deferred)\" : \"\");\r\n    /**\r\n     * FBC's socket listener may in some cases run before the game's socket listener initializes the character\r\n     * This is an attempt to fix the issue by ensuring the message gets processed at the end of the current event loop.\r\n     */\r\n    if (!sender?.ArousalSettings && !deferred) {\r\n      logWarn(\"No arousal settings found for\", sender, \"; deferring execution to microtask.\");\r\n      queueMicrotask(() => processBCEMessage(sender, message, true));\r\n      return;\r\n    }\r\n    if (!sender?.ArousalSettings) logWarn(\"No arousal settings found for\", sender);\r\n\r\n    switch (message.type) {\r\n      case MESSAGE_TYPES.Hello:\r\n        processHello(sender, message);\r\n        break;\r\n      case MESSAGE_TYPES.ArousalSync:\r\n        sender.BCEArousal = message.alternateArousal || false;\r\n        sender.BCEArousalProgress = message.progress || 0;\r\n        sender.BCEEnjoyment = message.enjoyment || 1;\r\n        break;\r\n      case MESSAGE_TYPES.Activity:\r\n        // Sender is owner and player is not already wearing a club slave collar\r\n        if (sender.MemberNumber === Player.Ownership?.MemberNumber && !Player.Appearance.some(a => a.Asset.Name === \"ClubSlaveCollar\")) {\r\n          bceStartClubSlave();\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  function processHello(sender: Character, message: Partial<BCEMessage>) {\r\n    sender.FBC = message.version ?? \"0.0\";\r\n    sender.BCEArousal = message.alternateArousal || false;\r\n    sender.BCEArousalProgress = message.progress || sender.ArousalSettings?.Progress || 0;\r\n    sender.BCEEnjoyment = message.enjoyment || 1;\r\n    sender.BCECapabilities = message.capabilities ?? [];\r\n    if (message.replyRequested) sendHello(sender.MemberNumber);\r\n    sender.FBCOtherAddons = message.otherAddons;\r\n  }\r\n\r\n  registerSocketListener(\"ChatRoomMessage\", (data: ServerChatRoomMessage) => {\r\n    if (data.Type !== HIDDEN) return;\r\n    if (data.Content === \"BCEMsg\") {\r\n      const sender = Character.find(a => a.MemberNumber === data.Sender);\r\n      if (!sender) return;\r\n      const message = parseBCEMessage(data);\r\n      processBCEMessage(sender, message);\r\n    }\r\n  });\r\n\r\n  registerSocketListener(\"ChatRoomSyncMemberJoin\", (data: ServerChatRoomSyncMemberJoinResponse) => {\r\n    if (data.SourceMemberNumber !== Player.MemberNumber) sendHello(data.SourceMemberNumber);\r\n  });\r\n\r\n  registerSocketListener(\"ChatRoomSync\", () => {\r\n    sendHello();\r\n  });\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"./modding\";\r\n\r\nconst timers: { lastTime: number; cb: () => void; intval: number }[] = [];\r\n\r\nexport function createTimer(cb: () => void, intval: number): () => void {\r\n  timers.push({ cb, intval, lastTime: performance.now() });\r\n  return () => {\r\n    timers.splice(timers.findIndex(t => t.cb === cb), 1);\r\n  };\r\n}\r\n\r\nSDK.hookFunction(\r\n    \"GameRun\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n        if (document.hidden) {\r\n            return next(args);\r\n        }\r\n        const ts = performance.now();\r\n        timers.forEach((t) => {\r\n            if (ts - t.lastTime > t.intval) {\r\n                t.lastTime = ts;\r\n                t.cb();\r\n            }\r\n        });\r\n        return next(args);\r\n    }\r\n);\r\n\r\nSDK.hookFunction(\r\n    \"GameRunBackground\",\r\n    HOOK_PRIORITIES.Top,\r\n    /**\r\n     * @param {Parameters<typeof GameRun>} args\r\n     */\r\n    (args, next) => {\r\n        if (!document.hidden) {\r\n            return next(args);\r\n        }\r\n        const ts = performance.now();\r\n        timers.forEach((t) => {\r\n            if (ts - t.lastTime > t.intval) {\r\n                t.lastTime = ts;\r\n                t.cb();\r\n            }\r\n        });\r\n        return next(args);\r\n    }\r\n);\r\n\r\nexport function fbcBeepNotify(title: string, text: string) {\r\n  SDK.callOriginal(\"ServerAccountBeep\", [\r\n    {\r\n      MemberNumber: Player.MemberNumber || -1,\r\n      BeepType: \"\",\r\n      MemberName: \"WCE\",\r\n      ChatRoomName: title,\r\n      Private: true,\r\n      Message: text,\r\n      ChatRoomSpace: \"\",\r\n    },\r\n  ]);\r\n}\r\n","import { createTimer } from \"../util/hooks\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { debug, logInfo, logWarn, logError } from \"../util/logger\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { fbcChatNotify } from \"../util/utils\";\r\nimport type { ButtplugClientDevice } from \"buttplug\";\r\n\r\nexport interface FBCToySetting {\r\n  Name: string;\r\n  SlotName: string;\r\n  LastIntensity?: number;\r\n}\r\ninterface FBCToySyncState {\r\n  client?: import(\"buttplug\").ButtplugClient;\r\n  deviceSettings: Map<string, FBCToySetting>;\r\n}\r\n\r\nexport const toySyncState: FBCToySyncState = { deviceSettings: new Map() };\r\n\r\nexport default async function toySync(): Promise<void> {\r\n  // Handles synchronizing in-game vibrators with real bluetooth devices via buttplut.io\r\n  if (!fbcSettings.toySync) {\r\n    return;\r\n  }\r\n\r\n  const { ButtplugClient, ButtplugBrowserWebsocketClientConnector } = await import(\"buttplug\");\r\n\r\n  logInfo(\"Loaded Buttplug.io\");\r\n\r\n  const client = new ButtplugClient(\"WCE Toy Sync\");\r\n  client.addListener(\r\n    \"deviceadded\",\r\n    (device: ButtplugClientDevice) => {\r\n      debug(\"Device connected\", device);\r\n      fbcChatNotify(displayText(\"Vibrator connected: $DeviceName\", { $DeviceName: device.name }));\r\n      const deviceSettings = toySyncState.deviceSettings.get(device.name);\r\n      if (deviceSettings) delete deviceSettings.LastIntensity;\r\n    }\r\n  );\r\n  client.addListener(\r\n    \"deviceremoved\",\r\n    (device: ButtplugClientDevice) => {\r\n      debug(\"Device disconnected\", device);\r\n      fbcChatNotify(displayText(\"Vibrator disconnected: $DeviceName\", { $DeviceName: device.name }));\r\n    }\r\n  );\r\n  client.addListener(\"scanningfinished\", (data) => {\r\n    debug(\"Scanning finished\", data);\r\n  });\r\n\r\n  const connector = new ButtplugBrowserWebsocketClientConnector(fbcSettings.toySyncAddress || \"ws://127.0.0.1:12345\");\r\n  try {\r\n    await client.connect(connector);\r\n    logInfo(\"Connected buttplug.io\");\r\n  } catch (ex) {\r\n    FUSAM.modals.openAsync({\r\n      prompt: displayText(\r\n        \"buttplug.io is enabled, but server could not be contacted at $toySyncAddress. Is Intiface Desktop running? Is another client connected to it?\",\r\n        { $toySyncAddress: fbcSettings.toySyncAddress }\r\n      ),\r\n      buttons: { submit: \"OK\" },\r\n    });\r\n    logError(\"buttplug.io could not connect to server\", ex);\r\n    return;\r\n  }\r\n\r\n  toySyncState.client = client;\r\n\r\n  // Sync vibrations from slots\r\n  const removeTimer = createTimer(() => {\r\n    if (!client.connected) {\r\n      removeTimer();\r\n      return;\r\n    }\r\n    for (const d of client.devices.filter(dev => dev.vibrateAttributes.length > 0)) {\r\n      const deviceSettings = toySyncState.deviceSettings?.get(d.name);\r\n      if (!deviceSettings) continue;\r\n\r\n      const slot = deviceSettings.SlotName;\r\n      const intensity = Player.Appearance.find(a => a.Asset.Group.Name === slot)?.Property?.Intensity;\r\n\r\n      if (deviceSettings.LastIntensity === intensity) continue;\r\n      deviceSettings.LastIntensity = intensity;\r\n\r\n      if (typeof intensity !== \"number\" || intensity < 0) {\r\n        d.vibrate(0);\r\n      } else {\r\n        switch (intensity) {\r\n          case 0:\r\n            d.vibrate(0.1);\r\n            debug(d.name, slot, \"intensity 0.1\");\r\n            break;\r\n          case 1:\r\n            d.vibrate(0.4);\r\n            debug(d.name, slot, \"intensity 0.4\");\r\n            break;\r\n          case 2:\r\n            d.vibrate(0.75);\r\n            debug(d.name, slot, \"intensity 0.75\");\r\n            break;\r\n          case 3:\r\n            d.vibrate(1.0);\r\n            debug(d.name, slot, \"intensity 1\");\r\n            break;\r\n          default:\r\n            logWarn(\"Invalid intensity in \", slot, \":\", intensity);\r\n            break;\r\n        }\r\n      }\r\n    }\r\n  }, 3000);\r\n\r\n  CommandCombine([\r\n    {\r\n      Tag: \"toybatteries\",\r\n      Description: displayText(\"Shows the battery status of all connected buttplug.io toys\"),\r\n      Action: () => {\r\n        if (!client.connected) {\r\n          fbcChatNotify(\"buttplug.io is not connected\");\r\n          return;\r\n        }\r\n        const batteryDevices: ButtplugClientDevice[] = client.devices.filter(dev => dev.hasBattery);\r\n        if (batteryDevices.length === 0) {\r\n          fbcChatNotify(\"No battery devices connected\");\r\n          return;\r\n        }\r\n        Promise.all(batteryDevices.map(dev => dev.battery())).then((batteryStatus: number[]) => {\r\n          for (let i = 0; i < batteryDevices.length; i++) {\r\n            const battery = batteryStatus[i] * 100;\r\n            fbcChatNotify(`${batteryDevices[i].name}: ${battery}%`);\r\n          }\r\n        });\r\n      },\r\n    },\r\n    {\r\n      Tag: \"toyscan\",\r\n      Description: displayText(\"Scans for connected buttplug.io toys\"),\r\n      Action: () => {\r\n        if (!client.connected) {\r\n          fbcChatNotify(displayText(\"buttplug.io is not connected\"));\r\n          return;\r\n        }\r\n        if (client.isScanning) {\r\n          client.stopScanning();\r\n          fbcChatNotify(displayText(\"Scanning stopped\"));\r\n          return;\r\n        }\r\n        client.startScanning();\r\n        fbcChatNotify(displayText(\"Scanning for toys\"));\r\n      },\r\n    },\r\n  ]);\r\n\r\n  await client.startScanning();\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcBeepNotify } from \"../util/hooks\";\r\nimport { waitFor, isWardrobe, parseJSON } from \"../util/utils\";\r\nimport { logInfo, logError } from \"../util/logger\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { DEFAULT_WARDROBE_SIZE, EXPANDED_WARDROBE_SIZE } from \"../util/constants\";\r\nimport type { Table, IndexableType } from \"dexie\";\r\n\r\nlet localWardrobeTable: Table<{ id: number; appearance: ServerItemBundle[] }, IndexableType, unknown>;\r\nlet extendedWardrobeLoaded = false;\r\n\r\nexport async function loadLocalWardrobe(wardrobe: ItemBundle[][]): Promise<void> {\r\n  const { Dexie } = await import(\"dexie\");\r\n  const db = new Dexie(\"wce-local-wardrobe\");\r\n  db.version(1).stores({ wardrobe: \"id, appearance\" });\r\n  localWardrobeTable = db.table(\"wardrobe\");\r\n  const localWardrobe: { id: number; appearance: ServerItemBundle[] }[] = (await localWardrobeTable.toArray()) || [];\r\n  await waitFor(() => wardrobe.length === EXPANDED_WARDROBE_SIZE);\r\n  wardrobe.push(...localWardrobe.map(w => sanitizeBundles(w.appearance)));\r\n}\r\n\r\nasync function saveLocalWardrobe(wardrobe: ServerItemBundle[][]): Promise<void> {\r\n  await localWardrobeTable.bulkPut(wardrobe.map((appearance, id) => ({ id, appearance })));\r\n}\r\n\r\n/** Convert old {@link ItemProperties.Type} remnants into {@link ItemProperties.TypeRecord} in the passed item bundles. */\r\nfunction sanitizeBundles(bundleList: ItemBundle[]): ItemBundle[] {\r\n  if (!Array.isArray(bundleList)) return bundleList;\r\n  return bundleList.map((bundle) => {\r\n    // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n    if (typeof bundle.Property?.Type === \"string\" && !CommonIsObject(bundle.Property?.TypeRecord)) {\r\n      const asset = AssetGet(\"Female3DCG\", bundle.Group, bundle.Name);\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n      if (asset) bundle.Property.TypeRecord = ExtendedItemTypeToRecord(asset, bundle.Property.Type);\r\n    }\r\n    return bundle;\r\n  });\r\n}\r\n\r\nexport function loadExtendedWardrobe(wardrobe: ItemBundle[][]): ItemBundle[][] {\r\n  if (fbcSettings.extendedWardrobe) {\r\n    WardrobeSize = EXPANDED_WARDROBE_SIZE;\r\n    WardrobeFixLength();\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n  const wardrobeData: string = Player.ExtensionSettings.FBCWardrobe || Player.OnlineSettings?.BCEWardrobe;\r\n  if (wardrobeData) {\r\n    // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n    if (Player.OnlineSettings?.BCEWardrobe) {\r\n      Player.ExtensionSettings.FBCWardrobe = wardrobeData;\r\n      ServerPlayerExtensionSettingsSync(\"FBCWardrobe\");\r\n      logInfo(\"Migrated wardrobe from OnlineSettings to ExtensionSettings\");\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n      delete Player.OnlineSettings.BCEWardrobe;\r\n    }\r\n    try {\r\n      const additionalItemBundle: ItemBundle[][] = parseJSON(LZString.decompressFromUTF16(wardrobeData));\r\n      if (isWardrobe(additionalItemBundle)) {\r\n        for (let i = DEFAULT_WARDROBE_SIZE; i < EXPANDED_WARDROBE_SIZE; i++) {\r\n          const additionalIdx = i - DEFAULT_WARDROBE_SIZE;\r\n          if (additionalIdx >= additionalItemBundle.length) {\r\n            break;\r\n          }\r\n          wardrobe[i] = sanitizeBundles(additionalItemBundle[additionalIdx]);\r\n        }\r\n        extendedWardrobeLoaded = true;\r\n      }\r\n    } catch (e) {\r\n      logError(\"Failed to load extended wardrobe\", e);\r\n      fbcBeepNotify(\"Wardrobe error\", `Failed to load extended wardrobe.\\n\\nBackup: ${wardrobeData}`);\r\n      logInfo(\"Backup wardrobe\", wardrobeData);\r\n    }\r\n  }\r\n  return wardrobe;\r\n}\r\n\r\nexport default async function extendedWardrobe(): Promise<void> {\r\n  await waitFor(() => !!ServerSocket);\r\n\r\n  SDK.hookFunction(\r\n    \"CharacterCompressWardrobe\",\r\n    HOOK_PRIORITIES.Top,\r\n    ([wardrobe], next) => {\r\n      if (isWardrobe(wardrobe)) {\r\n        const additionalWardrobe = wardrobe.slice(DEFAULT_WARDROBE_SIZE, EXPANDED_WARDROBE_SIZE);\r\n        if (additionalWardrobe.length > 0 && extendedWardrobeLoaded) {\r\n          Player.ExtensionSettings.FBCWardrobe = LZString.compressToUTF16(JSON.stringify(additionalWardrobe));\r\n          const additionalLocalWardrobe = wardrobe.slice(EXPANDED_WARDROBE_SIZE);\r\n          if (additionalLocalWardrobe.length > 0) saveLocalWardrobe(additionalLocalWardrobe);\r\n          wardrobe = wardrobe.slice(0, DEFAULT_WARDROBE_SIZE);\r\n          ServerPlayerExtensionSettingsSync(\"FBCWardrobe\");\r\n        }\r\n      }\r\n      return next([wardrobe]);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeLoadCharacterNames\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (!fbcSettings.localWardrobe) return next(args);\r\n      if (!Player.WardrobeCharacterNames) Player.WardrobeCharacterNames = [];\r\n      let Push = false;\r\n      while (Player.WardrobeCharacterNames.length <= WardrobeSize) {\r\n        if (Player.WardrobeCharacterNames.length < EXPANDED_WARDROBE_SIZE) {\r\n          Player.WardrobeCharacterNames.push(Player.Name);\r\n          Push = true;\r\n        } else {\r\n          Player.WardrobeCharacterNames.push(\"Local\");\r\n        }\r\n      }\r\n      if (Push) ServerAccountUpdate.QueueData({ WardrobeCharacterNames: Player.WardrobeCharacterNames.slice(0, EXPANDED_WARDROBE_SIZE) });\r\n      return null;\r\n    }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\n/** @type {Map<string, \"allowed\" | \"denied\">} */\r\nexport const sessionCustomOrigins = new Map();\r\n\r\nexport default function customContentDomainCheck() {\r\n  const trustedOrigins = [\"https://fs.kinkop.eu\", \"https://i.imgur.com\"];\r\n\r\n  let open = false;\r\n  /**\r\n   * @param {string} origin\r\n   * @param {\"image\" | \"music\" | null} type\r\n   */\r\n  function showCustomContentDomainCheckWarning(origin, type = null) {\r\n    if (open) {\r\n      return;\r\n    }\r\n    open = true;\r\n    FUSAM.modals.open({\r\n      prompt: displayText(`Do you want to allow 3rd party ${type ?? \"content\"} to be loaded from $origin? $trusted`, {\r\n        $origin: origin,\r\n        $trusted: trustedOrigins.includes(origin) ? displayText(\"(This origin is trusted by authors of WCE)\") : \"\",\r\n      }),\r\n      callback: (act) => {\r\n        open = false;\r\n        if (act === \"submit\") {\r\n          sessionCustomOrigins.set(origin, \"allowed\");\r\n        } else if (act === \"cancel\") {\r\n          sessionCustomOrigins.set(origin, \"denied\");\r\n        }\r\n      },\r\n      buttons: {\r\n        cancel: displayText(\"Deny for session\"),\r\n        submit: displayText(\"Allow for session\"),\r\n      },\r\n    });\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"ChatAdminRoomCustomizationProcess\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (!fbcSettings.customContentDomainCheck) {\r\n        return next(args);\r\n      }\r\n\r\n      try {\r\n        // @ts-ignore - the function's types are garbage\r\n        const [{ ImageURL, MusicURL }] = args;\r\n        const imageOrigin = ImageURL && new URL(ImageURL).origin;\r\n        const musicOrigin = MusicURL && new URL(MusicURL).origin;\r\n\r\n        if (imageOrigin && !sessionCustomOrigins.has(imageOrigin)) {\r\n          showCustomContentDomainCheckWarning(imageOrigin, \"image\");\r\n        } else if (musicOrigin && !sessionCustomOrigins.has(musicOrigin)) {\r\n          showCustomContentDomainCheckWarning(musicOrigin, \"music\");\r\n        }\r\n\r\n        if ((!ImageURL || sessionCustomOrigins.get(imageOrigin) === \"allowed\") && (!MusicURL || sessionCustomOrigins.get(musicOrigin) === \"allowed\")) {\r\n          return next(args);\r\n        }\r\n      } catch {\r\n        // Don't care\r\n      }\r\n\r\n      return null;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatAdminRoomCustomizationClick\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      for (const s of [ElementValue(\"InputImageURL\").trim(), ElementValue(\"InputMusicURL\").trim()]) {\r\n        try {\r\n          const url = new URL(s);\r\n          sessionCustomOrigins.set(url.origin, \"allowed\");\r\n        } catch {\r\n          // Don't care\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { createTimer } from \"../util/hooks\";\r\nimport { debug } from \"../util/logger\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { sessionCustomOrigins } from \"./customContentDomainCheck\";\r\nimport { fbcChatNotify } from \"../util/utils\";\r\n\r\nconst CLOSINGBRACKETINDICATOR = \"\\\\uf130\\\\u005d\";\r\nconst EMBED_TYPE = /** @type {const} */ ({\r\n  Image: \"img\",\r\n  None: \"\",\r\n  Untrusted: \"none-img\",\r\n});\r\n\r\n/** @type {(word: string) => URL | false} */\r\nfunction bceParseUrl(word) {\r\n  try {\r\n    const url = new URL(word);\r\n    if (![\"http:\", \"https:\"].includes(url.protocol)) {\r\n      return false;\r\n    }\r\n    return url;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst startSounds = [\"..\", \"--\"];\r\nconst endSounds = [\"...\", \"~\", \"~..\", \"~~\", \"..~\"];\r\nconst eggedSounds = [\"ah\", \"aah\", \"mnn\", \"nn\", \"mnh\", \"mngh\", \"haa\", \"nng\", \"mnng\"];\r\n/**\r\n * StutterWord will add s-stutters to the beginning of words and return 1-2 words, the original word with its stutters and a sound, based on arousal\r\n * @type {(word: string, forceStutter?: boolean) => {results: string[], stutter: boolean}}\r\n */\r\nexport function stutterWord(word, forceStutter) {\r\n  if (!word?.length) {\r\n    return { results: [word], stutter: false };\r\n  }\r\n\r\n  /** @type {(wrd: string) => string} */\r\n  function addStutter(wrd) {\r\n    return /^\\p{L}/u.test(wrd) ? `${wrd.substring(0, /[\\uD800-\\uDFFF]/u.test(wrd[0]) ? 2 : 1)}-${wrd}` : wrd;\r\n  }\r\n\r\n  const maxIntensity = Math.max(\r\n    0,\r\n    ...Player.Appearance.filter(a => (a.Property?.Intensity ?? -1) > -1).map(a => a.Property?.Intensity ?? 0)\r\n  );\r\n\r\n  const playerArousal = Player.ArousalSettings?.Progress ?? 0;\r\n  const eggedBonus = maxIntensity * 5;\r\n  const chanceToStutter = (Math.max(0, playerArousal - 10 + eggedBonus) * 0.5) / 100;\r\n\r\n  const chanceToMakeSound = (Math.max(0, playerArousal / 2 - 20 + eggedBonus * 2) * 0.5) / 100;\r\n  let stutter = false;\r\n\r\n  const r = Math.random();\r\n  for (let i = Math.min(4, Math.max(1, maxIntensity)); i >= 1; i--) {\r\n    if (r < chanceToStutter / i || (i === 1 && forceStutter && chanceToStutter > 0)) {\r\n      word = addStutter(word);\r\n      stutter = true;\r\n    }\r\n  }\r\n  const results = [word];\r\n  if (maxIntensity > 0 && Math.random() < chanceToMakeSound) {\r\n    const startSound = startSounds[Math.floor(Math.random() * startSounds.length)];\r\n    const sound = eggedSounds[Math.floor(Math.random() * eggedSounds.length)];\r\n    const endSound = endSounds[Math.floor(Math.random() * endSounds.length)];\r\n    results.push(\" \", `${startSound}${displayText(sound)}${endSound}`);\r\n    stutter = true;\r\n  }\r\n  return { results, stutter };\r\n}\r\n\r\n/** @type {(url: URL) => \"img\" | \"\" | \"none-img\"} */\r\nfunction bceAllowedToEmbed(url) {\r\n  const isTrustedOrigin =\r\n    [\r\n      \"cdn.discordapp.com\",\r\n      \"media.discordapp.com\",\r\n      \"i.imgur.com\",\r\n      \"tenor.com\",\r\n      \"c.tenor.com\",\r\n      \"media.tenor.com\",\r\n      \"i.redd.it\",\r\n      \"puu.sh\",\r\n      \"fs.kinkop.eu\",\r\n    ].includes(url.host) || sessionCustomOrigins.get(url.origin) === \"allowed\";\r\n\r\n  if (/\\/[^/]+\\.(png|jpe?g|webp|gif)$/ui.test(url.pathname)) {\r\n    return isTrustedOrigin ? EMBED_TYPE.Image : EMBED_TYPE.Untrusted;\r\n  }\r\n  return EMBED_TYPE.None;\r\n}\r\n\r\n/** @type {(chatMessageElement: Element, scrollToEnd: () => void) => void} */\r\nexport function processChatAugmentsForLine(chatMessageElement, scrollToEnd) {\r\n  const newChildren = [];\r\n  let originalText = \"\";\r\n  for (const node of chatMessageElement.childNodes) {\r\n    if (node.nodeType !== Node.TEXT_NODE) {\r\n      newChildren.push(node);\r\n      continue;\r\n    }\r\n    const contents = node.textContent ?? \"\",\r\n      words = [contents];\r\n\r\n    originalText += contents;\r\n\r\n    for (let i = 0; i < words.length; i++) {\r\n      // Handle other whitespace\r\n      const whitespaceIdx = words[i].search(/[\\s\\r\\n]/u);\r\n      if (whitespaceIdx >= 1) {\r\n        words.splice(i + 1, 0, words[i].substring(whitespaceIdx));\r\n        words[i] = words[i].substring(0, whitespaceIdx);\r\n      } else if (whitespaceIdx === 0) {\r\n        words.splice(i + 1, 0, words[i].substring(1));\r\n        [words[i]] = words[i];\r\n        newChildren.push(document.createTextNode(words[i]));\r\n        continue;\r\n      }\r\n\r\n      // Handle url linking\r\n      const url = bceParseUrl(words[i].replace(/(^\\(+|\\)+$)/gu, \"\"));\r\n      if (url) {\r\n        // Embed or link\r\n        /** @type {HTMLElement | Text | null} */\r\n        let domNode = null;\r\n        const linkNode = document.createElement(\"a\");\r\n        newChildren.push(linkNode);\r\n        const embedType = bceAllowedToEmbed(url);\r\n        switch (embedType) {\r\n          case EMBED_TYPE.Image:\r\n            {\r\n              const imgNode = document.createElement(\"img\");\r\n              imgNode.src = url.href;\r\n              imgNode.alt = url.href;\r\n              imgNode.onload = scrollToEnd;\r\n              imgNode.classList.add(\"bce-img\");\r\n              linkNode.classList.add(\"bce-img-link\");\r\n              domNode = imgNode;\r\n            }\r\n            break;\r\n          default:\r\n            domNode = document.createTextNode(url.href);\r\n            if (embedType !== EMBED_TYPE.None) {\r\n              const promptTrust = document.createElement(\"a\");\r\n              promptTrust.onclick = (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                // eslint-disable-next-line prefer-destructuring\r\n                const target = /** @type {HTMLAnchorElement} */ (e.target);\r\n                FUSAM.modals.open({\r\n                  prompt: displayText(\"Do you want to add $origin to trusted origins?\", { $origin: url.origin }),\r\n                  callback: (act) => {\r\n                    if (act === \"submit\") {\r\n                      sessionCustomOrigins.set(url.origin, \"allowed\");\r\n\r\n                      const parent = target.parentElement;\r\n                      if (!parent) {\r\n                        throw new Error(\"clicked promptTrust has no parent\");\r\n                      }\r\n                      parent.removeChild(target);\r\n\r\n                      const name = parent.querySelector(\".ChatMessageName\");\r\n                      parent.innerHTML = \"\";\r\n                      if (name) {\r\n                        parent.appendChild(name);\r\n                        parent.appendChild(document.createTextNode(\" \"));\r\n                      }\r\n\r\n                      const ogText = parent.getAttribute(\"bce-original-text\");\r\n                      if (!ogText) {\r\n                        throw new Error(\"clicked promptTrust has no original text\");\r\n                      }\r\n                      parent.appendChild(document.createTextNode(ogText));\r\n                      processChatAugmentsForLine(chatMessageElement, scrollToEnd);\r\n                      debug(\"updated trusted origins\", sessionCustomOrigins);\r\n                    }\r\n                  },\r\n                  buttons: { submit: displayText(\"Trust this session\") },\r\n                });\r\n              };\r\n              promptTrust.href = \"#\";\r\n              promptTrust.title = displayText(\"Trust this session\");\r\n              promptTrust.textContent = displayText(\"(embed)\");\r\n              newChildren.push(document.createTextNode(\" \"));\r\n              newChildren.push(promptTrust);\r\n            }\r\n            break;\r\n        }\r\n        linkNode.href = url.href;\r\n        linkNode.title = url.href;\r\n        linkNode.target = \"_blank\";\r\n        linkNode.appendChild(domNode);\r\n      } else if (/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/u.test(words[i])) {\r\n        const color = document.createElement(\"span\");\r\n        color.classList.add(\"bce-color\");\r\n        color.style.background = words[i];\r\n        newChildren.push(color);\r\n        newChildren.push(document.createTextNode(words[i]));\r\n      } else {\r\n        newChildren.push(document.createTextNode(words[i]));\r\n      }\r\n    }\r\n  }\r\n  while (chatMessageElement.firstChild) {\r\n    chatMessageElement.removeChild(chatMessageElement.firstChild);\r\n  }\r\n  for (const child of newChildren) {\r\n    chatMessageElement.appendChild(child);\r\n  }\r\n  chatMessageElement.setAttribute(\"bce-original-text\", originalText);\r\n}\r\n\r\n/**\r\n * @type {(node: HTMLElement | HTMLElement[] | string) => void}\r\n */\r\nexport function augmentedChatNotify(node) {\r\n  const div = document.createElement(\"div\");\r\n  div.setAttribute(\"class\", \"ChatMessage bce-notification\");\r\n  div.setAttribute(\"data-time\", ChatRoomCurrentTime());\r\n  div.setAttribute(\"data-sender\", Player.MemberNumber?.toString());\r\n  if (typeof node === \"string\") {\r\n    div.appendChild(document.createTextNode(node));\r\n  } else if (Array.isArray(node)) {\r\n    div.append(...node);\r\n  } else {\r\n    div.appendChild(node);\r\n  }\r\n  ChatRoomAppendChat(div);\r\n  processChatAugmentsForLine(div, () => {\r\n    if (ElementIsScrolledToEnd(\"TextAreaChatLog\")) ElementScrollToEnd(\"TextAreaChatLog\");\r\n  });\r\n}\r\n\r\nexport default function chatAugments() {\r\n  // CTRL+Enter OOC implementation\r\n  SDK.hookFunction(\r\n    \"ChatRoomKeyDown\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    ([event], next) => {\r\n      const inputChat = /** @type {HTMLInputElement} */(document.getElementById(\"InputChat\"));\r\n      if (inputChat && document.activeElement === inputChat) {\r\n        if (event.key === \"Enter\" && !event.shiftKey) {\r\n          if (fbcSettings.ctrlEnterOoc && event.ctrlKey && inputChat.value.trim().length !== 0) {\r\n            let text = inputChat.value;\r\n            let prefix = \"\";\r\n            if (!text) {\r\n              fbcChatNotify(\"Nothing to send!\");\r\n              return true;\r\n            }\r\n            // Whisper command\r\n            if (text.startsWith(\"/w \")) {\r\n              const textParts = text.split(\" \");\r\n              text = textParts.slice(2).join(\" \");\r\n              prefix = `${textParts.slice(0, 2).join(\" \")} `;\r\n            } else if (text.startsWith(\"/\") && !text.startsWith(\"//\")) {\r\n              fbcChatNotify(\"Tried to OOC send a command. Use double // to confirm sending to chat.\");\r\n              return true;\r\n            }\r\n            inputChat.value = `${prefix}(${text.replace(/\\)/g, CLOSINGBRACKETINDICATOR)}`;\r\n          }\r\n          ChatRoomSendChat();\r\n          return true;\r\n        }\r\n        if (event.metaKey && (event.key === \"ArrowUp\" || event.key === \"ArrowDown\")) {\r\n          ChatRoomScrollHistory(event.key === \"ArrowUp\");\r\n          return true;\r\n        }\r\n      }\r\n      return next([event]);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomMessageDisplay\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    ([data, msg, SenderCharacter, metadata], next) => next(\r\n      [data, msg.replace(new RegExp(CLOSINGBRACKETINDICATOR, \"g\"), \")\"), SenderCharacter, metadata]\r\n    )\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"SpeechTransformProcess\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    ([C, m, effects, ignoreOOC], next) => {\r\n      const { msg, hasStuttered } = bceMessageReplacements(m || \"\");\r\n      const result = next([C, msg, effects.filter(f => f !== \"stutter\" || !fbcSettings.stutters), ignoreOOC]);\r\n      if (hasStuttered) result.effects.push(\"stutter\");\r\n      return result;\r\n    }\r\n  );\r\n\r\n  /** @type {(msg: string) => {msg: string, hasStuttered: boolean}} */\r\n  function bceMessageReplacements(msg) {\r\n    const words = [msg];\r\n    let firstStutter = true,\r\n      inOOC = false;\r\n    const newWords = [];\r\n    let hasStuttered = false;\r\n    for (let i = 0; i < words.length; i++) {\r\n      // Handle other whitespace\r\n      const whitespaceIdx = words[i].search(/[\\s\\r\\n]/u);\r\n      if (whitespaceIdx >= 1) {\r\n        // Insert remainder into list of words\r\n        words.splice(i + 1, 0, words[i].substring(whitespaceIdx));\r\n        // Truncate current word to whitespace\r\n        words[i] = words[i].substring(0, whitespaceIdx);\r\n      } else if (whitespaceIdx === 0) {\r\n        // Insert remainder into list of words\r\n        words.splice(i + 1, 0, words[i].substring(1));\r\n        // Keep space in the message\r\n        [words[i]] = words[i];\r\n        newWords.push(words[i]);\r\n        continue;\r\n      }\r\n      // Handle OOC\r\n      const oocIdx = words[i].search(/[()]/u);\r\n      if (oocIdx > 0) {\r\n        // Insert remainder into list of words\r\n        words.splice(i + 1, 0, words[i].substring(oocIdx + 1));\r\n        // Insert OOC marker into list of words, before remainder\r\n        words.splice(i + 1, 0, words[i].substring(oocIdx, oocIdx + 1));\r\n        // Truncate current word to OOC\r\n        words[i] = words[i].substring(0, oocIdx);\r\n      } else if (oocIdx === 0 && words[i].length > 1) {\r\n        // Insert remainder into list of words\r\n        words.splice(i + 1, 0, words[i].substring(1));\r\n        // Keep OOC marker in the message\r\n        [words[i]] = words[i];\r\n      }\r\n\r\n      if (words[i] === \"(\") {\r\n        inOOC = true;\r\n      }\r\n\r\n      if (bceParseUrl(words[i]) && !inOOC) {\r\n        newWords.push(\"( \");\r\n        newWords.push(words[i]);\r\n        newWords.push(\" )\");\r\n      } else if (fbcSettings.stutters && !inOOC) {\r\n        const { results, stutter } = stutterWord(words[i], firstStutter);\r\n        hasStuttered ||= stutter;\r\n        newWords.push(...results);\r\n        firstStutter = false;\r\n      } else {\r\n        newWords.push(words[i]);\r\n      }\r\n\r\n      if (words[i] === \")\") {\r\n        inOOC = false;\r\n      }\r\n    }\r\n    return { msg: newWords.join(\"\"), hasStuttered };\r\n  }\r\n\r\n  function bceChatAugments() {\r\n    if (CurrentScreen !== \"ChatRoom\" || !fbcSettings.augmentChat) {\r\n      return;\r\n    }\r\n    const chatLogContainerId = \"TextAreaChatLog\",\r\n      // Handle chat events\r\n      handledAttributeName = \"data-bce-handled\",\r\n      unhandledChat = document.querySelectorAll(`.ChatMessage:not([${handledAttributeName}=true])`);\r\n    for (const chatMessageElement of unhandledChat) {\r\n      chatMessageElement.setAttribute(handledAttributeName, \"true\");\r\n      if (\r\n        (chatMessageElement.classList.contains(\"ChatMessageChat\") || chatMessageElement.classList.contains(\"ChatMessageWhisper\")) &&\r\n        !chatMessageElement.classList.contains(\"bce-pending\")\r\n      ) {\r\n        const scrolledToEnd = ElementIsScrolledToEnd(chatLogContainerId);\r\n        processChatAugmentsForLine(chatMessageElement, () => {\r\n          if (scrolledToEnd) {\r\n            ElementScrollToEnd(chatLogContainerId);\r\n          }\r\n        });\r\n        if (scrolledToEnd) {\r\n          ElementScrollToEnd(chatLogContainerId);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  createTimer(bceChatAugments, 500);\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings, defaultSettings } from \"../util/settings\";\r\nimport { stutterWord } from \"./chatAugments\";\r\n\r\nexport let createChatOptions: (div: HTMLDivElement) => void;\r\n\r\nexport default function antiGarbling(): void {\r\n  SDK.hookFunction(\r\n    \"ChatRoomGenerateChatRoomChatMessage\",\r\n    HOOK_PRIORITIES.Top,\r\n    ([type, msg], next) => {\r\n      if (!fbcSettings.antiGarble) return next([type, msg]);\r\n      const lastRange = SpeechGetOOCRanges(msg).pop();\r\n      if (Player.ChatSettings.OOCAutoClose && typeof lastRange === \"object\" && msg.charAt(lastRange.start + lastRange.length - 1) !== \")\" &&\r\n        lastRange.start + lastRange.length === msg.length && lastRange.length !== 1) {\r\n        msg += \")\";\r\n      }\r\n\r\n      let process: { effects: SpeechTransformName[]; text: string } = { effects: [], text: msg };\r\n      let originalMsg: string | undefined;\r\n\r\n      if (type !== \"Whisper\" || fbcSettings.antiGarbleWhisperLevel !== \"off\") {\r\n        process = SpeechTransformProcess(Player, msg, SpeechTransformSenderEffects);\r\n        const shouldBabyTalk = SpeechTransformShouldBabyTalk(Player);\r\n        const gagIntensity = SpeechTransformGagGarbleIntensity(Player);\r\n        const stutterIntensity = SpeechTransformStutterIntensity(Player);\r\n        if (gagIntensity > 0 ||\r\n          (fbcSettings[`antiGarble${type}BabyTalk`] === \"remove\" && shouldBabyTalk) ||\r\n          (fbcSettings[`antiGarble${type}Stutter`] === \"remove\" && stutterIntensity > 0)\r\n        ) {\r\n          if (Player.RestrictionSettings?.NoSpeechGarble) {\r\n            originalMsg = msg;\r\n          } else if (fbcSettings[`antiGarble${type}Level`] !== \"full\") {\r\n            originalMsg = msg;\r\n            if (fbcSettings[`antiGarble${type}BabyTalk`] === \"preserve\" && shouldBabyTalk) {\r\n              originalMsg = SpeechTransformBabyTalk(originalMsg);\r\n            }\r\n            if ([\"low\", \"medium\", \"high\"].includes(fbcSettings[`antiGarble${type}Level`])) {\r\n              const int = Math.min(gagIntensity, { low: 1, medium: 3, high: 5 }[fbcSettings[`antiGarble${type}Level`]]);\r\n              originalMsg = SpeechTransformGagGarble(originalMsg, int);\r\n            }\r\n            if (fbcSettings[`antiGarble${type}Stutter`] === \"preserve\" && stutterIntensity > 0) {\r\n              originalMsg = fbcSettings.stutters ? stutterWord(originalMsg, true).results.join(\"\") : SpeechTransformStutter(originalMsg, stutterIntensity);\r\n            }\r\n          }\r\n        }\r\n        // eslint-disable-next-line no-undefined\r\n        if (process.text === originalMsg) originalMsg = undefined;\r\n      }\r\n\r\n      const Dictionary: ChatMessageDictionary = [{ Effects: process.effects, Original: originalMsg }];\r\n      return { Content: process.text, Type: type, Dictionary };\r\n    }\r\n  );\r\n\r\n  const effectOptions = defaultSettings.antiGarbleChatBabyTalk.options;\r\n\r\n  /** Click listener for managing the baby talk button. */\r\n  function BabyTalkOnClick(this: HTMLButtonElement) {\r\n    if (this.disabled || this.getAttribute(\"aria-disabled\") === \"true\") return;\r\n    const key = this.parentElement.classList.contains(\"wce-whisper\") ? \"antiGarbleWhisperBabyTalk\" : \"antiGarbleChatBabyTalk\";\r\n    const idx = effectOptions.indexOf(fbcSettings[key]);\r\n    fbcSettings[key] = effectOptions[(idx + 1) % effectOptions.length];\r\n    resetChatButtonStates(this.id);\r\n  }\r\n\r\n  /** Click listener for managing the stutter button. */\r\n  function StutterOnClick(this: HTMLButtonElement) {\r\n    if (this.disabled || this.getAttribute(\"aria-disabled\") === \"true\") return;\r\n    const key = this.parentElement.classList.contains(\"wce-whisper\") ? \"antiGarbleWhisperStutter\" : \"antiGarbleChatStutter\";\r\n    const idx = effectOptions.indexOf(fbcSettings[key]);\r\n    fbcSettings[key] = effectOptions[(idx + 1) % effectOptions.length];\r\n    resetChatButtonStates(this.id);\r\n  }\r\n\r\n  /** Change listener for managing the garble level select. */\r\n  function GarbleOnChange(this: HTMLSelectElement) {\r\n    const key = this.parentElement.parentElement.classList.contains(\"wce-whisper\") ? \"antiGarbleWhisperLevel\" : \"antiGarbleChatLevel\";\r\n    fbcSettings[key] = this.value;\r\n    resetChatButtonStates();\r\n  }\r\n\r\n  /**\r\n   * Reset the WCE chat button state (and tooltips) to match the players `fbcSettings`\r\n   * @param id - The ID of the to-be updated button; update all buttons if ommited\r\n   */\r\n  function resetChatButtonStates(id?: string) {\r\n    type AntiGarbleKeys = \"antiGarbleChatBabyTalk\" | \"antiGarbleWhisperBabyTalk\" | \"antiGarbleChatStutter\" | \"antiGarbleWhisperStutter\";\r\n    const buttons: Record<string, { state: AntiGarbleKeys; whisperState: AntiGarbleKeys }> = {\r\n      \"wce-chat-baby-talk\": { state: \"antiGarbleChatBabyTalk\", whisperState: \"antiGarbleWhisperBabyTalk\" },\r\n      \"wce-chat-stutters\": { state: \"antiGarbleChatStutter\", whisperState: \"antiGarbleWhisperStutter\" },\r\n    };\r\n    const div = document.getElementById(\"chat-room-buttons\") as null | HTMLDivElement;\r\n    const isWhisper = div.classList.contains(\"wce-whisper\");\r\n    const select = document.getElementById(\"wce-chat-garble\") as null | HTMLSelectElement;\r\n\r\n    if (!id) {\r\n      const tooltip = document.getElementById(select?.getAttribute(\"aria-describedby\")) as null | HTMLDivElement;\r\n      if (select && tooltip) {\r\n        const key = isWhisper ? \"antiGarbleWhisperLevel\" : \"antiGarbleChatLevel\";\r\n        select.value = fbcSettings[key];\r\n        select.dataset.state = fbcSettings[key];\r\n        tooltip.innerText = `${isWhisper ? \"Whisper\" : \"Chat\"} garble level: ${fbcSettings[key]}`;\r\n      }\r\n    }\r\n\r\n    const garbleIsFull = [\"full\", \"off\"].includes(select?.value);\r\n    const entries = id ? [[id, buttons[id]] as const] : Object.entries(buttons);\r\n    for (const [buttonId, { state, whisperState }] of entries) {\r\n      const button = document.getElementById(buttonId) as null | HTMLButtonElement;\r\n      const tooltip = document.getElementById(button?.getAttribute(\"aria-describedby\")) as null | HTMLDivElement;\r\n      if (button && tooltip) {\r\n        const key = isWhisper ? whisperState : state;\r\n        button.dataset.state = fbcSettings[key];\r\n        tooltip.innerText = `${isWhisper ? \"Whisper\" : \"Chat\"} ${buttonId === \"wce-chat-stutters\" ? \"stutters\" : \"baby talk\"}: ${fbcSettings[key]}`;\r\n        button.setAttribute(\"aria-disabled\", garbleIsFull);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Set or remove the .wce-whisper css class on all WCE chat room buttoms and update their tooltip */\r\n  function whisperUpdate(isWhisper: boolean) {\r\n    const div = document.getElementById(\"chat-room-buttons\") as null | HTMLDivElement;\r\n    if (!div) return;\r\n    if (isWhisper && !div.classList.contains(\"wce-whisper\")) {\r\n      div.classList.add(\"wce-whisper\");\r\n      resetChatButtonStates();\r\n    } else if (!isWhisper && div.classList.contains(\"wce-whisper\")) {\r\n      div.classList.remove(\"wce-whisper\");\r\n      resetChatButtonStates();\r\n    }\r\n  }\r\n\r\n  createChatOptions = function(div: HTMLDivElement) {\r\n    // Only add the WCE chat room buttons if they do not yet exist\r\n    const buttonGrid: null | HTMLDivElement = div?.querySelector(\"#chat-room-buttons\");\r\n    if (buttonGrid && !buttonGrid.querySelector(\".wce-chat-room-button\")) {\r\n      ElementMenu.PrependItem(buttonGrid, ElementCreate({\r\n        tag: \"div\",\r\n        style: { display: \"none\" },\r\n        classList: [\"wce-chat-room-select-div\", \"wce-chat-room-button\"],\r\n        children: [\r\n          {\r\n            tag: \"label\",\r\n            attributes: { id: \"wce-chat-garble-label\", for: \"wce-chat-garble\" },\r\n          },\r\n          {\r\n            tag: \"select\",\r\n            attributes: { id: \"wce-chat-garble\", \"aria-describedby\": \"wce-chat-garble-tooltip\" },\r\n            classList: [\"wce-chat-room-select\"],\r\n            eventListeners: { change: GarbleOnChange },\r\n            children: defaultSettings.antiGarbleWhisperLevel.options.map(option => ({\r\n              tag: \"option\",\r\n              attributes: { value: option },\r\n              children: [option],\r\n            })),\r\n          },\r\n          {\r\n            tag: \"div\",\r\n            attributes: { id: \"wce-chat-garble-tooltip\", role: \"tooltip\" },\r\n            classList: [\"button-tooltip\", \"button-tooltip-left\"],\r\n            children: [],\r\n          },\r\n        ],\r\n      }));\r\n      ElementMenu.AppendButton(buttonGrid, ElementButton.Create(\r\n        \"wce-chat-baby-talk\",\r\n        BabyTalkOnClick,\r\n        { noStyling: true },\r\n        { button: { classList: [\"chat-room-button\", \"wce-chat-room-button\"], style: { display: \"none\" } } }\r\n      ));\r\n      ElementMenu.AppendButton(buttonGrid, ElementButton.Create(\r\n        \"wce-chat-stutters\",\r\n        StutterOnClick,\r\n        { noStyling: true },\r\n        { button: { classList: [\"chat-room-button\", \"wce-chat-room-button\"], style: { display: \"none\" } } }\r\n      ));\r\n      resetChatButtonStates();\r\n    }\r\n  };\r\n\r\n  let registeredChatInputListener = false;\r\n  // Attach extra DOM buttons to the chat button grid for managing stuttering, garbling and babytalk\r\n  SDK.hookFunction(\r\n    \"ChatRoomCreateElement\",\r\n    HOOK_PRIORITIES.ModifyBehaviourHigh,\r\n    (args, next) => {\r\n      if (!fbcSettings.antiGarbleChatOptions) return next(args);\r\n      // Event listener for attaching the .wce-whisper css class to the chat buttons while whispering\r\n      // Make sure this is only done the very first time the input chat is created\r\n      if (!registeredChatInputListener) {\r\n        const chatInput = document.getElementById(\"InputChat\") as null | HTMLInputElement;\r\n        const chatButtonArrow = document.getElementById(\"chat-room-buttons-collapse\") as null | HTMLButtonElement;\r\n        if (chatInput && chatButtonArrow) {\r\n          chatInput.addEventListener(\"input\", function WceInputChatListener() {\r\n            const isWhisper = this.value.startsWith(\"/w \") || this.value.startsWith(\"/whisper \");\r\n            whisperUpdate(isWhisper);\r\n          });\r\n          chatButtonArrow.addEventListener(\"click\", (e) => {\r\n            ChatRoomChatInputChangeHandler.call(chatInput, e);\r\n          });\r\n          registeredChatInputListener = true;\r\n        }\r\n      }\r\n      const div = next(args);\r\n      createChatOptions(div);\r\n      return div;\r\n    }\r\n  );\r\n\r\n  // Attach the .wce-whisper css class to the wce chat buttons while whispering\r\n  SDK.hookFunction(\r\n    \"ChatRoomSetTarget\",\r\n    HOOK_PRIORITIES.ModifyBehaviourHigh,\r\n    ([memberNumer, ...args], next) => {\r\n      const isWhisper = Number.isInteger(memberNumer) && memberNumer !== -1;\r\n      whisperUpdate(isWhisper);\r\n      return next([memberNumer, ...args]);\r\n    }\r\n  );\r\n\r\n  ChatRoomRegisterMessageHandler({\r\n    Description: \"show OriginalMsg while deafened\",\r\n    Priority: 90,\r\n    Callback: (data, _, msg, metadata) => {\r\n      if (data.Type === \"Chat\" && fbcSettings.antiDeaf && Player.GetDeafLevel() > 0 && !metadata.OriginalMsg) {\r\n        metadata.OriginalMsg = msg;\r\n      }\r\n      return false;\r\n    },\r\n  });\r\n\r\n  if (CurrentScreen === \"ChatRoom\") ChatRoomResize(false);\r\n}\r\n","import { sendHello } from \"../functions/hiddenMessageHandler\";\r\nimport { toySyncState, type FBCToySetting } from \"../functions/toySync\";\r\nimport { fbcBeepNotify } from \"./hooks\";\r\nimport { debug, logInfo, logWarn, logError } from \"./logger\";\r\nimport {\r\n  waitFor,\r\n  sleep,\r\n  isString,\r\n  parseJSON,\r\n  isNonNullObject,\r\n  removeCustomEffect,\r\n  enableLeashing,\r\n  disableLeashing,\r\n} from \"./utils\";\r\nimport { loadExtendedWardrobe, loadLocalWardrobe } from \"../functions/extendedWardrobe\";\r\nimport {\r\n  settingsVersion,\r\n  fbcChangelog,\r\n  DEFAULT_WARDROBE_SIZE,\r\n  EXPANDED_WARDROBE_SIZE,\r\n  LOCAL_WARDROBE_SIZE,\r\n  BCE_MAX_AROUSAL,\r\n  BCE_COLOR_ADJUSTMENTS_CLASS_NAME,\r\n  // DISCORD_INVITE_URL,\r\n} from \"./constants\";\r\nimport { displayText } from \"./localization\";\r\nimport { augmentedChatNotify } from \"../functions/chatAugments\";\r\nimport { createChatOptions } from \"../functions/antiGarbling\";\r\n\r\ndeclare global {\r\n  interface PlayerOnlineSettings {\r\n    /** @deprecated */ BCE: string;\r\n    /** @deprecated */ BCEWardrobe: string;\r\n  }\r\n  interface CharacterOnlineSharedSettings {\r\n    Uwall: boolean;\r\n    Ulist: number[];\r\n  }\r\n}\r\n\r\nexport type SettingsCategory = \"chat\" | \"activities\" | \"appearance\" | \"immersion\" | \"antigarble\" | \"performance\" | \"misc\" | \"cheats\" | \"buttplug\";\r\ntype SideEffects<Type> = (newValue: Type, init: boolean) => void;\r\nexport interface CheckboxSetting {\r\n  label: string;\r\n  type: \"checkbox\";\r\n  value: boolean;\r\n  disabled: () => boolean | null;\r\n  sideEffects: SideEffects<boolean>;\r\n  category: SettingsCategory | \"hidden\";\r\n  description: string;\r\n}\r\nexport interface SelectSetting {\r\n  label: string;\r\n  type: \"select\";\r\n  value: string;\r\n  options: string[];\r\n  tooltips: string[];\r\n  disabled: () => boolean | null;\r\n  sideEffects: SideEffects<string>;\r\n  category: SettingsCategory | \"hidden\";\r\n  description: string;\r\n}\r\nexport interface InputSetting {\r\n  label: string;\r\n  type: \"input\";\r\n  value: string;\r\n  disabled: () => boolean | null;\r\n  sideEffects: SideEffects<string>;\r\n  category: SettingsCategory | \"hidden\";\r\n  description: string;\r\n}\r\ndeclare global {\r\n  interface ExtensionSettings {\r\n    FBC: string;\r\n    FBCWardrobe: string;\r\n    WCEOverrides: string;\r\n  }\r\n}\r\n\r\n// @ts-ignore -- this is fully initialized in loadSettings\r\nexport let fbcSettings: { [Property in keyof (typeof defaultSettings)]: (typeof defaultSettings)[Property][\"value\"] } & { version: number } = {};\r\nlet postSettingsHasRun = false;\r\n\r\nexport const defaultSettings = {\r\n  animationEngine: {\r\n    label: \"Animation Engine\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      if (newValue && Player.ArousalSettings) {\r\n        // Disable conflicting settings\r\n        Player.ArousalSettings.AffectExpression = false;\r\n      }\r\n      if (!newValue) {\r\n        fbcSettings.expressions = false;\r\n        fbcSettings.activityExpressions = false;\r\n      }\r\n      debug(\"animationEngine\", newValue);\r\n    },\r\n    category: \"activities\",\r\n    description: \"Enables the animation engine. This will replace the game's expression and pose system.\",\r\n  },\r\n  expressions: {\r\n    label: \"Automatic Arousal Expressions (Replaces Vanilla)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => !fbcSettings.animationEngine,\r\n    sideEffects: (newValue) => {\r\n      debug(\"expressions\", newValue);\r\n    },\r\n    category: \"activities\",\r\n    description: \"Automatically express arousal when performing an activity (requires Animation Engine).\",\r\n  },\r\n  activityExpressions: {\r\n    label: \"Activity Expressions\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => !fbcSettings.animationEngine,\r\n    sideEffects: (newValue) => {\r\n      debug(\"activityExpressions\", newValue);\r\n    },\r\n    category: \"activities\",\r\n    description: \"Automatically express reactions to certain activities (requires Animation Engine).\",\r\n  },\r\n  alternateArousal: {\r\n    label: \"Alternate Arousal (Replaces Vanilla, requires hybrid/locked arousal meter)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      sendHello();\r\n      Player.BCEArousal = !!newValue;\r\n      Player.BCEArousalProgress = Math.min(BCE_MAX_AROUSAL, Player.ArousalSettings?.Progress ?? 0);\r\n      debug(\"alternateArousal\", newValue);\r\n    },\r\n    category: \"activities\",\r\n    description: \"More intense activities will affect arousal faster.\",\r\n  },\r\n  stutters: {\r\n    label: \"Alternative speech stutter\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"stutters\", newValue);\r\n    },\r\n    category: \"activities\",\r\n    description: \"More stuttering at high arousal, moans between words with vibrators.\",\r\n  },\r\n  numericArousalMeter: {\r\n    label: \"Show numeric arousal meter\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"numericArousalMeter\", newValue);\r\n    },\r\n    category: \"activities\",\r\n    description: \"Shows the numeric value of arousal meters when expanded.\",\r\n  },\r\n  layeringHide: {\r\n    label: \"[Beta] Allow configuring layer hiding in layering menu\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"layeringHide\", newValue);\r\n    },\r\n    category: \"appearance\",\r\n    description: \"Allows you to configure which lower layers an item should hide or not (changes only visible to other WCE players).\",\r\n  },\r\n  copyColor: {\r\n    label: \"Enable option to copy color to all item's of the same type\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"copyColor\", newValue);\r\n    },\r\n    category: \"appearance\",\r\n    description: \"Enable option to copy color to all item's of the same type.\",\r\n  },\r\n  extendedWardrobe: {\r\n    label: \"Extended wardrobe slots (96)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"extendedWardrobe\", newValue);\r\n      if (newValue) {\r\n        if (Player.Wardrobe) {\r\n          WardrobeSize = EXPANDED_WARDROBE_SIZE;\r\n          loadExtendedWardrobe(Player.Wardrobe);\r\n          // Call compress wardrobe to save existing outfits, if another addon has extended the wardrobe\r\n          CharacterCompressWardrobe(Player.Wardrobe);\r\n        } else {\r\n          logWarn(\"Player.Wardrobe not found, skipping wardrobe extension\");\r\n        }\r\n      } else {\r\n        // Restore original size\r\n        fbcSettings.localWardrobe = false;\r\n        WardrobeSize = DEFAULT_WARDROBE_SIZE;\r\n        WardrobeFixLength();\r\n        CharacterAppearanceWardrobeOffset = 0;\r\n      }\r\n    },\r\n    category: \"appearance\",\r\n    description: \"Increase the amount of wardrobe slots to save more outfits.\",\r\n  },\r\n  localWardrobe: {\r\n    label: \"Local Wardrobe (+288)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => !fbcSettings.extendedWardrobe,\r\n    sideEffects: (newValue) => {\r\n      debug(\"localWardrobe\", newValue);\r\n      if (newValue) {\r\n        if (Player.Wardrobe) {\r\n          WardrobeSize = LOCAL_WARDROBE_SIZE;\r\n          loadLocalWardrobe(Player.Wardrobe);\r\n          // Call compress wardrobe to save existing outfits, if another addon has extended the wardrobe\r\n          CharacterCompressWardrobe(Player.Wardrobe);\r\n        } else {\r\n          logWarn(\"Player.Wardrobe not found, skipping wardrobe extension\");\r\n        }\r\n      } else if (fbcSettings.extendedWardrobe) {\r\n        // Restore original size\r\n        WardrobeSize = EXPANDED_WARDROBE_SIZE;\r\n        WardrobeFixLength();\r\n        CharacterAppearanceWardrobeOffset = 0;\r\n      }\r\n    },\r\n    category: \"appearance\",\r\n    description: \"Enables the Local Wardrobe - save 288 additional outfits on your device (not synced between devices, but shared between alts on the same device).\",\r\n  },\r\n  privateWardrobe: {\r\n    label: \"Replace wardrobe list with character previews\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"privateWardrobe\", newValue);\r\n    },\r\n    category: \"appearance\",\r\n    description: \"Allows you to preview all saved outfits at a glance, no more having to remember names.\",\r\n  },\r\n  confirmWardrobeSave: {\r\n    label: \"Confirm overriding wardrobe outfits\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"confirmWardrobeSave\", newValue);\r\n    },\r\n    category: \"appearance\",\r\n    description: \"When saving over an already existing wardrobe outfit you'll ask for confirmation, preventing accidentally overwriting outfits.\",\r\n  },\r\n  automateCacheClear: {\r\n    label: \"Clear Drawing Cache Hourly\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"automateCacheClear\", newValue);\r\n    },\r\n    category: \"performance\",\r\n    description:\r\n      \"Automatically clears the drawing cache every hour, preventing memory usage from growing out of control during long play sessions.\",\r\n  },\r\n  manualCacheClear: {\r\n    label: \"Adds a clear / reload drawing cache button\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"manualCacheClear\", newValue);\r\n    },\r\n    category: \"performance\",\r\n    description:\r\n      \"Adds a button to the chat room menu to clear and reload the drawing cache of all characters, helping to fix buged / non-loaded assets.\",\r\n  },\r\n  instantMessenger: {\r\n    label: \"Instant messenger\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"instantMessenger\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description:\r\n      \"Allows you to send messages to other players without having to open the friends list, with enhancements.\",\r\n  },\r\n  augmentChat: {\r\n    label: \"Chat Links and Embeds\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"augmentChat\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Adds clickable links and image embeds from trusted domains only (e.g. imgur) to chat messages.\",\r\n  },\r\n  ctrlEnterOoc: {\r\n    label: \"Use Ctrl+Enter to OOC\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"ctrlEnterOoc\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Allows you to use Ctrl+Enter to send OOC messages.\",\r\n  },\r\n  whisperInput: {\r\n    label: \"Use italics for input when whispering\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"whisperInput\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Changes the input field to italics when you're in whisper mode to make it more obvious.\",\r\n  },\r\n  chatColors: {\r\n    label: \"Improve colors for readability\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      if (newValue) {\r\n        document.body.classList.add(BCE_COLOR_ADJUSTMENTS_CLASS_NAME);\r\n      } else {\r\n        document.body.classList.remove(BCE_COLOR_ADJUSTMENTS_CLASS_NAME);\r\n      }\r\n      debug(\"chatColors\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description:\r\n      \"Improves contrast between the colors used for chat messages to comply with web accessibility standards.\",\r\n  },\r\n  friendPresenceNotifications: {\r\n    label: \"Show friend presence notifications\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"friendPresenceNotifications\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Enables friend presence tracking and shows a notification when a friend logs in.\",\r\n  },\r\n  friendOfflineNotifications: {\r\n    label: \"Show friends going offline too\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"friendOfflineNotifications\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Shows a notification when a friend logs out. (Requires friend presence)\",\r\n  },\r\n  friendNotificationsInChat: {\r\n    label: \"Show friend presence notifications in chat, when possible\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"friendNotificationsInChat\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Shows friend presence notifications in chat, when possible. (Requires friend presence)\",\r\n  },\r\n  pastProfiles: {\r\n    label: \"Save & browse seen profiles (requires refresh)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"pastProfiles\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description:\r\n      \"Saves the profiles for everyone you've seen and allows you to browse them using /profiles in chatrooms.\",\r\n  },\r\n  pendingMessages: {\r\n    label: \"Show sent messages while waiting for server\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"showSentMessages\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description:\r\n      \"Shows messages you've sent while waiting for the server to respond, confirming you have sent the message and the server is just being slow.\",\r\n  },\r\n  richOnlineProfile: {\r\n    label: \"Rich online profile\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"richOnlineProfile\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Changes the online profile to support clickable links and embedded images.\",\r\n  },\r\n  whisperTargetFixes: {\r\n    label: \"Improved whisper target handling\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"whisperTargetFixes\", newValue);\r\n    },\r\n    category: \"chat\",\r\n    description: \"Automatically reset whisper target if they leave the room for more than one minute and after the first invalid whisper target warning message.\",\r\n  },\r\n  antiGarble: {\r\n    label: \"Anti Garble\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue, init) => {\r\n      if (!newValue) {\r\n        fbcSettings.antiGarbleChatOptions = false;\r\n        defaultSettings.antiGarbleChatOptions.sideEffects(false, init);\r\n        fbcSettings.antiGarbleChatLevel = \"full\";\r\n        fbcSettings.antiGarbleChatBabyTalk = \"preserve\";\r\n        fbcSettings.antiGarbleChatStutter = \"preserve\";\r\n        fbcSettings.antiGarbleWhisperLevel = \"full\";\r\n        fbcSettings.antiGarbleWhisperBabyTalk = \"preserve\";\r\n        fbcSettings.antiGarbleWhisperStutter = \"preserve\";\r\n      } else if (!init) {\r\n        fbcSettings.antiGarbleChatOptions = true;\r\n        defaultSettings.antiGarbleChatOptions.sideEffects(true, init);\r\n        fbcSettings.antiGarbleChatLevel = \"none\";\r\n        fbcSettings.antiGarbleChatBabyTalk = \"remove\";\r\n        fbcSettings.antiGarbleChatStutter = \"ignore\";\r\n        fbcSettings.antiGarbleWhisperLevel = \"none\";\r\n        fbcSettings.antiGarbleWhisperBabyTalk = \"remove\";\r\n        fbcSettings.antiGarbleWhisperStutter = \"ignore\";\r\n      }\r\n      debug(\"antiGarble\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description:\r\n      \"Enables the anti-garble system. Allowing you to send less garbled version of your messages together with the garbled one to others, who could read it in brackets.\",\r\n  },\r\n  antiGarbleChatOptions: {\r\n    label: \"Anti Garble chat options\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => !fbcSettings.antiGarble,\r\n    sideEffects: (newValue, init) => {\r\n      debug(\"antiGarbleChatoptions\", newValue);\r\n      if (!init && newValue) {\r\n        createChatOptions(document.getElementById(\"chat-room-div\") as HTMLDivElement);\r\n      } else if (!init) {\r\n        document.querySelectorAll(\".wce-chat-room-button\").forEach(e => e.remove());\r\n      }\r\n    },\r\n    category: \"antigarble\",\r\n    description: \"Adds quick options for your anti-garble settings to the chat input menu.\",\r\n  },\r\n  antiGarbleChatLevel: {\r\n    label: \"Chat garble level:\",\r\n    type: \"select\",\r\n    value: \"none\",\r\n    options: [\"none\", \"low\", \"medium\", \"high\", \"full\"],\r\n    tooltips: [\r\n      \"Chat garble level: none (send a fully ungarbled message to the recipient, shown in brackets)\",\r\n      \"Chat garble level: low (send a partly ungarbled message, which is only garbled up to the low garbel level 1)\",\r\n      \"Chat garble level: medium (send a partly ungarbled message, which is only garbled up to the medium garbel level 3)\",\r\n      \"Chat garble level: high (send a partly ungarbled message, which is only garbled up to the high garbel level 5)\",\r\n      \"Chat garble level: full (always only sends the full garbled message, no ungarbled message in brackets)\",\r\n    ],\r\n    disabled: () => !fbcSettings.antiGarble,\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiGarbleChatLevel\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description:\r\n      \"Sends an ungarbled (or lower garbled up to the selected value) chat message together with the garbled messages, which is shown on the recipient side in brackets (defaults to full = no ungarbling).\",\r\n  },\r\n  antiGarbleChatStutter: {\r\n    label: \"Chat stutters:\",\r\n    type: \"select\",\r\n    value: \"preserve\",\r\n    options: [\"remove\", \"ignore\", \"preserve\"],\r\n    tooltips: [\r\n      \"Chat stutters: remove (always remove chat stutters, even if it is the only effect)\",\r\n      \"Chat stutters: ignore (remove chat stutters if ungarbling gag speech, but ignore it if it's the only effect)\",\r\n      \"Chat stutters: preserve (always preserve chat stutters in the ungarbled text in brackets)\",\r\n    ],\r\n    disabled: () => !fbcSettings.antiGarble || fbcSettings.antiGarbleChatLevel === \"full\",\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiGarbleChatoptions\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description: \"Controls if stutters in chat messages are always removed, ignored (only removed if other ungarbling applied) or preserved.\",\r\n  },\r\n  antiGarbleChatBabyTalk: {\r\n    label: \"Chat baby talk:\",\r\n    type: \"select\",\r\n    value: \"preserve\",\r\n    options: [\"remove\", \"ignore\", \"preserve\"],\r\n    tooltips: [\r\n      \"Chat baby talk: remove (always remove chat baby talk, even if it is the only effect)\",\r\n      \"Chat baby talk: ignore (remove chat baby talk if ungarbling gag speech, but ignore it if it's the only effect)\",\r\n      \"Chat baby talk: preserve (always preserve chat baby talk in the ungarbled text in brackets)\",\r\n    ],\r\n    disabled: () => !fbcSettings.antiGarble || fbcSettings.antiGarbleChatLevel === \"full\",\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiGarbleChatBabyTalk\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description: \"Controls if baby talk in chat messages is always removed, ignored (only removed if other ungarbling applied) or preserved.\",\r\n  },\r\n  antiGarbleWhisperLevel: {\r\n    label: \"Whisper garble level:\",\r\n    type: \"select\",\r\n    value: \"none\",\r\n    options: [\"none\", \"low\", \"medium\", \"high\", \"full\", \"off\"],\r\n    tooltips: [\r\n      \"Whisper garble level: none (send a fully ungarbled whisper to the recipient, shown in brackets)\",\r\n      \"Whisper garble level: low (send a partly ungarbled whisper, which is only garbled up to the low garbel level 1)\",\r\n      \"Whisper garble level: medium (send a partly ungarbled whisper, which is only garbled up to the medium garbel level 3)\",\r\n      \"Whisper garble level: high (send a partly ungarbled whisper, which is only garbled up to the high garbel level 5)\",\r\n      \"Whisper garble level: full (always only sends the full garbled whisper, no ungarbled message in brackets)\",\r\n      \"Whisper garble level: off (don't garble whisper messages at all, normal message is ungarbled, no message in brackets)\",\r\n    ],\r\n    disabled: () => !fbcSettings.antiGarble,\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiGarbleWhisperLevel\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description:\r\n      \"Sends an ungarbled (or lower garbled) whisper message together with the garbled messages, which is shown on the recipient side in brackets. (off = only sending the ungarbled messages as the original).\",\r\n  },\r\n  antiGarbleWhisperStutter: {\r\n    label: \"Whispers stutters:\",\r\n    type: \"select\",\r\n    value: \"preserve\",\r\n    options: [\"remove\", \"ignore\", \"preserve\"],\r\n    tooltips: [\r\n      \"Whispers stutters: remove (always remove whispers stutters, even if it is the only effect)\",\r\n      \"Whispers stutters: ignore (remove whispers stutters if ungarbling gag speech, but ignore it if it's the only effect)\",\r\n      \"Whispers stutters: preserve (always preserve whispers stutters in the ungarbled text in brackets)\",\r\n    ],\r\n    disabled: () => !fbcSettings.antiGarble || [\"off\", \"full\"].includes(fbcSettings.antiGarbleWhisperLevel),\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiGarbleWhisperStutter\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description: \"Controls if stutters in whispers are always removed, ignored (only removed if other ungarbling applied) or preserved.\",\r\n  },\r\n  antiGarbleWhisperBabyTalk: {\r\n    label: \"Whispers baby talk:\",\r\n    type: \"select\",\r\n    value: \"preserve\",\r\n    options: [\"remove\", \"ignore\", \"preserve\"],\r\n    tooltips: [\r\n      \"Whispers baby talk: remove (always remove whispers baby talk, even if it is the only effect)\",\r\n      \"Whispers baby talk: ignore (remove whispers baby talk if ungarbling gag speech, but ignore it if it's the only effect)\",\r\n      \"Whispers baby talk: preserve (always preserve whispers baby talk in the ungarbled text in brackets)\",\r\n    ],\r\n    disabled: () => !fbcSettings.antiGarble || [\"off\", \"full\"].includes(fbcSettings.antiGarbleWhisperLevel),\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiGarbleWhisperBabyTalk\", newValue);\r\n    },\r\n    category: \"antigarble\",\r\n    description: \"Controls if baby talk in whispers is always removed, ignored (only removed if other ungarbling applied) or preserved.\",\r\n  },\r\n  lockpick: {\r\n    label: \"Reveal Lockpicking Order Based on Skill\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"lockpick\", newValue);\r\n    },\r\n    category: \"cheats\",\r\n    description:\r\n      \"Randomly reveals the order of some of the pins with higher lockpicking skill revealing more pins on average. Picking can still be impossible like other forms of struggling.\",\r\n  },\r\n  allowLayeringWhileBound: {\r\n    label: \"Allow layering menus while bound\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"allowLayeringWhileBound\", newValue);\r\n    },\r\n    category: \"cheats\",\r\n    description: \"Allows you to open menus while bound, even if they're disabled in the settings.\",\r\n  },\r\n  autoStruggle: {\r\n    label: \"Make automatic progress while struggling\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"autoStruggle\", newValue);\r\n    },\r\n    category: \"cheats\",\r\n    description:\r\n      \"All three forms of struggling will be completed automatically in a realistic amount of time, if the restraint is possible to struggle out of.\",\r\n  },\r\n  allowIMBypassBCX: {\r\n    label: \"Allow IMs to bypass BCX beep restrictions\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"allowIMBypassBCX\", newValue);\r\n    },\r\n    category: \"cheats\",\r\n    description: \"This setting is temporary until BCX supports a focus mode rule.\",\r\n  },\r\n  antiDeaf: {\r\n    label: \"Anti Deafen\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiDeaf\", newValue);\r\n    },\r\n    category: \"cheats\",\r\n    description: \"Show original messages in brackets while deafened.\",\r\n  },\r\n  toySync: {\r\n    label: \"Enable buttplug.io (requires refresh)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"toySync\", newValue);\r\n    },\r\n    category: \"buttplug\",\r\n    description:\r\n      \"Allows the game to control your real vibrators. For a list of supported vibrators see https://buttplug.io\",\r\n  },\r\n  blindWithoutGlasses: {\r\n    label: \"Require glasses to see\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      if (!newValue) {\r\n        removeCustomEffect(\"BlurLight\");\r\n      }\r\n      debug(\"blindWithoutGlasses\", newValue);\r\n    },\r\n    category: \"immersion\",\r\n    description: \"You will be partially blinded while not wearing glasses.\",\r\n  },\r\n  leashAlways: {\r\n    label: \"Allow leashing without wearing a leashable item (requires leasher to have WCE too)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"leashAlways\", newValue);\r\n      if (newValue) {\r\n        enableLeashing();\r\n      } else {\r\n        disableLeashing();\r\n      }\r\n    },\r\n    category: \"immersion\",\r\n    description:\r\n      \"Allows you to be leashed between rooms even when you are not wearing an item that counts as a leash to allow roleplaying being carried in arms.\",\r\n  },\r\n  hideHiddenItemsIcon: {\r\n    label: \"Hide the hidden items icon\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"hideHiddenItemsIcon\", newValue);\r\n    },\r\n    category: \"immersion\",\r\n    description:\r\n      \"You can choose to hide items (not on extreme difficulty). The game shows an icon on players that have hidden items. This option hides that icon.\",\r\n  },\r\n  itemAntiCheat: {\r\n    label: \"Enable anti-cheat\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"itemAntiCheat\", newValue);\r\n    },\r\n    category: \"immersion\",\r\n    description:\r\n      \"Prevents certain console cheats from impacting your character. Whitelisted actors are exempt from this.\",\r\n  },\r\n  antiCheatBlackList: {\r\n    label: \"Blacklist detected cheaters automatically\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"antiCheatBlackList\", newValue);\r\n    },\r\n    category: \"immersion\",\r\n    description: \"Automatically blacklist detected cheaters. Whitelisted actors are exempt from this.\",\r\n  },\r\n  uwall: {\r\n    label: \"Enable uwall anti-cheat\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"uwall\", newValue);\r\n      if (Player?.OnlineSharedSettings && typeof newValue === \"boolean\") {\r\n        Player.OnlineSharedSettings.Uwall = newValue;\r\n        ServerAccountUpdate.QueueData({ OnlineSharedSettings: Player.OnlineSharedSettings });\r\n      } else {\r\n        logWarn(\"Player.OnlineSharedSettings not found, skipping uwall\");\r\n      }\r\n    },\r\n    category: \"immersion\",\r\n    description: \"Prevents certain other addon cheats from impacting your character.\",\r\n  },\r\n  preventLayeringByOthers: {\r\n    label: \"Prevents other players from using layering on you\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue, init) => {\r\n      debug(\"preventLayeringByOthers\", newValue);\r\n      if (!init) sendHello();\r\n    },\r\n    category: \"immersion\",\r\n    description: \"Prevents other WCE players to make Layering based changes to your character.\",\r\n  },\r\n  relogin: {\r\n    label: \"Automatic Relogin on Disconnect\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"relogin\", newValue);\r\n    },\r\n    category: \"misc\",\r\n    description:\r\n      \"Automatically re-enter your password after you disconnect from the game. For convenience or AFK. Requires the password for the current account to have been saved in the login screen. Passwords are saved in your browser's local storage in plain text.\",\r\n  },\r\n  ghostNewUsers: {\r\n    label: \"Automatically ghost+blocklist unnaturally new users\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"ghostNewUsers\", newValue);\r\n    },\r\n    category: \"misc\",\r\n    description:\r\n      \"Automatically ghost+blocklist unnaturally new users. This is useful for preventing malicious bots, but is not recommended to be enabled normally.\",\r\n  },\r\n  confirmLeave: {\r\n    label: \"Confirm leaving the game\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"confirmLeave\", newValue);\r\n    },\r\n    category: \"misc\",\r\n    description:\r\n      \"When you leave the game, you will be prompted to confirm your decision. This is useful for preventing accidentally closing the tab, but will cause you to reconnect.\",\r\n  },\r\n  discreetMode: {\r\n    label: \"Discreet mode (disable drawing)\",\r\n    type: \"checkbox\",\r\n    value: false,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"discreetMode\", newValue);\r\n      if (newValue) {\r\n        (document.getElementById(\"favicon\") as HTMLLinkElement).href =\r\n          \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9oFFAADATTAuQQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAEklEQVQ4y2NgGAWjYBSMAggAAAQQAAGFP6pyAAAAAElFTkSuQmCC\";\r\n        document.title = \"OnlineChat\";\r\n      }\r\n    },\r\n    category: \"misc\",\r\n    description: \"Disables drawing on the screen. This is useful for preventing accidental drawing.\",\r\n  },\r\n  customContentDomainCheck: {\r\n    label: \"Prompt before loading content from a 3rd party domain\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"customContentDomainCheck\", newValue);\r\n    },\r\n    category: \"misc\",\r\n    description: \"Show a confirmation prompt before allowing content from a 3rd party domain to be loaded.\",\r\n  },\r\n  shareAddons: {\r\n    label: \"Share Addons\",\r\n    type: \"checkbox\",\r\n    value: true,\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"shareAddons\", newValue);\r\n    },\r\n    category: \"misc\",\r\n    description:\r\n      \"Share a list of your installed addons with other WCE users in the room, visible via /versions chat command.\",\r\n  },\r\n  buttplugDevices: {\r\n    label: \"Buttplug Devices\",\r\n    type: \"input\",\r\n    value: \"\",\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"buttplugDevices\", newValue);\r\n      // Don't handle empty string\r\n      if (newValue === \"\") {\r\n        return;\r\n      }\r\n      try {\r\n        if (!isString(newValue)) {\r\n          throw new Error(\"expected string for buttplugDevices\");\r\n        }\r\n        const devices: FBCToySetting[] = parseJSON(newValue);\r\n        if (!Array.isArray(devices)) {\r\n          throw new Error(\"expected array for devices\");\r\n        }\r\n        for (const device of devices) {\r\n          toySyncState.deviceSettings.set(device.Name, device);\r\n        }\r\n      } catch (ex) {\r\n        logError(ex);\r\n      }\r\n    },\r\n    category: \"hidden\",\r\n    description: \"\",\r\n  },\r\n  toySyncAddress: {\r\n    label: \"Intiface Address\",\r\n    type: \"input\",\r\n    value: \"ws://127.0.0.1:12345\",\r\n    disabled: () => false,\r\n    sideEffects: (newValue) => {\r\n      debug(\"toySyncAddress\", newValue);\r\n    },\r\n    category: \"hidden\",\r\n    description: \"\",\r\n  },\r\n};\r\n\r\nexport function settingsLoaded(): boolean {\r\n  return postSettingsHasRun;\r\n}\r\n\r\nfunction bceSettingKey(): string {\r\n  return `bce.settings.${Player?.AccountName}`;\r\n}\r\n\r\nexport async function bceLoadSettings(): Promise<void> {\r\n  await waitFor(() => !!Player?.AccountName);\r\n  const key = bceSettingKey();\r\n  debug(\"loading settings\");\r\n  if (Object.keys(fbcSettings).length === 0) {\r\n    let settings: typeof fbcSettings | null = parseJSON(localStorage.getItem(key));\r\n    const onlineSettings: typeof fbcSettings | null = parseJSON(LZString.decompressFromBase64(\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n      Player.ExtensionSettings.FBC || (Player.OnlineSettings?.BCE ?? \"\")\r\n    ) || null);\r\n    if (!onlineSettings) {\r\n      logWarn(\"No online settings found\");\r\n      debug(\"onlineSettings\", Player.OnlineSettings);\r\n      debug(\"extensionSettings\", Player.ExtensionSettings);\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n    if (Player.OnlineSettings?.BCE) {\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n      Player.ExtensionSettings.FBC = Player.OnlineSettings.BCE;\r\n      ServerPlayerExtensionSettingsSync(\"FBC\");\r\n      logInfo(\"Migrated online settings to extension settings\");\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n      delete Player.OnlineSettings.BCE;\r\n    }\r\n    const localVersion = settings?.version || 0;\r\n    if (onlineSettings && onlineSettings.version >= localVersion) {\r\n      logInfo(\"using online settings\");\r\n      settings = onlineSettings;\r\n    }\r\n    if (!isNonNullObject(settings)) {\r\n      debug(\"no settings\", key);\r\n      fbcBeepNotify(\r\n        \"Welcome to WCE\",\r\n        `Welcome to Wholesome Club Extensions v${globalThis.FBC_VERSION}! As this is your first time using WCE on this account, you may want to check out the settings page for some options to customize your experience. You can find it in the game preferences. Enjoy!` // In case of problems, you can contact us via Discord at ${DISCORD_INVITE_URL}`\r\n      );\r\n      // @ts-expect-error -- this is fully populated in the loop below\r\n      settings = {};\r\n    }\r\n\r\n    if (!isNonNullObject(settings)) {\r\n      throw new Error(\"failed to initialize settings\");\r\n    }\r\n\r\n    for (const [setting] of Object.entries(defaultSettings)) {\r\n      if (!(setting in settings)) {\r\n        if (setting === \"activityExpressions\" && \"expressions\" in settings) {\r\n          settings[setting] = settings.expressions;\r\n          continue;\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\r\n        settings[setting] = defaultSettings[setting].value;\r\n      }\r\n    }\r\n    if (typeof settings.version === \"undefined\" || settings.version < settingsVersion) {\r\n      beepChangelog();\r\n    }\r\n    settings.version = settingsVersion;\r\n    fbcSettings = settings;\r\n  }\r\n}\r\n\r\nexport function bceSaveSettings(): void {\r\n  debug(\"saving settings\");\r\n  if (toySyncState.deviceSettings.size > 0) {\r\n    fbcSettings.buttplugDevices = JSON.stringify(Array.from(toySyncState.deviceSettings.values()));\r\n  }\r\n  localStorage.setItem(bceSettingKey(), JSON.stringify(fbcSettings));\r\n  Player.ExtensionSettings.FBC = LZString.compressToBase64(JSON.stringify(fbcSettings));\r\n  ServerPlayerExtensionSettingsSync(\"FBC\");\r\n  debug(\"saved settings\", fbcSettings);\r\n}\r\n\r\nexport function isDefaultSettingKey(key: string): key is keyof typeof defaultSettings {\r\n  return key in defaultSettings;\r\n}\r\n\r\nexport function postSettings(): void {\r\n  debug(\"handling settings side effects\");\r\n  for (const [k, v] of Object.entries(fbcSettings)) {\r\n    if (k === \"version\") {\r\n      continue;\r\n    }\r\n    if (!isDefaultSettingKey(k)) {\r\n      logWarn(\"Deleting unknown setting\", k);\r\n      delete fbcSettings[k];\r\n      continue;\r\n    }\r\n    defaultSettings[k].sideEffects(v, true);\r\n  }\r\n  bceSaveSettings();\r\n\r\n  postSettingsHasRun = true;\r\n}\r\n\r\nasync function beepChangelog(): Promise<void> {\r\n  await waitFor(() => !!Player?.AccountName);\r\n  await sleep(5000);\r\n  fbcBeepNotify(\r\n    displayText(\"WCE Changelog\"),\r\n    displayText(\"WCE has received significant updates since you last used it. See /wcechangelog in a chatroom.\")\r\n  );\r\n  await waitFor(() => !!document.getElementById(\"TextAreaChatLog\"));\r\n  augmentedChatNotify(`Wholesome Club Extensions (WCE) changelog:\\n${fbcChangelog}`);\r\n}\r\n\r\nexport function fbcSettingValue(key: string): boolean | string {\r\n  if (isDefaultSettingKey(key)) {\r\n    return fbcSettings[key];\r\n  }\r\n  return false;\r\n}\r\n","export function expectedHashes(gameVersion: string): Readonly<Record<string, string>> {\r\n  switch (gameVersion.toLowerCase()) {\r\n    case \"r109\":\r\n      return {\r\n        ActivityChatRoomArousalSync: \"BFF3DED7\",\r\n        ActivitySetArousal: \"3AE28123\",\r\n        ActivitySetArousalTimer: \"1342AFE2\",\r\n        ActivityTimerProgress: \"6CD388A7\",\r\n        AppearanceClick: \"48B83523\", // Screens/Character/Appearance/Appearance.js (21.5.2024)\r\n        AppearanceLoad: \"4360C485\",\r\n        AppearanceRun: \"8B7558CB\", // Screens/Character/Appearance/Appearance.js (13.5.2024)\r\n        CharacterAppearanceBuildCanvas: \"C05FE035\", // Screens/Character/Appearance/Appearance.js\r\n        CharacterAppearanceMustHide: \"9C34DF21\",\r\n        CharacterAppearanceVisible: \"0740043C\",\r\n        CharacterAppearanceWardrobeLoad: \"A5B63A03\",\r\n        CharacterBuildDialog: \"85F79C6E\",\r\n        CharacterCompressWardrobe: \"2A05ECD1\",\r\n        CharacterDelete: \"57AA5D48\",\r\n        CharacterGetCurrent: \"69F45A41\",\r\n        CharacterLoadCanvas: \"EAB81BC4\",\r\n        CharacterLoadOnline: \"407FEDDE\", // Scripts/Character.js\r\n        CharacterNickname: \"A794EFF5\",\r\n        CharacterRefresh: \"301DA9CF\",\r\n        CharacterSetCurrent: \"F46573D8\",\r\n        CharacterSetFacialExpression: \"EC032BEE\", // Scripts/Character.js (6.5.2024)\r\n        CharacterSetActivePose: \"566A14D7\",\r\n        ChatAdminRoomCustomizationClick: \"9D859B28\",\r\n        ChatAdminRoomCustomizationProcess: \"AF01C65A\",\r\n        ChatRoomAppendChat: \"12890378\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomCharacterUpdate: \"DE2DC592\",\r\n        ChatRoomCharacterViewDraw: \"732C91C9\", // Screens/Online/ChatRoom/ChatRoomCharacterView.js (19.4.2024 )\r\n        ChatRoomCharacterViewIsActive: \"CD8066FA\",\r\n        ChatRoomClearAllElements: \"ECF65628\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomCurrentTime: \"A462DD3A\",\r\n        ChatRoomDrawCharacterStatusIcons: \"B5209E11\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomGenerateChatRoomChatMessage: \"3BDE0884\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomHideElements: \"D58ECB5C\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomHTMLEntities: \"0A7ADB1D\",\r\n        ChatRoomKeyDown: \"9F45A713\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomListManipulation: \"75D28A8B\",\r\n        ChatRoomMapViewCharacterIsVisible: \"286C447D\",\r\n        ChatRoomMapViewCharacterOnWhisperRange: \"B0D08E96\",\r\n        ChatRoomMapViewIsActive: \"D181020D\",\r\n        ChatRoomMenuBuild: \"F76AEFC3\",\r\n        ChatRoomMenuClick: \"3BC3C582\", // Screens/Online/ChatRoom/ChatRoom.js (6.5.2024)\r\n        ChatRoomMenuDraw: \"83275135\", // Screens/Online/ChatRoom/ChatRoom.js (6.5.2024)\r\n        ChatRoomMessage: \"E75ED29B\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomRegisterMessageHandler: \"C432923A\",\r\n        ChatRoomSendChat: \"ACB10CE5\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomStart: \"9B822A9A\",\r\n        ChatRoomSyncMemberJoin: \"2A9CB40B\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        CommandCombine: \"80F9D4AF\", // Screens/Online/ChatRoom/Commands.js\r\n        CommandExecute: \"D1DEB2AD\", // Screens/Online/ChatRoom/Commands.js\r\n        CommonClick: \"1F6DF7CB\",\r\n        CommonColorIsValid: \"390A2CE4\",\r\n        CommonSetScreen: \"B674BE4D\", // Scripts/Common.js\r\n        CraftingClick: \"083CC3CA\", // Screens/Room/Crafting/Crafting.js\r\n        CraftingConvertSelectedToItem: \"03E97498\",\r\n        CraftingRun: \"CA7B4FE0\", // Screens/Room/Crafting/Crafting.js\r\n        DialogCanUnlock: \"A86B2558\",\r\n        DialogDrawItemMenu: \"FCE556C2\",\r\n        DialogLeave: \"C37553DC\",\r\n        DialogMenuButtonBuild: \"3FDE2F94\", // Scripts/Dialog.js (13.5.2024)\r\n        DialogMenuButtonClick: \"C1F5E0AF\", // Scripts/Dialog.js (2.5.2024)\r\n        DrawArousalMeter: \"BB0755AF\",\r\n        DrawArousalThermometer: \"7ED6D822\",\r\n        DrawBackNextButton: \"7263249E\", // Scripts/Drawing.js\r\n        DrawButton: \"B747DF6E\",\r\n        DrawCharacter: \"B175AF5E\",\r\n        DrawCheckbox: \"00FD87EB\",\r\n        DrawImageEx: \"E01BE7E7\",\r\n        DrawImageResize: \"D205975A\",\r\n        DrawItemPreview: \"6A7A1E2A\",\r\n        DrawProcess: \"9776CBC2\",\r\n        DrawText: \"C1BF0F50\",\r\n        DrawTextFit: \"F9A1B11E\",\r\n        ElementCreate: \"A3E07B07\",\r\n        ElementCreateInput: \"0755ED07\",\r\n        ElementCreateTextArea: \"4E040819\", // Scripts/Element.js\r\n        ElementIsScrolledToEnd: \"1CC4FE11\",\r\n        ElementPosition: \"81836C4E\", // Scripts/Element.js\r\n        ElementScrollToEnd: \"1AC45575\",\r\n        ElementValue: \"4F26C62F\",\r\n        FriendListShowBeep: \"5B91D5DA\", // Screens/Character/FriendList/FriendList.js\r\n        GameRun: \"337CB358\", // Scripts/Game.js\r\n        GLDrawResetCanvas: \"81214642\",\r\n        InformationSheetRun: \"5B5C7751\", // Screens/Character/InformationSheet/InformationSheet.js\r\n        InterfaceTextGet: \"66603471\", // Scripts/Text.js (2.5.2024)\r\n        InventoryGet: \"E666F671\",\r\n        \"Layering.Load\": \"589C88CD\", // Scripts/Layering.js\r\n        \"Layering._ResetClickListener\": \"5EDCC26F\", // Scripts/Layering.js\r\n        LoginClick: \"ADA7E2B7\", // Screens/Character/Login/Login.js\r\n        LoginDoLogin: \"D4000B03\", // Screens/Character/Login/Login.js\r\n        LoginRun: \"D1DB7A8A\", // Screens/Character/Login/Login.js\r\n        LoginSetSubmitted: \"C88F4A8E\",\r\n        LoginStatusReset: \"18619F02\",\r\n        MouseIn: \"CA8B839E\",\r\n        NotificationDrawFavicon: \"AB88656B\",\r\n        NotificationRaise: \"E8F29646\",\r\n        NotificationTitleUpdate: \"0E92F3ED\",\r\n        OnlineGameAllowChange: \"3779F42C\",\r\n        OnlineProfileClick: \"521146DF\",\r\n        OnlineProfileUnload: \"A8651F30\",\r\n        OnlineProfileLoad: \"BE8B009B\",\r\n        OnlineProfileRun: \"7F57EF9A\",\r\n        PoseSetActive: \"22C02050\",\r\n        PreferenceExit: \"27E40748\",\r\n        PreferenceInitPlayer: \"B12FA731\", // Screens/Character/Preference/Preference.js (6.5.2024)\r\n        PreferenceSubscreenArousalClick: \"84F49886\",\r\n        PreferenceSubscreenArousalRun: \"96A6157B\",\r\n        PreferenceSubscreenImmersionClick: \"0EF82344\",\r\n        PreferenceSubscreenImmersionRun: \"276FA30B\",\r\n        RelogRun: \"10AF5A60\",\r\n        RelogExit: \"2DFB2DAD\",\r\n        ServerAccountBeep: \"37ED13F6\", // Scripts/Server.js\r\n        ServerAppearanceBundle: \"4D069622\",\r\n        ServerAppearanceLoadFromBundle: \"946537FD\",\r\n        ServerConnect: \"845E50A6\",\r\n        ServerDisconnect: \"198FF7E7\",\r\n        ServerInit: \"B6CEF7F1\",\r\n        ServerOpenFriendList: \"FA8D3CDE\",\r\n        ServerPlayerAppearanceSync: \"A014E0B7\",\r\n        ServerPlayerExtensionSettingsSync: \"1776666B\",\r\n        ServerSend: \"ABE74E75\",\r\n        ServerSendQueueProcess: \"BD4277AC\",\r\n        SkillGetWithRatio: \"3EB4BC45\",\r\n        SpeechTransformBabyTalk: \"C812EE0E\", // Scripts/Speech.js\r\n        SpeechTransformGagGarble: \"691A05BF\", // Scripts/Speech.js\r\n        SpeechTransformGagGarbleIntensity: \"F61ECBDA\", // Scripts/Speech.js\r\n        SpeechTransformProcess: \"666DDA2F\", // Scripts/Speech.js\r\n        SpeechTransformShouldBabyTalk: \"634BCD64\", // Scripts/Speech.js\r\n        SpeechTransformStutter: \"A930F55E\", // Scripts/Speech.js\r\n        SpeechTransformStutterIntensity: \"4754768A\", // Scripts/Speech.js\r\n        StruggleDexterityProcess: \"D185D348\", // Scripts/Struggle.js\r\n        StruggleFlexibilityCheck: \"727CE05B\",\r\n        StruggleFlexibilityProcess: \"1A0B96EF\", // Scripts/Struggle.js\r\n        StruggleLockPickDraw: \"CCCCA4BE\", // Scripts/Struggle.js\r\n        StruggleMinigameHandleExpression: \"1B3ABF55\",\r\n        StruggleMinigameStop: \"FB05E8A9\",\r\n        StruggleStrengthProcess: \"B1A1457D\", // StruggleStrengthProcess\r\n        TextGet: \"4DDE5794\",\r\n        TextLoad: \"0D535190\",\r\n        TimerInventoryRemove: \"2588CA11\",\r\n        TimerProcess: \"BFB7FFE2\",\r\n        TitleExit: \"F13F533C\",\r\n        ValidationSanitizeProperties: \"659F5965\",\r\n        WardrobeClick: \"33405B1D\",\r\n        WardrobeExit: \"12D14AE4\",\r\n        WardrobeFastLoad: \"AAB9F25B\",\r\n        WardrobeFastSave: \"D1E906FD\",\r\n        WardrobeFixLength: \"CA3334C6\",\r\n        WardrobeLoad: \"C343A4C7\",\r\n        WardrobeLoadCharacterNames: \"F39DF5E3\",\r\n        WardrobeRun: \"633B3570\",\r\n      } as const;\r\n    default:\r\n      return {\r\n        ActivityChatRoomArousalSync: \"BFF3DED7\",\r\n        ActivitySetArousal: \"3AE28123\",\r\n        ActivitySetArousalTimer: \"1342AFE2\",\r\n        ActivityTimerProgress: \"6CD388A7\",\r\n        AppearanceClick: \"48B83523\", // Screens/Character/Appearance/Appearance.js (21.5.2024)\r\n        AppearanceLoad: \"4360C485\",\r\n        AppearanceRun: \"8B7558CB\", // Screens/Character/Appearance/Appearance.js (13.5.2024)\r\n        CharacterAppearanceBuildCanvas: \"C05FE035\", // Screens/Character/Appearance/Appearance.js\r\n        CharacterAppearanceMustHide: \"9C34DF21\",\r\n        CharacterAppearanceVisible: \"0740043C\",\r\n        CharacterAppearanceWardrobeLoad: \"A5B63A03\",\r\n        CharacterBuildDialog: \"85F79C6E\",\r\n        CharacterCompressWardrobe: \"2A05ECD1\",\r\n        CharacterDelete: \"57AA5D48\",\r\n        CharacterGetCurrent: \"69F45A41\",\r\n        CharacterLoadCanvas: \"EAB81BC4\",\r\n        CharacterLoadOnline: \"407FEDDE\", // Scripts/Character.js\r\n        CharacterNickname: \"A794EFF5\",\r\n        CharacterRefresh: \"301DA9CF\",\r\n        CharacterSetCurrent: \"F46573D8\",\r\n        CharacterSetFacialExpression: \"EC032BEE\", // Scripts/Character.js (6.5.2024)\r\n        CharacterSetActivePose: \"566A14D7\",\r\n        ChatAdminRoomCustomizationClick: \"9D859B28\",\r\n        ChatAdminRoomCustomizationProcess: \"AF01C65A\",\r\n        ChatRoomAppendChat: \"12890378\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomCharacterUpdate: \"DE2DC592\",\r\n        ChatRoomCharacterViewDraw: \"732C91C9\", // Screens/Online/ChatRoom/ChatRoomCharacterView.js (19.4.2024 )\r\n        ChatRoomCharacterViewIsActive: \"CD8066FA\",\r\n        ChatRoomClearAllElements: \"ECF65628\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomCurrentTime: \"A462DD3A\",\r\n        ChatRoomDrawCharacterStatusIcons: \"B5209E11\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomGenerateChatRoomChatMessage: \"3BDE0884\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomHideElements: \"D58ECB5C\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomHTMLEntities: \"0A7ADB1D\",\r\n        ChatRoomKeyDown: \"9F45A713\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomLeave: \"DAFE49DC\",\r\n        ChatRoomListManipulation: \"75D28A8B\",\r\n        ChatRoomMapViewCharacterIsVisible: \"286C447D\",\r\n        ChatRoomMapViewCharacterOnWhisperRange: \"B0D08E96\",\r\n        ChatRoomMapViewIsActive: \"D181020D\",\r\n        ChatRoomMenuBuild: \"F76AEFC3\",\r\n        ChatRoomMenuClick: \"259784BA\", // Screens/Online/ChatRoom/ChatRoom.js (6.5.2024)\r\n        ChatRoomMenuDraw: \"83275135\", // Screens/Online/ChatRoom/ChatRoom.js (6.5.2024)\r\n        ChatRoomMessage: \"E75ED29B\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomRegisterMessageHandler: \"C432923A\",\r\n        ChatRoomSendChat: \"ACB10CE5\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        ChatRoomStart: \"9B822A9A\",\r\n        ChatRoomSyncMemberJoin: \"2A9CB40B\", // Screens/Online/ChatRoom/ChatRoom.js\r\n        CommandCombine: \"80F9D4AF\", // Screens/Online/ChatRoom/Commands.js\r\n        CommandExecute: \"D1DEB2AD\", // Screens/Online/ChatRoom/Commands.js\r\n        CommonClick: \"1F6DF7CB\",\r\n        CommonColorIsValid: \"390A2CE4\",\r\n        CommonSetScreen: \"85E69EBB\", // Scripts/Common.js\r\n        CraftingClick: \"5E7225EA\", // Screens/Room/Crafting/Crafting.js\r\n        CraftingConvertSelectedToItem: \"F5211D40\",\r\n        CraftingRun: \"4CD7AB08\", // Screens/Room/Crafting/Crafting.js\r\n        DialogCanUnlock: \"A86B2558\",\r\n        DialogDrawItemMenu: \"FCE556C2\",\r\n        DialogLeave: \"C37553DC\",\r\n        DialogMenuButtonBuild: \"3FDE2F94\", // Scripts/Dialog.js (13.5.2024)\r\n        DialogMenuButtonClick: \"C1F5E0AF\", // Scripts/Dialog.js (2.5.2024)\r\n        DrawArousalMeter: \"BB0755AF\",\r\n        DrawArousalThermometer: \"7ED6D822\",\r\n        DrawBackNextButton: \"7263249E\", // Scripts/Drawing.js\r\n        DrawButton: \"B747DF6E\",\r\n        DrawCharacter: \"B175AF5E\",\r\n        DrawCheckbox: \"00FD87EB\",\r\n        DrawImageEx: \"E01BE7E7\",\r\n        DrawImageResize: \"D205975A\",\r\n        DrawItemPreview: \"6A7A1E2A\",\r\n        DrawProcess: \"9776CBC2\",\r\n        DrawText: \"C1BF0F50\",\r\n        DrawTextFit: \"F9A1B11E\",\r\n        ElementCreate: \"A3E07B07\",\r\n        ElementCreateInput: \"0755ED07\",\r\n        ElementCreateTextArea: \"4E040819\", // Scripts/Element.js\r\n        ElementIsScrolledToEnd: \"1CC4FE11\",\r\n        ElementPosition: \"81836C4E\", // Scripts/Element.js\r\n        ElementScrollToEnd: \"1AC45575\",\r\n        ElementValue: \"4F26C62F\",\r\n        FriendListShowBeep: \"5B91D5DA\", // Screens/Character/FriendList/FriendList.js\r\n        GameRun: \"337CB358\", // Scripts/Game.js\r\n        GLDrawResetCanvas: \"81214642\",\r\n        InformationSheetRun: \"5B5C7751\", // Screens/Character/InformationSheet/InformationSheet.js\r\n        InterfaceTextGet: \"66603471\", // Scripts/Text.js (2.5.2024)\r\n        InventoryGet: \"E666F671\",\r\n        \"Layering.Load\": \"589C88CD\", // Scripts/Layering.js\r\n        \"Layering._ResetClickListener\": \"5EDCC26F\", // Scripts/Layering.js\r\n        LoginClick: \"ADA7E2B7\", // Screens/Character/Login/Login.js\r\n        LoginDoLogin: \"D4000B03\", // Screens/Character/Login/Login.js\r\n        LoginRun: \"D1DB7A8A\", // Screens/Character/Login/Login.js\r\n        LoginSetSubmitted: \"C88F4A8E\",\r\n        LoginStatusReset: \"18619F02\",\r\n        MouseIn: \"CA8B839E\",\r\n        NotificationDrawFavicon: \"AB88656B\",\r\n        NotificationRaise: \"E8F29646\",\r\n        NotificationTitleUpdate: \"0E92F3ED\",\r\n        OnlineGameAllowChange: \"3779F42C\",\r\n        OnlineProfileClick: \"521146DF\",\r\n        OnlineProfileUnload: \"A8651F30\",\r\n        OnlineProfileLoad: \"BE8B009B\",\r\n        OnlineProfileRun: \"7F57EF9A\",\r\n        PoseSetActive: \"22C02050\",\r\n        PreferenceExit: \"27E40748\",\r\n        PreferenceInitPlayer: \"B12FA731\", // Screens/Character/Preference/Preference.js (6.5.2024)\r\n        PreferenceSubscreenArousalClick: \"84F49886\",\r\n        PreferenceSubscreenArousalRun: \"96A6157B\",\r\n        PreferenceSubscreenImmersionClick: \"0EF82344\",\r\n        PreferenceSubscreenImmersionRun: \"276FA30B\",\r\n        RelogRun: \"10AF5A60\",\r\n        RelogExit: \"2DFB2DAD\",\r\n        ServerAccountBeep: \"8782A099\", // Scripts/Server.js\r\n        ServerAppearanceBundle: \"4D069622\",\r\n        ServerAppearanceLoadFromBundle: \"946537FD\",\r\n        ServerConnect: \"845E50A6\",\r\n        ServerDisconnect: \"433A71F9\",\r\n        ServerInit: \"B6CEF7F1\",\r\n        ServerOpenFriendList: \"FA8D3CDE\",\r\n        ServerPlayerAppearanceSync: \"A014E0B7\",\r\n        ServerPlayerExtensionSettingsSync: \"1776666B\",\r\n        ServerSend: \"ABE74E75\",\r\n        ServerSendQueueProcess: \"BD4277AC\",\r\n        SkillGetWithRatio: \"3EB4BC45\",\r\n        SpeechTransformBabyTalk: \"C812EE0E\", // Scripts/Speech.js\r\n        SpeechTransformGagGarble: \"691A05BF\", // Scripts/Speech.js\r\n        SpeechTransformGagGarbleIntensity: \"F61ECBDA\", // Scripts/Speech.js\r\n        SpeechTransformProcess: \"666DDA2F\", // Scripts/Speech.js\r\n        SpeechTransformShouldBabyTalk: \"634BCD64\", // Scripts/Speech.js\r\n        SpeechTransformStutter: \"A930F55E\", // Scripts/Speech.js\r\n        SpeechTransformStutterIntensity: \"4754768A\", // Scripts/Speech.js\r\n        StruggleDexterityProcess: \"D185D348\", // Scripts/Struggle.js\r\n        StruggleFlexibilityCheck: \"727CE05B\",\r\n        StruggleFlexibilityProcess: \"1A0B96EF\", // Scripts/Struggle.js\r\n        StruggleLockPickDraw: \"6FE841B9\", // Scripts/Struggle.js\r\n        StruggleMinigameHandleExpression: \"1B3ABF55\",\r\n        StruggleMinigameStop: \"FB05E8A9\",\r\n        StruggleStrengthProcess: \"B1A1457D\", // StruggleStrengthProcess\r\n        TextGet: \"4DDE5794\",\r\n        TextLoad: \"0D535190\",\r\n        TimerInventoryRemove: \"2588CA11\",\r\n        TimerProcess: \"BFB7FFE2\",\r\n        TitleExit: \"F13F533C\",\r\n        ValidationSanitizeProperties: \"843D3952\",\r\n        WardrobeClick: \"33405B1D\",\r\n        WardrobeExit: \"12D14AE4\",\r\n        WardrobeFastLoad: \"AAB9F25B\",\r\n        WardrobeFastSave: \"D1E906FD\",\r\n        WardrobeFixLength: \"CA3334C6\",\r\n        WardrobeLoad: \"C343A4C7\",\r\n        WardrobeLoadCharacterNames: \"F39DF5E3\",\r\n        WardrobeRun: \"633B3570\",\r\n      } as const;\r\n  }\r\n}\r\n","import { SDK, deviatingHashes } from \"../util/modding\";\r\nimport { waitFor } from \"../util/utils\";\r\nimport { logInfo, logWarn } from \"../util/logger\";\r\nimport { expectedHashes } from \"../util/functionHashes\";\r\n\r\nexport default async function functionIntegrityCheck(): Promise<void> {\r\n  await waitFor(() => GameVersion !== \"R0\" && typeof ServerIsConnected === \"boolean\" && ServerIsConnected);\r\n\r\n  logInfo(\"Checking function integrity with GameVersion\", GameVersion);\r\n\r\n  function isObject(obj): obj is typeof Object {\r\n    return !!obj && typeof obj === \"object\" && !Array.isArray(obj);\r\n  }\r\n\r\n  for (const [func, hash] of Object.entries(expectedHashes(GameVersion) || {})) {\r\n    if (hash === \"SKIP\") continue;\r\n\r\n    let context: unknown = window;\r\n    const targetPath: string[] = func.split(\".\");\r\n    for (let i = 0; i < targetPath.length - 1; i++) {\r\n      context = context[targetPath[i]];\r\n      if (!isObject(context)) {\r\n        logWarn(`Expected Function ${func} not found; ${targetPath.slice(0, i + 1).join(\".\")} is not object`);\r\n      }\r\n    }\r\n    context = context[targetPath.pop()];\r\n    if (typeof context !== \"function\") {\r\n      logWarn(`Expected function ${func} is not a function.`);\r\n      continue;\r\n    }\r\n    const actualHash = SDK.getOriginalHash(func);\r\n    if (actualHash !== hash) {\r\n      logWarn(`Function ${func} has been modified before WCE, potential incompatibility: ${actualHash}`);\r\n      deviatingHashes.push(func);\r\n    }\r\n  }\r\n}\r\n","import { BCE_COLOR_ADJUSTMENTS_CLASS_NAME, DARK_INPUT_CLASS, WHISPER_CLASS } from \"../util/constants\";\r\n\r\nconst INPUT_WARN_CLASS = \"bce-input-warn\";\r\n\r\nexport default function wceStyles(): void {\r\n  const css = /* CSS */ `\r\n  .bce-beep-link {\r\n    text-decoration: none;\r\n  }\r\n  #TextAreaChatLog .bce-notification,\r\n  #TextAreaChatLog .bce-notification {\r\n    background-color: #D696FF;\r\n    color: black;\r\n  }\r\n  #TextAreaChatLog[data-colortheme=\"dark\"] .bce-notification,\r\n  #TextAreaChatLog[data-colortheme=\"dark2\"] .bce-notification {\r\n    background-color: #481D64;\r\n    color: white;\r\n  }\r\n  .bce-img-link {\r\n    vertical-align: top;\r\n  }\r\n  .bce-img {\r\n    max-height: 25rem;\r\n    max-width: 90%;\r\n    display: inline;\r\n    border:1px solid red;\r\n    padding: 0.1rem;\r\n  }\r\n  .bce-color {\r\n    width: 0.8em;\r\n    height: 0.8em;\r\n    display: inline-block;\r\n    vertical-align: middle;\r\n    border: 0.1em solid black;\r\n    margin-right: 0.1em;\r\n  }\r\n  .${BCE_COLOR_ADJUSTMENTS_CLASS_NAME} .${DARK_INPUT_CLASS}.${INPUT_WARN_CLASS} {\r\n    background-color: #400000 !important;\r\n  }\r\n  .${INPUT_WARN_CLASS} {\r\n    background-color: yellow !important;\r\n  }\r\n  #TextAreaChatLog a,\r\n  .bce-message a {\r\n    color: #003f91;\r\n    cursor: pointer;\r\n  }\r\n  #TextAreaChatLog a:visited,\r\n  .bce-message a {\r\n    color: #380091;\r\n  }\r\n  .${BCE_COLOR_ADJUSTMENTS_CLASS_NAME} div.ChatMessageWhisper,\r\n  .${BCE_COLOR_ADJUSTMENTS_CLASS_NAME} div.ChatMessageWhisper {\r\n    color: #646464;\r\n  }\r\n  .${BCE_COLOR_ADJUSTMENTS_CLASS_NAME} #TextAreaChatLog[data-colortheme=\"dark\"] div.ChatMessageWhisper,\r\n  .${BCE_COLOR_ADJUSTMENTS_CLASS_NAME} #TextAreaChatLog[data-colortheme=\"dark2\"] div.ChatMessageWhisper {\r\n    color: #828282;\r\n  }\r\n  #TextAreaChatLog[data-colortheme=\"dark\"] a,\r\n  #TextAreaChatLog[data-colortheme=\"dark2\"] a,\r\n  .bce-message a {\r\n    color: #a9ceff;\r\n  }\r\n  #TextAreaChatLog[data-colortheme=\"dark\"] a:visited,\r\n  #TextAreaChatLog[data-colortheme=\"dark2\"] a:visited,\r\n  .bce-message a {\r\n    color: #3d91ff;\r\n  }\r\n  .${WHISPER_CLASS} {\r\n    font-style: italic;\r\n  }\r\n  .${BCE_COLOR_ADJUSTMENTS_CLASS_NAME} .${DARK_INPUT_CLASS} {\r\n    background-color: #111;\r\n    color: #eee;\r\n    border-color: #333;\r\n  }\r\n  a.bce-button {\r\n    text-decoration: none;\r\n  }\r\n  .bce-hidden {\r\n    display: none !important;\r\n  }\r\n  .bce-false-hidden {\r\n    position: absolute;\r\n    border: 0;\r\n    margin: 0;\r\n    padding: 0;\r\n    top: 0;\r\n    left: 0;\r\n    width: 0.1px;\r\n    height: 0.1px;\r\n    opacity: 0.01;\r\n  }\r\n  .bce-line-icon-wrapper {\r\n    display: none;\r\n    position: absolute;\r\n    right: 1em;\r\n  }\r\n  .ChatMessage:hover .bce-line-icon-wrapper,\r\n  .ChatMessage:focus .bce-line-icon-wrapper,\r\n  .ChatMessage:focus-within .bce-line-icon-wrapper {\r\n    display: inline;\r\n  }\r\n  .bce-line-icon {\r\n    height: 1em;\r\n    vertical-align: middle;\r\n  }\r\n  #bce-instant-messenger {\r\n    display: flex;\r\n    z-index: 100;\r\n    position: fixed;\r\n    width: 80%;\r\n    height: 70%;\r\n    top: 5%;\r\n    left: 10%;\r\n    padding: 0;\r\n    margin: 0;\r\n    flex-direction: row;\r\n    background-color: #111;\r\n    color: #eee;\r\n    border: 0.2em solid white;\r\n    resize: both;\r\n    overflow: auto;\r\n    max-width: 80%;\r\n    max-height: 75%;\r\n    min-width: 38%;\r\n    min-height: 30%;\r\n    overflow-wrap: break-word;\r\n  }\r\n  #bce-friend-list {\r\n    width: 100%;\r\n    overflow-x: hidden;\r\n    overflow-y: scroll;\r\n  }\r\n  .bce-friend-list-entry {\r\n    padding: 1em;\r\n  }\r\n  .bce-friend-list-entry-name {\r\n    font-weight: bold;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .bce-friend-list-selected {\r\n    font-style: italic;\r\n    border-top: 0.1em solid white;\r\n    border-bottom: 0.1em solid white;\r\n    background-color: #222;\r\n  }\r\n  #bce-message-container {\r\n    width: 100%;\r\n    height: 90%;\r\n    font-size: 1.5rem;\r\n    font-family: Arial, sans-serif;\r\n  }\r\n  #bce-message-right-container {\r\n    width: 80%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    border-left: 0.1em solid white;\r\n  }\r\n  #bce-message-input {\r\n    width: 100%;\r\n    height: 10%;\r\n    border: 0;\r\n    padding: 0;\r\n    margin: 0;\r\n    background-color: #222;\r\n    color: #eee;\r\n    font-size: 1.5rem;\r\n    font-family: system-ui;\r\n  }\r\n  .bce-friend-list-unread {\r\n    background-color: #a22;\r\n  }\r\n  .bce-message-divider {\r\n    margin: 0.5em 2em;\r\n    border-bottom: 0.2em solid white;\r\n  }\r\n  .bce-message {\r\n    padding: 0.2em 0.4em;\r\n    position: relative;\r\n    white-space: pre-wrap;\r\n  }\r\n  .bce-message::before {\r\n    content: attr(data-time);\r\n    float: right;\r\n    color: gray;\r\n    font-size: 0.5em;\r\n    margin-right: 0.2em;\r\n    font-style: italic;\r\n  }\r\n  .bce-message-sender {\r\n    text-shadow: 0.05em 0.05em #eee;\r\n    font-weight: bold;\r\n  }\r\n  .bce-message-Emote, .bce-message-Action {\r\n    font-style: italic;\r\n    color: gray;\r\n  }\r\n  .bce-message-Message .bce-message-sender {\r\n    text-shadow: 0.05em 0.05em #eee;\r\n  }\r\n  .bce-friend-history {\r\n    overflow-y: scroll;\r\n    overflow-x: hidden;\r\n    height: 100%;\r\n  }\r\n  .bce-friend-list-handshake-false,\r\n  .bce-friend-list-handshake-pending {\r\n    text-decoration: line-through;\r\n    color: gray;\r\n  }\r\n  #bce-message-left-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    width: 20%;\r\n    height: 100%;\r\n  }\r\n  #bce-friend-search {\r\n    border: 0;\r\n    border-bottom: 0.1em solid white;\r\n    padding: 0.5em;\r\n    height: 1em;\r\n    background-color: #222;\r\n    color: #eee;\r\n  }\r\n  .bce-profile-open {\r\n    margin-right: 0.5em;\r\n  }\r\n  .bce-pending {\r\n    opacity: 0.4;\r\n  }\r\n\r\n  .lds-ellipsis {\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 80px;\r\n    height: 1em;\r\n  }\r\n  .lds-ellipsis div {\r\n    position: absolute;\r\n    top: 44%;\r\n    width: 13px;\r\n    height: 13px;\r\n    border-radius: 50%;\r\n    background: #fff;\r\n    animation-timing-function: cubic-bezier(0, 1, 1, 0);\r\n  }\r\n  .lds-ellipsis div:nth-child(1) {\r\n    left: 8px;\r\n    animation: lds-ellipsis1 0.6s infinite;\r\n  }\r\n  .lds-ellipsis div:nth-child(2) {\r\n    left: 8px;\r\n    animation: lds-ellipsis2 0.6s infinite;\r\n  }\r\n  .lds-ellipsis div:nth-child(3) {\r\n    left: 32px;\r\n    animation: lds-ellipsis2 0.6s infinite;\r\n  }\r\n  .lds-ellipsis div:nth-child(4) {\r\n    left: 56px;\r\n    animation: lds-ellipsis3 0.6s infinite;\r\n  }\r\n  @keyframes lds-ellipsis1 {\r\n    0% {\r\n      transform: scale(0);\r\n    }\r\n    100% {\r\n      transform: scale(1);\r\n    }\r\n  }\r\n  @keyframes lds-ellipsis3 {\r\n    0% {\r\n      transform: scale(1);\r\n    }\r\n    100% {\r\n      transform: scale(0);\r\n    }\r\n  }\r\n  @keyframes lds-ellipsis2 {\r\n    0% {\r\n      transform: translate(0, 0);\r\n    }\r\n    100% {\r\n      transform: translate(24px, 0);\r\n    }\r\n  }\r\n\r\n  #bceNoteInput {\r\n    z-index: 100 !important;\r\n  }\r\n\r\n  #layering {\r\n    overflow-y: auto;\r\n    grid-template:\r\n      \"asset-header button-grid\" min-content\r\n      \"asset-grid asset-grid\" min-content\r\n      \"layer-header layer-header\" min-content\r\n      \"layer-grid layer-grid\" auto\r\n      \"layer-hide-header layer-hide-header\" min-content\r\n      \"layer-hide-grid layer-hide-grid\" auto\r\n      / auto min-content\r\n    ;\r\n  }\r\n  #layering-layer-div {\r\n    overflow-y: visible;\r\n  }\r\n  #layering-button-grid {\r\n    top: 0;\r\n    position: sticky;\r\n  }\r\n  .layering-button-container {\r\n    position: relative;\r\n  }\r\n  #layering-hide-header {\r\n    grid-area: layer-hide-header;\r\n  }\r\n  #layering-hide-div {\r\n    grid-area: layer-hide-grid;\r\n  }\r\n\r\n  .wce-chat-room-select,\r\n  #wce-chat-garble-label {\r\n    font-size: 80%;\r\n  }\r\n  #TextAreaChatLog[data-colortheme=\"dark\"] + #chat-room-bot .wce-chat-room-select,\r\n  #TextAreaChatLog[data-colortheme=\"dark2\"] + #chat-room-bot .wce-chat-room-select {\r\n    color: #fff;\r\n    background-color: #111;\r\n    border-color: #555;\r\n  }\r\n  .wce-chat-room-select option[value=\"off\"] {\r\n    display: none;\r\n  }\r\n  .wce-whisper .wce-chat-room-select option[value=\"off\"] {\r\n    display: block;\r\n  }\r\n  #wce-chat-garble-label:after {\r\n    content: \"chat: \";\r\n  }\r\n  .wce-whisper #wce-chat-garble-label:after {\r\n    content: \"whis: \";\r\n  }\r\n  .wce-chat-room-select-div {\r\n    grid-column: 1 / 4;\r\n    direction: ltr;\r\n    position: relative;\r\n    display: grid;\r\n    grid-template-columns: 28% 72%;\r\n    justify-items: stretch;\r\n    align-items: baseline;\r\n  }\r\n  @media (hover: hover) {\r\n    .wce-chat-room-select-div:hover > .button-tooltip {\r\n      visibility: visible;\r\n    }\r\n  }\r\n  #wce-chat-baby-talk::before {\r\n    background-image: url(\"${PUBLIC_URL}/baby.png\");\r\n    mask-image: url(\"${PUBLIC_URL}/baby.png\");\r\n  }\r\n  #wce-chat-stutters::before {\r\n    background-image: url(\"${PUBLIC_URL}/stutter.png\");\r\n    mask-image: url(\"${PUBLIC_URL}/stutter.png\");\r\n  }\r\n  #wce-chat-baby-talk[data-state=\"ignore\"]::before,\r\n  #wce-chat-stutters[data-state=\"ignore\"]::before {\r\n    ${GameVersion === \"R106\" ? \"background-color\" : \"--button-color\"}: #bbb;\r\n  }\r\n  #wce-chat-baby-talk[data-state=\"preserve\"]::before,\r\n  #wce-chat-stutters[data-state=\"preserve\"]::before {\r\n    ${GameVersion === \"R106\" ? \"background-color\" : \"--button-color\"}: #666;\r\n  }\r\n  `;\r\n  const head = document.head || document.getElementsByTagName(\"head\")[0];\r\n  const style = document.createElement(\"style\");\r\n  style.appendChild(document.createTextNode(css));\r\n  head.appendChild(style);\r\n}\r\n","import { SDK, HOOK_PRIORITIES, patchFunction } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { isNonNullObject } from \"../util/utils\";\r\n\r\nconst FBC_DEVS = [23476, 27006, 24890];\r\nconst WCE_DEVS = [129178];\r\n\r\nexport default function commonPatches(): void {\r\n  // DrawBackNextButton patch to allow overriding hover text position\r\n  patchFunction(\r\n    \"DrawBackNextButton\",\r\n    {\r\n      \"Disabled, ArrowWidth\": \"Disabled, ArrowWidth, tooltipPosition\",\r\n      \"DrawButtonHover(Left, Top, Width, Height,\":\r\n        \"DrawButtonHover(tooltipPosition?.X || Left, tooltipPosition?.Y || Top, tooltipPosition?.Width || Width, tooltipPosition?.Height || Height,\",\r\n    },\r\n    \"DrawBackNextButton tooltip positions may be incorrect.\"\r\n  );\r\n\r\n  // DrawButton patch to allow overriding hover text position\r\n  patchFunction(\r\n    \"DrawButton\",\r\n    {\r\n      \"HoveringText, Disabled\": \"HoveringText, Disabled, tooltipPosition\",\r\n      \"DrawButtonHover(Left, Top, Width, Height,\":\r\n        \"DrawButtonHover(tooltipPosition?.X || Left, tooltipPosition?.Y || Top, tooltipPosition?.Width || Width, tooltipPosition?.Height || Height,\",\r\n    },\r\n    \"DrawButton tooltip positions may be incorrect.\"\r\n  );\r\n\r\n  // CommandExecute patch to fix /whitelistadd and /whitelistremove\r\n  patchFunction(\r\n    \"CommandExecute\",\r\n    { \"key.indexOf(CommandsKey + cmd.Tag) == 0)\": \"key.substring(1) === cmd.Tag)\" },\r\n    \"Whitelist commands will not work.\"\r\n  );\r\n\r\n  patchFunction(\r\n    \"PreferenceSubscreenArousalRun\",\r\n    {\r\n      'DrawCheckbox(1250, 276, 64, 64, TextGet(\"ArousalAffectExpression\"), Player.ArousalSettings.AffectExpression);':\r\n        'DrawCheckbox(1250, 276, 64, 64, TextGet(\"ArousalAffectExpression\"), Player.ArousalSettings.AffectExpression, fbcSettingValue(\"animationEngine\"));',\r\n    },\r\n    \"disabling conflicting Player.ArousalSettings.AffectExpression when Animation Engine is active\"\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"PreferenceSubscreenArousalClick\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (fbcSettings.animationEngine && PreferenceArousalIsActive() && MouseIn(1250, 276, 64, 64)) return null;\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  patchFunction(\r\n    \"PreferenceSubscreenImmersionRun\",\r\n    {\r\n      'TextGet(\"ShowUngarbledMessages\"), Player.ImmersionSettings.ShowUngarbledMessages, disableButtons);':\r\n        'TextGet(\"ShowUngarbledMessages\"), Player.ImmersionSettings.ShowUngarbledMessages, false);',\r\n    },\r\n    \"Can't control show ungarbled messages while in Extreme mode.\"\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"PreferenceSubscreenImmersionClick\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (PreferencePageCurrent === 2 && MouseIn(500, 592, 64, 64) &&\r\n        (Player.GetDifficulty() > 2 || (Player.GameplaySettings.ImmersionLockSetting && Player.IsRestrained()))) {\r\n        Player.ImmersionSettings.ShowUngarbledMessages = !Player.ImmersionSettings.ShowUngarbledMessages;\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  PreferenceSubscreens.find(s => s.name === \"Arousal\").run = PreferenceSubscreenArousalRun;\r\n  PreferenceSubscreens.find(s => s.name === \"Arousal\").click = PreferenceSubscreenArousalClick;\r\n  PreferenceSubscreens.find(s => s.name === \"Immersion\").run = PreferenceSubscreenImmersionRun;\r\n  PreferenceSubscreens.find(s => s.name === \"Immersion\").click = PreferenceSubscreenImmersionClick;\r\n\r\n  // fix other addons adding multiple legacy settings screens\r\n  SDK.hookFunction(\r\n    \"PreferenceLoad\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      PreferenceDidAddOldStyleScreens = false;\r\n      const ret = next(args);\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n      PreferenceSubscreenList = [];\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"InformationSheetRun\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (!InformationSheetSelection?.MemberNumber) {\r\n        return next(args);\r\n      }\r\n\r\n      const ret = next(args);\r\n      const isFbcDev = FBC_DEVS.includes(InformationSheetSelection.MemberNumber);\r\n      const isWceDev = WCE_DEVS.includes(InformationSheetSelection.MemberNumber);\r\n\r\n      if (isFbcDev || isWceDev) {\r\n        const ctx = window.MainCanvas.getContext(\"2d\");\r\n        if (!ctx) {\r\n          throw new Error(\"could not get canvas 2d context\");\r\n        }\r\n        ctx.textAlign = \"left\";\r\n        DrawText(\r\n          isWceDev ? displayText(\"WCE Developer\") : displayText(\"FBC Developer\"),\r\n          550,\r\n          75,\r\n          isWceDev ? \"fuchsia\" : \"hotpink\",\r\n          \"black\"\r\n        );\r\n        ctx.textAlign = \"center\";\r\n      }\r\n\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  // Looking for settings erasure by client\r\n  SDK.hookFunction(\r\n    \"ServerSend\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      const [msgType, data] = args;\r\n      if (msgType !== \"AccountUpdate\") {\r\n        return next(args);\r\n      }\r\n      if (!isNonNullObject(data)) {\r\n        return next(args);\r\n      }\r\n      if (\"ExtensionSettings\" in data) {\r\n        throw new Error(\"misuse of ExtensionSettings detected; write prevented\");\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  // Prevent processing of sent messages when disconnected\r\n  SDK.hookFunction(\r\n    \"ServerSendQueueProcess\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (!ServerIsConnected) {\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { patchFunction } from \"../util/modding\";\r\nimport { fbcBeepNotify } from \"../util/hooks\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default function beepImprovements() {\r\n  if (typeof window.StartBcUtil === \"function\") {\r\n    fbcBeepNotify(\r\n      displayText(\"Incompatibility\"),\r\n      displayText(\r\n        \"WCE is incompatible with BCUtil. Some functionality from WCE may not work. BCUtil's wardrobe, appearance, and instant messaging functionality are all available within WCE. Go to WCE settings and enable the relevant options, then disable BCUtil to migrate fully to WCE. This beep will appear every time WCE detects BCUtil as having loaded before WCE.\"\r\n      )\r\n    );\r\n    return;\r\n  }\r\n  // ServerAccountBeep patch for beep notification improvements in chat\r\n  patchFunction(\r\n    \"ServerAccountBeep\",\r\n    {\r\n      // eslint-disable-next-line no-template-curly-in-string\r\n      'ChatRoomSendLocal(`<a onclick=\"ServerOpenFriendList()\">(${ServerBeep.Message})</a>`);': `{\r\n        const beepId = FriendListBeepLog.length - 1;\r\n        ChatRoomSendLocal(\\`<a id=\"bce-beep-reply-\\${beepId}\">\\u21a9\\ufe0f</a><a class=\"bce-beep-link\" id=\"bce-beep-\\${beepId}\">(\\${ServerBeep.Message}\\${ChatRoomHTMLEntities(data.Message ? \\`: \\${bceStripBeepMetadata(data.Message.length > 150 ? data.Message.substring(0, 150) + \"...\" : data.Message)}\\` : \"\")})</a>\\`);\r\n        if (document.getElementById(\"bce-beep-reply-\" + beepId)) {\r\n          document.getElementById(\\`bce-beep-reply-\\${beepId}\\`).onclick = (e) => {\r\n            e.preventDefault();\r\n            ElementValue(\"InputChat\", \\`/beep \\${data.MemberNumber} \\${ElementValue(\"InputChat\").replace(/^\\\\/(beep|w) \\\\S+ ?/u, '')}\\`);\r\n            document.getElementById('InputChat').focus();\r\n          };\r\n        }\r\n        if (document.getElementById(\"bce-beep-\" + beepId)) {\r\n          document.getElementById(\\`bce-beep-\\${beepId}\\`).onclick = (e) => {\r\n            e.preventDefault();\r\n            ServerOpenFriendList();\r\n            FriendListModeIndex = 1;\r\n            FriendListShowBeep(\\`\\${beepId}\\`);\r\n          };\r\n        }\r\n      }`,\r\n    },\r\n    \"Beeps are not enhanced by WCE.\"\r\n  );\r\n}\r\n","import { skippedFunctionality, deviatingHashes } from \"../util/modding\";\r\nimport { BCX } from \"./hookBCXAPI\";\r\nimport { waitFor, parseJSON, fbcChatNotify, objEntries } from \"../util/utils\";\r\nimport { debug, logInfo, pastLogs } from \"../util/logger\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { fbcChangelog, SUPPORTED_GAME_VERSIONS, FBC_VERSION } from \"../util/constants\";\r\nimport { toySyncState } from \"./toySync\";\r\nimport { incompleteFunctions } from \"../registerFunctions\";\r\nimport { bceGotoRoom } from \"./forcedClubSlave\";\r\nimport { augmentedChatNotify } from \"./chatAugments\";\r\n\r\nexport async function fbcDebug(copy: boolean): Promise<string> {\r\n  const info = new Map<string, string>();\r\n  info.set(\"Browser\", navigator.userAgent);\r\n  info.set(\"Game Version\", `${GameVersion}${SUPPORTED_GAME_VERSIONS.includes(GameVersion) ? \"\" : \" (unsupported)\"}`);\r\n  info.set(\"WebGL Version\", GLVersion);\r\n  info.set(\"WCE Version\", FBC_VERSION);\r\n  info.set(\"Loaded via FUSAM\", typeof FUSAM === \"object\" && FUSAM?.addons?.WCE ? \"Yes\" : \"No\");\r\n  info.set(\r\n    \"WCE Enabled Settings\",\r\n    `\\n- ${objEntries(fbcSettings).filter(([k, v]) => v || k === \"version\").map(([k, v]) => `${k}: ${v.toString()}`).join(\"\\n- \")}`\r\n  );\r\n  if (toySyncState.client?.connected) {\r\n    info.set(\r\n      \"Buttplug.io Devices\",\r\n      toySyncState.client.devices.map(d => `${d.name} (${d.vibrateAttributes.join(\",\")})`).join(\", \")\r\n    );\r\n  }\r\n  info.set(\r\n    \"SDK Mods\",\r\n    `\\n- ${bcModSdk.getModsInfo().map(m => `${m.name} @ ${m.version}`).join(\"\\n- \")}`\r\n  );\r\n  info.set(\"Incomplete Functions\", incompleteFunctions.join(\", \"));\r\n  info.set(\"Modified Functions (non-SDK)\", deviatingHashes.join(\", \"));\r\n  info.set(\"Skipped Functionality for Compatibility\", `\\n- ${skippedFunctionality.join(\"\\n- \")}`);\r\n  info.set(\r\n    \"Log\",\r\n    pastLogs.filter(v => v).map(v => `[${v.level.toUpperCase()}] ${v.message}`).join(\"\\n\")\r\n  );\r\n  const print = Array.from(info).map(([k, v]) => `${k}: ${v}`).join(\"\\n\");\r\n  if (copy) {\r\n    fbcChatNotify(`${print}\\n\\n**The report has been copied to your clipboard.**`);\r\n    // Not using FBC's debug() to avoid the report ending up on future reports\r\n    console.debug(`${print}\\n\\n**The report has been copied to your clipboard.**`);\r\n    await navigator.clipboard.writeText(print);\r\n  }\r\n  if (skippedFunctionality.length > 0) {\r\n    fbcChatNotify(\r\n      \"If you are running another addon that modifies the game, but is not listed above, please tell its developer to use https://github.com/Jomshir98/bondage-club-mod-sdk to hook into the game instead. This is a very cheap and easy way for addon developers to almost guarantee compatibility with other addons.\"\r\n    );\r\n  }\r\n  return print;\r\n}\r\n\r\nfunction findDrawnCharacters(target?: string, limitVisible = false): Character[] {\r\n  let baseList = limitVisible ? ChatRoomCharacterDrawlist : ChatRoomCharacter;\r\n\r\n  if (ChatRoomMapViewIsActive()) {\r\n    baseList = baseList.filter(ChatRoomMapViewCharacterIsVisible);\r\n  }\r\n\r\n  if (target === null) {\r\n    return baseList;\r\n  }\r\n\r\n  let targetMembers: Character[] = [];\r\n  if (/^\\d+$/u.test(target)) {\r\n    targetMembers = [baseList.find(c => c.MemberNumber === parseInt(target))];\r\n  } else {\r\n    targetMembers = baseList.filter(c =>\r\n      CharacterNickname(c).split(\" \")[0]?.toLowerCase() === target?.toLowerCase() ||\r\n      c.Name.split(\" \")[0].toLowerCase() === target?.toLowerCase()\r\n    );\r\n  }\r\n  return targetMembers.filter(Boolean);\r\n}\r\n\r\nexport default async function commands(): Promise<void> {\r\n  await waitFor(() => !!Commands);\r\n  debug(\"registering additional commands\");\r\n\r\n  CommandCombine([\r\n    {\r\n      Tag: \"fbcdebug\",\r\n      Description: displayText(\"Get debug information to share with developers.\"),\r\n      Action: () => {\r\n        fbcChatNotify(\"Warning: /fbcdebug is deprecated, use /wcedebug instead!\");\r\n        fbcDebug(true);\r\n      },\r\n    },\r\n    {\r\n      Tag: \"fbcchangelog\",\r\n      Description: displayText(\"Show recent WCE changelog\"),\r\n      Action: () => {\r\n        augmentedChatNotify(fbcChangelog);\r\n        fbcChatNotify(\"Warning: /fbcchangelog is deprecated, use /wcechangelog instead!\");\r\n      },\r\n    },\r\n    {\r\n      Tag: \"wcedebug\",\r\n      Description: displayText(\"Get debug information to share with developers.\"),\r\n      Action: () => {\r\n        fbcDebug(true);\r\n      },\r\n    },\r\n    {\r\n      Tag: \"wcechangelog\",\r\n      Description: displayText(\"Show recent WCE changelog\"),\r\n      Action: () => {\r\n        augmentedChatNotify(fbcChangelog);\r\n      },\r\n    },\r\n    {\r\n      Tag: \"wcegotoroom\",\r\n      Description: displayText(\"[room name or empty] switches to the room or leaves room if empty (ignoring all restrictions)\"),\r\n      Action: (_, command) => {\r\n        bceGotoRoom(command.substring(13).trim());\r\n      },\r\n    },\r\n    {\r\n      Tag: \"exportlooks\",\r\n      Description: displayText(\"[target member number]: Copy your or another player's appearance in a format that can be imported with WCE or BCX\"),\r\n      Action: (_, _command, [target]) => {\r\n        let targetCharacter: Character | null = null;\r\n        if (!target) {\r\n          targetCharacter = Player;\r\n        } else {\r\n          targetCharacter = Character.find(c => c.MemberNumber === parseInt(target)) ?? null;\r\n        }\r\n        if (!targetCharacter) {\r\n          logInfo(\"Could not find member\", target);\r\n          return;\r\n        }\r\n        let includeBase = false,\r\n          includeBinds = false,\r\n          includeLocks = false;\r\n        FUSAM.modals.openAsync({\r\n          prompt: displayText(\"Include binds?\"),\r\n          buttons: { cancel: \"No\", submit: \"Yes\" },\r\n        }).then(([bindSubmit]) => {\r\n          includeBinds = bindSubmit === \"submit\";\r\n          if (includeBinds) {\r\n            return FUSAM.modals.openAsync({\r\n              prompt: displayText(\"Include locks?\"),\r\n              buttons: { cancel: \"No\", submit: \"Yes\" },\r\n            }).then(([lockSubmit]) => { includeLocks = lockSubmit === \"submit\"; });\r\n          }\r\n          return null;\r\n        }).then(() => FUSAM.modals.openAsync({\r\n          prompt: displayText(\"Include height, body type, hair, etc?\"),\r\n          buttons: { cancel: \"No\", submit: \"Yes\" },\r\n        })).then(([baseSubmit]) => {\r\n          includeBase = baseSubmit === \"submit\";\r\n\r\n          const base: Item[] = targetCharacter.Appearance.filter(a => a.Asset.Group.IsDefault && !a.Asset.Group.Clothing);\r\n          const clothes: Item[] = targetCharacter.Appearance.filter(a => a.Asset.Group.Category === \"Appearance\" && a.Asset.Group.Clothing);\r\n          const binds: Item[] = targetCharacter.Appearance.filter(a => a.Asset.Group.Category === \"Item\" && !a.Asset.Group.BodyCosplay);\r\n\r\n          const appearance = [...clothes];\r\n          if (includeBinds) appearance.push(...binds);\r\n          if (includeBase) appearance.push(...base);\r\n\r\n          const looks: ItemBundle[] = appearance.map((i) => {\r\n            const property = i.Property ? { ...i.Property } : {};\r\n            if (!includeLocks && property.LockedBy) {\r\n              delete property.LockedBy;\r\n              delete property.LockMemberNumber;\r\n            }\r\n            if (property?.LockMemberNumber) {\r\n              property.LockMemberNumber = Player.MemberNumber;\r\n            }\r\n            return {\r\n              Group: i.Asset.Group.Name,\r\n              Name: i.Asset.Name,\r\n              Color: i.Color,\r\n              Difficulty: i.Difficulty,\r\n              Property: property,\r\n              Craft: i.Craft,\r\n            };\r\n          });\r\n\r\n          const targetName = targetCharacter.IsPlayer() ? \"yourself\" : CharacterNickname(targetCharacter);\r\n          const exportString = LZString.compressToBase64(JSON.stringify(looks));\r\n\r\n          FUSAM.modals.openAsync({\r\n            prompt: displayText(displayText(\"Copy the looks string below\")),\r\n            input: { initial: exportString, readonly: true, type: \"textarea\" },\r\n            buttons: { submit: \"Done\" },\r\n          });\r\n\r\n          return navigator.clipboard.writeText(exportString).then(() => {\r\n            fbcChatNotify(displayText(\"Exported looks for $TargetName copied to clipboard\", { $TargetName: targetName }));\r\n          });\r\n        });\r\n      },\r\n    },\r\n    {\r\n      Tag: \"importlooks\",\r\n      Description: displayText(\"Import looks from a string (BCX or WCE export)\"),\r\n      Action: () => {\r\n        if (!Player.CanChangeOwnClothes() || !OnlineGameAllowChange()) {\r\n          fbcChatNotify(displayText(\"You cannot change your appearance while bound or during online games, such as LARP.\"));\r\n          return;\r\n        }\r\n\r\n        FUSAM.modals.open({\r\n          prompt: displayText(\"Paste your looks here\"),\r\n          input: { initial: \"\", readonly: false, type: \"textarea\" },\r\n          callback: (act, bundleString) => {\r\n            if (act !== \"submit\") return;\r\n            if (!bundleString) {\r\n              fbcChatNotify(displayText(\"No looks string provided\"));\r\n              return;\r\n            }\r\n            try {\r\n              const bundle: ItemBundle[] = bundleString.startsWith(\"[\") ? parseJSON(bundleString) : parseJSON(LZString.decompressFromBase64(bundleString));\r\n              if (!Array.isArray(bundle) || bundle.length === 0 || !bundle[0].Group) throw new Error(\"Invalid bundle\");\r\n\r\n              // Keep items you cannot unlock in your appearance\r\n              for (const item of Player.Appearance) {\r\n                if (item.Property?.LockedBy && !DialogCanUnlock(Player, item)) {\r\n                  const itemBundle: ItemBundle = {\r\n                    Group: item.Asset.Group.Name,\r\n                    Name: item.Asset.Name,\r\n                    Color: item.Color,\r\n                    Difficulty: item.Difficulty,\r\n                    Property: item.Property,\r\n                  };\r\n                  const idx = bundle.findIndex(v => v.Group === item.Asset.Group.Name);\r\n                  if (idx < 0) {\r\n                    bundle.push(itemBundle);\r\n                  } else {\r\n                    bundle[idx] = itemBundle;\r\n                  }\r\n                }\r\n              }\r\n              ServerAppearanceLoadFromBundle(Player, \"Female3DCG\", bundle, Player.MemberNumber);\r\n              ChatRoomCharacterUpdate(Player);\r\n              fbcChatNotify(displayText(\"Applied looks\"));\r\n            } catch (e) {\r\n              console.error(e);\r\n              fbcChatNotify(displayText(\"Could not parse looks\"));\r\n            }\r\n          },\r\n        });\r\n      },\r\n    },\r\n    {\r\n      Tag: \"beep\",\r\n      Description: displayText(\"[membernumber] [message]: beep someone\"),\r\n      Action: (_, command, [target]) => {\r\n        if (BCX?.getRuleState(\"speech_restrict_beep_send\")?.isEnforced) {\r\n          fbcChatNotify(displayText(\"Sending beeps is restricted by BCX rule.\"));\r\n          return;\r\n        }\r\n        const [, , ...message] = command.split(\" \");\r\n        const msg = message?.join(\" \");\r\n        if (!target || !msg || !/^\\d+$/u.test(target)) {\r\n          fbcChatNotify(displayText(\"beep target or message not provided\"));\r\n          return;\r\n        }\r\n\r\n        const targetMemberNumber = parseInt(target);\r\n        if (!Player.FriendList?.includes(targetMemberNumber)) {\r\n          fbcChatNotify(displayText(\"$Target is not in your friend list\", { $Target: target }));\r\n          return;\r\n        }\r\n\r\n        const targetName = Player.FriendNames?.get(targetMemberNumber);\r\n        ServerSend(\"AccountBeep\", {\r\n          BeepType: \"\",\r\n          MemberNumber: targetMemberNumber,\r\n          Message: msg,\r\n          IsSecret: true,\r\n        });\r\n        FriendListBeepLog.push({\r\n          MemberNumber: targetMemberNumber,\r\n          MemberName: targetName ?? `unknown (${targetMemberNumber})`,\r\n          Sent: true,\r\n          Private: false,\r\n          Time: new Date(),\r\n          Message: msg,\r\n        });\r\n\r\n        const beepId = FriendListBeepLog.length - 1;\r\n        const link = document.createElement(\"a\");\r\n        link.href = `#beep-${beepId}`;\r\n        link.onclick = (e) => {\r\n          e.preventDefault();\r\n          ServerOpenFriendList();\r\n          FriendListModeIndex = 1;\r\n          FriendListShowBeep(beepId);\r\n        };\r\n        link.textContent = displayText(\"(Beep to $Name ($Number): $Message)\", {\r\n          $Name: targetName ?? \"unknown\",\r\n          $Number: targetMemberNumber.toString(),\r\n          $Message: msg.length > 150 ? `${msg.substring(0, 150)}...` : msg,\r\n        });\r\n        link.classList.add(\"bce-beep-link\");\r\n        fbcChatNotify(link);\r\n      },\r\n    },\r\n    {\r\n      Tag: \"w\",\r\n      Description: displayText(\r\n        \"[target name] [message]: whisper the target player. Use first name only. Finds the first person in the room with a matching name, left-to-right, top-to-bottom.\"\r\n      ),\r\n      Action: (_, command, args) => {\r\n        if (args.length < 2) {\r\n          fbcChatNotify(displayText(\"Whisper target or message not provided\"));\r\n          return;\r\n        }\r\n\r\n        const [target] = args;\r\n        const [, , ...message] = command.split(\" \");\r\n        const msg = message?.join(\" \");\r\n        const targetMembers = findDrawnCharacters(target);\r\n        if (!target || !targetMembers || targetMembers.length === 0) {\r\n          fbcChatNotify(`Whisper target not found: ${target}`);\r\n        } else if (targetMembers.length > 1) {\r\n          fbcChatNotify(displayText(\r\n            \"Multiple whisper targets found: $Targets. You can still whisper the player by clicking their name or by using their member number.\",\r\n            { $Targets: targetMembers.map(c => `${CharacterNickname(c)} (${c.MemberNumber ?? \"\"})`).join(\", \") }\r\n          ));\r\n        } else if (targetMembers[0].IsPlayer()) {\r\n          fbcChatNotify(\"You can't whisper yourself!\");\r\n        } else if (!msg) {\r\n          fbcChatNotify(displayText(\"No message provided\"));\r\n        } else {\r\n          const targetMemberNumber = targetMembers[0].MemberNumber;\r\n          const originalTarget = ChatRoomTargetMemberNumber;\r\n          ChatRoomTargetMemberNumber = targetMemberNumber ?? -1;\r\n          ElementValue(\"InputChat\", `${msg.length > 0 && [\".\", \"/\"].includes(msg[0]) ? \"\\u200b\" : \"\"}${msg}`);\r\n          ChatRoomSendChat();\r\n          // Erase duplicate from history to prevent things like automatic shock collars listening to the history from triggering\r\n          ChatRoomLastMessage.pop();\r\n          ChatRoomTargetMemberNumber = originalTarget;\r\n        }\r\n      },\r\n    },\r\n    {\r\n      Tag: \"versions\",\r\n      Description: displayText(\"show versions of the club, WCE, BCX and other mods in use by players\"),\r\n      Action: (_, _command, args) => {\r\n        function getCharacterModInfo(character: Character): string {\r\n          const bcVersion = character.OnlineSharedSettings?.GameVersion ?? \"R0\";\r\n          const BCXi = window.bcx?.getCharacterVersion(character.MemberNumber) ?\r\n            ` BCX ${window.bcx.getCharacterVersion(character.MemberNumber) ?? \"?\"}` :\r\n            \"\";\r\n          const FBCi = character.FBC ? `\\nWCE v${character.FBC} Alt Arousal: ${character.BCEArousal?.toString()}` : \"\";\r\n          const others = character.FBCOtherAddons?.some(mod => ![\"BCX\", \"FBC\", \"WCE\"].includes(mod.name)) ?\r\n            `\\nOther Addons:\\n- ${character.FBCOtherAddons.filter(mod => ![\"BCX\", \"FBC\", \"WCE\"].includes(mod.name))\r\n              .map(mod => `${mod.name} v${mod.version} ${mod.repository ?? \"\"}`).join(\"\\n- \")}` :\r\n            \"\";\r\n          return `${CharacterNickname(character)} (${character.MemberNumber ?? \"\"}) club ${bcVersion}${BCXi}${FBCi}${others}`;\r\n        }\r\n\r\n        const printList = findDrawnCharacters(args.length > 0 ? args[0] : null, true);\r\n        const versionOutput = printList.map(getCharacterModInfo).filter(info => info).join(\"\\n\\n\");\r\n        fbcChatNotify(versionOutput);\r\n        debug(versionOutput);\r\n      },\r\n    },\r\n    {\r\n      Tag: \"ulistadd\",\r\n      Description: displayText(\"[membernumber]: adds a player to the list allowing to bypass Uwall.\"),\r\n      Action: (_, _command, args) => {\r\n        if (args.length < 1) {\r\n          fbcChatNotify(\"The ulistadd command must be followed by the member number of the player that you allow to bypass Uwall.\");\r\n        } else {\r\n          const member = parseInt(args[0]);\r\n          const Ulist = Player.OnlineSharedSettings.Ulist ?? [];\r\n          if (!isNaN(member) && member > 0 && member !== Player.MemberNumber && !Ulist.includes(member)) {\r\n            Player.OnlineSharedSettings.Ulist = [...Ulist, member];\r\n            ServerAccountUpdate.QueueData({ OnlineSharedSettings: Player.OnlineSharedSettings });\r\n          }\r\n          if (!fbcSettings.uwall) fbcChatNotify(\"Warning: Uwall is not activated in WCE's settings.\");\r\n        }\r\n      },\r\n    },\r\n    {\r\n      Tag: \"ulistremove\",\r\n      Description: displayText(\"[membernumber]: removes a player from the list allowing to bypass Uwall.\"),\r\n      Action: (_, _command, args) => {\r\n        if (args.length < 1) {\r\n          fbcChatNotify(\"The ulistremove command must be followed by the member number of the player who is no more allowed to bypass Uwall.\");\r\n        } else {\r\n          const member = parseInt(args[0]);\r\n          const { Ulist } = Player.OnlineSharedSettings;\r\n          if (Array.isArray(Ulist) && !isNaN(member) && member > 0 && member !== Player.MemberNumber) {\r\n            Player.OnlineSharedSettings.Ulist = Ulist.filter(m => m !== member);\r\n            ServerAccountUpdate.QueueData({ OnlineSharedSettings: Player.OnlineSharedSettings });\r\n          }\r\n          if (!fbcSettings.uwall) fbcChatNotify(\"Warning: Uwall is not activated in WCE's settings.\");\r\n        }\r\n      },\r\n    },\r\n    {\r\n      Tag: \"ulistshow\",\r\n      Description: displayText(\"displays the list of players allowed to bypass Uwall.\"),\r\n      Action: () => {\r\n        fbcChatNotify(`Ulist: ${JSON.stringify(Player.OnlineSharedSettings.Ulist ?? [])}`);\r\n        if (!fbcSettings.uwall) fbcChatNotify(\"Warning: Uwall is not activated in WCE's settings.\");\r\n      },\r\n    },\r\n  ]);\r\n}\r\n","import { toySyncState } from \"./toySync\";\r\nimport { waitFor, drawTooltip } from \"../util/utils\";\r\nimport { debug, logWarn, logError } from \"../util/logger\";\r\nimport { fbcSettings, defaultSettings, bceSaveSettings, isDefaultSettingKey, type SelectSetting, type SettingsCategory } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { BCE_LICENSE, /* DISCORD_INVITE_URL, */ WEBSITE_URL } from \"../util/constants\";\r\n\r\nconst SelectButtonOffset = 900;\r\nconst SelectButtonWidth = 200;\r\n\r\n// Create settings page\r\nexport default async function settingsPage(): Promise<void> {\r\n  await waitFor(() => !!PreferenceRegisterExtensionSetting);\r\n\r\n  debug(\"initializing\");\r\n\r\n  const settingsPerPage = 8,\r\n    settingsYIncrement = 70,\r\n    settingsYStart = 225;\r\n\r\n  function settingsPageCount(category: SettingsCategory): number {\r\n    return Math.ceil(Object.values(defaultSettings).filter(v => v.category === category).length / settingsPerPage);\r\n  }\r\n\r\n  // const discordInvitePosition = [1500, 60, 250, 50] as const;\r\n  const licensePosition = [1500, /* 120 */ 60, 250, 50] as const;\r\n  const websitePosition = [1240, 60, 250, 50] as const;\r\n  let currentPageNumber = 0;\r\n\r\n  let currentCategory: SettingsCategory | null = null;\r\n  let currentSetting = \"\";\r\n\r\n  // Excludes hidden\r\n  const settingsCategories: SettingsCategory[] = [\r\n    \"chat\",\r\n    \"activities\",\r\n    \"appearance\",\r\n    \"immersion\",\r\n    \"antigarble\",\r\n    \"performance\",\r\n    \"misc\",\r\n    \"cheats\",\r\n    \"buttplug\",\r\n  ];\r\n  const settingCategoryLabels = {\r\n    chat: \"Chat & Social\",\r\n    activities: \"Activities & Arousal\",\r\n    appearance: \"Appearance & Wardrobe\",\r\n    immersion: \"Immersion & Anti-Cheat\",\r\n    antigarble: \"Gagspeak & Anti-Garble\",\r\n    performance: \"Performance\",\r\n    misc: \"Misc\",\r\n    cheats: \"Cheats\",\r\n    buttplug: \"Buttplug.io Toys\",\r\n    hidden: \"\",\r\n  } as const;\r\n\r\n  const vibratingSlots = [\r\n    \"None\",\r\n    ...new Set(Asset.filter(a => a.AllowEffect?.includes(\"Vibrating\") || a.AllowEffect?.includes(\"Egged\")).map(a => a.Group.Name)),\r\n  ];\r\n\r\n  const scanButtonPosition = [1650, 225, 150, 50] as const;\r\n\r\n  function currentDefaultSettings(category: SettingsCategory) {\r\n    return Object.entries(defaultSettings).filter(([k, v]) => v.category === category && k !== \"buttplugDevices\");\r\n  }\r\n\r\n  function PreferenceSubscreenBCESettingsLoad(): void {\r\n    ElementCreateInput(\"WceIntifaceAddress\", \"text\", fbcSettings.toySyncAddress);\r\n    ElementPosition(\"WceIntifaceAddress\", -999, -999, 550);\r\n    currentPageNumber = 0;\r\n  }\r\n  function PreferenceSubscreenBCESettingsExit(): void {\r\n    fbcSettings.toySyncAddress = ElementValue(\"WceIntifaceAddress\");\r\n    ElementRemove(\"WceIntifaceAddress\");\r\n    bceSaveSettings();\r\n    PreferenceSubscreenExtensionsClear();\r\n  }\r\n\r\n  function PreferenceSubscreenBCESettingsRun(): void {\r\n    const ctx = window.MainCanvas.getContext(\"2d\");\r\n    if (!ctx) {\r\n      logError(\"Could not get canvas context\");\r\n      return;\r\n    }\r\n    ctx.textAlign = \"left\";\r\n    DrawText(\r\n      displayText(currentCategory ? `WCE Settings - ${settingCategoryLabels[currentCategory]}` : \"Wholesome Club Extensions (WCE) Settings\"),\r\n      300,\r\n      125,\r\n      \"Black\",\r\n      \"Gray\"\r\n    );\r\n    /* DrawButton(...discordInvitePosition, \"\", \"White\", \"\");\r\n    DrawText(\r\n      displayText(\"Join Discord\"),\r\n      discordInvitePosition[0] + 20,\r\n      discordInvitePosition[1] + discordInvitePosition[3] / 2,\r\n      \"Black\",\r\n      \"\"\r\n    ); */\r\n    DrawButton(...licensePosition, \"\", \"White\", \"\");\r\n    DrawText(displayText(\"License\"), licensePosition[0] + 20, licensePosition[1] + licensePosition[3] / 2, \"Black\", \"\");\r\n    DrawButton(...websitePosition, \"\", \"White\", \"\");\r\n    DrawText(\r\n      displayText(\"Information\"),\r\n      websitePosition[0] + 20,\r\n      websitePosition[1] + websitePosition[3] / 2,\r\n      \"Black\",\r\n      \"\"\r\n    );\r\n    DrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\");\r\n\r\n    if (currentCategory) {\r\n      let y = settingsYStart;\r\n      for (const [settingName, defaultSetting] of currentDefaultSettings(currentCategory).slice(\r\n        currentPageNumber * settingsPerPage,\r\n        currentPageNumber * settingsPerPage + settingsPerPage\r\n      )) {\r\n        if (defaultSetting.type === \"select\" && Array.isArray((defaultSetting as SelectSetting).options)) {\r\n          const defSetting = defaultSetting as SelectSetting;\r\n          const idx = defSetting.options.indexOf(fbcSettings[settingName] as string);\r\n          const len = defSetting.options.length;\r\n          const disabled = defSetting.disabled?.() || false;\r\n          DrawText(\r\n            displayText(defaultSetting.label),\r\n            400,\r\n            y + 33,\r\n            currentSetting === settingName ? \"Red\" : \"Black\",\r\n            \"Gray\"\r\n          );\r\n          DrawBackNextButton(\r\n            SelectButtonOffset,\r\n            y,\r\n            SelectButtonWidth,\r\n            64,\r\n            displayText(defSetting.options[idx]),\r\n            disabled ? \"#ebebe4\" : \"White\",\r\n            \"\",\r\n            () => displayText(`${defaultSetting.label} ${defSetting.options[(idx - 1 + len) % len]}`),\r\n            () => displayText(`${defaultSetting.label} ${defSetting.options[(idx + 1 + len) % len]}`),\r\n            disabled\r\n          );\r\n        } else {\r\n          DrawCheckbox(\r\n            300,\r\n            y,\r\n            64,\r\n            64,\r\n            displayText(defaultSetting.label),\r\n            !!fbcSettings[settingName],\r\n            defaultSetting.disabled(),\r\n            currentSetting === settingName ? \"Red\" : \"Black\"\r\n          );\r\n        }\r\n        y += settingsYIncrement;\r\n      }\r\n      if (currentCategory === \"buttplug\") {\r\n        DrawText(\r\n          displayText(\"This page allows configuration of the synchronization of bluetooth connected toys.\"),\r\n          300,\r\n          350,\r\n          \"Black\",\r\n          \"Gray\"\r\n        );\r\n        ElementPosition(\"WceIntifaceAddress\", 1300, settingsYStart + 32, 550);\r\n        if (fbcSettings.toySync) {\r\n          if (!toySyncState.client?.connected) {\r\n            DrawText(displayText(\"Still connecting or connection failed...\"), 300, 450, \"Black\", \"Gray\");\r\n          } else {\r\n            ctx.textAlign = \"center\";\r\n            DrawButton(\r\n              ...scanButtonPosition,\r\n              displayText(\"Scan\"),\r\n              toySyncState.client.isScanning ? \"Grey\" : \"White\",\r\n              \"\",\r\n              // Bc types do not accept null\r\n              // eslint-disable-next-line no-undefined\r\n              toySyncState.client.isScanning ? \"Already scanning\" : undefined,\r\n              toySyncState.client.isScanning\r\n            );\r\n            ctx.textAlign = \"left\";\r\n            DrawText(displayText(\"Device Name\"), 300, 420, \"Black\", \"Gray\");\r\n            DrawText(displayText(\"Synchronized Slot\"), 800, 420, \"Black\", \"Gray\");\r\n            y = 500;\r\n            for (const d of toySyncState.client.devices.filter(dev => dev.vibrateAttributes.length > 0)) {\r\n              let deviceSettings = toySyncState.deviceSettings.get(d.name);\r\n              if (!deviceSettings) {\r\n                deviceSettings = {\r\n                  Name: d.name,\r\n                  SlotName: \"None\",\r\n                };\r\n                toySyncState.deviceSettings.set(d.name, deviceSettings);\r\n              }\r\n              const currentIdx = vibratingSlots.indexOf(deviceSettings.SlotName);\r\n              let nextIdx = 0,\r\n                previousIdx = 0;\r\n              if (currentIdx <= 0) {\r\n                previousIdx = vibratingSlots.length - 1;\r\n              } else {\r\n                previousIdx = currentIdx - 1;\r\n              }\r\n              if (currentIdx === vibratingSlots.length - 1) {\r\n                nextIdx = 0;\r\n              } else {\r\n                nextIdx = currentIdx + 1;\r\n              }\r\n              DrawText(d.name, 300, y, \"Black\", \"Gray\");\r\n\r\n              ctx.textAlign = \"center\";\r\n              DrawBackNextButton(\r\n                800,\r\n                y - 32,\r\n                450,\r\n                64,\r\n                displayText(deviceSettings.SlotName),\r\n                \"white\",\r\n                \"\",\r\n                () => displayText(vibratingSlots[previousIdx]),\r\n                () => displayText(vibratingSlots[nextIdx])\r\n              );\r\n              ctx.textAlign = \"left\";\r\n              y += settingsYIncrement;\r\n              if (y > 950) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        DrawText(displayText(\"Click on a setting to see its description\"), 300, 160, \"Gray\", \"Silver\");\r\n\r\n        if (isDefaultSettingKey(currentSetting)) {\r\n          if (defaultSettings[currentSetting].type === \"select\" && Array.isArray((defaultSettings[currentSetting] as SelectSetting).tooltips)) {\r\n            const defSetting = defaultSettings[currentSetting] as SelectSetting;\r\n            const idx = defSetting.options.indexOf(fbcSettings[currentSetting] as string);\r\n            drawTooltip(300, 800, 1600, displayText(defSetting.description), \"left\");\r\n            drawTooltip(330, 870, 1570, displayText(defSetting.tooltips[idx]), \"left\");\r\n          } else {\r\n            drawTooltip(300, 830, 1600, displayText(defaultSettings[currentSetting].description), \"left\");\r\n          }\r\n        }\r\n        if (settingsPageCount(currentCategory) > 1) {\r\n          DrawText(`${currentPageNumber + 1} / ${settingsPageCount(currentCategory)}`, 1700, 230, \"Black\", \"Gray\");\r\n          DrawButton(1815, 180, 90, 90, \"\", \"White\", \"Icons/Next.png\");\r\n        }\r\n      }\r\n    } else {\r\n      let y = settingsYStart;\r\n      for (const category of settingsCategories) {\r\n        DrawButton(300, y, 400, 64, \"\", \"White\");\r\n        DrawTextFit(displayText(settingCategoryLabels[category]), 310, y + 32, 380, \"Black\");\r\n        y += settingsYIncrement;\r\n      }\r\n    }\r\n    ctx.textAlign = \"center\";\r\n  }\r\n  // eslint-disable-next-line complexity\r\n  function PreferenceSubscreenBCESettingsClick() {\r\n    let y = settingsYStart;\r\n    if (MouseIn(1815, 75, 90, 90)) {\r\n      if (currentCategory === null) {\r\n        PreferenceSubscreenBCESettingsExit();\r\n      } else {\r\n        ElementPosition(\"WceIntifaceAddress\", -999, -999, 550);\r\n        currentCategory = null;\r\n      }\r\n    } else if (MouseIn(...licensePosition)) {\r\n      open(BCE_LICENSE, \"_blank\");\r\n    /* } else if (MouseIn(...discordInvitePosition)) {\r\n      open(DISCORD_INVITE_URL, \"_blank\"); */\r\n    } else if (MouseIn(...websitePosition)) {\r\n      open(WEBSITE_URL, \"_blank\");\r\n    } else if (currentCategory !== null) {\r\n      if (MouseIn(1815, 180, 90, 90) && currentCategory !== \"buttplug\") {\r\n        currentPageNumber += 1;\r\n        currentPageNumber %= settingsPageCount(currentCategory);\r\n      } else {\r\n        for (const [settingName, defaultSetting] of currentDefaultSettings(currentCategory).slice(\r\n          currentPageNumber * settingsPerPage,\r\n          currentPageNumber * settingsPerPage + settingsPerPage\r\n        )) {\r\n          if (defaultSetting.type === \"select\" && Array.isArray((defaultSetting as SelectSetting).options)) {\r\n            const defSetting = defaultSetting as SelectSetting;\r\n            const segWidth = SelectButtonWidth / 2;\r\n            const idx = defSetting.options.indexOf(fbcSettings[settingName] as string);\r\n            const len = defSetting.options.length;\r\n            if (MouseIn(SelectButtonOffset + segWidth, y, segWidth, 64) && (!defSetting.disabled?.())) {\r\n              fbcSettings[settingName] = defSetting.options[(idx + 1 + len) % len];\r\n            } else if (MouseIn(SelectButtonOffset, y, segWidth, 64) && (!defSetting.disabled?.())) {\r\n              fbcSettings[settingName] = defSetting.options[(idx - 1 + len) % len];\r\n            }\r\n          } else if (MouseIn(300, y, 64, 64) && (!defaultSetting.disabled?.())) {\r\n            fbcSettings[settingName] = !fbcSettings[settingName];\r\n            defaultSetting.sideEffects(fbcSettings[settingName], false);\r\n          }\r\n          if (MouseIn(364, y, 1000, 64)) {\r\n            currentSetting = settingName;\r\n            debug(\"currentSetting\", currentSetting);\r\n          }\r\n          y += settingsYIncrement;\r\n        }\r\n      }\r\n      if (currentCategory === \"buttplug\" && toySyncState.client?.connected) {\r\n        if (MouseIn(...scanButtonPosition)) {\r\n          if (!toySyncState.client.isScanning) {\r\n            toySyncState.client.startScanning();\r\n          }\r\n          return;\r\n        }\r\n        y = 500;\r\n        for (const d of toySyncState.client.devices.filter(dev => dev.vibrateAttributes.length > 0)) {\r\n          if (!MouseIn(800, y - 32, 450, 64)) {\r\n            y += settingsYIncrement;\r\n            continue;\r\n          }\r\n          const deviceSettings = toySyncState.deviceSettings.get(d.name);\r\n          if (!deviceSettings) {\r\n            logWarn(\"Could not find device settings for\", d.name, toySyncState.deviceSettings);\r\n            y += settingsYIncrement;\r\n            continue;\r\n          }\r\n          const currentIdx = vibratingSlots.indexOf(deviceSettings.SlotName);\r\n          let nextIdx = 0,\r\n            previousIdx = 0;\r\n          if (currentIdx <= 0) {\r\n            previousIdx = vibratingSlots.length - 1;\r\n          } else {\r\n            previousIdx = currentIdx - 1;\r\n          }\r\n          if (currentIdx === vibratingSlots.length - 1) {\r\n            nextIdx = 0;\r\n          } else {\r\n            nextIdx = currentIdx + 1;\r\n          }\r\n\r\n          if (MouseX < 800 + 450 / 2) {\r\n            deviceSettings.SlotName = vibratingSlots[previousIdx];\r\n          } else {\r\n            deviceSettings.SlotName = vibratingSlots[nextIdx];\r\n          }\r\n\r\n          y += settingsYIncrement;\r\n          if (y > 950) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const category of settingsCategories) {\r\n        if (MouseIn(300, y, 400, 64)) {\r\n          currentCategory = category;\r\n          currentPageNumber = 0;\r\n          break;\r\n        }\r\n        y += settingsYIncrement;\r\n      }\r\n    }\r\n  }\r\n\r\n  PreferenceRegisterExtensionSetting({\r\n    Identifier: \"WCE\",\r\n    ButtonText: displayText(\"WCE Settings\"),\r\n    Image: `${PUBLIC_URL}/icon.png`,\r\n    click: PreferenceSubscreenBCESettingsClick,\r\n    run: PreferenceSubscreenBCESettingsRun,\r\n    exit: PreferenceSubscreenBCESettingsExit,\r\n    load: PreferenceSubscreenBCESettingsLoad,\r\n  });\r\n\r\n  function keyHandler(e: KeyboardEvent): void {\r\n    if (e.key === \"Escape\" && currentCategory !== null) {\r\n      currentCategory = null;\r\n      ElementPosition(\"WceIntifaceAddress\", -999, -999, 550);\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  document.addEventListener(\"keydown\", keyHandler, true);\r\n  document.addEventListener(\"keypress\", keyHandler, true);\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { waitFor } from \"../util/utils\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { debug } from \"../util/logger\";\r\n\r\nexport default async function lockpickHelp() {\r\n    await waitFor(() => !!StruggleMinigames);\r\n\r\n  /** @type {(s: number) => () => number} */\r\n  function newRand(s) {\r\n    return () => {\r\n      s = Math.sin(s) * 10000;\r\n      return s - Math.floor(s);\r\n    };\r\n  }\r\n\r\n    const pinSpacing = 100,\r\n        pinWidth = 200,\r\n        x = 1575,\r\n        y = 300;\r\n\r\n  SDK.hookFunction(\r\n    \"StruggleLockPickDraw\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (fbcSettings.lockpick && StruggleLockPickOrder) {\r\n        const hints = StruggleLockPickOrder.map((a) => {\r\n          return a;\r\n        });\r\n        for (let p = 0; p < hints.length; p++) {\r\n          // Replicates pin rendering in the game Struggle.js\r\n          const xx = x - pinWidth / 2 + (0.5 - hints.length / 2 + p) * pinSpacing;\r\n        DrawText(`${StruggleLockPickOrder.indexOf(p) + 1}`, xx, y, \"white\");\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n  debug(\"hooking struggle for lockpick cheat draw\", StruggleMinigames);\r\n  StruggleMinigames.LockPick.Draw = StruggleLockPickDraw;\r\n}\r\n","/* eslint-disable @typescript-eslint/no-unsafe-assignment */\r\nimport { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { waitFor, sleep, parseJSON, isString } from \"../util/utils\";\r\nimport { debug, logWarn } from \"../util/logger\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default async function automaticReconnect() {\r\n  const { Dexie } = await import(\"dexie\");\r\n  const db = new Dexie(\"wce-saved-accounts\");\r\n  db.version(2).stores({\r\n    key: \"id, key\",\r\n    accounts: \"id, data, iv, auth\",\r\n  });\r\n  const keyTable = db.table(\"key\");\r\n  const accTable = db.table(\"accounts\");\r\n\r\n  let /** @type {CryptoKey} */ encKey, /** @type {{key: CryptoKey;}} */ key;\r\n  try {\r\n    key = await keyTable.get({ id: 1 });\r\n  } catch (e) {\r\n    logWarn(e);\r\n    localStorage.removeItem(\"bce.passwords\");\r\n    await db.delete();\r\n    window.location.reload();\r\n  }\r\n  if (!key) {\r\n    encKey = await window.crypto.subtle.generateKey({ name: \"AES-GCM\", length: 256 }, false, [\"encrypt\", \"decrypt\"]);\r\n    await keyTable.put({ id: 1, key: encKey });\r\n  } else {\r\n    encKey = key.key;\r\n  }\r\n\r\n  /** @type {() => Promise<Passwords>} */\r\n  async function loadAccounts() {\r\n    const d = localStorage.getItem(\"bce.passwords\");\r\n    if (d) {\r\n      /** @type {Passwords} */\r\n      const accs = parseJSON(d) || {};\r\n      if (window.crypto?.subtle) {\r\n        setTimeout(() => {\r\n          localStorage.removeItem(\"bce.passwords\");\r\n          storeAccounts(accs);\r\n        }, 1);\r\n      }\r\n      return accs;\r\n    }\r\n    /** @type {{auth: Uint8Array; iv: Uint8Array; data: Uint8Array;}} */\r\n    const res = await accTable.get({ id: 1 });\r\n    if (!res) return {};\r\n    const { auth, iv, data } = res;\r\n    const decoder = new TextDecoder(\"utf8\");\r\n    try {\r\n      const s = await window.crypto.subtle.decrypt({ name: \"AES-GCM\", iv, additionalData: auth, tagLength: 128 }, encKey, data);\r\n      // eslint-disable-next-line @typescript-eslint/return-await\r\n      return parseJSON(decoder.decode(new Uint8Array(s))) || {};\r\n    } catch (e) {\r\n      logWarn(e);\r\n      localStorage.removeItem(\"bce.passwords\");\r\n      keyTable.clear();\r\n      accTable.clear();\r\n      return {};\r\n    }\r\n  }\r\n\r\n  let accounts = await loadAccounts();\r\n\r\n  /** @type {() => Passwords} */\r\n  function loadPasswords() {\r\n    return accounts || {};\r\n  }\r\n\r\n  /** @type {(accs: Passwords) => void} */\r\n  function storeAccounts(accs) {\r\n    if (window.crypto?.subtle) {\r\n      const iv = window.crypto.getRandomValues(new Uint8Array(16));\r\n      const auth = window.crypto.getRandomValues(new Uint8Array(16));\r\n      const encoder = new TextEncoder();\r\n      accounts = accs;\r\n      window.crypto.subtle.encrypt(\r\n        { name: \"AES-GCM\", iv, additionalData: auth, tagLength: 128 },\r\n        encKey,\r\n        encoder.encode(JSON.stringify(accs))\r\n      ).then(s => accTable.put({ id: 1, iv, auth, data: new Uint8Array(s) }, [1]));\r\n    } else {\r\n      localStorage.removeItem(\"bce.passwords\");\r\n    }\r\n  }\r\n\r\n  /** @type {() => void} */\r\n  function updatePasswordForReconnect() {\r\n    let name = \"\";\r\n    if (CurrentScreen === \"Login\") {\r\n      name = ElementValue(\"InputName\").toUpperCase();\r\n    } else if (CurrentScreen === \"Relog\") {\r\n      name = Player.AccountName;\r\n    }\r\n\r\n    const passwords = loadPasswords();\r\n    passwords[name] = ElementValue(\"InputPassword\");\r\n    storeAccounts(passwords);\r\n  }\r\n  globalThis.bceUpdatePasswordForReconnect = updatePasswordForReconnect;\r\n\r\n  /** @type {(accountname: string) => void} */\r\n  function clearPassword(accountname) {\r\n    const passwords = loadPasswords();\r\n    if (!Object.hasOwn(passwords, accountname)) {\r\n      return;\r\n    }\r\n    delete passwords[accountname];\r\n    storeAccounts(passwords);\r\n  }\r\n  globalThis.bceClearPassword = clearPassword;\r\n\r\n  let lastClick = Date.now();\r\n\r\n  async function loginCheck() {\r\n    await waitFor(() => CurrentScreen === \"Login\");\r\n\r\n    /** @type {{ passwords: Passwords, posMaps: Record<string, string> }} */\r\n    const loginData = {\r\n      passwords: loadPasswords(),\r\n      posMaps: {},\r\n    };\r\n\r\n    SDK.hookFunction(\r\n      \"LoginRun\",\r\n      HOOK_PRIORITIES.Top,\r\n      (args, next) => {\r\n        const ret = next(args);\r\n        if (Object.keys(loginData.passwords).length > 0) {\r\n          DrawText(displayText(\"Saved Logins (WCE)\"), 170, 35, \"White\", \"Black\");\r\n        }\r\n        DrawButton(1250, 387, 180, 50, displayText(\"Save (WCE)\"), \"White\");\r\n\r\n        let y = 60;\r\n        for (const user in loginData.passwords) {\r\n          if (!Object.hasOwn(loginData.passwords, user)) {\r\n            continue;\r\n          }\r\n          loginData.posMaps[y] = user;\r\n          DrawButton(10, y, 350, 60, user, \"White\");\r\n          DrawButton(355, y, 60, 60, \"X\", \"White\");\r\n          y += 70;\r\n        }\r\n        return ret;\r\n      }\r\n    );\r\n\r\n    SDK.hookFunction(\r\n      \"LoginClick\",\r\n      HOOK_PRIORITIES.Top,\r\n      (args, next) => {\r\n        const ret = next(args);\r\n        if (MouseIn(1250, 385, 180, 60)) {\r\n          updatePasswordForReconnect();\r\n          loginData.posMaps = {};\r\n          loginData.passwords = loadPasswords();\r\n        }\r\n        const now = Date.now();\r\n        if (now - lastClick < 150) {\r\n          return ret;\r\n        }\r\n        lastClick = now;\r\n        for (const pos in loginData.posMaps) {\r\n          if (!Object.hasOwn(loginData.posMaps, pos)) {\r\n            continue;\r\n          }\r\n          const idx = parseInt(pos);\r\n          if (MouseIn(10, idx, 350, 60)) {\r\n            ElementValue(\"InputName\", loginData.posMaps[idx]);\r\n            ElementValue(\"InputPassword\", loginData.passwords[loginData.posMaps[idx]]);\r\n            LoginDoLogin();\r\n          } else if (MouseIn(355, idx, 60, 60)) {\r\n            clearPassword(loginData.posMaps[idx]);\r\n            loginData.posMaps = {};\r\n            loginData.passwords = loadPasswords();\r\n          }\r\n        }\r\n        return ret;\r\n      }\r\n    );\r\n\r\n    CurrentScreenFunctions.Run = LoginRun;\r\n    CurrentScreenFunctions.Click = LoginClick;\r\n  }\r\n  loginCheck();\r\n\r\n  let breakCircuit = false;\r\n  let breakCircuitFull = false;\r\n\r\n  async function relog() {\r\n    if (\r\n      !Player?.AccountName ||\r\n      !ServerIsConnected ||\r\n      LoginSubmitted ||\r\n      !ServerSocket.connected ||\r\n      breakCircuit ||\r\n      breakCircuitFull ||\r\n      !fbcSettings.relogin\r\n    ) {\r\n      return;\r\n    }\r\n    breakCircuit = true;\r\n    const passwords = loadPasswords();\r\n    debug(\"Attempting to log in again as\", Player.AccountName);\r\n    if (!passwords[Player.AccountName]) {\r\n      logWarn(\"No saved credentials for account\", Player.AccountName);\r\n      return;\r\n    }\r\n    LoginSetSubmitted();\r\n    ServerSend(\"AccountLogin\", {\r\n      AccountName: Player.AccountName,\r\n      Password: passwords[Player.AccountName],\r\n    });\r\n    if (\r\n      !(await waitFor(\r\n        () => CurrentScreen !== \"Relog\",\r\n        () => !breakCircuit\r\n      ))\r\n    ) {\r\n      logWarn(\"Relogin failed, circuit was restored\");\r\n    }\r\n    await sleep(500);\r\n    SDK.callOriginal(\"ServerAccountBeep\", [\r\n      {\r\n        MemberNumber: Player.MemberNumber || -1,\r\n        BeepType: \"\",\r\n        MemberName: \"VOID\",\r\n        ChatRoomName: \"VOID\",\r\n        Private: true,\r\n        Message: displayText(\"Reconnected!\"),\r\n        ChatRoomSpace: \"\",\r\n      },\r\n    ]);\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"RelogRun\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      const forbiddenReasons = [\"ErrorDuplicatedLogin\"];\r\n      if (!forbiddenReasons.includes(LoginErrorMessage)) {\r\n        relog();\r\n      } else if (!breakCircuit) {\r\n        SDK.callOriginal(\"ServerAccountBeep\", [\r\n          {\r\n            MemberNumber: Player.MemberNumber || -1,\r\n            BeepType: \"\",\r\n            MemberName: Player.Name,\r\n            ChatRoomName: displayText(\"ERROR\"),\r\n            Private: true,\r\n            Message: displayText(\r\n              \"Signed in from a different location! Refresh the page to re-enable relogin in this tab.\"\r\n            ),\r\n            ChatRoomSpace: \"\",\r\n          },\r\n        ]);\r\n        breakCircuit = true;\r\n        breakCircuitFull = true;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"RelogExit\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      breakCircuit = false;\r\n      breakCircuitFull = false;\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  registerSocketListener(\"connect\", () => {\r\n    breakCircuit = false;\r\n  });\r\n\r\n  SDK.hookFunction(\r\n    \"ServerDisconnect\",\r\n    HOOK_PRIORITIES.ModifyBehaviourHigh,\r\n    (args, next) => {\r\n      const [, force] = args;\r\n      args[1] = false;\r\n      const ret = next(args);\r\n      if (force) {\r\n        logWarn(\"Forcefully disconnected\", args);\r\n        ServerSocket.disconnect();\r\n        if (isString(args[0]) && [\"ErrorRateLimited\", \"ErrorDuplicatedLogin\"].includes(args[0])) {\r\n          // Reconnect after 3-6 seconds if rate limited\r\n          logWarn(\"Reconnecting...\");\r\n          setTimeout(\r\n            () => {\r\n              logWarn(\"Connecting...\");\r\n              ServerInit();\r\n            },\r\n            3000 + Math.round(Math.random() * 3000)\r\n          );\r\n        } else {\r\n          logWarn(\"Disconnected.\");\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n}\r\n","import { patchFunction, SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { waitFor, isCharacter, deepCopy, fbcSendAction, parseJSON } from \"../util/utils\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\ndeclare global {\r\n  interface ItemProperties {\r\n    wceOverrideHide?: AssetGroupName[];\r\n  }\r\n}\r\ninterface WCEOverrideSetting {\r\n  Hide: Record<string, AssetGroupName[]>;\r\n}\r\n\r\nexport default async function layeringMenu(): Promise<void> {\r\n  await waitFor(() => !!Player?.AppearanceLayers);\r\n\r\n  // DialogCanUnlock with Player.CanInteract() requirement removed\r\n  function DialogCanUnlock2(C: Character, Item: Item) {\r\n    if (Item?.Property?.LockedBy === \"ExclusivePadlock\") return (!C.IsPlayer());\r\n    if (LogQuery(\"KeyDeposit\", \"Cell\")) return false;\r\n    if (Item?.Asset?.OwnerOnly) return Item.Asset.Enable && C.IsOwnedByPlayer();\r\n    if (Item?.Asset?.LoverOnly) return Item.Asset.Enable && C.IsLoverOfPlayer();\r\n    if (Item?.Asset?.FamilyOnly) return Item.Asset.Enable && C.IsFamilyOfPlayer();\r\n    return DialogHasKey(C, Item);\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"Layering.Load\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (fbcSettings.allowLayeringWhileBound && (!InventoryItemHasEffect(Layering.Item, \"Lock\") || DialogCanUnlock2(Layering.Character, Layering.Item))) {\r\n        Layering.Readonly = false;\r\n      }\r\n      if (!Layering.Character.IsPlayer() && Layering.Character.BCECapabilities?.includes(\"preventLayeringByOthers\")) {\r\n        Layering.Readonly = true;\r\n      }\r\n      if (!fbcSettings.layeringHide || CurrentScreen === \"Crafting\" || !Layering.Character.BCECapabilities?.includes(\"layeringHide\")) return next(args);\r\n      const ret = next(args);\r\n      const defaultItemHide = Layering.Asset.Hide || [];\r\n      if (defaultItemHide.length === 0) return ret;\r\n      const overrideItemHide = Layering.Item.Property.wceOverrideHide || defaultItemHide;\r\n      ElementCreate({\r\n        tag: \"h1\",\r\n        attributes: { id: \"layering-hide-header\" },\r\n        parent: document.getElementById(\"layering\"),\r\n        children: [displayText(\"[WCE] Configure layer hiding\")],\r\n      });\r\n      ElementCreate({\r\n        tag: \"form\",\r\n        attributes: { id: \"layering-hide-div\" },\r\n        classList: [\"layering-layer-inner-grid\"],\r\n        parent: document.getElementById(\"layering\"),\r\n        children: defaultItemHide.map(h => ({\r\n          tag: \"div\",\r\n          classList: [\"layering-pair\"],\r\n          children: [\r\n            {\r\n              tag: \"input\",\r\n              // eslint-disable-next-line no-undefined\r\n              attributes: { type: \"checkbox\", name: \"checkbox-hide\", value: h, disabled: Layering.Readonly ? true : undefined, checked: overrideItemHide.includes(h) ? true : undefined },\r\n              classList: [],\r\n              eventListeners: {\r\n                click: () => {\r\n                  const hideForm: HTMLFormElement = document.getElementById(\"layering-hide-div\") as HTMLFormElement;\r\n                  Layering.Item.Property.wceOverrideHide = new FormData(hideForm).getAll(\"checkbox-hide\") as AssetGroupName[];\r\n                  if (defaultItemHide.length === Layering.Item.Property.wceOverrideHide.length) delete Layering.Item.Property.wceOverrideHide;\r\n                  // eslint-disable-next-line no-underscore-dangle\r\n                  Layering._CharacterRefresh(Layering.Character, false, false);\r\n                },\r\n              },\r\n            },\r\n            {\r\n              tag: \"span\",\r\n              classList: [\"layering-pair-text\"],\r\n              children: [h],\r\n            },\r\n          ],\r\n\r\n        })),\r\n      });\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"Layering._ResetClickListener\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (!fbcSettings.layeringHide || CurrentScreen === \"Crafting\") return next(args);\r\n      delete Layering.Item.Property.wceOverrideHide;\r\n      document.querySelectorAll(\"input[name=checkbox-hide]\").forEach((e: HTMLInputElement) => {\r\n        e.checked = true;\r\n      });\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  patchFunction(\r\n    \"CharacterAppearanceVisible\",\r\n    {\r\n      \"if ((item.Asset.Hide != null) && (item.Asset.Hide.indexOf(GroupName) >= 0) && !Excluded) HidingItem = true;\": `\r\n        const hide = item.Property?.wceOverrideHide != null ? item.Property.wceOverrideHide : item.Asset.Hide;\r\n        if ((hide != null) && (hide.indexOf(GroupName) >= 0) && !Excluded) HidingItem = true;`,\r\n    },\r\n    \"Override C.Appeareance.Asset.Hide won't work\"\r\n  );\r\n\r\n  function serverAppearance(appearance: AppearanceBundle): AppearanceBundle {\r\n    const WCEOverrides: WCEOverrideSetting = { Hide: {} };\r\n    for (const a of appearance) {\r\n      if (Array.isArray(a.Property?.wceOverrideHide)) {\r\n        const { wceOverrideHide, ...property } = a.Property;\r\n        WCEOverrides.Hide[a.Group] = wceOverrideHide;\r\n        a.Property = property;\r\n      }\r\n    }\r\n    Player.ExtensionSettings.WCEOverrides = LZString.compressToUTF16(JSON.stringify(WCEOverrides));\r\n    ServerPlayerExtensionSettingsSync(\"WCEOverrides\");\r\n    return appearance;\r\n  }\r\n\r\n  globalThis.wceServerAppearance = serverAppearance;\r\n\r\n  patchFunction(\r\n    \"ServerPlayerAppearanceSync\",\r\n    {\r\n      \"D.Appearance = ServerAppearanceBundle(Player.Appearance);\":\r\n        \"D.Appearance = wceServerAppearance(ServerAppearanceBundle(Player.Appearance));\",\r\n    },\r\n    \"wceOverrideHide would be stored in the BC database\"\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ServerAppearanceLoadFromBundle\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      const [C] = args;\r\n      if (C.IsPlayer() && Array.isArray(C.Appearance)) {\r\n        let updated = false;\r\n        const WCEOverrides: WCEOverrideSetting = parseJSON(LZString.decompressFromUTF16(Player.ExtensionSettings.WCEOverrides));\r\n        for (const [Group, Hide] of Object.entries(WCEOverrides?.Hide || {})) {\r\n          const item = InventoryGet(C, Group as AssetGroupName);\r\n          if (item && !Array.isArray(item.Property?.wceOverrideHide)) {\r\n            item.Property ??= {};\r\n            item.Property.wceOverrideHide = Hide;\r\n            updated = true;\r\n          }\r\n        }\r\n        if (updated) ChatRoomCharacterUpdate(C);\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomSyncMemberJoin\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (Player.Appearance.some(a => Array.isArray(a.Property?.wceOverrideHide))) ChatRoomCharacterUpdate(Player);\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"PreferenceExit\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const test = PreferenceSubscreen.name === \"Main\";\r\n      const ret = next(args);\r\n      if (test && Player.Appearance.some(a => Array.isArray(a.Property?.wceOverrideHide))) ChatRoomCharacterUpdate(Player);\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  // Pseudo-items that we do not want to process for color copying\r\n  const ignoredColorCopyableAssets = [\r\n    \"LeatherCrop\",\r\n    \"LeatherWhip\",\r\n    \"ShockCollarRemote\",\r\n    \"SpankingToys\",\r\n    \"VibratorRemote\",\r\n  ];\r\n  const colorCopyableAssets = Asset.filter(ass =>\r\n    AssetGroup.filter(a => a.Name.startsWith(\"Item\") && !/\\d$/u.test(a.Name) && a.Asset.find(b => b.Name === ass.Name)).length > 1\r\n  ).filter((v, i, a) => a.findIndex(as => as.Name === v.Name) === i).map(a => a.Name).filter(a => !ignoredColorCopyableAssets.includes(a));\r\n\r\n  function assetWorn(C: Character, item?: Item): boolean {\r\n    return !!item && !!C.Appearance.find(a => a === item);\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"DialogMenuButtonBuild\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    ([C], next) => {\r\n      const ret = next([C]);\r\n      if (\r\n        isCharacter(C) &&\r\n        fbcSettings.copyColor &&\r\n        Player.CanInteract() &&\r\n        C?.FocusGroup?.Name &&\r\n        !InventoryGroupIsBlocked(C, C.FocusGroup.Name) &&\r\n        DialogMenuMode === \"items\"\r\n      ) {\r\n        const focusItem = InventoryGet(C, C.FocusGroup.Name);\r\n        if (assetWorn(C, focusItem) && colorCopyableAssets.includes(focusItem.Asset.Name)) {\r\n          // @ts-ignore\r\n          DialogMenuButton.push(\"Paint\");\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"InterfaceTextGet\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (args[0] === \"DialogMenuPaint\") return displayText(\"[WCE] Copy colors to other items of same type\");\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"DialogMenuButtonClick\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (!ret && ![\"colorExpression\", \"colorItem\", \"extended\", \"layering\", \"tighten\"].includes(DialogMenuMode)) {\r\n        const C = CharacterGetCurrent();\r\n        const Item = C.FocusGroup ? InventoryGet(C, C.FocusGroup.Name) : null;\r\n        for (let I = 0; I < DialogMenuButton.length; I++) {\r\n          if (MouseIn(1885 - I * 110, 15, 90, 90)) {\r\n            const button = DialogMenuButton[I];\r\n            // @ts-ignore\r\n            if (Item && button === \"Paint\") {\r\n              copyColors(C, Item);\r\n              return false;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  function copyColorTo(item: Item, focusItem: Item): void {\r\n    if (item.Asset.Name === focusItem.Asset.Name) {\r\n      if (Array.isArray(focusItem.Color)) {\r\n        if (Array.isArray(item.Color)) {\r\n          for (let i = item.Color.length - 1; i >= 0; i--) {\r\n            item.Color[i] = focusItem.Color[i % focusItem.Color.length];\r\n          }\r\n        } else {\r\n          item.Color = focusItem.Color[focusItem.Color.length - 1];\r\n        }\r\n      } else if (Array.isArray(item.Color)) {\r\n        for (let i = 0; i < item.Color.length; i++) {\r\n          item.Color[i] = focusItem.Color ?? \"Default\";\r\n        }\r\n      } else { // Both are array\r\n        item.Color = deepCopy(focusItem.Color);\r\n      }\r\n    }\r\n  }\r\n\r\n  function copyColors(C: Character, focusItem: Item): void {\r\n    if (\r\n      !fbcSettings.copyColor ||\r\n      !Player.CanInteract() ||\r\n      InventoryGroupIsBlocked(C, C.FocusGroup.Name) ||\r\n      !assetWorn(C, focusItem) ||\r\n      !colorCopyableAssets.includes(focusItem.Asset.Name)\r\n    ) return;\r\n    for (const item of C.Appearance) {\r\n      copyColorTo(item, focusItem);\r\n    }\r\n    if (CurrentScreen === \"ChatRoom\") {\r\n      ChatRoomCharacterUpdate(C);\r\n      fbcSendAction(\r\n        displayText(\"$TargetName's $ItemName colors spread from their $ItemGroup\", {\r\n          $TargetName: CharacterNickname(C),\r\n          $ItemName: focusItem.Asset.Description.toLowerCase(),\r\n          $ItemGroup: focusItem.Asset.Group.Description.toLowerCase(),\r\n        })\r\n      );\r\n    } else {\r\n      CharacterRefresh(C);\r\n    }\r\n  }\r\n}\r\n","import { patchFunction, SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { createTimer } from \"../util/hooks\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { waitFor } from \"../util/utils\";\r\nimport { debug } from \"../util/logger\";\r\n\r\nexport default function cacheClearer(): void {\r\n  const cacheClearInterval = 1 * 60 * 60 * 1000;\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomMenuBuild\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (fbcSettings.manualCacheClear) ChatRoomMenuButtons.splice(ChatRoomMenuButtons.indexOf(\"Cut\"), 0, \"clearCache\");\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomMenuClick\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (fbcSettings.manualCacheClear) {\r\n        const Space = 992 / ChatRoomMenuButtons.length;\r\n        for (let B = 0; B < ChatRoomMenuButtons.length; B++) {\r\n          if (MouseXIn(1005 + Space * B, Space - 2) && ChatRoomMenuButtons[B] === \"clearCache\") {\r\n            doClearCaches();\r\n          }\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  patchFunction(\r\n    \"ChatRoomMenuDraw\",\r\n    {\r\n      'let suffix = \"\";': `let suffix = \"\";\r\n        if (name === \"clearCache\") {\r\n          DrawButton(1005 + Space * Number(idx), 2, Space - 2, 60, \"\", color, null, \"[WCE] clear and reload the drawing cache of all characters\");\r\n          DrawImage(\"Icons/Small/Reset.png\", 976 + Space * Number(idx) + Space / 2, 4);\r\n          continue;\r\n        }`,\r\n    },\r\n    \"manual clearing and reloading of drawing cache\"\r\n  );\r\n\r\n  async function clearCaches(): Promise<void> {\r\n    const start = Date.now();\r\n    const canClear = await waitFor(\r\n      // Only clear when in chat room and not inspecting a character and BC window in focus\r\n      () => CurrentScreen === \"ChatRoom\" && !CurrentCharacter && document.hasFocus(),\r\n      () => Date.now() - start > cacheClearInterval\r\n    );\r\n    if (canClear && fbcSettings.automateCacheClear) doClearCaches();\r\n  }\r\n\r\n  globalThis.bceClearCaches = clearCaches;\r\n\r\n  function doClearCaches(): void {\r\n    debug(\"Clearing caches\");\r\n    if (GLDrawCanvas.GL?.textureCache) {\r\n      GLDrawCanvas.GL.textureCache.clear();\r\n    }\r\n    GLDrawResetCanvas();\r\n\r\n    debug(\"Clearing old characters from cache\");\r\n    const oldOnlineCharacters = Character.filter(c => c.IsOnline?.() && !ChatRoomCharacter.some(cc => cc.MemberNumber === c.MemberNumber));\r\n    oldOnlineCharacters.forEach(c => CharacterDelete(c));\r\n    Character.filter(c => c.IsOnline?.()).forEach(c => CharacterRefresh(c, false, false));\r\n  }\r\n\r\n  createTimer(() => {\r\n    if (fbcSettings.automateCacheClear) {\r\n      clearCaches();\r\n    }\r\n  }, cacheClearInterval);\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { isCharacter } from \"../util/utils\";\r\n\r\nexport default function chatRoomOverlay(): void {\r\n  SDK.hookFunction(\r\n    \"ChatRoomDrawCharacterStatusIcons\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    ([C, CharX, CharY, Zoom], next) => {\r\n      const ret = next([C, CharX, CharY, Zoom]);\r\n      if (\r\n        isCharacter(C) &&\r\n        typeof CharX === \"number\" &&\r\n        typeof CharY === \"number\" &&\r\n        typeof Zoom === \"number\" &&\r\n        C.FBC &&\r\n        ChatRoomHideIconState === 0\r\n      ) {\r\n        const text = [\"1\", \"2\", \"3\", \"4\", \"5\"].includes(C.FBC.split(\".\")[0]) ? \"FBC\" : \"WCE\";\r\n        DrawTextFit(\r\n          text,\r\n          CharX + 290 * Zoom,\r\n          CharY + 14 * Zoom,\r\n          60 * Zoom,\r\n          C.FBCNoteExists ? \"Cyan\" : \"White\",\r\n          \"Black\"\r\n        );\r\n        DrawTextFit(\r\n          /^\\d+\\.\\d+(\\.\\d+)?b?$/u.test(C.FBC) ? C.FBC.replace(\"b\", \"\") : \"\",\r\n          CharX + 290 * Zoom,\r\n          CharY + 36 * Zoom,\r\n          C.FBC.split(\".\").length === 3 ? 60 * Zoom : 40 * Zoom,\r\n          C.FBC.endsWith(\"b\") ? \"Lightpink\" : \"White\",\r\n          \"Black\"\r\n        );\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n}\r\n","import { patchFunction, SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { waitFor, isCharacter, drawTextFitLeft } from \"../util/utils\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default async function privateWardrobe() {\r\n  await waitFor(() => !!Player);\r\n\r\n  let inCustomWardrobe = false,\r\n    /** @type {Character | null} */\r\n    targetCharacter = null;\r\n\r\n  /** @type {string | null} */\r\n  let appearanceBackup = null;\r\n\r\n  let excludeBodyparts = false;\r\n\r\n  function currentWardrobeTargetIsPlayer() {\r\n    return (inCustomWardrobe && targetCharacter?.IsPlayer()) || CharacterAppearanceSelection?.IsPlayer();\r\n  }\r\n\r\n  patchFunction(\r\n    \"DrawProcess\",\r\n    { 'CurrentScreen !== \"Crafting\"': 'CurrentScreen !== \"Crafting\" && CurrentScreen !== \"Wardrobe\"' },\r\n    \"Full wardrobe may display blur and blindness effects of the background\"\r\n  );\r\n\r\n  patchFunction(\r\n    \"DrawCharacter\",\r\n    { '|| CurrentScreen === \"Crafting\"': '|| CurrentScreen === \"Crafting\" || CurrentScreen === \"Wardrobe\"' },\r\n    \"Full wardrobe may display blur and blindness effects of the outfits\"\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"CharacterAppearanceWardrobeLoad\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      const [C] = args;\r\n      if (fbcSettings.privateWardrobe && CurrentScreen === \"Appearance\") {\r\n        inCustomWardrobe = true;\r\n        targetCharacter = isCharacter(C) ? C : CharacterGetCurrent();\r\n        CommonSetScreen(\"Character\", \"Wardrobe\");\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"AppearanceLoad\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (inCustomWardrobe) {\r\n        CharacterAppearanceBackup = appearanceBackup;\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"AppearanceRun\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (CharacterAppearanceMode === \"Wardrobe\" && currentWardrobeTargetIsPlayer()) {\r\n        DrawCheckbox(1300, 350, 64, 64, \"\", excludeBodyparts, false, \"white\");\r\n        drawTextFitLeft(displayText(\"Load without body parts\"), 1374, 380, 630, \"white\");\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"AppearanceClick\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (CharacterAppearanceMode === \"Wardrobe\" && MouseIn(1300, 350, 64, 64) && currentWardrobeTargetIsPlayer()) {\r\n        excludeBodyparts = !excludeBodyparts;\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeLoad\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      appearanceBackup = CharacterAppearanceBackup;\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeRun\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const playerBackup = Player;\r\n      // Replace Player with target character in rendering\r\n      if (inCustomWardrobe) {\r\n        // @ts-ignore - explicitly overriding with another Character temporarily\r\n        Player = targetCharacter;\r\n      }\r\n      const ret = next(args);\r\n      if (inCustomWardrobe) {\r\n        Player = playerBackup;\r\n      }\r\n      DrawText(`Page: ${((WardrobeOffset / 12) | 0) + 1}/${WardrobeSize / 12}`, 300, 35, \"White\");\r\n      DrawCheckbox(10, 74, 64, 64, \"\", excludeBodyparts, false, \"white\");\r\n      drawTextFitLeft(displayText(\"Exclude body parts\"), 84, 106, 300, \"white\");\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeClick\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (MouseIn(10, 74, 64, 64)) {\r\n        excludeBodyparts = !excludeBodyparts;\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeExit\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (!inCustomWardrobe) {\r\n        return next(args);\r\n      }\r\n      CommonSetScreen(\"Character\", \"Appearance\");\r\n      inCustomWardrobe = false;\r\n      return null;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeFastLoad\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      let [C] = args;\r\n      const base = C.Appearance.filter(a => a.Asset.Group.IsDefault && !a.Asset.Group.Clothing);\r\n      if (inCustomWardrobe && isCharacter(C) && C.IsPlayer()) {\r\n        if (!targetCharacter) {\r\n          throw new Error(\"targetCharacter is not defined in WardrobeFastLoad\");\r\n        }\r\n        args[0] = targetCharacter;\r\n        C = targetCharacter;\r\n        args[2] = false;\r\n      }\r\n      const ret = next(args);\r\n      if (excludeBodyparts) {\r\n        C.Appearance = [...base, ...C.Appearance.filter(a => !a.Asset.Group.IsDefault || a.Asset.Group.Clothing)];\r\n        CharacterLoadCanvas(C);\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"WardrobeFastSave\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      const [C] = args;\r\n      if (inCustomWardrobe && isCharacter(C) && C.IsPlayer()) {\r\n        if (!targetCharacter) {\r\n          throw new Error(\"targetCharacter is not defined in WardrobeFastSave\");\r\n        }\r\n        args[0] = targetCharacter;\r\n      }\r\n      if (fbcSettings.confirmWardrobeSave && Player.Wardrobe?.length > args[1] && Player.Wardrobe[args[1]]?.some(a => a.Group === \"Pronouns\")) {\r\n        // eslint-disable-next-line no-alert\r\n        if (!window.confirm(\"Do you really want to override this wardrobe outfit?\")) {\r\n          return null;\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ServerPlayerIsInChatRoom\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => (inCustomWardrobe && CharacterAppearanceReturnRoom === \"ChatRoom\") || next(args)\r\n  );\r\n\r\n  /** @type {(e: KeyboardEvent) => void} */\r\n  function keyHandler(e) {\r\n    if (!fbcSettings.privateWardrobe) {\r\n      return;\r\n    }\r\n    if (e.key === \"Escape\" && inCustomWardrobe) {\r\n      WardrobeExit();\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  document.addEventListener(\"keydown\", keyHandler, true);\r\n  document.addEventListener(\"keypress\", keyHandler, true);\r\n}\r\n","export const ArousalExpressionStages: ArousalExpressionStages = {\r\n  Blush: [\r\n    { Expression: \"High\", Limit: 100 },\r\n    { Expression: \"Medium\", Limit: 60 },\r\n    { Expression: \"Low\", Limit: 10 },\r\n    { Expression: null, Limit: 0 },\r\n  ],\r\n  Eyebrows: [\r\n    { Expression: \"Soft\", Limit: 80 },\r\n    { Expression: \"Lowered\", Limit: 50 },\r\n    { Expression: \"Raised\", Limit: 20 },\r\n    { Expression: null, Limit: 0 },\r\n  ],\r\n  Fluids: [\r\n    { Expression: \"DroolMedium\", Limit: 100 },\r\n    { Expression: \"DroolLow\", Limit: 40 },\r\n    { Expression: null, Limit: 0 },\r\n  ],\r\n  Eyes: [\r\n    { Expression: \"Closed\", Limit: 100 },\r\n    { Expression: \"Surprised\", Limit: 90 },\r\n    { Expression: \"Horny\", Limit: 70 },\r\n    { Expression: \"Dazed\", Limit: 20 },\r\n    { Expression: null, Limit: 0 },\r\n  ],\r\n  Eyes2: [\r\n    { Expression: \"Closed\", Limit: 100 },\r\n    { Expression: \"Surprised\", Limit: 90 },\r\n    { Expression: \"Horny\", Limit: 70 },\r\n    { Expression: \"Dazed\", Limit: 20 },\r\n    { Expression: null, Limit: 0 },\r\n  ],\r\n  // Pussy group includes Penis, which is the only type of \"pussy\" with expressions and controls erections.\r\n  Pussy: [{ Expression: \"Hard\", Limit: 50 }, { Expression: null, Limit: 0 }],\r\n};\r\n\r\nexport const EventExpressions: Record<string, Expression> = {\r\n  PostOrgasm: {\r\n    Type: \"PostOrgasm\",\r\n    Duration: 20000,\r\n    Priority: 10000,\r\n    Expression: {\r\n      Blush: [\r\n        { Expression: \"Extreme\", Duration: 5000 },\r\n        { ExpressionModifier: -1, Duration: 5000 },\r\n        { ExpressionModifier: -1, Duration: 5000, Priority: 1000 },\r\n        { ExpressionModifier: -1, Duration: 5000, Priority: 200 },\r\n      ],\r\n      Eyes: [\r\n        { Expression: \"Closed\", Duration: 8500 },\r\n        { Expression: \"Heart\", Duration: 7500 },\r\n        { Expression: \"Sad\", Duration: 4000, Priority: 200 },\r\n      ],\r\n      Eyes2: [\r\n        { Expression: \"Closed\", Duration: 8000 },\r\n        { Expression: \"Heart\", Duration: 8000 },\r\n        { Expression: \"Sad\", Duration: 4000, Priority: 200 },\r\n      ],\r\n      Mouth: [\r\n        { Expression: \"Ahegao\", Duration: 5000 },\r\n        { Expression: \"Moan\", Duration: 5000 },\r\n        { Expression: \"HalfOpen\", Duration: 10000, Priority: 200 },\r\n      ],\r\n      Fluids: [\r\n        { Expression: \"DroolMessy\", Duration: 5000 },\r\n        { Expression: \"DroolSides\", Duration: 9000, Priority: 400 },\r\n        { Expression: \"DroolLow\", Duration: 6000, Priority: 200 },\r\n      ],\r\n      Eyebrows: [\r\n        { Expression: \"Soft\", Duration: 10000 },\r\n        { Expression: \"Lowered\", Duration: 5000, Priority: 200 },\r\n        { Expression: null, Duration: 5000, Priority: 1 },\r\n      ],\r\n    },\r\n  },\r\n  Pout: {\r\n    Type: \"Pout\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Mouth: [{ Expression: \"Pout\", Duration: -1 }],\r\n      Eyes: [{ Expression: \"Dazed\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Dazed\", Duration: -1 }],\r\n      Eyebrows: [{ Expression: \"Harsh\", Duration: -1 }],\r\n    },\r\n  },\r\n  ResetBrows: { Type: \"ResetBrows\", Duration: -1, Expression: { Eyebrows: [{ Expression: null, Duration: -1 }] } },\r\n  RaiseBrows: { Type: \"RaiseBrows\", Duration: -1, Expression: { Eyebrows: [{ Expression: \"Raised\", Duration: -1 }] } },\r\n  Confused: { Type: \"Confused\", Duration: -1, Expression: { Eyebrows: [{ Expression: \"OneRaised\", Duration: -1 }] } },\r\n  Smirk: { Type: \"Smirk\", Duration: -1, Expression: { Mouth: [{ Expression: \"Smirk\", Duration: -1 }] } },\r\n  Wink: { Type: \"Wink\", Duration: 1500, Expression: { Eyes: [{ Expression: \"Closed\", Duration: 1500 }] } },\r\n  Laugh: {\r\n    Type: \"Laugh\",\r\n    Duration: 8000,\r\n    Expression: {\r\n      Mouth: [\r\n        { Expression: \"Laughing\", Duration: 1000 },\r\n        { Expression: \"Grin\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 1000 },\r\n        { Expression: \"Happy\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 800 },\r\n        { Expression: \"Grin\", Duration: 400 },\r\n        { Expression: \"Laughing\", Duration: 800 },\r\n        { Expression: \"Happy\", Duration: 400 },\r\n        { Expression: \"Laughing\", Duration: 600 },\r\n        { Expression: \"Grin\", Duration: 600 },\r\n        { Expression: \"Laughing\", Duration: 600 },\r\n        { Expression: \"Happy\", Duration: 600 },\r\n        { Expression: \"Laughing\", Duration: 200 },\r\n        { Expression: \"Grin\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 200 },\r\n        { Expression: \"Happy\", Duration: 200 },\r\n      ],\r\n    },\r\n  },\r\n  Giggle: {\r\n    Type: \"Giggle\",\r\n    Duration: 4000,\r\n    Expression: {\r\n      Mouth: [\r\n        { Expression: \"Laughing\", Duration: 800 },\r\n        { Expression: \"Grin\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 700 },\r\n        { Expression: \"Happy\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 600 },\r\n        { Expression: \"Grin\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 500 },\r\n        { Expression: \"Grin\", Duration: 200 },\r\n        { Expression: \"Laughing\", Duration: 400 },\r\n        { Expression: \"Happy\", Duration: 200 },\r\n      ],\r\n    },\r\n  },\r\n  Chuckle: { Type: \"Chuckle\", Duration: 4000, Expression: { Mouth: [{ Expression: \"Grin\", Duration: 4000 }] } },\r\n  Smile: { Type: \"Smile\", Duration: -1, Expression: { Mouth: [{ Expression: \"Grin\", Duration: -1 }] } },\r\n  Blink: {\r\n    Type: \"Blink\",\r\n    Duration: 200,\r\n    Expression: { Eyes: [{ Expression: \"Closed\", Duration: 200 }], Eyes2: [{ Expression: \"Closed\", Duration: 200 }] },\r\n  },\r\n  Grin: {\r\n    Type: \"Grin\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Horny\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Horny\", Duration: -1 }],\r\n      Mouth: [{ Expression: \"Grin\", Duration: -1 }],\r\n    },\r\n  },\r\n  Cuddle: {\r\n    Type: \"Cuddle\",\r\n    Duration: 10000,\r\n    Priority: 150,\r\n    Expression: {\r\n      Mouth: [{ Expression: \"Happy\", Duration: 10000 }],\r\n      Eyes: [{ Expression: \"ShylyHappy\", Duration: 10000 }],\r\n      Eyes2: [{ Expression: \"ShylyHappy\", Duration: 10000 }],\r\n      Eyebrows: [{ Expression: \"Raised\", Duration: 10000 }],\r\n    },\r\n  },\r\n  Blush: { Type: \"Blush\", Duration: 10000, Expression: { Blush: [{ ExpressionModifier: 1, Duration: 10000 }] } },\r\n  Choke: {\r\n    Type: \"Choke\",\r\n    Duration: 4000,\r\n    Priority: 150,\r\n    Expression: {\r\n      Blush: [{ ExpressionModifier: 3, Duration: 4000 }],\r\n      Eyes: [{ Expression: \"VeryLewd\", Duration: 3000 }, { Expression: \"Sad\", Duration: 1000 }],\r\n      Eyes2: [{ Expression: \"VeryLewd\", Duration: 3000 }, { Expression: \"Sad\", Duration: 1000 }],\r\n      Eyebrows: [{ Expression: \"Harsh\", Duration: 4000 }],\r\n    },\r\n  },\r\n  Stimulated: {\r\n    Type: \"Stimulated\",\r\n    Duration: 5000,\r\n    Priority: 400,\r\n    Expression: {\r\n      Blush: [{ ExpressionModifier: 2, Duration: 5000 }],\r\n      Eyes: [{ Expression: \"VeryLewd\", Duration: 4000 }, { Expression: \"Sad\", Duration: 1000 }],\r\n      Eyes2: [{ Expression: \"VeryLewd\", Duration: 4000 }, { Expression: \"Sad\", Duration: 1000 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: 5000 }],\r\n    },\r\n  },\r\n  StimulatedLong: { Type: \"StimulatedLong\", Duration: 20000, Priority: 400, Expression: { Blush: [{ ExpressionModifier: 1, Duration: 20000 }] } },\r\n  Shock: {\r\n    Type: \"Shock\",\r\n    Duration: 15000,\r\n    Priority: 1000,\r\n    Expression: {\r\n      Blush: [\r\n        { ExpressionModifier: 5, Duration: 10000 },\r\n        { ExpressionModifier: -1, Duration: 2000 },\r\n        { ExpressionModifier: -1, Duration: 2000 },\r\n        { ExpressionModifier: -1, Duration: 1000 },\r\n      ],\r\n      Eyes: [{ Expression: \"Dizzy\", Duration: 1000 }, { Expression: \"Scared\", Duration: 8000 }, { Expression: \"Surprised\", Duration: 7000 }],\r\n      Eyes2: [{ Expression: \"Dizzy\", Duration: 1000 }, { Expression: \"Scared\", Duration: 8000 }, { Expression: \"Surprised\", Duration: 7000 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: 15000 }],\r\n      Mouth: [{ Expression: \"Pained\", Duration: 10000 }, { Expression: \"Angry\", Duration: 5000 }],\r\n    },\r\n  },\r\n  ShockLight: {\r\n    Type: \"ShockLight\",\r\n    Duration: 5000,\r\n    Priority: 900,\r\n    Expression: {\r\n      Blush: [{ ExpressionModifier: 2, Duration: 5000 }],\r\n      Eyes: [{ Expression: \"Dizzy\", Duration: 2000 }, { Expression: \"Surprised\", Duration: 3000 }],\r\n      Eyes2: [{ Expression: \"Dizzy\", Duration: 2000 }, { Expression: \"Surprised\", Duration: 3000 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: 5000 }],\r\n      Mouth: [{ Expression: \"Angry\", Duration: 5000 }],\r\n    },\r\n  },\r\n  Hit: {\r\n    Type: \"Hit\",\r\n    Duration: 7000,\r\n    Priority: 500,\r\n    Expression: {\r\n      Blush: [{ Expression: \"VeryHigh\", Duration: 7000 }],\r\n      Eyes: [{ Expression: \"Daydream\", Duration: 1000 }, { Expression: \"Closed\", Duration: 3000 }, { Expression: \"Daydream\", Duration: 3000 }],\r\n      Eyes2: [{ Expression: \"Daydream\", Duration: 1000 }, { Expression: \"Closed\", Duration: 3000 }, { Expression: \"Daydream\", Duration: 3000 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: 7000 }],\r\n    },\r\n  },\r\n  Spank: {\r\n    Type: \"Spank\",\r\n    Duration: 3000,\r\n    Priority: 300,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Lewd\", Duration: 3000 }],\r\n      Eyes2: [{ Expression: \"Lewd\", Duration: 3000 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: 3000 }],\r\n    },\r\n  },\r\n  Kiss: { Type: \"Kiss\", Duration: 2000, Priority: 200, Expression: { Mouth: [{ Expression: \"HalfOpen\", Duration: 2000 }] } },\r\n  KissOnLips: {\r\n    Type: \"KissOnLips\",\r\n    Duration: 2000,\r\n    Priority: 200,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Closed\", Duration: 2000 }],\r\n      Eyes2: [{ Expression: \"Closed\", Duration: 2000 }],\r\n      Mouth: [{ Expression: \"HalfOpen\", Duration: 2000 }],\r\n      Blush: [{ Skip: true, Duration: 1000 }, { ExpressionModifier: 1, Duration: 1000 }],\r\n    },\r\n  },\r\n  LongKiss: {\r\n    Type: \"LongKiss\",\r\n    Duration: 4000,\r\n    Priority: 200,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Closed\", Duration: 4000 }],\r\n      Eyes2: [{ Expression: \"Closed\", Duration: 4000 }],\r\n      Mouth: [{ Expression: \"Open\", Duration: 4000 }],\r\n      Blush: [{ Skip: true, Duration: 1000 }, { ExpressionModifier: 1, Duration: 1000 }, { ExpressionModifier: 1, Duration: 2000 }],\r\n    },\r\n  },\r\n  Disoriented: {\r\n    Type: \"Disoriented\",\r\n    Duration: 8000,\r\n    Priority: 250,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Dizzy\", Duration: 8000 }],\r\n      Eyes2: [{ Expression: \"Dizzy\", Duration: 8000 }],\r\n      Eyebrows: [{ Expression: \"Raised\", Duration: 8000 }],\r\n      Blush: [{ ExpressionModifier: 2, Duration: 8000 }],\r\n    },\r\n  },\r\n  Angry: {\r\n    Type: \"Angry\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Mouth: [{ Expression: \"Angry\", Duration: -1 }],\r\n      Eyes: [{ Expression: \"Angry\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Angry\", Duration: -1 }],\r\n      Eyebrows: [{ Expression: \"Angry\", Duration: -1 }],\r\n    },\r\n  },\r\n  Sad: {\r\n    Type: \"Sad\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Mouth: [{ Expression: \"Frown\", Duration: -1 }],\r\n      Eyes: [{ Expression: \"Shy\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Shy\", Duration: -1 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: -1 }],\r\n    },\r\n  },\r\n  Worried: {\r\n    Type: \"Worried\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Surprised\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Surprised\", Duration: -1 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: -1 }],\r\n    },\r\n  },\r\n  Distressed: {\r\n    Type: \"Distressed\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Scared\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Scared\", Duration: -1 }],\r\n      Eyebrows: [{ Expression: \"Soft\", Duration: -1 }],\r\n      Mouth: [{ Expression: \"Angry\", Duration: -1 }],\r\n    },\r\n  },\r\n  Reset: {\r\n    Type: \"Reset\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Mouth: [{ Expression: null, Duration: -1 }],\r\n      Eyes: [{ Expression: null, Duration: -1 }],\r\n      Eyes2: [{ Expression: null, Duration: -1 }],\r\n      Eyebrows: [{ Expression: null, Duration: -1 }],\r\n      Blush: [{ Expression: null, Duration: -1 }],\r\n      Fluids: [{ Expression: null, Duration: -1 }],\r\n    },\r\n  },\r\n  Cry: { Type: \"Cry\", Duration: -1, Expression: { Fluids: [{ Expression: \"TearsMedium\", Duration: -1 }] } },\r\n  DroolReset: { Type: \"DroolReset\", Duration: -1, Expression: { Fluids: [{ Expression: null, Duration: -1 }] } },\r\n  DroolSides: { Type: \"DroolSides\", Duration: -1, Expression: { Fluids: [{ Expression: \"DroolSides\", Duration: -1 }] } },\r\n  BareTeeth: { Type: \"BareTeeth\", Duration: -1, Expression: { Mouth: [{ Expression: \"Angry\", Duration: -1 }] } },\r\n  Happy: { Type: \"Happy\", Duration: -1, Expression: { Mouth: [{ Expression: \"Happy\", Duration: -1 }] } },\r\n  Frown: { Type: \"Frown\", Duration: -1, Expression: { Mouth: [{ Expression: \"Frown\", Duration: -1 }] } },\r\n  Glare: {\r\n    Type: \"Glare\",\r\n    Duration: -1,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Angry\", Duration: -1 }],\r\n      Eyes2: [{ Expression: \"Angry\", Duration: -1 }],\r\n      Eyebrows: [{ Expression: \"Harsh\", Duration: -1 }],\r\n    },\r\n  },\r\n  NarrowEyes: {\r\n    Type: \"NarrowEyes\",\r\n    Duration: -1,\r\n    Expression: { Eyes: [{ Expression: \"Horny\", Duration: -1 }], Eyes2: [{ Expression: \"Horny\", Duration: -1 }] },\r\n  },\r\n  OpenEyes: {\r\n    Type: \"OpenEyes\",\r\n    Duration: -1,\r\n    Expression: { Eyes: [{ Expression: null, Duration: -1 }], Eyes2: [{ Expression: null, Duration: -1 }] },\r\n  },\r\n  CloseEyes: {\r\n    Type: \"CloseEyes\",\r\n    Duration: -1,\r\n    Expression: { Eyes: [{ Expression: \"Closed\", Duration: -1 }], Eyes2: [{ Expression: \"Closed\", Duration: -1 }] },\r\n  },\r\n  CloseMouth: { Type: \"CloseMouth\", Duration: -1, Expression: { Mouth: [{ Expression: null, Duration: -1 }] } },\r\n  OpenMouth: { Type: \"OpenMouth\", Duration: -1, Expression: { Mouth: [{ Expression: \"Moan\", Duration: -1 }] } },\r\n  LipBite: { Type: \"LipBite\", Duration: -1, Expression: { Mouth: [{ Expression: \"LipBite\", Duration: -1 }] } },\r\n  Lick: {\r\n    Type: \"Lick\",\r\n    Duration: 4000,\r\n    Priority: 200,\r\n    Expression: { Mouth: [{ Expression: \"Ahegao\", Duration: 4000 }], Blush: [{ ExpressionModifier: 1, Duration: 4000 }] },\r\n  },\r\n  GagInflate: {\r\n    Type: \"GagInflate\",\r\n    Duration: 4000,\r\n    Priority: 400,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Lewd\", Duration: 4000 }],\r\n      Eyes2: [{ Expression: \"Lewd\", Duration: 4000 }],\r\n      Blush: [{ ExpressionModifier: 2, Duration: 2000 }, { ExpressionModifier: -1, Duration: 2000 }],\r\n    },\r\n  },\r\n  Iced: {\r\n    Type: \"Iced\",\r\n    Duration: 4000,\r\n    Priority: 500,\r\n    Expression: {\r\n      Eyes: [{ Expression: \"Surprised\", Duration: 3000 }, { Expression: null, Duration: 1000 }],\r\n      Eyes2: [{ Expression: \"Surprised\", Duration: 3000 }, { Expression: null, Duration: 1000 }],\r\n      Mouth: [{ Expression: \"Angry\", Duration: 4000 }],\r\n    },\r\n  },\r\n  AllFours: { Type: \"AllFours\", Duration: -1, Poses: [{ Pose: [\"AllFours\"], Duration: -1 }] },\r\n  SpreadKnees: { Type: \"SpreadKnees\", Duration: -1, Poses: [{ Pose: [\"KneelingSpread\"], Duration: -1 }] },\r\n  Hogtied: { Type: \"Hogtied\", Duration: -1, Poses: [{ Pose: [\"Hogtied\"], Duration: -1 }] },\r\n  Handstand: { Type: \"Handstand\", Duration: -1, Poses: [{ Pose: [\"Suspension\", \"OverTheHead\"], Duration: -1 }] },\r\n  Stretch: {\r\n    Type: \"Stretch\",\r\n    Priority: 100,\r\n    Duration: 6000,\r\n    Poses: [\r\n      { Pose: [\"OverTheHead\"], Duration: 1000 },\r\n      { Pose: [\"Yoked\"], Duration: 1000 },\r\n      { Pose: [\"BaseUpper\"], Duration: 1000 },\r\n      { Pose: [\"Spread\"], Duration: 1000 },\r\n      { Pose: [\"LegsClosed\"], Duration: 1000 },\r\n      { Pose: [\"BaseLower\"], Duration: 1000 },\r\n    ],\r\n  },\r\n  SpreadLegs: { Type: \"SpreadLegs\", Duration: -1, Poses: [{ Pose: [\"Spread\"], Duration: -1 }] },\r\n  JumpingJacks: {\r\n    Type: \"JumpingJacks\",\r\n    Priority: 100,\r\n    Duration: 8000,\r\n    Poses: [\r\n      { Pose: [\"OverTheHead\", \"Spread\"], Duration: 1000 },\r\n      { Pose: [\"BaseUpper\", \"LegsClosed\"], Duration: 1000 },\r\n      { Pose: [\"OverTheHead\", \"Spread\"], Duration: 1000 },\r\n      { Pose: [\"BaseUpper\", \"LegsClosed\"], Duration: 1000 },\r\n      { Pose: [\"OverTheHead\", \"Spread\"], Duration: 1000 },\r\n      { Pose: [\"BaseUpper\", \"LegsClosed\"], Duration: 1000 },\r\n      { Pose: [\"OverTheHead\", \"Spread\"], Duration: 1000 },\r\n      { Pose: [\"BaseUpper\", \"LegsClosed\"], Duration: 1000 },\r\n    ],\r\n  },\r\n};\r\n\r\nexport const ActivityTriggers: ActivityTrigger[] = [\r\n  { Event: \"Blush\", Type: \"Activity\", Matchers: [{ Tester: /^ChatOther-ItemMouth-PoliteKiss$/u }] },\r\n  { Event: \"Stretch\", Type: \"Emote\", Matchers: [{ Tester: /^stretches (her|his|their) whole body/u }] },\r\n  { Event: \"JumpingJacks\", Type: \"Emote\", Matchers: [{ Tester: /^does jumping[ -]?jacks/u }] },\r\n  { Event: \"AllFours\", Type: \"Emote\", Matchers: [{ Tester: /^(gets on all fours|starts crawling)/u }] },\r\n  { Event: \"SpreadKnees\", Type: \"Emote\", Matchers: [{ Tester: /^spreads(( (her|his|their) legs)? on)? (her|his|their) knees/u }] },\r\n  { Event: \"SpreadLegs\", Type: \"Emote\", Matchers: [{ Tester: /^spreads (her|his|their) legs apart/u }] },\r\n  { Event: \"Handstand\", Type: \"Emote\", Matchers: [{ Tester: /^(does a handstand|stands on (her|his|their) hands)/u }] },\r\n  { Event: \"Hogtied\", Type: \"Emote\", Matchers: [{ Tester: /^lies( down)? on (the floor|(her|his|their) (tummy|stomach))/u }] },\r\n  { Event: \"Blush\", Type: \"Emote\", Matchers: [{ Tester: /^blushes/u }] },\r\n  { Event: \"Chuckle\", Type: \"Emote\", Matchers: [{ Tester: /^chuckles/u }] },\r\n  { Event: \"Laugh\", Type: \"Emote\", Matchers: [{ Tester: /^laughs/u }] },\r\n  { Event: \"Giggle\", Type: \"Emote\", Matchers: [{ Tester: /^giggles/u }] },\r\n  { Event: \"Smirk\", Type: \"Emote\", Matchers: [{ Tester: /^(smirk(s|ing)|.*with a smirk)/u }] },\r\n  { Event: \"Wink\", Type: \"Emote\", Matchers: [{ Tester: /^winks/u }] },\r\n  { Event: \"Pout\", Type: \"Emote\", Matchers: [{ Tester: /^pouts/u }] },\r\n  { Event: \"Blink\", Type: \"Emote\", Matchers: [{ Tester: /^blinks/u }] },\r\n  { Event: \"Frown\", Type: \"Emote\", Matchers: [{ Tester: /^frowns/u }] },\r\n  { Event: \"Grin\", Type: \"Emote\", Matchers: [{ Tester: /^(grins|is grinning)/u }] },\r\n  { Event: \"Confused\", Type: \"Emote\", Matchers: [{ Tester: /^((seems|looks) (confused|curious|suspicious)|raises an eyebrow)/u }] },\r\n  { Event: \"CloseMouth\", Type: \"Emote\", Matchers: [{ Tester: /^closes (her|his|their) mouth/u }] },\r\n  { Event: \"OpenMouth\", Type: \"Emote\", Matchers: [{ Tester: /^opens (her|his|their) mouth/u }] },\r\n  { Event: \"Happy\", Type: \"Emote\", Matchers: [{ Tester: /^(looks|seems|is|gets|smiles) happ(il)?y/u }] },\r\n  { Event: \"Smile\", Type: \"Emote\", Matchers: [{ Tester: /^smiles/u }] },\r\n  { Event: \"Distressed\", Type: \"Emote\", Matchers: [{ Tester: /^(looks|seems|is|gets) distressed/u }] },\r\n  { Event: \"Sad\", Type: \"Emote\", Matchers: [{ Tester: /^(looks|seems|is|gets) sad/u }] },\r\n  { Event: \"Worried\", Type: \"Emote\", Matchers: [{ Tester: /^(looks|seems|is|gets) (worried|surprised)/u }] },\r\n  { Event: \"BareTeeth\", Type: \"Emote\", Matchers: [{ Tester: /^(bares (her|his|their) teeth|snarls)/u }] },\r\n  { Event: \"Angry\", Type: \"Emote\", Matchers: [{ Tester: /^(looks angr(il)?y|(gets|is|seems) angry)/u }] },\r\n  { Event: \"Glare\", Type: \"Emote\", Matchers: [{ Tester: /^(glares|looks harshly|gives a (glare|harsh look))/u }] },\r\n  { Event: \"OpenEyes\", Type: \"Emote\", Matchers: [{ Tester: /^opens (her|his|their) eyes/u }] },\r\n  { Event: \"NarrowEyes\", Type: \"Emote\", Matchers: [{ Tester: /^((squints|narrows) (her|his|their) eyes|narrowly opens (her|his|their) eyes)/u }] },\r\n  { Event: \"CloseEyes\", Type: \"Emote\", Matchers: [{ Tester: /^closes (her|his|their) eyes/u }] },\r\n  { Event: \"ResetBrows\", Type: \"Emote\", Matchers: [{ Tester: /^lowers (her|his|their) eyebrows/u }] },\r\n  { Event: \"RaiseBrows\", Type: \"Emote\", Matchers: [{ Tester: /^raises (her|his|their) eyebrows/u }] },\r\n  { Event: \"DroolSides\", Type: \"Emote\", Matchers: [{ Tester: /^drools/u }] },\r\n  { Event: \"Cry\", Type: \"Emote\", Matchers: [{ Tester: /^(starts to cry|sheds .* tears?|eyes( start( to)?)? leak)/u }] },\r\n  { Event: \"Reset\", Type: \"Emote\", Matchers: [{ Tester: /^'s (expression|face) returns to normal/u }] },\r\n  {\r\n    Event: \"Shock\",\r\n    Type: \"Action\",\r\n    Matchers: [\r\n      {\r\n        Tester: /^(ActionActivityShockItem|FuturisticVibratorShockTrigger|FuturisticChastityBeltShock\\w+|(TriggerShock|(ShockCollar|Collar(Auto)?ShockUnit|(LoveChastityBelt|SciFiPleasurePanties)Shock)Trigger)(1|2))$/u,\r\n        Criteria: { TargetIsPlayer: true },\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    Event: \"ShockLight\",\r\n    Type: \"Action\",\r\n    Matchers: [\r\n      {\r\n        Tester: /^(TriggerShock|(ShockCollar|Collar(Auto)?ShockUnit|(LoveChastityBelt|SciFiPleasurePanties)Shock)Trigger)0$/u,\r\n        Criteria: { TargetIsPlayer: true },\r\n      },\r\n    ],\r\n  },\r\n  { Event: \"Hit\", Type: \"Action\", Matchers: [{ Tester: /^ActionActivitySpankItem$/u, Criteria: { TargetIsPlayer: true } }] },\r\n  {\r\n    Event: \"Spank\",\r\n    Type: \"Activity\",\r\n    Matchers: [\r\n      { Tester: /^ChatOther-ItemButt-Spank$/u, Criteria: { TargetIsPlayer: true } },\r\n      { Tester: /^ChatSelf-ItemButt-Spank$/u },\r\n    ],\r\n  },\r\n  { Event: \"Cuddle\", Type: \"Activity\", Matchers: [{ Tester: /^ChatOther-.*-Cuddle$/u }, { Tester: /^ChatSelf-.*-Cuddle$/u }] },\r\n  { Event: \"Stimulated\", Type: \"Action\", Matchers: [{ Tester: /^ActionActivityMasturbateItem$/u, Criteria: { TargetIsPlayer: true } }] },\r\n  {\r\n    Event: \"StimulatedLong\",\r\n    Type: \"Activity\",\r\n    Matchers: [\r\n      { Tester: /^ChatOther-.*-(Masturbate|Penetrate).*$/u, Criteria: { TargetIsPlayer: true } },\r\n      { Tester: /^ChatSelf-.*-(Masturbate|Penetrate).*$/u },\r\n    ],\r\n  },\r\n  { Event: \"KissOnLips\", Type: \"Activity\", Matchers: [{ Tester: /^ChatOther-ItemMouth-Kiss$/u }] },\r\n  { Event: \"Kiss\", Type: \"Activity\", Matchers: [{ Tester: /^ChatOther-.*-Kiss$/u, Criteria: { SenderIsPlayer: true } }] },\r\n  { Event: \"Disoriented\", Type: \"Action\", Matchers: [{ Tester: /^(KneelDown|StandUp)Fail$/u }] },\r\n  { Event: \"LipBite\", Type: \"Activity\", Matchers: [{ Tester: /^ChatSelf-ItemMouth-Bite$/u }] },\r\n  { Event: \"Lick\", Type: \"Activity\", Matchers: [{ Tester: /^ChatOther-.*-(Lick|MasturbateTongue)$/u, Criteria: { SenderIsPlayer: true } }] },\r\n  {\r\n    Event: \"DroolReset\",\r\n    Type: \"Activity\",\r\n    Matchers: [{ Tester: /^ChatOther-ItemMouth-Caress$/u, Criteria: { TargetIsPlayer: true } }, { Tester: /^ChatSelf-ItemMouth-Caress$/u }],\r\n  },\r\n  { Event: \"LongKiss\", Type: \"Activity\", Matchers: [{ Tester: /^ChatOther-ItemMouth-FrenchKiss$/u }] },\r\n];\r\n","import { patchFunction, SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { BCX } from \"./hookBCXAPI\";\r\nimport { createTimer } from \"../util/hooks\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport {\r\n  waitFor,\r\n  fbcChatNotify,\r\n  deepCopy,\r\n  isString,\r\n  objEntries,\r\n  isCharacter,\r\n  isNonNullObject,\r\n  isStringOrStringArray,\r\n  mustNum,\r\n} from \"../util/utils\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { logWarn } from \"../util/logger\";\r\nimport { ActivityTriggers, ArousalExpressionStages, EventExpressions } from \"../util/expressions\";\r\n\r\nexport default async function automaticExpressions() {\r\n  await waitFor(() => CurrentScreen === \"ChatRoom\" && !!Player.ArousalSettings);\r\n  if (!Player.ArousalSettings) {\r\n    throw new Error(\"Player.ArousalSettings is not defined\");\r\n  }\r\n\r\n  patchFunction(\r\n    \"StruggleMinigameHandleExpression\",\r\n    { '\");': '\", 3);' },\r\n    \"Resetting blush, eyes, and eyebrows after struggling\"\r\n  );\r\n\r\n  /** @type {() => boolean} */\r\n  function animationEngineEnabled() {\r\n    return !!fbcSettings.animationEngine;\r\n  }\r\n  globalThis.bceAnimationEngineEnabled = animationEngineEnabled;\r\n\r\n  SDK.hookFunction(\r\n    \"StruggleMinigameStop\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (fbcSettings.animationEngine) {\r\n        // eslint-disable-next-line no-undefined\r\n        StruggleExpressionStore = undefined;\r\n        resetExpressionQueue([GAME_TIMED_EVENT_TYPE], [MANUAL_OVERRIDE_EVENT_TYPE]);\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  if (!globalThis.bce_ArousalExpressionStages) {\r\n    // eslint-disable-next-line camelcase\r\n    globalThis.bce_ArousalExpressionStages = ArousalExpressionStages;\r\n  }\r\n\r\n  /** @type {{[key: string]: ExpressionName[]}} */\r\n  const bceExpressionModifierMap = Object.freeze({ Blush: [null, \"Low\", \"Medium\", \"High\", \"VeryHigh\", \"Extreme\"] });\r\n\r\n  const AUTOMATED_AROUSAL_EVENT_TYPE = \"AutomatedByArousal\",\r\n    DEFAULT_EVENT_TYPE = \"DEFAULT\",\r\n    GAME_TIMED_EVENT_TYPE = \"GameTimer\",\r\n    MANUAL_OVERRIDE_EVENT_TYPE = \"ManualOverride\",\r\n    POST_ORGASM_EVENT_TYPE = \"PostOrgasm\";\r\n\r\n  /** @type {ExpressionEvent[]} */\r\n  const bceExpressionsQueue = [];\r\n  let lastUniqueId = 0;\r\n\r\n  /** @type {() => number} */\r\n  function newUniqueId() {\r\n    lastUniqueId = (lastUniqueId + 1) % (Number.MAX_SAFE_INTEGER - 1);\r\n    return lastUniqueId;\r\n  }\r\n\r\n  /** @type {Partial<Record<'Eyes' | 'Eyes2' | 'Eyebrows' | 'Mouth' | 'Fluids' | 'Emoticon' | 'Blush' | 'Pussy', string | null>>} */\r\n  const manualComponents = {};\r\n\r\n  /** @type {(evt: ExpressionEvent) => void} */\r\n  function pushEvent(evt) {\r\n    if (!evt) {\r\n      return;\r\n    }\r\n    switch (evt.Type) {\r\n      case AUTOMATED_AROUSAL_EVENT_TYPE:\r\n      case POST_ORGASM_EVENT_TYPE:\r\n        if (!fbcSettings.expressions) {\r\n          return;\r\n        }\r\n        break;\r\n      case MANUAL_OVERRIDE_EVENT_TYPE:\r\n        break;\r\n      default:\r\n        if (!fbcSettings.activityExpressions) {\r\n          return;\r\n        }\r\n    }\r\n    const time = Date.now();\r\n    // Deep copy\r\n    /** @type {ExpressionEvent} */\r\n    const event = deepCopy(evt);\r\n    event.At = time;\r\n    event.Until = time + event.Duration;\r\n    event.Id = newUniqueId();\r\n    if (typeof event.Priority !== \"number\") {\r\n      event.Priority = 1;\r\n    }\r\n    if (event.Expression) {\r\n      for (const t of Object.values(event.Expression)) {\r\n        for (const exp of t) {\r\n          exp.Id = newUniqueId();\r\n          if (typeof exp.Priority !== \"number\") {\r\n            exp.Priority = 1;\r\n          }\r\n          if (typeof exp.Duration !== \"number\") {\r\n            exp.Duration = event.Duration;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (event.Poses) {\r\n      for (const p of event.Poses) {\r\n        p.Id = newUniqueId();\r\n        if (typeof p.Priority !== \"number\") {\r\n          p.Priority = 1;\r\n        }\r\n      }\r\n    }\r\n    bceExpressionsQueue.push(event);\r\n  }\r\n  globalThis.fbcPushEvent = pushEvent;\r\n\r\n  if (!globalThis.bce_EventExpressions) {\r\n    // eslint-disable-next-line camelcase\r\n    globalThis.bce_EventExpressions = EventExpressions;\r\n  }\r\n\r\n  if (!globalThis.bce_ActivityTriggers) {\r\n    // eslint-disable-next-line camelcase\r\n    globalThis.bce_ActivityTriggers = ActivityTriggers;\r\n  }\r\n\r\n  /** @type {(dict?: ChatMessageDictionary) => boolean} */\r\n  function dictHasPlayerTarget(dict) {\r\n    return dict?.some(t => t && \"TargetCharacter\" in t && t.TargetCharacter === Player.MemberNumber) || false;\r\n  }\r\n\r\n  registerSocketListener(\"ChatRoomMessage\", (/** @type {ServerChatRoomMessage} */ data) => {\r\n    activityTriggers: for (const trigger of globalThis.bce_ActivityTriggers.filter(t => t.Type === data.Type)) {\r\n      if (Player.GhostList.includes(data.Sender)) break;\r\n      for (const matcher of trigger.Matchers) {\r\n        if (matcher.Tester.test(data.Content)) {\r\n          if (matcher.Criteria) {\r\n            if (matcher.Criteria.SenderIsPlayer && data.Sender !== Player.MemberNumber) {\r\n              continue;\r\n            } else if (matcher.Criteria.TargetIsPlayer && !dictHasPlayerTarget(data.Dictionary)) {\r\n              continue;\r\n            } else if (\r\n              matcher.Criteria.DictionaryMatchers &&\r\n              !matcher.Criteria.DictionaryMatchers.some(m => data.Dictionary?.find(t => Object.keys(m).every(k => m[k] === t[k])))\r\n            ) {\r\n              continue;\r\n            }\r\n            // Criteria met\r\n            pushEvent(globalThis.bce_EventExpressions[trigger.Event]);\r\n          } else if (data.Sender === Player.MemberNumber || dictHasPlayerTarget(data.Dictionary)) {\r\n            // Lacking criteria, check for presence of player as source or target\r\n            pushEvent(globalThis.bce_EventExpressions[trigger.Event]);\r\n            break activityTriggers;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  /** @type {(faceComponent: string) => [ExpressionName, boolean]} */\r\n  function expression(t) {\r\n    const properties = Player.Appearance.find(a => a.Asset.Group.Name === t)?.Property ?? null;\r\n    return [properties?.Expression || null, !properties?.RemoveTimer];\r\n  }\r\n\r\n  /** @type {(faceComponent: string, newExpression: ExpressionName, color?: string | string[]) => void} */\r\n  function setExpression(t, n, color) {\r\n    if (!n) {\r\n      n = null;\r\n    }\r\n    for (const appearance of Player.Appearance) {\r\n      if (appearance.Asset.Group.Name === t) {\r\n        if (!appearance.Property) {\r\n          appearance.Property = {};\r\n        }\r\n        appearance.Property.Expression = n;\r\n        if (color) {\r\n          appearance.Color = color;\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  const poseCategories = /** @type {const} */ ({\r\n    BodyFull: { Conflicts: [\"BodyUpper\", \"BodyLower\"] },\r\n    BodyUpper: { Conflicts: [\"BodyFull\"] },\r\n    BodyLower: { Conflicts: [\"BodyFull\"] },\r\n  });\r\n\r\n  /**\r\n   * @param {unknown} pose\r\n   * @returns {pose is keyof typeof poseCategories}\r\n   */\r\n  function hasConflicts(pose) {\r\n    return isString(pose) && pose in poseCategories;\r\n  }\r\n\r\n  const faceComponents = [\"Eyes\", \"Eyes2\", \"Eyebrows\", \"Mouth\", \"Fluids\", \"Emoticon\", \"Blush\", \"Pussy\"];\r\n\r\n  // When first initializing, set the current face as manual override\r\n  pushEvent({\r\n    Type: MANUAL_OVERRIDE_EVENT_TYPE,\r\n    Duration: -1,\r\n    Expression: faceComponents\r\n      .map((t) => {\r\n        const [expr] = expression(t);\r\n        return [t, expr];\r\n      })\r\n      .filter(v => v[1] !== null)\r\n      .map(v => [v[0], [{ Expression: v[1] }]])\r\n      .reduce((a, v) => ({ ...a, [/** @type {string} */ (v[0])]: v[1] }), {}),\r\n  });\r\n\r\n  let lastOrgasm = 0,\r\n    orgasmCount = 0,\r\n    wasDefault = false;\r\n\r\n  let PreviousArousal = Player.ArousalSettings;\r\n\r\n  const ArousalMeterDirection = {\r\n    None: 0,\r\n    Down: 1,\r\n    Up: 2,\r\n  };\r\n  let PreviousDirection = ArousalMeterDirection.Up;\r\n\r\n  /**\r\n   * @param {string[]} types Types to reset\r\n   * @param {string[]} skippedTypes Types to skip resetting in addition to automated arousal events\r\n   */\r\n  function resetExpressionQueue(types, skippedTypes = []) {\r\n    delete Player.ExpressionQueue;\r\n    bceExpressionsQueue.push(\r\n      ...bceExpressionsQueue.splice(0, bceExpressionsQueue.length).map((e) => {\r\n        if (\r\n          types.includes(e.Type) ||\r\n          (e.Duration <= 0 && e.Type !== AUTOMATED_AROUSAL_EVENT_TYPE && !skippedTypes.includes(e.Type))\r\n        ) {\r\n          delete e.Expression;\r\n        }\r\n        return e;\r\n      })\r\n    );\r\n    // Restore manual overrides, if manual not in types\r\n    if (!types.includes(MANUAL_OVERRIDE_EVENT_TYPE)) {\r\n      pushEvent({\r\n        Type: MANUAL_OVERRIDE_EVENT_TYPE,\r\n        Duration: -1,\r\n        Expression: objEntries(manualComponents).reduce((a, [k, v]) => ({ ...a, [k]: [{ Expression: v }] }), {}),\r\n      });\r\n    } else {\r\n      for (const [k] of objEntries(manualComponents)) {\r\n        delete manualComponents[k];\r\n      }\r\n    }\r\n  }\r\n\r\n  CommandCombine([\r\n    {\r\n      Tag: \"r\",\r\n      Description: displayText(\"[part of face or 'all']: resets expression overrides on part of or all of face\"),\r\n      Action: (args) => {\r\n        if (args.length === 0 || args === \"all\") {\r\n          resetExpressionQueue([MANUAL_OVERRIDE_EVENT_TYPE]);\r\n          fbcChatNotify(displayText(\"Reset all expressions\"));\r\n        } else {\r\n          const component = `${args[0].toUpperCase()}${args.substring(1).toLowerCase()}`;\r\n          for (const e of bceExpressionsQueue.map(a => a.Expression).filter(Boolean)) {\r\n            if (component === \"Eyes\" && \"Eyes2\" in e) {\r\n              delete e.Eyes2;\r\n            }\r\n            if (component in e) {\r\n              delete e[component];\r\n            }\r\n          }\r\n          fbcChatNotify(displayText(\"Reset expression on $component\", { $component: component }));\r\n        }\r\n      },\r\n    },\r\n    {\r\n      Tag: \"anim\",\r\n      Description: displayText(\"['list' or name of emote]: run an animation\"),\r\n      Action: (_1, _2, args) => {\r\n        if (!fbcSettings.activityExpressions) {\r\n          fbcChatNotify(displayText(\"Activity expressions are not enabled in WCE settings. Unable to run animations.\"));\r\n          return;\r\n        }\r\n        if (args[0] === \"list\") {\r\n          fbcChatNotify(displayText(\"Available animations: $anims\", { $anims: Object.keys(globalThis.bce_EventExpressions).join(\", \") }));\r\n        }\r\n        const animation = Object.keys(globalThis.bce_EventExpressions).find(a => a.toLowerCase() === args[0]?.toLowerCase());\r\n        if (animation) {\r\n          pushEvent(globalThis.bce_EventExpressions[animation]);\r\n        }\r\n      },\r\n    },\r\n  ]);\r\n\r\n  /**\r\n   * @param {AssetPoseName} pose\r\n   */\r\n  function getPoseCategory(pose) {\r\n    return PoseFemale3DCG.find(a => a.Name === pose)?.Category;\r\n  }\r\n\r\n  /**\r\n   * @param {readonly string[]} poses\r\n   */\r\n  function setPoses(poses) {\r\n    poses = poses.filter(p => p).map(p => p.toLowerCase());\r\n    bceExpressionsQueue.forEach((e) => {\r\n      if (e.Type === MANUAL_OVERRIDE_EVENT_TYPE) {\r\n        e.Poses = [];\r\n      } else if (e.Poses && e.Poses.length > 0) {\r\n        e.Poses.forEach((p) => {\r\n          if (p.Pose.length === 0) {\r\n            return;\r\n          }\r\n          if (typeof p.Pose[0] === \"string\") {\r\n            return;\r\n          }\r\n          const poseList = p.Pose;\r\n          p.Pose = poseList.filter(pp => !!getPoseCategory(pp));\r\n        });\r\n      }\r\n    });\r\n    const poseNames = PoseFemale3DCG.filter(p => poses.includes(p.Name.toLowerCase())).map(p => p.Name);\r\n    for (const poseName of poseNames) {\r\n      PoseSetActive(Player, poseName, false);\r\n    }\r\n  }\r\n\r\n  CommandCombine({\r\n    Tag: \"pose\",\r\n    Description: displayText(\"['list' or list of poses]: set your pose\"),\r\n    Action: (_1, _2, poses) => {\r\n      if (poses[0] === \"list\") {\r\n        const categories = [...new Set(PoseFemale3DCG.map(a => a.Category))];\r\n        for (const category of categories) {\r\n          const list = PoseFemale3DCG.filter(a => a.Category === category)?.map(a => a.Name);\r\n          list.sort();\r\n          fbcChatNotify(`=> ${category}:\\n${list.join(\"\\n\")}\\n\\n`);\r\n        }\r\n        return;\r\n      }\r\n      if (!fbcSettings.animationEngine) {\r\n        fbcChatNotify(\r\n          displayText(\r\n            \"Warning: animation engine in WCE is disabled. Pose may not be synchronized or set. Enable animation engine in WCE settings.\"\r\n          )\r\n        );\r\n      }\r\n      setPoses(poses);\r\n    },\r\n  });\r\n\r\n  patchFunction(\r\n    \"TimerInventoryRemove\",\r\n    {\r\n      \"CharacterSetFacialExpression(C, C.ExpressionQueue[0].Group, C.ExpressionQueue[0].Expression, undefined, undefined, true);\": `if (bceAnimationEngineEnabled()) {\r\n        fbcPushEvent({\r\n          Type: \"${GAME_TIMED_EVENT_TYPE}\",\r\n          Duration: -1,\r\n          Expression: {\r\n            [C.ExpressionQueue[0].Group]: [{ Expression: C.ExpressionQueue[0].Expression, Duration: -1 }]\r\n          }\r\n        })\r\n      } else {\r\n        CharacterSetFacialExpression(C, C.ExpressionQueue[0].Group, C.ExpressionQueue[0].Expression, undefined, undefined, true);\r\n      }`,\r\n    },\r\n    \"Game's timed expressions are not hooked to WCE's animation engine\"\r\n  );\r\n\r\n  patchFunction(\r\n    \"ValidationSanitizeProperties\",\r\n    {\r\n      \"delete property.Expression;\": `delete property.Expression;\r\n      if (bceAnimationEngineEnabled()) {\r\n        if (item?.Asset?.Group?.Name) {\r\n          CharacterSetFacialExpression(C, item.Asset.Group.Name, null);\r\n          console.warn(\"(WCE) Animation engine acknowledged validation-based expression removal for face component\", item)\r\n        } else {\r\n          console.warn(\"Unable to determine asset group name for item\", item);\r\n        }\r\n      }`,\r\n    },\r\n    \"Prevent animation engine from getting into an endless loop when another addon includes an invalid expression\"\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"CharacterSetFacialExpression\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      // eslint-disable-next-line prefer-const\r\n      let [C, AssetGroup, Expression, Timer, Color] = args;\r\n      if (\r\n        !isCharacter(C) ||\r\n        !isString(AssetGroup) ||\r\n        (!isString(Expression) && Expression !== null) ||\r\n        !C.IsPlayer() ||\r\n        !fbcSettings.animationEngine\r\n      ) {\r\n        return next(args);\r\n      }\r\n\r\n      const duration = typeof Timer === \"number\" && Timer > 0 ? Timer * 1000 : -1,\r\n        /** @type {Record<string, ExpressionStage[]>} */\r\n        e = {};\r\n      /** @type {(keyof typeof manualComponents)[]} */\r\n      let types = [];\r\n\r\n      if (AssetGroup === \"Eyes\") {\r\n        types = [\"Eyes\", \"Eyes2\"];\r\n      } else if (AssetGroup === \"Eyes1\") {\r\n        types = [\"Eyes\"];\r\n      } else {\r\n        types = [AssetGroup];\r\n      }\r\n\r\n      if (!Color || !isStringOrStringArray(Color) || !CommonColorIsValid(Color)) {\r\n        // eslint-disable-next-line no-undefined\r\n        Color = undefined;\r\n      }\r\n\r\n      for (const t of types) {\r\n        e[t] = [{ Expression, Duration: duration, Color }];\r\n        if (duration < 0) {\r\n          manualComponents[t] = Expression;\r\n        }\r\n      }\r\n\r\n      const evt = {\r\n        Type: MANUAL_OVERRIDE_EVENT_TYPE,\r\n        Duration: duration,\r\n        Expression: e,\r\n      };\r\n      pushEvent(evt);\r\n      return CustomArousalExpression();\r\n    }\r\n  );\r\n\r\n  const poseFuncs = /** @type {const} */ ([\"CharacterSetActivePose\", \"PoseSetActive\"]);\r\n  for (const poseFunc of poseFuncs) {\r\n    SDK.hookFunction(\r\n      poseFunc,\r\n      HOOK_PRIORITIES.OverrideBehaviour,\r\n      (args, next) => {\r\n        const [C, Pose] = args;\r\n        if (\r\n          !isCharacter(C) ||\r\n          (!isStringOrStringArray(Pose) && Pose !== null) ||\r\n          !C.IsPlayer() ||\r\n          !fbcSettings.animationEngine\r\n        ) {\r\n          return next(args);\r\n        }\r\n\r\n        const p = {};\r\n        if (!Pose || (Array.isArray(Pose) && Pose.every(pp => !pp))) {\r\n          p.Pose = /** @type {AssetPoseName[]} */ ([\"BaseUpper\", \"BaseLower\"]);\r\n        } else {\r\n          p.Pose = [Pose];\r\n        }\r\n        p.Duration = -1;\r\n        const evt = {\r\n          Type: MANUAL_OVERRIDE_EVENT_TYPE,\r\n          Duration: -1,\r\n          Poses: [p],\r\n        };\r\n        pushEvent(evt);\r\n        return CustomArousalExpression();\r\n      }\r\n    );\r\n  }\r\n\r\n  registerSocketListener(\"ChatRoomSyncPose\", (/** @type {ServerCharacterPoseResponse} */ data) => {\r\n    if (data === null || !isNonNullObject(data)) {\r\n      return;\r\n    }\r\n    if (!Array.isArray(data.Pose)) {\r\n      logWarn(`data.Pose in ChatRoomSyncPose for ${data.MemberNumber?.toString()} is not an array`);\r\n      return;\r\n    }\r\n    if (!fbcSettings.animationEngine) {\r\n      return;\r\n    }\r\n    if (data.MemberNumber === Player.MemberNumber) {\r\n      setPoses(data.Pose);\r\n    }\r\n  });\r\n\r\n  registerSocketListener(\"ChatRoomSyncSingle\", (/** @type {ServerChatRoomSyncCharacterResponse} */ data) => {\r\n    if (data === null || !isNonNullObject(data)) {\r\n      return;\r\n    }\r\n    if (!fbcSettings.animationEngine) {\r\n      return;\r\n    }\r\n    if (data.Character?.MemberNumber === Player.MemberNumber) {\r\n      setPoses(data.Character.ActivePose ?? []);\r\n    }\r\n  });\r\n\r\n  resetExpressionQueue([MANUAL_OVERRIDE_EVENT_TYPE, GAME_TIMED_EVENT_TYPE]);\r\n\r\n  // This is called once per interval to check for expression changes\r\n  // eslint-disable-next-line complexity\r\n  function CustomArousalExpression() {\r\n    if (!fbcSettings.animationEngine || !Player?.AppearanceLayers) {\r\n      return;\r\n    }\r\n\r\n    // Ensure none of the expressions have remove timers on them; we handle timers here\r\n    Player.Appearance.filter(a => faceComponents.includes(a.Asset.Group.Name) && a.Property?.RemoveTimer).forEach(\r\n      (a) => {\r\n        // @ts-ignore - a.Property cannot be undefined due to filter above\r\n        delete a.Property.RemoveTimer;\r\n      }\r\n    );\r\n\r\n    if (!Player.ArousalSettings) {\r\n      logWarn(\"Player.ArousalSettings is not defined\");\r\n      return;\r\n    }\r\n\r\n    Player.ArousalSettings.AffectExpression = false;\r\n\r\n    const oCount = Player.ArousalSettings.OrgasmCount ?? 0;\r\n    if (orgasmCount < oCount) {\r\n      orgasmCount = oCount;\r\n    } else if (orgasmCount > oCount) {\r\n      Player.ArousalSettings.OrgasmCount = orgasmCount;\r\n      ActivityChatRoomArousalSync(Player);\r\n    }\r\n\r\n    // Reset everything when face is fully default\r\n    let isDefault = true;\r\n    for (const t of faceComponents) {\r\n      if (expression(t)[0]) {\r\n        isDefault = false;\r\n      }\r\n    }\r\n    if (isDefault) {\r\n      PreviousArousal.Progress = 0;\r\n      PreviousDirection = ArousalMeterDirection.Up;\r\n      if (!wasDefault) {\r\n        for (const queuedExpression of bceExpressionsQueue) {\r\n          if (queuedExpression.Type === AUTOMATED_AROUSAL_EVENT_TYPE) {\r\n            continue;\r\n          }\r\n          queuedExpression.Expression = {};\r\n        }\r\n      }\r\n      wasDefault = true;\r\n    } else {\r\n      wasDefault = false;\r\n    }\r\n\r\n    // Detect arousal movement\r\n    const arousal = Player.ArousalSettings.Progress;\r\n    let direction = PreviousDirection;\r\n    if (arousal < PreviousArousal.Progress) {\r\n      direction = ArousalMeterDirection.Down;\r\n    } else if (arousal > PreviousArousal.Progress) {\r\n      direction = ArousalMeterDirection.Up;\r\n    }\r\n    PreviousDirection = direction;\r\n\r\n    function lastOrgasmAdjustment() {\r\n      // Only boost up to the expression at arousal 90\r\n      const lastOrgasmMaxArousal = 90,\r\n        lastOrgasmMaxBoost = 30,\r\n        orgasms = Player.ArousalSettings?.OrgasmCount || 0;\r\n      const lastOrgasmBoostDuration = Math.min(300, 60 + orgasms * 5),\r\n        secondsSinceOrgasm = ((Date.now() - lastOrgasm) / 10000) | 0;\r\n      if (secondsSinceOrgasm > lastOrgasmBoostDuration) {\r\n        return 0;\r\n      }\r\n      return Math.min(\r\n        Math.max(0, lastOrgasmMaxArousal - arousal),\r\n        (lastOrgasmMaxBoost * (lastOrgasmBoostDuration - secondsSinceOrgasm)) / lastOrgasmBoostDuration\r\n      );\r\n    }\r\n\r\n    // Handle events\r\n    const OrgasmRecoveryStage = 2;\r\n    if (\r\n      PreviousArousal.OrgasmStage !== OrgasmRecoveryStage &&\r\n      Player.ArousalSettings.OrgasmStage === OrgasmRecoveryStage &&\r\n      bceExpressionsQueue.filter(a => a.Type === POST_ORGASM_EVENT_TYPE).length === 0\r\n    ) {\r\n      pushEvent(globalThis.bce_EventExpressions.PostOrgasm);\r\n      lastOrgasm = Date.now();\r\n    }\r\n\r\n    // Keep track of desired changes\r\n    /** @type {{ [key: string]: ExpressionStage }} */\r\n    const desiredExpression = {};\r\n\r\n    /** @type {Record<string, { Id: number; Pose: AssetPoseName; Category?: string; Duration: number; Priority: number; Type: string }>} */\r\n    let desiredPose = {};\r\n\r\n    /** @type {{ [key: string]: ExpressionStage }} */\r\n    const nextExpression = {};\r\n\r\n    /** @type {(expression: ExpressionName, stage: ExpressionStage, next: ExpressionEvent, faceComponent: string) => void} */\r\n    function trySetNextExpression(e, exp, next, t) {\r\n      const priority = exp.Priority || next.Priority || 0;\r\n      if (!nextExpression[t] || (nextExpression[t].Priority ?? 0) <= priority) {\r\n        nextExpression[t] = {\r\n          Id: exp.Id,\r\n          Expression: e,\r\n          Duration: exp.Duration,\r\n          Priority: priority,\r\n          Color: exp.Color,\r\n        };\r\n      }\r\n    }\r\n\r\n    // Calculate next expression\r\n    for (let j = 0; j < bceExpressionsQueue.length; j++) {\r\n      const next = bceExpressionsQueue[j];\r\n      const nextUntil = next.Until ?? 0;\r\n      const nextAt = next.At ?? 0;\r\n      let active = false;\r\n      if (nextUntil > Date.now() || nextUntil - nextAt < 0) {\r\n        const nextExpr = next.Expression ?? {};\r\n        if (Object.keys(nextExpr).length > 0) {\r\n          for (const t of Object.keys(nextExpr)) {\r\n            let durationNow = Date.now() - nextAt;\r\n            for (let i = 0; i < nextExpr[t].length; i++) {\r\n              /** @type {ExpressionStage} */\r\n              const exp = nextExpr[t][i];\r\n              durationNow -= exp.Duration;\r\n              if (durationNow < 0 || exp.Duration < 0) {\r\n                active = true;\r\n                if (!exp.Skip) {\r\n                  if (exp.ExpressionModifier && t in bceExpressionModifierMap) {\r\n                    const [current] = expression(t);\r\n                    if (!exp.Applied) {\r\n                      /** @type {number} */\r\n                      let idx = bceExpressionModifierMap[t].indexOf(current) + exp.ExpressionModifier;\r\n                      if (idx >= bceExpressionModifierMap[t].length) {\r\n                        idx = bceExpressionModifierMap[t].length - 1;\r\n                      } else if (idx < 0) {\r\n                        idx = 0;\r\n                      }\r\n                      trySetNextExpression(bceExpressionModifierMap[t][idx], exp, next, t);\r\n                      // @ts-ignore - not undefined, ts is a derp\r\n                      bceExpressionsQueue[j].Expression[t][i].Applied = true;\r\n                    } else {\r\n                      // Prevent being overridden by other expressions while also not applying a change\r\n                      trySetNextExpression(current, exp, next, t);\r\n                    }\r\n                  } else {\r\n                    trySetNextExpression(exp.Expression ?? null, exp, next, t);\r\n                  }\r\n                }\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (next.Poses?.length) {\r\n          let durationNow = Date.now() - nextAt;\r\n          for (const pose of next.Poses) {\r\n            durationNow -= pose.Duration;\r\n            if (durationNow < 0 || pose.Duration < 0) {\r\n              active = true;\r\n              for (const p of pose.Pose) {\r\n                const priority = pose.Priority || next.Priority || 0;\r\n                const category = getPoseCategory(p);\r\n                if (!category) {\r\n                  logWarn(`Pose ${p} has no category`);\r\n                  continue;\r\n                }\r\n\r\n                if (!pose.Id) {\r\n                  logWarn(`Pose ${p} has no ID`);\r\n                  pose.Id = newUniqueId();\r\n                }\r\n\r\n                if (!desiredPose[category] || desiredPose[category].Priority <= priority) {\r\n                  desiredPose[category] = {\r\n                    Id: pose.Id,\r\n                    Pose: p,\r\n                    Category: category,\r\n                    Duration: pose.Duration,\r\n                    Priority: priority,\r\n                    Type: next.Type,\r\n                  };\r\n                }\r\n              }\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (!active) {\r\n        const last = bceExpressionsQueue.splice(j, 1);\r\n        j--;\r\n        if (!fbcSettings.expressions && last.length > 0 && last[0].Expression) {\r\n          for (const t of Object.keys(last[0].Expression)) {\r\n            trySetNextExpression(\r\n              null,\r\n              { Duration: -1 },\r\n              {\r\n                Priority: 0,\r\n                Type: DEFAULT_EVENT_TYPE,\r\n                Duration: 500,\r\n              },\r\n              t\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Garbage collect unused expressions - this should occur before manual expressions are detected\r\n    for (let j = 0; j < bceExpressionsQueue.length; j++) {\r\n      const qExpr = bceExpressionsQueue[j].Expression;\r\n      const qPoses = bceExpressionsQueue[j].Poses;\r\n      if (qExpr) {\r\n        for (const t of Object.keys(qExpr)) {\r\n          if (!nextExpression[t] || nextExpression[t].Duration > 0) {\r\n            continue;\r\n          }\r\n          const nextId = mustNum(nextExpression[t].Id),\r\n            nextPriority = mustNum(nextExpression[t].Priority, 0);\r\n\r\n          for (let i = 0; i < qExpr[t].length; i++) {\r\n            const exp = qExpr[t][i];\r\n            if (exp.Duration < 0 && (mustNum(exp.Id) < nextId || mustNum(exp.Priority, 0) < nextPriority)) {\r\n              qExpr[t].splice(i, 1);\r\n              i--;\r\n            }\r\n          }\r\n          if (qExpr[t].length === 0) {\r\n            delete qExpr[t];\r\n          }\r\n        }\r\n      }\r\n      if (qPoses) {\r\n        for (let k = 0; k < qPoses.length; k++) {\r\n          const pose = qPoses[k];\r\n          const poseList = pose.Pose;\r\n          const desiredIsNewerAndInfinite = poseList.every(\r\n            // eslint-disable-next-line no-loop-func\r\n            (p) => {\r\n              const category = getPoseCategory(p);\r\n              return (\r\n                !!category &&\r\n                desiredPose[category]?.Duration < 0 &&\r\n                desiredPose[category]?.Id > mustNum(pose.Id) &&\r\n                (desiredPose[category]?.Type === MANUAL_OVERRIDE_EVENT_TYPE || bceExpressionsQueue[j].Type !== MANUAL_OVERRIDE_EVENT_TYPE)\r\n              );\r\n            }\r\n          );\r\n          if (pose.Duration < 0 && desiredIsNewerAndInfinite) {\r\n            qPoses.splice(k, 1);\r\n            k--;\r\n          }\r\n        }\r\n      }\r\n      if (\r\n        Object.keys(bceExpressionsQueue[j].Expression || {}).length === 0 &&\r\n        bceExpressionsQueue[j].Poses?.length === 0\r\n      ) {\r\n        bceExpressionsQueue.splice(j, 1);\r\n        j--;\r\n      }\r\n    }\r\n\r\n    // Clean up unused poses\r\n    let needsRefresh = false;\r\n    /** @type {false | AssetPoseName[]} */\r\n    let poseUpdate = false;\r\n    if (Player.ActivePose) {\r\n      for (let i = 0; i < Player.ActivePose.length; i++) {\r\n        const pose = Player.ActivePose[i];\r\n        const p = PoseFemale3DCG.find(pp => pp.Name === pose);\r\n        if (!p?.Category && Object.values(desiredPose).every(v => v.Pose !== pose)) {\r\n          poseUpdate = [...Player.ActivePose];\r\n          poseUpdate.splice(i, 1);\r\n          i--;\r\n          needsRefresh = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Handle arousal-based expressions\r\n    outer: for (const t of Object.keys(globalThis.bce_ArousalExpressionStages)) {\r\n      const [exp] = expression(t);\r\n      /** @type {ExpressionName} */\r\n      let chosenExpression = null;\r\n      let expressionChosen = false;\r\n      for (const face of globalThis.bce_ArousalExpressionStages[t]) {\r\n        const limit = face.Limit - (direction === ArousalMeterDirection.Up ? 0 : 1);\r\n        if (arousal + lastOrgasmAdjustment() >= limit) {\r\n          if (face.Expression !== exp) {\r\n            chosenExpression = face.Expression;\r\n            expressionChosen = true;\r\n            break;\r\n          } else {\r\n            continue outer;\r\n          }\r\n        }\r\n      }\r\n      if (expressionChosen) {\r\n        /** @type {ExpressionStages} */\r\n        const e = {};\r\n        e[t] = [{ Expression: chosenExpression, Duration: -1, Priority: 0 }];\r\n        pushEvent({\r\n          Type: AUTOMATED_AROUSAL_EVENT_TYPE,\r\n          Duration: -1,\r\n          Priority: 0,\r\n          // @ts-ignore\r\n          Expression: e,\r\n        });\r\n      }\r\n    }\r\n\r\n    for (const t of faceComponents) {\r\n      const [exp] = expression(t),\r\n        nextExp = nextExpression[t] || {\r\n          Duration: -1,\r\n          Expression: null,\r\n        };\r\n      if (nextExp.Expression !== exp && typeof nextExp.Expression !== \"undefined\") {\r\n        desiredExpression[t] = { ...nextExp };\r\n      }\r\n    }\r\n\r\n    if (Object.keys(desiredExpression).length > 0) {\r\n      for (const t of Object.keys(desiredExpression)) {\r\n        if (BCX?.getRuleState(\"block_changing_emoticon\")?.isEnforced && t === \"Emoticon\") {\r\n          continue;\r\n        }\r\n        setExpression(t, desiredExpression[t].Expression ?? null, desiredExpression[t].Color);\r\n        ServerSend(\"ChatRoomCharacterExpressionUpdate\", {\r\n          // @ts-ignore - null is a valid name, mistake in BC-stubs\r\n          Name: desiredExpression[t].Expression ?? null,\r\n          Group: t,\r\n          Appearance: ServerAppearanceBundle(Player.Appearance),\r\n        });\r\n      }\r\n\r\n      needsRefresh = true;\r\n    }\r\n\r\n    // Figure out desiredPose conflicts\r\n    function resolvePoseConflicts() {\r\n      const maxPriority = Math.max(...Object.values(desiredPose).map(p => p.Priority));\r\n\r\n      const maxPriorityPoses = objEntries(desiredPose).filter(p => p[1].Priority === maxPriority);\r\n\r\n      let maxPriorityPose = \"\";\r\n\r\n      if (maxPriorityPoses.length > 1) {\r\n        const maxId = Math.max(...maxPriorityPoses.map(p => p[1].Id)),\r\n          maxIdPoses = maxPriorityPoses.filter(p => p[1].Id === maxId);\r\n        [[maxPriorityPose]] = maxIdPoses;\r\n      } else if (maxPriorityPoses.length === 0) {\r\n        return 0;\r\n      } else {\r\n        [[maxPriorityPose]] = maxPriorityPoses;\r\n      }\r\n      let deleted = 0;\r\n      if (hasConflicts(maxPriorityPose)) {\r\n        const conflicts = poseCategories[maxPriorityPose].Conflicts || [];\r\n        for (const conflict of Array.from(conflicts).filter(c => c in desiredPose)) {\r\n          delete desiredPose[conflict];\r\n          deleted++;\r\n        }\r\n      }\r\n      return deleted;\r\n    }\r\n    while (resolvePoseConflicts() > 0) {\r\n      // Intentionally empty\r\n    }\r\n\r\n    if (Object.keys(desiredPose).length === 0) {\r\n      desiredPose = {\r\n        BodyUpper: {\r\n          Pose: \"BaseUpper\",\r\n          Duration: -1,\r\n          Id: newUniqueId(),\r\n          Priority: 0,\r\n          Type: DEFAULT_EVENT_TYPE,\r\n        },\r\n        BodyLower: {\r\n          Pose: \"BaseLower\",\r\n          Duration: -1,\r\n          Id: newUniqueId(),\r\n          Priority: 0,\r\n          Type: DEFAULT_EVENT_TYPE,\r\n        },\r\n      };\r\n    }\r\n    const basePoseMatcher = /^Base(Lower|Upper)$/u;\r\n    const newPose = Object.values(desiredPose)\r\n      .map(p => p.Pose)\r\n      .filter(p => !basePoseMatcher.test(p));\r\n    if (JSON.stringify(Player.ActivePose) !== JSON.stringify(newPose)) {\r\n      poseUpdate = newPose;\r\n      needsRefresh = true;\r\n    }\r\n\r\n    if (poseUpdate) {\r\n      Player.ActivePose = poseUpdate;\r\n      ServerSend(\"ChatRoomCharacterPoseUpdate\", { Pose: poseUpdate });\r\n    }\r\n\r\n    if (needsRefresh) {\r\n      CharacterRefresh(Player, false, false);\r\n    }\r\n\r\n    PreviousArousal = { ...Player.ArousalSettings };\r\n  }\r\n\r\n  createTimer(CustomArousalExpression, 250);\r\n}\r\n","import { patchFunction, SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { waitFor, isCharacter } from \"../util/utils\";\r\nimport { logWarn } from \"../util/logger\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { BCE_MAX_AROUSAL, HIDDEN, BCE_MSG, MESSAGE_TYPES, FBC_VERSION } from \"../util/constants\";\r\n\r\nexport default async function alternateArousal() {\r\n  await waitFor(() => !!ServerSocket && ServerIsConnected);\r\n\r\n  Player.BCEArousalProgress = Math.min(BCE_MAX_AROUSAL, Player.ArousalSettings?.Progress ?? 0);\r\n  Player.BCEEnjoyment = 1;\r\n  const enjoymentMultiplier = 0.2;\r\n\r\n  registerSocketListener(\"ChatRoomSyncArousal\", (/** @type {ServerCharacterArousalResponse} */ data) => {\r\n    if (data.MemberNumber === Player.MemberNumber) {\r\n      // Skip player's own sync messages since we're tracking locally\r\n      return;\r\n    }\r\n\r\n    const target = ChatRoomCharacter.find(c => c.MemberNumber === data.MemberNumber);\r\n\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    queueMicrotask(() => {\r\n      target.BCEArousalProgress = Math.min(BCE_MAX_AROUSAL, data.Progress || 0);\r\n\r\n      if (!target?.ArousalSettings) {\r\n        logWarn(\"No arousal settings found for\", target);\r\n        return;\r\n      }\r\n\r\n      target.ArousalSettings.Progress = Math.round(target.BCEArousalProgress);\r\n    });\r\n  });\r\n\r\n  patchFunction(\r\n    \"ActivitySetArousalTimer\",\r\n    {\r\n      \"if (Progress > 0 && (C.ArousalSettings.Progress + Progress) > Max)\\n\\t\\tProgress = (Max - C.ArousalSettings.Progress >= 0) ? Max - C.ArousalSettings.Progress : 0;\": `\r\n      if (!C.BCEArousal) {\r\n        if ((Progress > 0) && (C.ArousalSettings.Progress + Progress > Max)) Progress = (Max - C.ArousalSettings.Progress >= 0) ? Max - C.ArousalSettings.Progress : 0;\r\n      } else {\r\n        if (Max === 100) Max = 105;\r\n        const fromMax = Max - (C.BCEArousal ? C.BCEArousalProgress : C.ArousalSettings.Progress);\r\n        if (Progress > 0 && fromMax < Progress) {\r\n          if (fromMax <= 0) {\r\n            Progress = 0;\r\n          } else if (C.BCEArousal) {\r\n            Progress = Math.floor(fromMax / ${enjoymentMultiplier} / (C.BCEEnjoyment || 1));\r\n          } else {\r\n            Progress = fromMax;\r\n          }\r\n        }\r\n      }\r\n    `,\r\n\r\n      \"if (Progress < -25) Progress = -25;\": `\r\n      if (!C.BCEArousal) {\r\n        if (Progress < -25) Progress = -25;\r\n      } else {\r\n        if (Progress < -20) Progress = -20;\r\n      }\r\n      `,\r\n\r\n      \"if (Progress > 25) Progress = 25;\": `\r\n      if (!C.BCEArousal) {\r\n        if (Progress > 25) Progress = 25;\r\n      } else {\r\n        if (Progress > 20) Progress = 20;\r\n      }\r\n      `,\r\n    },\r\n    \"Alternate arousal algorithm will be incorrect.\"\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ActivityChatRoomArousalSync\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      const [C] = args;\r\n      if (isCharacter(C) && C.IsPlayer() && CurrentScreen === \"ChatRoom\") {\r\n        /** @type {ServerChatRoomMessage} */\r\n        const message = {\r\n          Type: HIDDEN,\r\n          Content: BCE_MSG,\r\n          Dictionary: [\r\n            {\r\n              // @ts-ignore - cannot extend valid dictionary entries to add our type to it, but this is possible within the game's wire format\r\n              message: {\r\n                type: MESSAGE_TYPES.ArousalSync,\r\n                version: FBC_VERSION,\r\n                alternateArousal: fbcSettings.alternateArousal,\r\n                progress: C.BCEArousalProgress,\r\n                enjoyment: C.BCEEnjoyment,\r\n              },\r\n            },\r\n          ],\r\n        };\r\n        ServerSend(\"ChatRoomChat\", message);\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ActivitySetArousal\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const [C, Progress] = args;\r\n      const ret = next(args);\r\n      if (isCharacter(C) && typeof Progress === \"number\" && Math.abs(C.BCEArousalProgress - Progress) > 3) {\r\n        C.BCEArousalProgress = Math.min(BCE_MAX_AROUSAL, Progress);\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ActivitySetArousalTimer\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const [C, , , Factor] = args;\r\n      if (isCharacter(C) && typeof Factor === \"number\") {\r\n        C.BCEEnjoyment = 1 + (Factor > 1 ? Math.round(Math.log2(Factor)) : 0);\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ActivityTimerProgress\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const [C, progress] = args;\r\n      if (isCharacter(C) && typeof progress === \"number\") {\r\n        if (!C.BCEArousalProgress) {\r\n          C.BCEArousalProgress = 0;\r\n        }\r\n        if (!C.BCEEnjoyment) {\r\n          C.BCEEnjoyment = 1;\r\n        }\r\n        C.BCEArousalProgress += progress * (progress > 0 ? C.BCEEnjoyment * enjoymentMultiplier : 1);\r\n        C.BCEArousalProgress = Math.min(BCE_MAX_AROUSAL, C.BCEArousalProgress);\r\n        if (C.BCEArousal) {\r\n          if (!C.ArousalSettings) {\r\n            throw new Error(`No arousal settings found for ${C.Name}`);\r\n          }\r\n          C.ArousalSettings.Progress = Math.round(C.BCEArousalProgress);\r\n          args[1] = 0;\r\n          return next(args);\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  patchFunction(\r\n    \"TimerProcess\",\r\n    {\r\n      \"// If the character is egged, we find the highest intensity factor and affect the progress, low and medium vibrations have a cap\\n\\t\\t\\t\\t\\t\\t\\tlet Factor = -1;\": `\r\n      let Factor = -1;\r\n      if (Character[C].BCEArousal) {\r\n        let maxIntensity = 0;\r\n        let vibes = 0;\r\n        let noOrgasmVibes = 0;\r\n        for (let A = 0; A < Character[C].Appearance.length; A++) {\r\n          let Item = Character[C].Appearance[A];\r\n          let ZoneFactor = PreferenceGetZoneFactor(Character[C], Item.Asset.ArousalZone) - 2;\r\n          if (InventoryItemHasEffect(Item, \"Egged\", true) && typeof Item.Property?.Intensity === \"number\" && !isNaN(Item.Property.Intensity) && Item.Property.Intensity >= 0 && ZoneFactor >= 0) {\r\n            if (Item.Property.Intensity >= 0) {\r\n              vibes++;\r\n              if (!PreferenceGetZoneOrgasm(Character[C], Item.Asset.ArousalZone)) {\r\n                noOrgasmVibes++;\r\n              }\r\n              maxIntensity = Math.max(Item.Property.Intensity, maxIntensity);\r\n              Factor += Item.Property.Intensity + ZoneFactor + 1;\r\n            }\r\n          }\r\n        }\r\n        // Adds the fetish value to the factor\r\n        if (Factor >= 0) {\r\n          var Fetish = ActivityFetishFactor(Character[C]);\r\n          if (Fetish > 0) Factor = Factor + Math.ceil(Fetish / 3);\r\n          if (Fetish < 0) Factor = Factor + Math.floor(Fetish / 3);\r\n        }\r\n\r\n        let maxProgress = 100;\r\n        switch (maxIntensity) {\r\n          case 0:\r\n            maxProgress = 40 + vibes * 5;\r\n            break;\r\n          case 1:\r\n            maxProgress = 70 + vibes * 5;\r\n            break;\r\n          default:\r\n            maxProgress = vibes === 0 || vibes > noOrgasmVibes ? 100 : 95;\r\n            break;\r\n        }\r\n        const topStepInterval = 2;\r\n        let stepInterval = topStepInterval;\r\n        if (Factor < 0) {\r\n          ActivityVibratorLevel(Character[C], 0);\r\n        } else {\r\n          if (Factor < 1) {\r\n            ActivityVibratorLevel(Character[C], 1);\r\n            maxProgress = Math.min(maxProgress, 35);\r\n            stepInterval = 5;\r\n          } else if (Factor < 2) {\r\n            ActivityVibratorLevel(Character[C], 1);\r\n            maxProgress = Math.min(maxProgress, 65);\r\n            stepInterval = 4;\r\n          } else if (Factor < 3) {\r\n            maxProgress = Math.min(maxProgress, 95);\r\n            stepInterval = 3;\r\n            ActivityVibratorLevel(Character[C], 2);\r\n          } else {\r\n            ActivityVibratorLevel(Character[C], Math.min(4, Math.floor(Factor)));\r\n          }\r\n          if (maxProgress === 100) {\r\n            maxProgress = 105;\r\n          }\r\n          let maxIncrease = maxProgress - Character[C].ArousalSettings.Progress;\r\n          if (TimerLastArousalProgressCount % stepInterval === 0 && maxIncrease > 0) {\r\n            Character[C].BCEEnjoyment = 1 + (Factor > 1 ? Math.round(1.5*Math.log2(Factor)) : 0);\r\n            ActivityTimerProgress(Character[C], 1);\r\n          }\r\n        }\r\n      } else {\r\n      `,\r\n\r\n      \"if ((Factor == -1)) {ActivityVibratorLevel(Character[C], 0);}\\n\\n\\t\\t\\t\\t\\t\\t}\": `if (Factor == -1) {\r\n          ActivityVibratorLevel(Character[C], 0);\r\n        }\r\n      }\r\n    } else {\r\n      ActivityVibratorLevel(Character[C], 0);\r\n    }\r\n    `,\r\n\r\n      \"// No decay if there's a vibrating item running\": `// No decay if there's a vibrating item running\r\n    Character[C].BCEEnjoyment = 1;`,\r\n    },\r\n    \"Alternative arousal algorithm will be incorrect.\"\r\n  );\r\n}\r\n","import { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { waitFor } from \"../util/utils\";\r\nimport { debug } from \"../util/logger\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default async function autoGhostBroadcast(): Promise<void> {\r\n  await waitFor(() => !!ServerSocket && ServerIsConnected);\r\n  registerSocketListener(\"ChatRoomSyncMemberJoin\", (data: ServerChatRoomSyncMemberJoinResponse) => {\r\n    if (fbcSettings.ghostNewUsers && Date.now() - data.Character.Creation < 30000) {\r\n      ChatRoomListManipulation(Player.BlackList, true, data.Character.MemberNumber.toString());\r\n      if (!Player.GhostList) {\r\n        Player.GhostList = [];\r\n      }\r\n      ChatRoomListManipulation(Player.GhostList, true, data.Character.MemberNumber.toString());\r\n      debug(\r\n        \"Blacklisted\",\r\n        data.Character.Name,\r\n        CharacterNickname(CharacterLoadOnline(data.Character, data.SourceMemberNumber)),\r\n        data.Character.MemberNumber,\r\n        \"registered\",\r\n        (Date.now() - data.Character.Creation) / 1000,\r\n        \"seconds ago\"\r\n      );\r\n    }\r\n  });\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { waitFor, fbcChatNotify, addCustomEffect, removeCustomEffect } from \"../util/utils\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default async function blindWithoutGlasses(): Promise<void> {\r\n  await waitFor(() => !!Player && !!Player.Appearance);\r\n\r\n  function checkBlindness(): void {\r\n    const glasses = [\r\n        \"Glasses1\",\r\n        \"Glasses2\",\r\n        \"Glasses3\",\r\n        \"Glasses4\",\r\n        \"Glasses5\",\r\n        \"Glasses6\",\r\n        \"SunGlasses1\",\r\n        \"SunGlasses2\",\r\n        \"SunGlassesClear\",\r\n        // \"EyePatch1\",\r\n        \"CatGlasses\",\r\n        \"Goggles\",\r\n        \"VGlasses\",\r\n        \"GradientSunglasses\",\r\n        \"JokeGlasses\",\r\n        \"StreetEyewear\",\r\n        \"Pincenez\",\r\n        \"FuturisticVisor\",\r\n        \"InteractiveVisor\",\r\n        \"InteractiveVRHeadset\",\r\n        \"FuturisticMask\",\r\n      ],\r\n      hasGlasses = !!Player.Appearance.find(a => glasses.includes(a.Asset.Name));\r\n\r\n    if (hasGlasses) {\r\n      if (removeCustomEffect(\"BlurLight\")) {\r\n        fbcChatNotify(displayText(\"Having recovered your glasses you can see again!\"));\r\n      }\r\n    } else if (addCustomEffect(\"BlurLight\")) {\r\n      fbcChatNotify(displayText(\"Having lost your glasses your eyesight is impaired!\"));\r\n    }\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"CharacterAppearanceBuildCanvas\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      if (fbcSettings.blindWithoutGlasses && args[0].IsPlayer()) checkBlindness();\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { createTimer } from \"../util/hooks\";\r\nimport { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { waitFor, fbcChatNotify, fbcNotify } from \"../util/utils\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nconst BEEP_CLICK_ACTIONS = Object.freeze({\r\n  /** @type {\"FriendList\"} */\r\n  FriendList: \"FriendList\",\r\n});\r\n\r\nexport default async function friendPresenceNotifications() {\r\n  await waitFor(() => !!Player && ServerSocket && ServerIsConnected);\r\n\r\n  function checkFriends() {\r\n    if (!fbcSettings.friendPresenceNotifications && !fbcSettings.instantMessenger) {\r\n      return;\r\n    }\r\n    if (CurrentScreen === \"FriendList\" || CurrentScreen === \"Relog\" || CurrentScreen === \"Login\") {\r\n      return;\r\n    }\r\n    ServerSend(\"AccountQuery\", { Query: \"OnlineFriends\" });\r\n  }\r\n  createTimer(checkFriends, 20000);\r\n\r\n  /** @type {Friend[]} */\r\n  let lastFriends = [];\r\n  registerSocketListener(\"AccountQueryResult\", (/** @type {ServerAccountQueryResponse} */ data) => {\r\n    if (CurrentScreen === \"FriendList\" || CurrentScreen === \"Relog\" || CurrentScreen === \"Login\") {\r\n      return;\r\n    }\r\n    if (!fbcSettings.friendPresenceNotifications) {\r\n      return;\r\n    }\r\n    if (data.Query !== \"OnlineFriends\") {\r\n      return;\r\n    }\r\n    const friendMemberNumbers = data.Result.map(f => f.MemberNumber),\r\n      offlineFriends = lastFriends.map(f => f.MemberNumber).filter(f => !friendMemberNumbers.includes(f)),\r\n      onlineFriends = friendMemberNumbers.filter(f => !lastFriends.some(ff => ff.MemberNumber === f));\r\n    if (onlineFriends.length) {\r\n      const list = onlineFriends\r\n        .map((f) => {\r\n          const { MemberNumber, MemberName } = data.Result.find(d => d.MemberNumber === f) ?? {\r\n            MemberName: \"\",\r\n            MemberNumber: -1,\r\n          };\r\n          return `${MemberName} (${MemberNumber})`;\r\n        })\r\n        .join(\", \");\r\n      if (fbcSettings.friendNotificationsInChat && CurrentScreen === \"ChatRoom\") {\r\n        fbcChatNotify(displayText(\"Now online: $list\", { $list: list }));\r\n      } else {\r\n        fbcNotify(displayText(\"Now online: $list\", { $list: list }), 5000, { ClickAction: BEEP_CLICK_ACTIONS.FriendList });\r\n      }\r\n    }\r\n    if (fbcSettings.friendOfflineNotifications && offlineFriends.length) {\r\n      const list = offlineFriends\r\n        .map((f) => {\r\n          const { MemberNumber, MemberName } = lastFriends.find(d => d.MemberNumber === f) ?? {\r\n            MemberName: \"\",\r\n            MemberNumber: -1,\r\n          };\r\n          return `${MemberName} (${MemberNumber})`;\r\n        })\r\n        .join(\", \");\r\n      if (fbcSettings.friendNotificationsInChat && CurrentScreen === \"ChatRoom\") {\r\n        fbcChatNotify(displayText(\"Now offline: $list\", { $list: list }));\r\n      } else {\r\n        fbcNotify(displayText(\"Now offline: $list\", { $list: list }), 5000, { ClickAction: BEEP_CLICK_ACTIONS.FriendList });\r\n      }\r\n    }\r\n    lastFriends = data.Result;\r\n  });\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { debug } from \"../util/logger\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { deepCopy, mustNum, fbcChatNotify, fbcSendAction } from \"../util/utils\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default function itemAntiCheat() {\r\n  /** @type {Map<number, number>} */\r\n  const noticesSent = new Map();\r\n\r\n  /** @type {(sourceCharacter: Character, newItem: ItemBundle) => boolean} */\r\n  function validateNewLockMemberNumber(sourceCharacter, newItem) {\r\n    if (!newItem.Name || !newItem.Property?.LockedBy) {\r\n      return true;\r\n    }\r\n    if (newItem.Property?.LockMemberNumber !== sourceCharacter.MemberNumber) {\r\n      debug(\"Bad lock member number\", newItem.Property?.LockMemberNumber, \"from\", sourceCharacter.MemberNumber);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /** @type {(sourceCharacter: Character, oldItem: ItemBundle | null, newItem: ItemBundle | null, ignoreLocks: boolean, ignoreColors: boolean) => { changed: number; prohibited: boolean }} */\r\n  function validateSingleItemChange(sourceCharacter, oldItem, newItem, ignoreLocks, ignoreColors) {\r\n    const changes = {\r\n      changed: 0,\r\n      prohibited: false,\r\n    };\r\n\r\n    if (sourceCharacter.IsPlayer()) {\r\n      return changes;\r\n    }\r\n\r\n    const sourceName = `${CharacterNickname(sourceCharacter)} (${sourceCharacter.MemberNumber ?? \"-1\"})`;\r\n\r\n    /** @type {(item: ItemBundle | null) => ItemBundle | null} */\r\n    function deleteUnneededMetaData(item) {\r\n      if (!item) {\r\n        return item;\r\n      }\r\n      const clone = deepCopy(item);\r\n      if (!clone) {\r\n        return clone;\r\n      }\r\n      if (clone.Property) {\r\n        if (ignoreLocks) {\r\n          delete clone.Property.LockMemberNumber;\r\n          delete clone.Property.LockedBy;\r\n          delete clone.Property.RemoveTimer;\r\n          delete clone.Property.Effect;\r\n        }\r\n        delete clone.Property.BlinkState;\r\n      }\r\n      if (ignoreColors) {\r\n        delete clone.Color;\r\n      }\r\n      return clone;\r\n    }\r\n\r\n    // eslint-disable-next-line complexity\r\n    function validateMistressLocks() {\r\n      const sourceCanBeMistress =\r\n        (sourceCharacter?.Reputation?.find(a => a.Type === \"Dominant\")?.Value ?? 0) >= 50 ||\r\n        sourceCharacter.Title === \"Mistress\";\r\n\r\n      if (\r\n        sourceCanBeMistress ||\r\n        sourceCharacter.MemberNumber === Player.Ownership?.MemberNumber ||\r\n        Player.Lovership?.some(a => a.MemberNumber === sourceCharacter.MemberNumber)\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      // Removal\r\n      if (\r\n        (oldItem?.Property?.LockedBy === \"MistressPadlock\" && newItem?.Property?.LockedBy !== \"MistressPadlock\") ||\r\n        (oldItem?.Property?.LockedBy === \"MistressTimerPadlock\" && newItem?.Property?.LockedBy !== \"MistressTimerPadlock\")\r\n      ) {\r\n        debug(\"Not a mistress attempting to remove mistress lock\", sourceName);\r\n        changes.prohibited = true;\r\n      }\r\n\r\n      // Addition\r\n      if (\r\n        (oldItem?.Property?.LockedBy !== \"MistressPadlock\" && newItem?.Property?.LockedBy === \"MistressPadlock\") ||\r\n        (oldItem?.Property?.LockedBy !== \"MistressTimerPadlock\" && newItem?.Property?.LockedBy === \"MistressTimerPadlock\")\r\n      ) {\r\n        debug(\"Not a mistress attempting to add mistress lock\", sourceName);\r\n        changes.prohibited = true;\r\n      }\r\n\r\n      // Timer change\r\n      if (\r\n        oldItem?.Property?.LockedBy === \"MistressTimerPadlock\" &&\r\n        Math.abs(mustNum(oldItem.Property?.RemoveTimer, Number.MAX_SAFE_INTEGER) - mustNum(newItem?.Property?.RemoveTimer)) > 31 * 60 * 1000\r\n      ) {\r\n        changes.prohibited = true;\r\n        debug(\"Not a mistress attempting to change mistress lock timer more than allowed by public entry\", sourceName);\r\n      }\r\n    }\r\n\r\n    // Validate lock changes\r\n    if (newItem && newItem.Property?.LockMemberNumber !== oldItem?.Property?.LockMemberNumber) {\r\n      if (!validateNewLockMemberNumber(sourceCharacter, newItem)) {\r\n        changes.prohibited = true;\r\n      }\r\n    }\r\n    validateMistressLocks();\r\n\r\n    newItem = deleteUnneededMetaData(newItem);\r\n    oldItem = deleteUnneededMetaData(oldItem);\r\n\r\n    if (JSON.stringify(newItem) !== JSON.stringify(oldItem)) {\r\n      debug(sourceName, \"changed\", JSON.stringify(oldItem), \"to\", JSON.stringify(newItem), \"changes:\", changes);\r\n      changes.changed++;\r\n    }\r\n    return changes;\r\n  }\r\n\r\n  /** @type {(sourceCharacter: Character) => void} */\r\n  function revertChanges(sourceCharacter) {\r\n    if (typeof sourceCharacter.MemberNumber !== \"number\") {\r\n      throw new Error(\"change from invalid source character with no member number\");\r\n    }\r\n\r\n    const sourceName = `${CharacterNickname(sourceCharacter)} (${sourceCharacter.MemberNumber ?? \"-1\"})`;\r\n    debug(\"Rejected changes from\", sourceName);\r\n    fbcChatNotify(\r\n      displayText(\r\n        `[Anti-Cheat] ${sourceName} tried to make suspicious changes! Appearance changes rejected. Consider telling the user to stop, whitelisting the user (if trusted friend), or blacklisting the user (if the behaviour continues, chat command: \"/blacklistadd ${sourceCharacter.MemberNumber}\").`\r\n      )\r\n    );\r\n\r\n    const noticeSent = noticesSent.get(sourceCharacter.MemberNumber) || 0;\r\n    if (Date.now() - noticeSent > 1000 * 60 * 10) {\r\n      noticesSent.set(sourceCharacter.MemberNumber, Date.now());\r\n      fbcSendAction(\r\n        displayText(\r\n          `A magical shield on ${CharacterNickname(\r\n            Player\r\n          )} repelled the suspiciously magical changes attempted by ${sourceName}! [WCE Anti-Cheat]`\r\n        )\r\n      );\r\n    }\r\n    if (\r\n      fbcSettings.antiCheatBlackList &&\r\n      !Player.WhiteList.includes(sourceCharacter.MemberNumber) &&\r\n      !Player.BlackList.includes(sourceCharacter.MemberNumber)\r\n    ) {\r\n      ChatRoomListManipulation(Player.BlackList, true, sourceCharacter.MemberNumber.toString());\r\n      fbcChatNotify(displayText(`[AntiCheat] ${sourceName} blacklisted.`));\r\n    }\r\n    ChatRoomCharacterUpdate(Player);\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomSyncItem\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      const [data] = args;\r\n      if (!fbcSettings.itemAntiCheat) {\r\n        return next(args);\r\n      }\r\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n      const item = /** @type {{ Target: number; } & ItemBundle} */ (data?.Item);\r\n      if (item?.Target !== Player.MemberNumber) {\r\n        return next(args);\r\n      }\r\n      if (Player.WhiteList.includes(data.Source)) {\r\n        return next(args);\r\n      }\r\n      const sourceCharacter =\r\n        ChatRoomCharacter.find(a => a.MemberNumber === data.Source) ||\r\n        (data.Source === Player.MemberNumber ? Player : null);\r\n\r\n      if (!sourceCharacter) {\r\n        throw new Error(\"change from invalid source character not in the current room\");\r\n      }\r\n\r\n      const ignoreLocks = Player.Appearance.some(a => a.Asset.Name === \"FuturisticCollar\");\r\n      const ignoreColors = Player.Appearance.some(a => a.Asset.Name === \"FuturisticHarness\") || ignoreLocks;\r\n      const oldItem = Player.Appearance.find(i => i.Asset.Group.Name === item.Group);\r\n      const oldItemBundle = oldItem ? ServerAppearanceBundle([oldItem])[0] : null;\r\n      const result = validateSingleItemChange(sourceCharacter, oldItemBundle, item, ignoreLocks, ignoreColors);\r\n      if (result.prohibited) {\r\n        revertChanges(sourceCharacter);\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomSyncSingle\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      const [data] = args;\r\n      if (!fbcSettings.itemAntiCheat) {\r\n        return next(args);\r\n      }\r\n      if (!data?.Character) {\r\n        return next(args);\r\n      }\r\n      if (data.Character.MemberNumber !== Player.MemberNumber) {\r\n        return next(args);\r\n      }\r\n      if (Player.WhiteList.includes(data.SourceMemberNumber)) {\r\n        return next(args);\r\n      }\r\n\r\n      const sourceCharacter =\r\n        ChatRoomCharacter.find(a => a.MemberNumber === data.SourceMemberNumber) ||\r\n        (data.SourceMemberNumber === Player.MemberNumber ? Player : null);\r\n\r\n      if (!sourceCharacter) {\r\n        throw new Error(\"change from invalid source character not in the current room\");\r\n      }\r\n\r\n      if (sourceCharacter.IsPlayer()) {\r\n        return next(args);\r\n      }\r\n\r\n      // Gets the item bundles to be used for diff comparison, also making necessary changes for the purpose\r\n      /** @type {(bundle: ItemBundle[]) => Map<string, ItemBundle>} */\r\n      function processItemBundleToMap(bundle) {\r\n        /** @type {(Map<string, ItemBundle>)} */\r\n        const initial = new Map();\r\n        return bundle.reduce((prev, cur) => {\r\n          // Ignoring color changes\r\n          cur = deepCopy(cur);\r\n          delete cur.Color;\r\n          prev.set(`${cur.Group}/${cur.Name}`, cur);\r\n          return prev;\r\n        }, initial);\r\n      }\r\n\r\n      // Number of items changed in appearance\r\n      const oldItems = processItemBundleToMap(\r\n        ServerAppearanceBundle(Player.Appearance.filter(a => a.Asset.Group.Category === \"Item\"))\r\n      );\r\n\r\n      if (!data.Character.Appearance) {\r\n        throw new Error(\"no appearance data in sync single\");\r\n      }\r\n\r\n      const newItems = processItemBundleToMap(\r\n        data.Character.Appearance.filter(a => ServerBundledItemToAppearanceItem(\"Female3DCG\", a)?.Asset.Group.Category === \"Item\")\r\n      );\r\n\r\n      // Locks can be modified enmass with futuristic collar\r\n      const ignoreLocks = Array.from(oldItems.values()).some(i => i.Name === \"FuturisticCollar\") &&\r\n        Array.from(newItems.values()).some(i => i.Name === \"FuturisticCollar\");\r\n      const ignoreColors = (Array.from(oldItems.values()).some(i => i.Name === \"FuturisticHarness\") &&\r\n        Array.from(newItems.values()).some(i => i.Name === \"FuturisticHarness\")) ||\r\n        ignoreLocks;\r\n\r\n      debug(\"Anti-Cheat validating bulk change from\", sourceCharacter.MemberNumber);\r\n\r\n      // Count number of new items\r\n      const newAndChanges = Array.from(newItems.keys()).reduce(\r\n        (changes, cur) => {\r\n          const newItem = newItems.get(cur);\r\n          if (!newItem) {\r\n            throw new Error(\"this should never happen: newItem is null inside map loop\");\r\n          }\r\n          if (!oldItems.has(cur)) {\r\n            // Item is new, validate it and mark as new\r\n            if (!validateNewLockMemberNumber(sourceCharacter, newItem)) {\r\n              changes.prohibited = true;\r\n            }\r\n            changes.new++;\r\n            return changes;\r\n          }\r\n          const oldItem = oldItems.get(cur) ?? null;\r\n          const result = validateSingleItemChange(sourceCharacter, oldItem, newItem, ignoreLocks, ignoreColors);\r\n          changes.prohibited = changes.prohibited || result.prohibited;\r\n          changes.changed += result.changed;\r\n          return changes;\r\n        },\r\n        { new: 0, changed: 0, prohibited: false }\r\n      );\r\n\r\n      // Count number of removed items\r\n      const removed = Array.from(oldItems.keys()).reduce((prev, cur) => {\r\n        if (!newItems.has(cur)) {\r\n          return prev + 1;\r\n        }\r\n        return prev;\r\n      }, 0);\r\n      if (newAndChanges.new + newAndChanges.changed + removed > 2 || newAndChanges.prohibited) {\r\n        debug(\"Anti-Cheat tripped on bulk change from\", sourceCharacter.MemberNumber, newAndChanges, removed);\r\n        revertChanges(sourceCharacter);\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { patchFunction } from \"../util/modding\";\r\n\r\nexport default function leashFix(): void {\r\n  patchFunction(\r\n    \"ChatSearchQuery\",\r\n    {\r\n      \"// Prevent spam searching the same thing.\":\r\n        'if (ChatRoomJoinLeash) { SearchData.Language = \"\"; }\\n\\t// Prevent spam searching the same thing.',\r\n    },\r\n    \"Leashing between language filters\"\r\n  );\r\n}\r\n","import { processChatAugmentsForLine } from \"./chatAugments\";\r\nimport { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { BCX } from \"./hookBCXAPI\";\r\nimport { registerSocketListener } from \"./appendSocketListenersToInit\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { parseJSON, objEntries, isNonNullObject, isString, fbcNotify } from \"../util/utils\";\r\nimport { debug } from \"../util/logger\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\n// BcUtil-compatible instant messaging with friends\r\nexport default function instantMessenger() {\r\n  /** @type {(text: string) => string} */\r\n  function stripBeepMetadata(msg) {\r\n    return msg.split(\"\\uf124\")[0].trimEnd();\r\n  }\r\n  globalThis.bceStripBeepMetadata = stripBeepMetadata;\r\n\r\n  // Build the DOM\r\n  const container = document.createElement(\"div\");\r\n  container.classList.add(\"bce-hidden\");\r\n  container.id = \"bce-instant-messenger\";\r\n  const leftContainer = document.createElement(\"div\");\r\n  leftContainer.id = \"bce-message-left-container\";\r\n  const friendList = document.createElement(\"div\");\r\n  friendList.id = \"bce-friend-list\";\r\n  const rightContainer = document.createElement(\"div\");\r\n  rightContainer.id = \"bce-message-right-container\";\r\n  const messageContainer = document.createElement(\"div\");\r\n  messageContainer.id = \"bce-message-container\";\r\n  const messageInput = document.createElement(\"textarea\");\r\n  messageInput.id = \"bce-message-input\";\r\n  messageInput.setAttribute(\"maxlength\", \"2000\");\r\n  messageInput.addEventListener(\"keydown\", (e) => {\r\n    // MBCHC compatibility: prevent chatroom keydown events from triggering at document level\r\n    e.stopPropagation();\r\n  });\r\n\r\n  const friendSearch = document.createElement(\"input\");\r\n  friendSearch.id = \"bce-friend-search\";\r\n  friendSearch.setAttribute(\"placeholder\", displayText(\"Search for a friend\"));\r\n  friendSearch.autocomplete = \"off\";\r\n  friendSearch.addEventListener(\"keydown\", (e) => {\r\n    // MBCHC compatibility: prevent chatroom keydown events from triggering at document level\r\n    e.stopPropagation();\r\n  });\r\n\r\n  const onlineClass = \"bce-friend-list-handshake-completed\";\r\n  const offlineClass = \"bce-friend-list-handshake-false\";\r\n\r\n  container.appendChild(leftContainer);\r\n  container.appendChild(rightContainer);\r\n  leftContainer.appendChild(friendSearch);\r\n  leftContainer.appendChild(friendList);\r\n  rightContainer.appendChild(messageContainer);\r\n  rightContainer.appendChild(messageInput);\r\n  document.body.appendChild(container);\r\n\r\n  function storageKey() {\r\n    return `bce-instant-messenger-state-${Player.AccountName.toLowerCase()}`;\r\n  }\r\n\r\n  /** @type {number} */\r\n  let activeChat = -1;\r\n\r\n  let unreadSinceOpened = 0;\r\n\r\n  let IMloaded = false;\r\n\r\n  /** @typedef {{ author: string, authorId: number, type: \"Emote\" | \"Action\" | \"Message\", message: string, color: string, createdAt: number }} RawHistory */\r\n  /** @typedef {{ unread: number, statusText: HTMLElement, listElement: HTMLElement, historyRaw: RawHistory[], history: HTMLElement, online: boolean }} IMFriendHistory */\r\n  /** @type {Map<number, IMFriendHistory>} */\r\n  const friendMessages = new Map();\r\n\r\n  function scrollToBottom() {\r\n    const friend = friendMessages.get(activeChat);\r\n    if (friend) {\r\n      friend.history.scrollTop = friend.history.scrollHeight;\r\n    }\r\n  }\r\n\r\n  function saveHistory() {\r\n    /** @type {Record<number, { historyRaw: RawHistory[] }>} */\r\n    const history = {};\r\n    friendMessages.forEach((friend, id) => {\r\n      if (friend.historyRaw.length === 0) {\r\n        return;\r\n      }\r\n      const historyLength = Math.min(friend.historyRaw.length, 100);\r\n      history[id] = { historyRaw: friend.historyRaw.slice(-historyLength) };\r\n    });\r\n    localStorage.setItem(storageKey(), JSON.stringify(history));\r\n  }\r\n\r\n  /** @type {(friendId: number) => void} */\r\n  function changeActiveChat(friendId) {\r\n    const friend = friendMessages.get(friendId);\r\n    messageInput.disabled = !friend?.online;\r\n    messageContainer.innerHTML = \"\";\r\n    for (const f of friendMessages.values()) {\r\n      f.listElement.classList.remove(\"bce-friend-list-selected\");\r\n    }\r\n    if (friend) {\r\n      friend.listElement.classList.add(\"bce-friend-list-selected\");\r\n      friend.listElement.classList.remove(\"bce-friend-list-unread\");\r\n      messageContainer.appendChild(friend.history);\r\n      friend.unread = 0;\r\n    }\r\n\r\n    const previousFriend = friendMessages.get(activeChat);\r\n    if (previousFriend) {\r\n      const divider = previousFriend.history.querySelector(\".bce-message-divider\");\r\n      if (divider) {\r\n        previousFriend.history.removeChild(divider);\r\n      }\r\n    }\r\n\r\n    sortIM();\r\n\r\n    activeChat = friendId;\r\n    scrollToBottom();\r\n  }\r\n\r\n  /** @type {(friendId: number, sent: boolean, beep: Partial<ServerAccountBeepResponse>, skipHistory: boolean, createdAt: Date) => void} */\r\n  // eslint-disable-next-line complexity\r\n  function addMessage(friendId, sent, beep, skipHistory, createdAt) {\r\n    const friend = friendMessages.get(friendId);\r\n    if (!friend || beep.BeepType) {\r\n      return;\r\n    }\r\n\r\n    /** @type {{ messageType: \"Message\" | \"Emote\" | \"Action\"; messageColor?: string; }?} */\r\n    const details = parseJSON(\r\n      beep.Message?.split(\"\\n\")\r\n        .find(line => line.startsWith(\"\\uf124\"))\r\n        ?.substring(1) ?? \"{}\"\r\n    ) ?? { messageType: \"Message\" };\r\n\r\n    if (!details.messageType) {\r\n      details.messageType = \"Message\";\r\n    }\r\n\r\n    /** @type {\"Message\" | \"Emote\" | \"Action\"} */\r\n    const messageType = [\"Message\", \"Emote\", \"Action\"].includes(details.messageType) ? details.messageType : \"Message\";\r\n    const messageColor = details?.messageColor ?? \"#ffffff\";\r\n    const messageText = beep.Message?.split(\"\\n\").filter(line => !line.startsWith(\"\\uf124\")).join(\"\\n\").trimEnd();\r\n\r\n    if (!messageText) {\r\n      debug(\"skipped empty beep\", friendId, beep, sent, skipHistory);\r\n      return;\r\n    }\r\n\r\n    const scrolledToEnd = friend.history.scrollHeight - friend.history.scrollTop - friend.history.clientHeight < 1;\r\n    const message = document.createElement(\"div\");\r\n    message.classList.add(\"bce-message\");\r\n    message.classList.add(sent ? \"bce-message-sent\" : \"bce-message-received\");\r\n    message.classList.add(`bce-message-${messageType}`);\r\n    message.setAttribute(\"data-time\", createdAt.toLocaleString());\r\n\r\n    const author = sent ? CharacterNickname(Player) : beep.MemberName ?? \"<Unknown>\";\r\n\r\n    switch (messageType) {\r\n      case \"Emote\":\r\n        message.textContent = `*${author}${messageText}*`;\r\n        break;\r\n      case \"Action\":\r\n        message.textContent = `*${messageText}*`;\r\n        break;\r\n      case \"Message\":\r\n        {\r\n          const sender = document.createElement(\"span\");\r\n          sender.classList.add(\"bce-message-sender\");\r\n          if (messageColor) {\r\n            sender.style.color = messageColor;\r\n          }\r\n          sender.textContent = `${author}: `;\r\n          message.appendChild(sender);\r\n          message.appendChild(document.createTextNode(messageText));\r\n        }\r\n        break;\r\n      default:\r\n        message.textContent = messageText;\r\n        break;\r\n    }\r\n\r\n    if (!Player.MemberNumber) {\r\n      throw new Error(\"Player.MemberNumber is invalid\");\r\n    }\r\n\r\n    let authorId = Player.MemberNumber;\r\n    if (!sent) {\r\n      if (!beep.MemberNumber) {\r\n        throw new Error(\"beep.MemberNumber is invalid\");\r\n      }\r\n      authorId = beep.MemberNumber;\r\n    }\r\n\r\n    if (!skipHistory) {\r\n      friend.historyRaw.push({\r\n        author,\r\n        authorId,\r\n        message: messageText,\r\n        type: messageType,\r\n        color: messageColor,\r\n        createdAt: Date.now(),\r\n      });\r\n\r\n      friend.listElement.setAttribute(\"data-last-updated\", Date.now().toString());\r\n\r\n      if (friendId !== activeChat) {\r\n        friend.listElement.classList.add(\"bce-friend-list-unread\");\r\n        friend.unread++;\r\n      }\r\n      if (friend.unread === 1 && (container.classList.contains(\"bce-hidden\") || friendId !== activeChat)) {\r\n        const divider = document.createElement(\"div\");\r\n        divider.classList.add(\"bce-message-divider\");\r\n        friend.history.appendChild(divider);\r\n      }\r\n\r\n      if (container.classList.contains(\"bce-hidden\")) {\r\n        unreadSinceOpened++;\r\n      }\r\n    }\r\n    processChatAugmentsForLine(message, scrolledToEnd ? scrollToBottom : () => null);\r\n\r\n    friend.history.appendChild(message);\r\n    if (scrolledToEnd) {\r\n      scrollToBottom();\r\n    }\r\n\r\n    saveHistory();\r\n  }\r\n\r\n  /** @type {(friendId: number) => IMFriendHistory} */\r\n  function handleUnseenFriend(friendId) {\r\n    let msgs = friendMessages.get(friendId);\r\n    if (!msgs) {\r\n      /** @type {IMFriendHistory} */\r\n      const friendData = {\r\n        statusText: document.createElement(\"span\"),\r\n        listElement: document.createElement(\"div\"),\r\n        historyRaw: [],\r\n        history: document.createElement(\"div\"),\r\n        unread: 0,\r\n        online: false,\r\n      };\r\n      friendData.listElement.id = `bce-friend-list-entry-${friendId}`;\r\n      friendData.listElement.classList.add(\"bce-friend-list-entry\");\r\n      friendData.listElement.onclick = () => {\r\n        changeActiveChat(friendId);\r\n      };\r\n\r\n      friendData.history.classList.add(\"bce-friend-history\");\r\n\r\n      const name = document.createElement(\"div\");\r\n      name.classList.add(\"bce-friend-list-entry-name\");\r\n      name.textContent = Player.FriendNames?.get(friendId) || \"\";\r\n      friendData.listElement.appendChild(name);\r\n\r\n      const memberNumber = document.createElement(\"div\");\r\n      memberNumber.classList.add(\"bce-friend-list-entry-member-number\");\r\n      memberNumber.textContent = friendId.toString();\r\n      friendData.listElement.appendChild(memberNumber);\r\n\r\n      friendData.listElement.appendChild(friendData.statusText);\r\n\r\n      friendList.appendChild(friendData.listElement);\r\n\r\n      friendMessages.set(friendId, friendData);\r\n      msgs = friendData;\r\n    }\r\n    return msgs;\r\n  }\r\n\r\n  // ToDo: migrate to IndexedDB\r\n  function loadIM() {\r\n    IMloaded = true;\r\n    const history = /** @type {Record<string, {historyRaw: RawHistory[]}>} */(parseJSON(localStorage.getItem(storageKey()) || \"{}\"));\r\n    for (const [friendIdStr, friendHistory] of objEntries(history)) {\r\n      const friendId = parseInt(friendIdStr);\r\n      const friend = handleUnseenFriend(friendId);\r\n      friend.historyRaw = friendHistory.historyRaw;\r\n      for (const hist of friendHistory.historyRaw) {\r\n        addMessage(\r\n          friendId,\r\n          hist.authorId === Player.MemberNumber,\r\n          {\r\n            Message: `${hist.message}\\n\\n\\uf124${JSON.stringify({\r\n              messageType: hist.type,\r\n              messageColor: hist.color,\r\n            })}`,\r\n            MemberNumber: hist.authorId,\r\n            MemberName: hist.author,\r\n          },\r\n          true,\r\n          hist.createdAt ? new Date(hist.createdAt) : new Date(0)\r\n        );\r\n        if (hist.createdAt) {\r\n          friend.listElement.setAttribute(\"data-last-updated\", hist.createdAt.toString());\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  messageInput.addEventListener(\"keydown\", (e) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      if (BCX?.getRuleState(\"speech_restrict_beep_send\")?.isEnforced && !fbcSettings.allowIMBypassBCX) {\r\n        fbcNotify(displayText(\"Sending beeps is currently restricted by BCX rules\"));\r\n        return;\r\n      }\r\n      let messageText = messageInput.value;\r\n      if (messageText.trim() === \"\") {\r\n        return;\r\n      }\r\n      messageInput.value = \"\";\r\n\r\n      /** @type {\"Message\" | \"Emote\" | \"Action\"} */\r\n      let messageType = \"Message\";\r\n      if (messageText.startsWith(\"/me \")) {\r\n        messageText = messageText.substring(4);\r\n        if (!/^[', ]/u.test(messageText)) {\r\n          messageText = ` ${messageText}`;\r\n        }\r\n        messageType = \"Emote\";\r\n      } else if (messageText.startsWith(\"/action \")) {\r\n        messageText = messageText.substring(8);\r\n        messageType = \"Action\";\r\n      } else if (/^\\*[^*]/u.test(messageText)) {\r\n        messageText = messageText.substring(1);\r\n        if (!/^[', ]/u.test(messageText)) {\r\n          messageText = ` ${messageText}`;\r\n        }\r\n        messageType = \"Emote\";\r\n      } else if (messageText.startsWith(\"**\")) {\r\n        messageText = messageText.substring(2);\r\n        messageType = \"Action\";\r\n      }\r\n\r\n      /** @type {ServerAccountBeepRequest} */\r\n      const message = {\r\n        BeepType: \"\",\r\n        MemberNumber: activeChat,\r\n        IsSecret: true,\r\n        Message: `${messageText}\\n\\n\\uf124${JSON.stringify({\r\n          messageType,\r\n          messageColor: Player.LabelColor,\r\n        })}`,\r\n      };\r\n      addMessage(activeChat, true, message, false, new Date());\r\n      FriendListBeepLog.push({\r\n        ...message,\r\n        MemberName: Player.FriendNames?.get(activeChat) || \"aname\",\r\n        Sent: true,\r\n        Private: false,\r\n        Time: new Date(),\r\n      });\r\n      ServerSend(\"AccountBeep\", message);\r\n    }\r\n  });\r\n\r\n  friendSearch.onkeyup = () => {\r\n    const search = friendSearch.value.toLowerCase();\r\n    for (const friendId of friendMessages.keys()) {\r\n      const friend = friendMessages.get(friendId);\r\n      if (!friend) {\r\n        throw new Error(\"this should never happen, friend is null in map loop\");\r\n      }\r\n      const friendName = Player.FriendNames?.get(friendId)?.toLowerCase();\r\n      if (search === \"\") {\r\n        friend.listElement.classList.remove(\"bce-hidden\");\r\n      } else if (!friendId.toString().includes(search) && !friendName?.includes(search)) {\r\n        friend.listElement.classList.add(\"bce-hidden\");\r\n      } else {\r\n        friend.listElement.classList.remove(\"bce-hidden\");\r\n      }\r\n    }\r\n    sortIM();\r\n  };\r\n\r\n  registerSocketListener(\"AccountQueryResult\", (/** @type {ServerAccountQueryResponse} */ data) => {\r\n    if (data.Query !== \"OnlineFriends\") {\r\n      return;\r\n    }\r\n    if (data.Result && fbcSettings.instantMessenger) {\r\n      for (const friend of data.Result) {\r\n        const f = handleUnseenFriend(friend.MemberNumber);\r\n        f.online = true;\r\n        f.statusText.textContent = displayText(\"Online\");\r\n        f.listElement.classList.remove(offlineClass);\r\n        f.listElement.classList.add(onlineClass);\r\n      }\r\n      for (const friendId of Array.from(friendMessages.keys()).filter(f => !data.Result.some(f2 => f2.MemberNumber === f))) {\r\n        const f = friendMessages.get(friendId);\r\n        if (!f) {\r\n          throw new Error(\"this should never happen, f is null in map loop\");\r\n        }\r\n        f.online = false;\r\n        f.statusText.textContent = displayText(\"Offline\");\r\n        f.listElement.classList.remove(onlineClass);\r\n        f.listElement.classList.add(offlineClass);\r\n      }\r\n      if (!data.Result.some(f => f.MemberNumber === activeChat)) {\r\n        // Disable input, current user is offline\r\n        messageInput.disabled = true;\r\n      } else {\r\n        // Enable input, current user is online\r\n        messageInput.disabled = false;\r\n      }\r\n    }\r\n  });\r\n\r\n  function sortIM() {\r\n    [...friendList.children]\r\n      .sort((a, b) => {\r\n        const notA = !a.classList.contains(onlineClass);\r\n        const notB = !b.classList.contains(onlineClass);\r\n        if ((notA && notB) || (!notA && !notB)) {\r\n          const aUpdatedAt = a.getAttribute(\"data-last-updated\") ?? \"\";\r\n          const bUpdatedAt = b.getAttribute(\"data-last-updated\") ?? \"\";\r\n          const au = /^\\d+$/u.test(aUpdatedAt) ? parseInt(aUpdatedAt) : 0;\r\n          const bu = /^\\d+$/u.test(bUpdatedAt) ? parseInt(bUpdatedAt) : 0;\r\n          return bu - au;\r\n        }\r\n        if (notA) {\r\n          return 1;\r\n        }\r\n        return -1;\r\n      })\r\n      .forEach((node) => {\r\n        friendList.removeChild(node);\r\n        friendList.appendChild(node);\r\n      });\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"ServerAccountBeep\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      const [beep] = args;\r\n      if (beep && isNonNullObject(beep) && !beep.BeepType && fbcSettings.instantMessenger) {\r\n        if (!IMloaded) loadIM();\r\n        addMessage(beep.MemberNumber, false, beep, false, new Date());\r\n      }\r\n      next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ServerSend\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      const [command, b] = args;\r\n      if (command !== \"AccountBeep\") {\r\n        return next(args);\r\n      }\r\n      const beep = /** @type {ServerAccountBeepRequest} */ (b);\r\n      if (!beep?.BeepType && isString(beep?.Message) && !beep.Message.includes(\"\\uf124\")) {\r\n        if (!IMloaded) loadIM();\r\n        addMessage(beep.MemberNumber, true, beep, false, new Date());\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  /** @type {[number, number, number, number]} */\r\n  const buttonPosition = [126, 905, 60, 60];\r\n\r\n  SDK.hookFunction(\r\n    \"DrawProcess\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      next(args);\r\n      if (fbcSettings.instantMessenger) {\r\n        if (\r\n          !fbcSettings.allowIMBypassBCX &&\r\n          (BCX?.getRuleState(\"speech_restrict_beep_receive\")?.isEnforced || (BCX?.getRuleState(\"alt_hide_friends\")?.isEnforced && Player.GetBlindLevel() >= 3))\r\n        ) {\r\n          if (!container.classList.contains(\"bce-hidden\")) hideIM();\r\n          DrawButton(\r\n            ...buttonPosition,\r\n            \"\",\r\n            \"Gray\",\r\n            \"Icons/Small/Chat.png\",\r\n            displayText(\"Instant Messenger (Disabled by BCX)\"),\r\n            false\r\n          );\r\n        } else {\r\n          DrawButton(\r\n            ...buttonPosition,\r\n            \"\",\r\n            unreadSinceOpened ? \"Red\" : \"White\",\r\n            \"Icons/Small/Chat.png\",\r\n            displayText(\"Instant Messenger\"),\r\n            false\r\n          );\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"CommonClick\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (fbcSettings.instantMessenger && MouseIn(...buttonPosition)) {\r\n        if (!container.classList.contains(\"bce-hidden\")) {\r\n          hideIM();\r\n          return;\r\n        }\r\n        if (!IMloaded) loadIM();\r\n        sortIM();\r\n        container.classList.toggle(\"bce-hidden\");\r\n        ServerSend(\"AccountQuery\", { Query: \"OnlineFriends\" });\r\n        unreadSinceOpened = 0;\r\n        scrollToBottom();\r\n        NotificationReset(\"Beep\");\r\n        return;\r\n      }\r\n      next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"NotificationRaise\",\r\n    HOOK_PRIORITIES.ModifyBehaviourHigh,\r\n    (args, next) => {\r\n      if (args[0] === \"Beep\" && args[1]?.body) {\r\n        args[1].body = stripBeepMetadata(args[1].body);\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  /** @type {(e: KeyboardEvent) => void} */\r\n  function keyHandler(e) {\r\n    if (!fbcSettings.instantMessenger) {\r\n      return;\r\n    }\r\n    if (e.key === \"Escape\" && !container.classList.contains(\"bce-hidden\")) {\r\n      hideIM();\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  function hideIM() {\r\n    container.classList.add(\"bce-hidden\");\r\n    messageInput.blur();\r\n    friendSearch.blur();\r\n  }\r\n\r\n  document.addEventListener(\"keydown\", keyHandler, true);\r\n  document.addEventListener(\"keypress\", keyHandler, true);\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { isString } from \"../util/utils\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default function discreetMode() {\r\n  const discreetModeFuncs = /** @type {const} */ ([\"CharacterSetActivePose\", \"PoseSetActive\"]);\r\n  for (const discreetModeFunc of discreetModeFuncs) {\r\n    SDK.hookFunction(\r\n      discreetModeFunc,\r\n      HOOK_PRIORITIES.Top,\r\n      (args, next) => {\r\n        if (fbcSettings.discreetMode) {\r\n          return null;\r\n        }\r\n        return next(args);\r\n      }\r\n    );\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"DrawImageEx\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      if (fbcSettings.discreetMode) {\r\n        if (!args) {\r\n          return false;\r\n        }\r\n        const isBackground = isString(args[0]) && args[0].startsWith(\"Backgrounds/\");\r\n        const ignoredImages =\r\n          /(^Backgrounds\\/(?!Sheet(White)?|grey|White\\.|BrickWall\\.)|\\b(Kneel|Arousal|Activity|Asylum|Cage|Cell|ChangeLayersMouth|Diaper|Kidnap|Logo|Player|Remote|Restriction|SpitOutPacifier|Struggle|Therapy|Orgasm\\d|Poses|HouseVincula|Seducer\\w+)\\b|^data:|^Assets\\/(?!Female3DCG\\/Emoticon\\/(Afk|Sleep|Read|Gaming|Hearing|Thumbs(Up|Down))\\/))/u;\r\n        if (isString(args[0]) && ignoredImages.test(args[0])) {\r\n          if (isBackground) {\r\n            args[0] = \"Backgrounds/BrickWall.jpg\";\r\n            return next(args);\r\n          }\r\n          return false;\r\n        }\r\n        // @ts-ignore\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\r\n        if (args[0]?.src && ignoredImages.test(args[0].src)) {\r\n          return false;\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomCharacterViewDraw\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      if (fbcSettings.discreetMode) {\r\n        // Check if we should use a custom background\r\n        let backgroundURL;\r\n        const itemBackground = DrawGetCustomBackground(Player);\r\n        if (itemBackground) {\r\n          backgroundURL = `Backgrounds/${itemBackground}.jpg`;\r\n        } else if (ChatRoomCustomized && ChatRoomCustomBackground) {\r\n          return false;\r\n        } else {\r\n          backgroundURL = `Backgrounds/${ChatRoomData.Background}.jpg`;\r\n        }\r\n\r\n        const ignoredImages =\r\n          /(^Backgrounds\\/(?!Sheet(White)?|grey|White\\.|BrickWall\\.)|\\b(Kneel|Arousal|Activity|Asylum|Cage|Cell|ChangeLayersMouth|Diaper|Kidnap|Logo|Player|Remote|Restriction|SpitOutPacifier|Struggle|Therapy|Orgasm\\d|Poses|HouseVincula|Seducer\\w+)\\b|^data:|^Assets\\/(?!Female3DCG\\/Emoticon\\/(Afk|Sleep|Read|Gaming|Hearing|Thumbs(Up|Down))\\/))/u;\r\n        if (ignoredImages.test(backgroundURL)) {\r\n          const charCount = ChatRoomCharacterViewCharacterCount;\r\n          const charsPerRow = ChatRoomCharacterViewCharactersPerRow;\r\n          const viewWidth = ChatRoomCharacterViewWidth;\r\n          const viewHeight = ChatRoomCharacterViewHeight;\r\n          const opts = {\r\n            inverted: Player.GraphicsSettings.InvertRoom && Player.IsInverted(),\r\n            blur: Player.GetBlurLevel(),\r\n            darken: DrawGetDarkFactor(),\r\n            tints: Player.GetTints(),\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n            sizeMode: ChatRoomCustomSizeMode,\r\n          };\r\n\r\n          // Loop over the room's characters to draw each of them\r\n          ChatRoomCharacterViewLoopCharacters((charIdx, charX, charY, _space, roomZoom) => {\r\n            // Draw the background every five characters, this fixes clipping errors\r\n            if (charIdx % charsPerRow === 0) {\r\n              const Y = charCount <= charsPerRow ? (viewHeight * (1 - roomZoom)) / 2 : 0;\r\n              const bgRect = RectMakeRect(0, Y + charIdx * 100, viewWidth, viewHeight * roomZoom);\r\n              DrawRoomBackground(\"Backgrounds/BrickWall.jpg\", bgRect, opts);\r\n            }\r\n\r\n            // Draw the character, it's status bubble and it's overlay\r\n            DrawCharacter(ChatRoomCharacterDrawlist[charIdx], charX, charY, roomZoom);\r\n            DrawStatus(ChatRoomCharacterDrawlist[charIdx], charX, charY, roomZoom);\r\n            // eslint-disable-next-line no-eq-null\r\n            if (ChatRoomCharacterDrawlist[charIdx].MemberNumber != null) {\r\n              ChatRoomCharacterViewDrawOverlay(ChatRoomCharacterDrawlist[charIdx], charX, charY, roomZoom);\r\n            }\r\n          });\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"NotificationTitleUpdate\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      if (fbcSettings.discreetMode) {\r\n        const notificationCount = NotificationGetTotalCount(1);\r\n        document.title = `${notificationCount > 0 ? `(${notificationCount}) ` : \"\"}${displayText(\"OnlineChat\")}`;\r\n        return;\r\n      }\r\n      // eslint-disable-next-line consistent-return\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { createTimer } from \"../util/hooks\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default function autoStruggle() {\r\n  SDK.hookFunction(\r\n    \"StruggleFlexibilityCheck\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (fbcSettings.autoStruggle) {\r\n        if (StruggleProgressFlexCircles && StruggleProgressFlexCircles.length > 0) {\r\n          StruggleProgressFlexCircles.splice(0, 1);\r\n          return true;\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  createTimer(() => {\r\n    if (!fbcSettings.autoStruggle) {\r\n      return;\r\n    }\r\n\r\n    if (typeof StruggleProgress !== \"number\" || StruggleProgress < 0) {\r\n      return;\r\n    }\r\n\r\n    if (StruggleProgressCurrentMinigame === \"Strength\") {\r\n      StruggleStrengthProcess(false);\r\n    } else if (StruggleProgressCurrentMinigame === \"Flexibility\") {\r\n      if (StruggleProgressFlexCircles && StruggleProgressFlexCircles.length > 0) {\r\n        StruggleFlexibilityProcess(false);\r\n      }\r\n    }\r\n  }, 60);\r\n\r\n  createTimer(() => {\r\n    if (!fbcSettings.autoStruggle) {\r\n      return;\r\n    }\r\n\r\n    if (typeof StruggleProgress !== \"number\" || StruggleProgress < 0) {\r\n      return;\r\n    }\r\n    if (StruggleProgressCurrentMinigame === \"Dexterity\") {\r\n      // Duplicated logic from StruggleDexterity\r\n      const distMult = Math.max(\r\n        -0.5,\r\n        Math.min(1, (85 - Math.abs(StruggleProgressDexTarget - StruggleProgressDexCurrent)) / 75)\r\n      );\r\n      if (distMult > 0.5) {\r\n        StruggleDexterityProcess();\r\n      }\r\n    }\r\n  }, 0);\r\n}\r\n","import { enableLeashing, disableLeashing } from \"../util/utils\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default function leashAlways(): void {\r\n  if (fbcSettings.leashAlways) {\r\n    enableLeashing();\r\n  } else {\r\n    disableLeashing();\r\n  }\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { deepCopy, parseJSON, isCharacter, isNonNullObject, drawTextFitLeft, fbcChatNotify } from \"../util/utils\";\r\nimport { debug, logInfo, logWarn, logError } from \"../util/logger\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default async function pastProfiles() {\r\n  if (!fbcSettings.pastProfiles) {\r\n    return;\r\n  }\r\n\r\n  const { Dexie } = await import(\"dexie\");\r\n  const db = new Dexie(\"bce-past-profiles\");\r\n  db.version(3).stores({\r\n    profiles: \"memberNumber, name, lastNick, seen, characterBundle\",\r\n    notes: \"memberNumber, note, updatedAt\",\r\n  });\r\n\r\n  ElementCreateTextArea(\"bceNoteInput\");\r\n  /** @type {HTMLTextAreaElement} */\r\n  // @ts-ignore\r\n  const noteInput = document.getElementById(\"bceNoteInput\");\r\n  noteInput.maxLength = 10000;\r\n  noteInput.classList.add(\"bce-hidden\");\r\n\r\n  const profiles = db.table(\"profiles\");\r\n  const notes = db.table(\"notes\");\r\n\r\n  async function readQuota() {\r\n    try {\r\n      const { quota, usage } = await navigator.storage.estimate();\r\n      debug(`current quota usage ${usage?.toLocaleString() ?? \"?\"} out of maximum ${quota?.toLocaleString() ?? \"?\"}`);\r\n      return { quota: quota ?? -1, usage: usage ?? 0 };\r\n    } catch (e) {\r\n      logError(\"reading storage quota information\", e);\r\n      return { quota: -1, usage: -1 };\r\n    }\r\n  }\r\n\r\n  /** @type {(num: number) => Promise<void>} */\r\n  async function trimProfiles(num) {\r\n    /** @type {FBCSavedProfile[]} */\r\n    let list = await profiles.toArray();\r\n    // Oldest first\r\n    list.sort((a, b) => a.seen - b.seen);\r\n    list = list.slice(0, num);\r\n    debug(\"deleting\", list);\r\n    await profiles.bulkDelete(list.map(p => p.memberNumber));\r\n  }\r\n\r\n  async function quotaSafetyCheck() {\r\n    const { quota, usage } = await readQuota();\r\n    if (usage / quota > 0.9) {\r\n      logInfo(\r\n        `storage quota above 90% utilization (${usage}/${quota}), cleaning some of the least recently seen profiles before saving new one`\r\n      );\r\n      await trimProfiles(10);\r\n    }\r\n  }\r\n\r\n  /** @type {(characterBundle: ServerAccountDataSynced) => Promise<void>} */\r\n  async function saveProfile(characterBundle) {\r\n    await quotaSafetyCheck();\r\n\r\n    const name = characterBundle.Name;\r\n    const nick = characterBundle.Nickname;\r\n\r\n    // Delete unnecessary data\r\n    /** @type {(keyof ServerAccountDataSynced)[]} */\r\n    const unnecessaryFields = [\r\n      \"ActivePose\",\r\n      \"Inventory\",\r\n      \"BlockItems\",\r\n      \"LimitedItems\",\r\n      \"FavoriteItems\",\r\n      \"ArousalSettings\",\r\n      \"OnlineSharedSettings\",\r\n      \"WhiteList\",\r\n      \"BlackList\",\r\n      \"Crafting\",\r\n    ];\r\n    for (const field of unnecessaryFields) {\r\n      delete characterBundle[field];\r\n    }\r\n\r\n    debug(`saving profile of ${nick ?? name} (${name})`);\r\n    try {\r\n      await profiles.put({\r\n        memberNumber: characterBundle.MemberNumber,\r\n        name,\r\n        lastNick: nick,\r\n        seen: Date.now(),\r\n        characterBundle: JSON.stringify(characterBundle),\r\n      });\r\n    } catch (e) {\r\n      const { quota, usage } = await readQuota();\r\n      logError(`unable to save profile (${usage}/${quota}):`, e);\r\n    }\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomSync\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      const [data] = args;\r\n      if (data?.Character?.length) {\r\n        for (const char of data.Character) {\r\n          saveProfile(deepCopy(char));\r\n        }\r\n      }\r\n      next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomSyncSingle\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      const [data] = args;\r\n      if (data?.Character?.MemberNumber) {\r\n        saveProfile(deepCopy(data.Character));\r\n      }\r\n      next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"InformationSheetRun\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (!InformationSheetSelection) {\r\n        throw new Error(\"InformationSheetSelection is null in InformationSheetRun\");\r\n      }\r\n      if (InformationSheetSelection.BCESeen) {\r\n        const ctx = window.MainCanvas.getContext(\"2d\");\r\n        if (!ctx) {\r\n          throw new Error(\"could not get canvas 2d context\");\r\n        }\r\n        ctx.textAlign = \"left\";\r\n        DrawText(\r\n          displayText(\"Last seen: \") + new Date(InformationSheetSelection.BCESeen).toLocaleString(),\r\n          1200,\r\n          75,\r\n          \"grey\",\r\n          \"black\"\r\n        );\r\n        ctx.textAlign = \"center\";\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  /** @type {(memberNumber: number) => Promise<void>} */\r\n  async function openCharacter(memberNumber) {\r\n    try {\r\n      /** @type {FBCSavedProfile} */\r\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n      const profile = await profiles.get(memberNumber);\r\n      const C = CharacterLoadOnline(\r\n        /** @type {ServerAccountDataSynced} */ (parseJSON(profile.characterBundle)),\r\n        memberNumber\r\n      );\r\n      C.BCESeen = profile.seen;\r\n      if (CurrentScreen === \"ChatRoom\") {\r\n        ChatRoomHideElements();\r\n        if (ChatRoomData) {\r\n          ChatRoomBackground = ChatRoomData.Background;\r\n        }\r\n      }\r\n      InformationSheetLoadCharacter(C);\r\n    } catch (e) {\r\n      fbcChatNotify(displayText(\"No profile found\"));\r\n      logError(\"reading profile\", e);\r\n    }\r\n  }\r\n\r\n  CommandCombine({\r\n    Tag: \"profiles\",\r\n    Description: displayText(\"<filter> - List seen profiles, optionally searching by member number or name\"),\r\n    Action: (argums) => {\r\n      (async(args) => {\r\n        /** @type {FBCSavedProfile[]} */\r\n        let list = await profiles.toArray();\r\n        list = list.filter(p =>\r\n          !args ||\r\n          p.name.toLowerCase().includes(args) ||\r\n          p.memberNumber.toString().includes(args) ||\r\n          p.lastNick?.toLowerCase().includes(args)\r\n        );\r\n        list.sort((a, b) => b.seen - a.seen);\r\n        const matches = list.length;\r\n        list = list.slice(0, 100);\r\n        list.sort((a, b) => -(b.lastNick ?? b.name).localeCompare(a.lastNick ?? a.name));\r\n        const lines = list.map((p) => {\r\n          const div = document.createElement(\"div\");\r\n          div.textContent = displayText(\"$nickAndName ($memberNumber) - Seen: $seen\", {\r\n            $nickAndName: p.lastNick ? `${p.lastNick} / ${p.name}` : p.name,\r\n            $memberNumber: p.memberNumber.toString(),\r\n            $seen: new Date(p.seen).toLocaleDateString(),\r\n          });\r\n          const link = document.createElement(\"a\");\r\n          link.textContent = displayText(\"Open\");\r\n          link.href = \"#\";\r\n          link.classList.add(\"bce-profile-open\");\r\n          link.addEventListener(\"click\", (e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            openCharacter(p.memberNumber);\r\n          });\r\n          div.prepend(link);\r\n          return div;\r\n        });\r\n        const header = document.createElement(\"h3\");\r\n        header.textContent = displayText(\"Saved Profiles\");\r\n        header.style.marginTop = \"0\";\r\n        const footer = document.createElement(\"div\");\r\n        footer.textContent = displayText(\"showing $num most recent of $total total profiles matching search\", {\r\n          $num: list.length.toLocaleString(),\r\n          $total: matches.toLocaleString(),\r\n        });\r\n        fbcChatNotify([header, ...lines, footer]);\r\n      })(argums);\r\n    },\r\n  });\r\n\r\n  // Notes view\r\n  let inNotes = false;\r\n  let noteUpdatedAt = 0;\r\n\r\n  /**\r\n   * @param {unknown} n\r\n   * @returns {n is FBCNote}\r\n   */\r\n  function isNote(n) {\r\n    return isNonNullObject(n) && typeof n.note === \"string\";\r\n  }\r\n\r\n  function showNoteInput() {\r\n    if (!InformationSheetSelection?.MemberNumber) {\r\n      throw new Error(\"invalid InformationSheetSelection in notes\");\r\n    }\r\n\r\n    inNotes = true;\r\n    noteInput.classList.remove(\"bce-hidden\");\r\n    noteInput.value = \"Loading...\";\r\n    notes\r\n      .get(InformationSheetSelection.MemberNumber)\r\n      .then((note) => {\r\n        if (isNote(note)) {\r\n          noteInput.value = note?.note || \"\";\r\n          noteUpdatedAt = note?.updatedAt || 0;\r\n        } else {\r\n          throw new Error(\"invalid note\");\r\n        }\r\n      })\r\n      .catch((/** @type {unknown} */reason) => {\r\n        noteInput.value = \"\";\r\n        logError(\"getting note\", reason);\r\n      });\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"CharacterLoadOnline\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      const C = next(args);\r\n      if (isCharacter(C) && C.MemberNumber) {\r\n        notes.get(C.MemberNumber).then((note) => {\r\n          C.FBCNoteExists = Boolean(isNote(note) && note.note);\r\n        });\r\n      }\r\n      return C;\r\n    }\r\n  );\r\n\r\n  function hideNoteInput() {\r\n    noteInput.classList.add(\"bce-hidden\");\r\n    inNotes = false;\r\n  }\r\n\r\n  /** @type {(e: KeyboardEvent) => void} */\r\n  function keyHandler(e) {\r\n    if (e.key === \"Escape\" && inNotes) {\r\n      hideNoteInput();\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  document.addEventListener(\"keydown\", keyHandler, true);\r\n  document.addEventListener(\"keypress\", keyHandler, true);\r\n\r\n  SDK.hookFunction(\r\n    \"OnlineProfileRun\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (inNotes) {\r\n        DrawText(displayText(\"Personal notes (only you can read these):\"), 910, 105, \"Black\", \"Gray\");\r\n        if (noteUpdatedAt) {\r\n          drawTextFitLeft(\r\n            displayText(\"Last saved: $date\", { $date: new Date(noteUpdatedAt).toLocaleString() }),\r\n            60,\r\n            105,\r\n            400,\r\n            \"Black\",\r\n            \"Gray\"\r\n          );\r\n        }\r\n        ElementPositionFix(\"bceNoteInput\", 36, 100, 160, 1790, 750);\r\n        // Always draw the accept button; normal method shows it when is player\r\n        DrawButton(1720, 60, 90, 90, \"\", \"White\", \"Icons/Accept.png\", TextGet(\"LeaveSave\"));\r\n        DrawButton(1820, 60, 90, 90, \"\", \"White\", \"Icons/Cancel.png\", TextGet(\"LeaveNoSave\"));\r\n        return null;\r\n      }\r\n      DrawButton(1620, 60, 90, 90, \"\", \"White\", \"Icons/Notifications.png\", displayText(\"[WCE] Notes\"));\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"OnlineProfileClick\",\r\n    HOOK_PRIORITIES.OverrideBehaviour,\r\n    (args, next) => {\r\n      if (inNotes) {\r\n        if (MouseIn(1720, 60, 90, 90)) {\r\n          quotaSafetyCheck().then(() => {\r\n            if (!InformationSheetSelection?.MemberNumber) {\r\n              throw new Error(\"invalid InformationSheetSelection in notes\");\r\n            }\r\n            return notes.put({\r\n              memberNumber: InformationSheetSelection.MemberNumber,\r\n              note: noteInput.value,\r\n              updatedAt: Date.now(),\r\n            });\r\n          });\r\n          hideNoteInput();\r\n        } else if (MouseIn(1820, 60, 90, 90)) {\r\n          hideNoteInput();\r\n        }\r\n        return;\r\n      } else if (!inNotes && MouseIn(1620, 60, 90, 90)) {\r\n        showNoteInput();\r\n      }\r\n      next(args);\r\n    }\r\n  );\r\n\r\n  if (navigator.storage?.persisted && !(await navigator.storage.persisted())) {\r\n    if (!(await navigator.storage.persist())) {\r\n      logWarn(\"Profile storage may not be persistent.\");\r\n    }\r\n  }\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { isChatMessage } from \"../util/utils\";\r\nimport { HIDDEN } from \"../util/constants\";\r\n\r\nexport default function pendingMessages() {\r\n  /** @type {(dictionary: Record<string, unknown>[], key: string, value: unknown) => Record<string, unknown>[]} */\r\n  function addToDictionary(dictionary, key, value) {\r\n    if (!Array.isArray(dictionary)) {\r\n      dictionary = [];\r\n    }\r\n    dictionary.push({ Tag: key, Text: value });\r\n    return dictionary;\r\n  }\r\n\r\n  let nonce = 0;\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomMessage\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (fbcSettings.pendingMessages && args?.length && isChatMessage(args[0]) && Array.isArray(args[0].Dictionary)) {\r\n        const [message] = args;\r\n        // @ts-ignore - custom dictionary Tag\r\n        const tag = message.Dictionary?.find?.(d => d.Tag === \"fbc_nonce\");\r\n        if (tag) {\r\n          // @ts-ignore - custom dictionary Tag\r\n          const el = document.querySelector(`[data-nonce='${tag.Text}']`);\r\n          if (el) {\r\n            el.remove();\r\n          }\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ServerSend\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (\r\n        fbcSettings.pendingMessages &&\r\n        args?.length >= 2 &&\r\n        args[0] === \"ChatRoomChat\" &&\r\n        isChatMessage(args[1]) &&\r\n        args[1].Type !== HIDDEN &&\r\n        !args[1].Target\r\n      ) {\r\n        nonce++;\r\n        if (nonce >= Number.MAX_SAFE_INTEGER) {\r\n          nonce = 0;\r\n        }\r\n        // @ts-ignore - custom dictionary Tag\r\n        args[1].Dictionary = addToDictionary(\r\n          // @ts-ignore - custom dictionary Tag\r\n          args[1].Dictionary,\r\n          \"fbc_nonce\",\r\n          nonce\r\n        );\r\n        const div = document.createElement(\"div\");\r\n        div.classList.add(\"ChatMessage\", \"bce-pending\");\r\n        div.setAttribute(\"data-time\", ChatRoomCurrentTime());\r\n        div.setAttribute(\"data-sender\", Player.MemberNumber?.toString());\r\n        div.setAttribute(\"data-nonce\", nonce.toString());\r\n        switch (args[1].Type) {\r\n          case \"Chat\":\r\n            {\r\n              div.classList.add(\"ChatMessageChat\");\r\n              const name = document.createElement(\"span\");\r\n              name.classList.add(\"ChatMessageName\");\r\n              name.style.color = Player.LabelColor || \"\";\r\n              name.textContent = CharacterNickname(Player);\r\n              div.appendChild(name);\r\n              div.appendChild(document.createTextNode(`: ${args[1].Content}`));\r\n            }\r\n            break;\r\n          case \"Emote\":\r\n          case \"Action\":\r\n            div.classList.add(\"ChatMessageEmote\");\r\n            div.appendChild(\r\n              document.createTextNode(\r\n                `*${args[1].Type === \"Emote\" ? `${CharacterNickname(Player)}: ` : \"\"}${args[1].Content}*`\r\n              )\r\n            );\r\n            break;\r\n          default:\r\n            return next(args);\r\n        }\r\n        const loader = document.createElement(\"div\");\r\n        loader.classList.add(\"lds-ellipsis\");\r\n        for (let i = 0; i < 4; i++) {\r\n          const dot = document.createElement(\"div\");\r\n          loader.appendChild(dot);\r\n        }\r\n        div.appendChild(loader);\r\n        const scroll = ElementIsScrolledToEnd(\"TextAreaChatLog\");\r\n        const textarea = document.getElementById(\"TextAreaChatLog\");\r\n        if (textarea) {\r\n          textarea.appendChild(div);\r\n          if (scroll) {\r\n            ElementScrollToEnd(\"TextAreaChatLog\");\r\n          }\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default function hideHiddenItemsIcon(): void {\r\n  SDK.hookFunction(\r\n    \"DrawCharacter\",\r\n    HOOK_PRIORITIES.ModifyBehaviourLow,\r\n    (args, next) => {\r\n      const [C] = args;\r\n      if (!C || !fbcSettings.hideHiddenItemsIcon) {\r\n        return next(args);\r\n      }\r\n      const backup = C.HasHiddenItems;\r\n      C.HasHiddenItems = false;\r\n      const ret = next(args);\r\n      C.HasHiddenItems = backup;\r\n      return ret;\r\n    }\r\n  );\r\n}\r\n","import { processChatAugmentsForLine } from \"./chatAugments\";\r\nimport { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\nimport { displayText } from \"../util/localization\";\r\n\r\nexport default function richOnlineProfile() {\r\n  const descTextArea = \"DescriptionInput\";\r\n  const descRich = \"bceRichOnlineProfile\";\r\n  let originalShown = true;\r\n\r\n  function hideOriginalTextArea() {\r\n    const ta = document.getElementById(descTextArea);\r\n    if (!ta) {\r\n      return;\r\n    }\r\n    originalShown = false;\r\n    ta.style.display = \"none\";\r\n  }\r\n\r\n  function showOriginalTextArea() {\r\n    const ta = document.getElementById(descTextArea);\r\n    if (!ta) {\r\n      return;\r\n    }\r\n    originalShown = true;\r\n    ta.style.display = \"\";\r\n  }\r\n\r\n  function enableRichTextArea() {\r\n    hideOriginalTextArea();\r\n\r\n    const div = document.createElement(\"div\");\r\n    div.id = descRich;\r\n    div.style.overflowY = \"scroll\";\r\n    div.style.overflowX = \"hidden\";\r\n    div.style.overflowWrap = \"break-word\";\r\n    div.style.whiteSpace = \"pre-wrap\";\r\n    div.style.background = \"rgb(244, 236, 216)\";\r\n    div.style.color = \"rgb(45, 35, 27)\";\r\n    div.style.border = \"2px solid black\";\r\n    div.style.padding = \"2px\";\r\n    div.classList.add(\"bce-rich-textarea\");\r\n    div.textContent = InformationSheetSelection?.Description || \"\";\r\n    processChatAugmentsForLine(div, () => false);\r\n\r\n    document.body.append(div);\r\n    resizeRichTextArea();\r\n  }\r\n\r\n  function resizeRichTextArea() {\r\n    ElementPositionFix(descRich, 36, 100, 160, 1790, 750);\r\n  }\r\n\r\n  function disableRichTextArea() {\r\n    const div = document.getElementById(descRich);\r\n    if (div) {\r\n      div.remove();\r\n    }\r\n\r\n    showOriginalTextArea();\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"OnlineProfileLoad\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      originalShown = true;\r\n      const ret = next(args);\r\n      const ta = document.getElementById(descTextArea);\r\n      if (!fbcSettings.richOnlineProfile || !ta) {\r\n        return ret;\r\n      }\r\n\r\n      enableRichTextArea();\r\n\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomHideElements\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      disableRichTextArea();\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  const toggleEditButtonPos = /** @type {const} */ ([90, 60, 90, 90]);\r\n  SDK.hookFunction(\r\n    \"OnlineProfileRun\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (!fbcSettings.richOnlineProfile) {\r\n        return next(args);\r\n      }\r\n      DrawButton(...toggleEditButtonPos, \"\", \"White\", \"Icons/Crafting.png\", displayText(\"Toggle Editing Mode\"));\r\n\r\n      const ret = next(args);\r\n      if (!originalShown) {\r\n        hideOriginalTextArea();\r\n        resizeRichTextArea();\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"OnlineProfileClick\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (!fbcSettings.richOnlineProfile) {\r\n        return next(args);\r\n      }\r\n      if (MouseIn(...toggleEditButtonPos)) {\r\n        if (originalShown) {\r\n          enableRichTextArea();\r\n        } else {\r\n          disableRichTextArea();\r\n        }\r\n        return true;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"OnlineProfileUnload\",\r\n    HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n    (args, next) => {\r\n      if (!originalShown) {\r\n        disableRichTextArea();\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { waitFor, isNonNullObject, parseJSON, objEntries, isString, drawTooltip } from \"../util/utils\";\r\nimport { displayText } from \"../util/localization\";\r\nimport { debug, logWarn, logError } from \"../util/logger\";\r\n\r\nexport default async function crafting(): Promise<void> {\r\n  await waitFor(() => Array.isArray(Commands) && Commands.length > 0);\r\n\r\n  const importPosition = [1485, 15, 90, 90] as const;\r\n  const exportPosition = [1585, 15, 90, 90] as const;\r\n\r\n  function importCraft(): void {\r\n    FUSAM.modals.open({\r\n      prompt: displayText(\"Paste the craft here\"),\r\n      input: { initial: \"\", readonly: false, type: \"textarea\" },\r\n      callback: (action, str) => {\r\n        if (action !== \"submit\" || !str) return;\r\n        try {\r\n          const craft: CraftingItem = parseJSON(LZString.decompressFromBase64(str));\r\n          if (!isNonNullObject(craft)) {\r\n            logError(craft);\r\n            throw new Error(`invalid craft type ${typeof craft} ${str}`);\r\n          }\r\n          for (const [key, value] of objEntries(craft)) {\r\n            if (\r\n              !isString(value) &&\r\n              !Number.isInteger(value) &&\r\n              value !== false &&\r\n              value !== true &&\r\n              value !== null &&\r\n              !isNonNullObject(value)\r\n            ) {\r\n              logWarn(\"potentially invalid craft bundle:\", key, \"was\", value);\r\n            }\r\n          }\r\n          CraftingSelectedItem = CraftingConvertItemToSelected(craft);\r\n          CraftingModeSet(\"Name\");\r\n        } catch (e) {\r\n          logError(\"importing craft\", e);\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  // ToDo: Fix this\r\n  if (GameVersion === \"R107\") {\r\n    SDK.hookFunction(\r\n      \"CraftingClick\",\r\n      HOOK_PRIORITIES.AddBehaviour,\r\n      (args, next) => {\r\n        if (CraftingMode === \"Name\") {\r\n          if (MouseIn(...exportPosition)) {\r\n            const exportString = LZString.compressToBase64(JSON.stringify(CraftingConvertSelectedToItem()));\r\n            FUSAM.modals.open({\r\n              prompt: displayText(\"Copy the craft here\"),\r\n              input: { initial: exportString, readonly: true, type: \"textarea\" },\r\n              callback: () => {\r\n                debug(\"exported craft\");\r\n              },\r\n            });\r\n            navigator.clipboard.writeText(exportString);\r\n          } else if (MouseIn(...importPosition)) {\r\n            importCraft();\r\n          }\r\n        }\r\n        return next(args);\r\n      }\r\n    );\r\n\r\n    SDK.hookFunction(\r\n      \"CraftingRun\",\r\n      HOOK_PRIORITIES.ModifyBehaviourMedium,\r\n      (args, next) => {\r\n        const ret = next(args);\r\n        if (CraftingMode === \"Name\") {\r\n          DrawButton(...importPosition, displayText(\"Import\"), \"white\");\r\n          DrawButton(...exportPosition, displayText(\"Export\"), \"white\");\r\n        }\r\n        return ret;\r\n      }\r\n    );\r\n  }\r\n\r\n  SDK.hookFunction(\r\n    \"DrawItemPreview\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      const [item, , x, y] = args;\r\n      if (item) {\r\n        const { Craft } = item;\r\n        if (MouseIn(x, y, DialogInventoryGrid.itemWidth, DialogInventoryGrid.itemHeight) && Craft) {\r\n          drawTooltip(x, y, DialogInventoryGrid.itemWidth, displayText(Craft.Property), \"center\");\r\n          drawTooltip(1000, y - 70, 975, `${displayText(\"Description:\")} ${CraftingDescription.Decode(Craft.Description) || \"<no description>\"}`, \"left\");\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default function numericArousalMeters(): void {\r\n  let isExpanded = false;\r\n  let increasing = false;\r\n  SDK.hookFunction(\r\n    \"DrawArousalMeter\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      const [C] = args;\r\n      isExpanded = !!C.ArousalZoom;\r\n      const progressTimer = C.ArousalSettings?.ProgressTimer ?? 0;\r\n      const activityGoing = progressTimer > 0;\r\n      const vibratorLevel = C.ArousalSettings?.VibratorLevel ?? 0;\r\n      const vibed = vibratorLevel > 0;\r\n      const progress = C.ArousalSettings?.Progress ?? 0;\r\n      const vibedOnEdge = (C.IsEdged() || C.HasEffect(\"DenialMode\")) && progress >= 95;\r\n      increasing = activityGoing || (vibed && !vibedOnEdge);\r\n      const ret = next(args);\r\n      isExpanded = false;\r\n      return ret;\r\n    }\r\n  );\r\n\r\n  SDK.hookFunction(\r\n    \"DrawArousalThermometer\",\r\n    HOOK_PRIORITIES.Observe,\r\n    (args, next) => {\r\n      const ret = next(args);\r\n      if (fbcSettings.numericArousalMeter && isExpanded) {\r\n        const [x, y, zoom, progress] = args;\r\n        let color: \"white\" | \"red\" | \"hotpink\" | \"pink\" = \"white\";\r\n        if (progress >= 95) {\r\n          if (increasing) {\r\n            color = \"red\";\r\n          } else {\r\n            color = \"hotpink\";\r\n          }\r\n        } else if (progress >= 70) {\r\n          color = \"pink\";\r\n        }\r\n        DrawTextFit(\r\n          progress.toLocaleString() + (increasing ? \"↑\" : \" \"),\r\n          x + 50 * zoom,\r\n          y - 30 * zoom,\r\n          100 * zoom,\r\n          color,\r\n          \"black\"\r\n        );\r\n      }\r\n      return ret;\r\n    }\r\n  );\r\n}\r\n","export default function nicknames(): void {\r\n  // Patch bc nickname regex (only allow arabic numbers and remove length limit of 20)\r\n  ServerCharacterNicknameRegex = /^[\\p{L}0-9\\p{Z}'-]+$/u;\r\n}\r\n","import { fbcSettings } from \"../util/settings\";\r\nimport { waitFor } from \"../util/utils\";\r\nimport { createTimer } from \"../util/hooks\";\r\nimport { sendHello } from \"./hiddenMessageHandler\";\r\n\r\nexport default function shareAddons(): void {\r\n  waitFor(() => ServerIsConnected && ServerPlayerIsInChatRoom());\r\n\r\n  sendHello(null, true);\r\n\r\n  createTimer(() => {\r\n    const loadedAddons = bcModSdk.getModsInfo();\r\n    if (\r\n      fbcSettings.shareAddons &&\r\n      JSON.stringify(loadedAddons) !== JSON.stringify(Player.FBCOtherAddons) &&\r\n      ServerIsConnected &&\r\n      ServerPlayerIsInChatRoom()\r\n    ) {\r\n      Player.FBCOtherAddons = loadedAddons;\r\n      sendHello(null, true);\r\n    }\r\n  }, 5000);\r\n}\r\n","import { toySyncState } from \"./toySync\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default function confirmLeave() {\r\n  // Confirm leaving the page to prevent accidental back button, refresh, or other navigation-related disruptions\r\n  window.addEventListener(\r\n    \"beforeunload\",\r\n    (e) => {\r\n      if (toySyncState.client?.connected) {\r\n        // Stop vibrating toys\r\n        for (const device of toySyncState.client.devices.filter(d => d.vibrateAttributes.length > 0)) {\r\n          device.vibrate(0);\r\n        }\r\n      }\r\n      if (fbcSettings.confirmLeave) {\r\n        e.preventDefault();\r\n        // @ts-ignore - TS thinks it's private, pffft we don't respect that\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\r\n        ServerSocket.io.disconnect();\r\n        CommonSetScreen(\"Character\", \"Relog\");\r\n        ServerSocket.io.connect();\r\n        // eslint-disable-next-line @typescript-eslint/no-deprecated\r\n        return (e.returnValue = \"Are you sure you want to leave the club?\");\r\n      }\r\n      return null;\r\n    },\r\n    { capture: true }\r\n  );\r\n}\r\n","import { SDK, HOOK_PRIORITIES, patchFunction } from \"../util/modding\";\r\nimport { fbcSettings } from \"../util/settings\";\r\n\r\nexport default function chatRoomWhisperFixes(): void {\r\n  const leaveResetTargetTimers: Record<number, number> = {};\r\n\r\n  SDK.hookFunction(\r\n    \"ChatRoomMessageDisplay\",\r\n    HOOK_PRIORITIES.AddBehaviour,\r\n    (args, next) => {\r\n      if (fbcSettings.whisperTargetFixes && args[0].Type === \"Action\" && args[0].Sender === ChatRoomTargetMemberNumber) {\r\n        if ([\"ServerLeave\", \"ServerBan\", \"ServerKick\", \"ServerDisconnect\"].some(m => args[0].Content.startsWith(m))) {\r\n          leaveResetTargetTimers[args[0].Sender] = window.setTimeout(() => {\r\n            ChatRoomSetTarget(-1);\r\n            ChatRoomSendLocal('<span style=\"color: red\">[WCE] Your whisper target was cleared, because they left the room for more than a minute!</span>');\r\n          }, 60 * 1000);\r\n        } else if (args[0].Content.startsWith(\"ServerEnter\")) {\r\n          if (leaveResetTargetTimers[args[0].Sender]) {\r\n            window.clearTimeout(leaveResetTargetTimers[args[0].Sender]);\r\n            delete leaveResetTargetTimers[args[0].Sender];\r\n          }\r\n        }\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  patchFunction(\r\n    \"ChatRoomSendChat\",\r\n    {\r\n      // eslint-disable-next-line no-template-curly-in-string\r\n      'ChatRoomSendLocal(`<span style=\"color: red\">${TextGet(\"WhisperTargetGone\")}</span>`);':\r\n        `ChatRoomSendLocal('<span style=\"color: red\">' + TextGet(\"WhisperTargetGone\") + \" Resetting to talk to everyone now!</span>\");\r\n        if(fbcSettingValue(\"whisperTargetFixes\")) ChatRoomSetTarget(-1);\r\n        `,\r\n    },\r\n    \"Resetting blush, eyes, and eyebrows after struggling\"\r\n  );\r\n}\r\n","import { waitFor } from \"../util/utils\";\r\n\r\nexport default async function allowCustomEffect() {\r\n  await waitFor(() => AssetFemale3DCG?.some(a => a.Group === \"Pronouns\"));\r\n  // @ts-ignore\r\n  AssetFemale3DCG.find(a => a.Group === \"Pronouns\").Asset.forEach(p => (p.AllowEffect = [E.Leash, E.BlurLight]));\r\n  await waitFor(() => Player?.Appearance?.some(a => a.Asset.Group.Name === \"Pronouns\"));\r\n  // @ts-ignore\r\n  Player.Appearance.find(a => a.Asset.Group.Name === \"Pronouns\").Asset.AllowEffect = [E.Leash, E.BlurLight];\r\n}\r\n","import { SDK, HOOK_PRIORITIES } from \"./util/modding\";\r\nimport { debug, logError } from \"./util/logger\";\r\nimport { fbcSettings, postSettings, bceLoadSettings } from \"./util/settings\";\r\nimport functionIntegrityCheck from \"./functions/functionIntegrityCheck\";\r\nimport wceStyles from \"./functions/wceStyles\";\r\nimport commonPatches from \"./functions/commonPatches\";\r\nimport beepImprovements from \"./functions/beepImprovements\";\r\nimport commands from \"./functions/commands\";\r\nimport settingsPage from \"./functions/settingsPage\";\r\nimport lockpickHelp from \"./functions/lockpickHelp\";\r\nimport automaticReconnect from \"./functions/automaticReconnect\";\r\nimport chatAugments from \"./functions/chatAugments\";\r\nimport layeringMenu from \"./functions/layeringMenu\";\r\nimport cacheClearer from \"./functions/cacheClearer\";\r\nimport chatRoomOverlay from \"./functions/chatRoomOverlay\";\r\nimport hiddenMessageHandler from \"./functions/hiddenMessageHandler\";\r\nimport privateWardrobe from \"./functions/privateWardrobe\";\r\nimport antiGarbling from \"./functions/antiGarbling\";\r\nimport automaticExpressions from \"./functions/automaticExpressions\";\r\nimport alternateArousal from \"./functions/alternateArousal\";\r\nimport autoGhostBroadcast from \"./functions/autoGhostBroadcast\";\r\nimport blindWithoutGlasses from \"./functions/blindWithoutGlasses\";\r\nimport friendPresenceNotifications from \"./functions/friendPresenceNotifications\";\r\nimport itemAntiCheat from \"./functions/itemAntiCheat\";\r\nimport forcedClubSlave from \"./functions/forcedClubSlave\";\r\nimport leashFix from \"./functions/leashFix\";\r\nimport instantMessenger from \"./functions/instantMessenger\";\r\nimport extendedWardrobe from \"./functions/extendedWardrobe\";\r\nimport customContentDomainCheck from \"./functions/customContentDomainCheck\";\r\nimport discreetMode from \"./functions/discreetMode\";\r\nimport autoStruggle from \"./functions/autoStruggle\";\r\nimport leashAlways from \"./functions/leashAlways\";\r\nimport pastProfiles from \"./functions/pastProfiles\";\r\nimport pendingMessages from \"./functions/pendingMessages\";\r\nimport hideHiddenItemsIcon from \"./functions/hideHiddenItemsIcon\";\r\nimport richOnlineProfile from \"./functions/richOnlineProfile\";\r\nimport crafting from \"./functions/crafting\";\r\nimport numericArousalMeters from \"./functions/numericArousalMeters\";\r\nimport appendSocketListenersToInit from \"./functions/appendSocketListenersToInit\";\r\nimport nicknames from \"./functions/nicknames\";\r\nimport hookBCXAPI from \"./functions/hookBCXAPI\";\r\nimport shareAddons from \"./functions/shareAddons\";\r\nimport confirmLeave from \"./functions/confirmLeave\";\r\nimport toySync from \"./functions/toySync\";\r\nimport chatRoomWhisperFixes from \"./functions/chatRoomWhisperFixes\";\r\nimport allowCustomEffect from \"./functions/allowCustomEffects\";\r\n\r\nexport const incompleteFunctions: string[] = [];\r\n\r\nasync function registerFunction(func: () => (Promise<void> | void), label: string): Promise<void> {\r\n  incompleteFunctions.push(label);\r\n  try {\r\n    const ret = func();\r\n    if (ret instanceof Promise) {\r\n      await ret;\r\n    }\r\n    incompleteFunctions.splice(incompleteFunctions.indexOf(label), 1);\r\n  } catch (err) {\r\n    const e = err as Error;\r\n    logError(`Error in ${label}: ${e?.toString()}\\n${e?.stack ?? \"\"}`);\r\n  }\r\n}\r\n\r\nexport async function registerAllFunctions(): Promise<void> {\r\n  // Delay game processes until registration is complete\r\n  let funcsRegistered: \"init\" | \"enable\" | \"disable\" = \"init\";\r\n\r\n  SDK.hookFunction(\r\n    \"LoginResponse\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      if (funcsRegistered === \"init\") {\r\n        funcsRegistered = \"disable\";\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n  SDK.hookFunction(\r\n    \"LoginStatusReset\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      if (funcsRegistered === \"disable\") {\r\n        funcsRegistered = \"init\";\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n  SDK.hookFunction(\r\n    \"GameRun\",\r\n    HOOK_PRIORITIES.Top,\r\n    (args, next) => {\r\n      if (funcsRegistered === \"disable\") {\r\n        GameAnimationFrameId = requestAnimationFrame(GameRun);\r\n        return null;\r\n      }\r\n      return next(args);\r\n    }\r\n  );\r\n  SDK.hookFunction(\r\n    \"GameRunBackground\",\r\n    HOOK_PRIORITIES.Top,\r\n    /**\r\n     * @param {Parameters<typeof GameRunBackground>} args\r\n     */ (args, next) => {\r\n      if (funcsRegistered === \"disable\") return null;\r\n      return next(args);\r\n    }\r\n  );\r\n\r\n  await registerFunction(functionIntegrityCheck, \"functionIntegrityCheck\");\r\n  registerFunction(wceStyles, \"wceStyles\");\r\n  registerFunction(commonPatches, \"commonPatches\");\r\n  registerFunction(extendedWardrobe, \"extendedWardrobe\");\r\n  registerFunction(allowCustomEffect, \"allowCustomEffect\");\r\n  registerFunction(automaticReconnect, \"automaticReconnect\");\r\n  registerFunction(hiddenMessageHandler, \"hiddenMessageHandler\");\r\n  await registerFunction(bceLoadSettings, \"bceLoadSettings\");\r\n  registerFunction(postSettings, \"postSettings\");\r\n  registerFunction(appendSocketListenersToInit, \"appendSocketListenersToInit\");\r\n  debug(fbcSettings);\r\n  registerFunction(discreetMode, \"discreetMode\");\r\n  registerFunction(beepImprovements, \"beepImprovements\");\r\n  registerFunction(settingsPage, \"settingsPage\");\r\n  registerFunction(alternateArousal, \"alternateArousal\");\r\n  registerFunction(chatAugments, \"chatAugments\");\r\n  registerFunction(automaticExpressions, \"automaticExpressions\");\r\n  registerFunction(layeringMenu, \"layeringMenu\");\r\n  registerFunction(cacheClearer, \"cacheClearer\");\r\n  registerFunction(lockpickHelp, \"lockpickHelp\");\r\n  registerFunction(commands, \"commands\");\r\n  registerFunction(chatRoomOverlay, \"chatRoomOverlay\");\r\n  registerFunction(privateWardrobe, \"privateWardrobe\");\r\n  registerFunction(antiGarbling, \"antiGarbling\");\r\n  registerFunction(autoGhostBroadcast, \"autoGhostBroadcast\");\r\n  registerFunction(blindWithoutGlasses, \"blindWithoutGlasses\");\r\n  registerFunction(friendPresenceNotifications, \"friendPresenceNotifications\");\r\n  registerFunction(forcedClubSlave, \"forcedClubSlave\");\r\n  registerFunction(instantMessenger, \"instantMessenger\");\r\n  registerFunction(autoStruggle, \"autoStruggle\");\r\n  registerFunction(nicknames, \"nicknames\");\r\n  registerFunction(leashAlways, \"leashAlways\");\r\n  registerFunction(toySync, \"toySync\");\r\n  registerFunction(pastProfiles, \"pastProfiles\");\r\n  registerFunction(pendingMessages, \"pendingMessages\");\r\n  registerFunction(hideHiddenItemsIcon, \"hideHiddenItemsIcon\");\r\n  registerFunction(crafting, \"crafting\");\r\n  registerFunction(itemAntiCheat, \"itemAntiCheat\");\r\n  registerFunction(leashFix, \"leashFix\");\r\n  registerFunction(hookBCXAPI, \"hookBCXAPI\");\r\n  registerFunction(customContentDomainCheck, \"customContentDomainCheck\");\r\n  registerFunction(numericArousalMeters, \"numericArousalMeters\");\r\n  registerFunction(richOnlineProfile, \"richOnlineProfile\");\r\n  registerFunction(shareAddons, \"shareAddons\");\r\n  registerFunction(confirmLeave, \"confirmLeave\");\r\n  registerFunction(chatRoomWhisperFixes, \"chatRoomWhisperFixes\");\r\n  funcsRegistered = \"enable\";\r\n}\r\n","import { waitFor, fbcChatNotify, fbcNotify, fbcSendAction } from \"./util/utils\";\r\nimport { fbcSettingValue } from \"./util/settings\";\r\nimport { displayText } from \"./util/localization\";\r\nimport { registerAllFunctions } from \"./registerFunctions\";\r\nimport { FBC_VERSION } from \"./util/constants\";\r\nimport { fbcDebug } from \"./functions/commands\";\r\nimport { pushLog } from \"./util/logger\";\r\n\r\nawait waitFor(() => typeof FUSAM === \"object\" && FUSAM?.present && typeof bcModSdk === \"object\" && !!bcModSdk);\r\n\r\nif (globalThis.FBC_VERSION) {\r\n  throw new Error(\"FBC already loaded. Skipping load.\");\r\n}\r\n\r\nif (typeof ChatRoomCharacter === \"undefined\") {\r\n  throw new Error(\"Bondage Club not detected. Skipping WCE initialization.\");\r\n}\r\n\r\nGameVersion = new URLSearchParams(location.hash.slice(1)).get(\"version\") ?? GameVersion;\r\nglobalThis.FBC_VERSION = FBC_VERSION;\r\nglobalThis.fbcDisplayText = displayText;\r\nglobalThis.fbcChatNotify = fbcChatNotify;\r\nglobalThis.fbcSendAction = fbcSendAction;\r\nglobalThis.fbcSettingValue = fbcSettingValue;\r\n// Expressions init method for custom expressions (here to not break customizer script)\r\n// eslint-disable-next-line camelcase\r\nglobalThis.bce_initializeDefaultExpression = () => null;\r\nglobalThis.fbcDebug = fbcDebug;\r\n\r\nFUSAM.registerDebugMethod(\"WCE\", () => fbcDebug(false));\r\n\r\nawait registerAllFunctions();\r\n\r\n// Post ready when in a chat room\r\nawait fbcNotify(`Wholesome Club Extensions v${globalThis.FBC_VERSION} loaded!`);\r\n\r\nPlayer.FBC = FBC_VERSION;\r\n\r\nwindow.addEventListener(\"error\", (e) => {\r\n  pushLog(\"error\", e.message, `${e.filename} (${e.lineno}:${e.colno})`, e.error);\r\n});\r\n"],"names":["pastLogs","pushLog","level","args","v","debug","logInfo","logWarn","logError","sleep","ms","resolve","waitFor","func","cancelFunc","isString","s","isNonNullObject","o","isChatMessage","m","isCharacter","c","isStringOrStringArray","isWardrobe","b","isItemBundleArray","isItemBundle","mustNum","id","def","deepCopy","objEntries","obj","parseJSON","jsonString","e","drawTextFitLeft","text","x","y","width","color","backColor","ctx","bk","drawTooltip","align","canvas","bak","fbcChatNotify","node","div","fbcNotify","duration","properties","fbcSendAction","addCustomEffect","effect","updated","pronouns","a","removeCustomEffect","enableLeashing","disableLeashing","FBC_VERSION","settingsVersion","SUPPORTED_GAME_VERSIONS","fbcChangelog","WEBSITE_URL","BCE_COLOR_ADJUSTMENTS_CLASS_NAME","BCE_LICENSE","BCE_MAX_AROUSAL","BCE_MSG","DARK_INPUT_CLASS","DEFAULT_WARDROBE_SIZE","EXPANDED_WARDROBE_SIZE","LOCAL_WARDROBE_SIZE","HIDDEN","MESSAGE_TYPES","WHISPER_CLASS","deviatingHashes","skippedFunctionality","HOOK_PRIORITIES","SDK","patchFunction","functionName","patches","affectedFunctionality","listeners","registerSocketListener","event","cb","l","appendSocketListenersToInit","next","ret","BCX","hookBCXAPI","displayText","original","replacements","key","val","bceStartClubSlave","room","bceGotoRoom","roomName","forcedClubSlave","patchDialog","clubSlaveDialog","idx","appendDialog","C","cc","patch","bceSendToClubSlavery","message","bceCanSendToClubSlavery","sendHello","target","requestReply","settingsLoaded","capabilities","fbcSettings","fbcMessage","hiddenMessageHandler","parseBCEMessage","data","t","processBCEMessage","sender","deferred","processHello","timers","createTimer","intval","ts","fbcBeepNotify","title","toySyncState","toySync","ButtplugClient","ButtplugBrowserWebsocketClientConnector","client","device","deviceSettings","connector","ex","removeTimer","d","dev","slot","intensity","batteryDevices","batteryStatus","i","battery","localWardrobeTable","extendedWardrobeLoaded","loadLocalWardrobe","wardrobe","Dexie","db","localWardrobe","w","sanitizeBundles","saveLocalWardrobe","appearance","bundleList","bundle","asset","loadExtendedWardrobe","wardrobeData","additionalItemBundle","additionalIdx","extendedWardrobe","additionalWardrobe","additionalLocalWardrobe","Push","sessionCustomOrigins","customContentDomainCheck","trustedOrigins","open","showCustomContentDomainCheckWarning","origin","type","act","ImageURL","MusicURL","imageOrigin","musicOrigin","url","CLOSINGBRACKETINDICATOR","EMBED_TYPE","bceParseUrl","word","startSounds","endSounds","eggedSounds","stutterWord","forceStutter","addStutter","wrd","maxIntensity","playerArousal","eggedBonus","chanceToStutter","chanceToMakeSound","stutter","r","results","startSound","sound","endSound","bceAllowedToEmbed","isTrustedOrigin","processChatAugmentsForLine","chatMessageElement","scrollToEnd","newChildren","originalText","contents","words","whitespaceIdx","domNode","linkNode","embedType","imgNode","promptTrust","parent","name","ogText","child","augmentedChatNotify","chatAugments","inputChat","prefix","textParts","msg","SenderCharacter","metadata","effects","ignoreOOC","hasStuttered","bceMessageReplacements","result","f","firstStutter","inOOC","newWords","oocIdx","bceChatAugments","chatLogContainerId","handledAttributeName","unhandledChat","scrolledToEnd","createChatOptions","antiGarbling","lastRange","process","originalMsg","shouldBabyTalk","gagIntensity","stutterIntensity","int","Dictionary","effectOptions","defaultSettings","BabyTalkOnClick","resetChatButtonStates","StutterOnClick","GarbleOnChange","buttons","isWhisper","select","tooltip","garbleIsFull","entries","buttonId","state","whisperState","button","whisperUpdate","buttonGrid","option","registeredChatInputListener","chatInput","chatButtonArrow","memberNumer","_","postSettingsHasRun","newValue","init","devices","bceSettingKey","bceLoadSettings","settings","onlineSettings","localVersion","setting","beepChangelog","bceSaveSettings","isDefaultSettingKey","postSettings","k","fbcSettingValue","expectedHashes","gameVersion","functionIntegrityCheck","isObject","hash","context","targetPath","actualHash","INPUT_WARN_CLASS","wceStyles","css","head","style","FBC_DEVS","WCE_DEVS","commonPatches","isFbcDev","isWceDev","msgType","beepImprovements","fbcDebug","copy","info","incompleteFunctions","print","findDrawnCharacters","limitVisible","baseList","targetMembers","commands","command","_command","targetCharacter","includeBase","includeBinds","includeLocks","bindSubmit","lockSubmit","baseSubmit","base","clothes","binds","looks","property","targetName","exportString","bundleString","item","itemBundle","targetMemberNumber","beepId","link","originalTarget","getCharacterModInfo","character","bcVersion","BCXi","FBCi","others","mod","versionOutput","member","Ulist","SelectButtonOffset","SelectButtonWidth","settingsPage","settingsPerPage","settingsYIncrement","settingsYStart","settingsPageCount","category","licensePosition","websitePosition","currentPageNumber","currentCategory","currentSetting","settingsCategories","settingCategoryLabels","vibratingSlots","scanButtonPosition","currentDefaultSettings","PreferenceSubscreenBCESettingsLoad","PreferenceSubscreenBCESettingsExit","PreferenceSubscreenBCESettingsRun","settingName","defaultSetting","defSetting","len","disabled","currentIdx","nextIdx","previousIdx","PreferenceSubscreenBCESettingsClick","segWidth","keyHandler","lockpickHelp","pinSpacing","pinWidth","hints","p","xx","automaticReconnect","keyTable","accTable","encKey","loadAccounts","accs","storeAccounts","res","auth","iv","decoder","accounts","loadPasswords","encoder","updatePasswordForReconnect","passwords","clearPassword","accountname","lastClick","loginCheck","loginData","user","now","pos","breakCircuit","breakCircuitFull","relog","force","layeringMenu","DialogCanUnlock2","Item","defaultItemHide","overrideItemHide","h","hideForm","serverAppearance","WCEOverrides","wceOverrideHide","Group","Hide","test","ignoredColorCopyableAssets","colorCopyableAssets","ass","as","assetWorn","focusItem","I","copyColors","copyColorTo","cacheClearer","Space","B","doClearCaches","clearCaches","start","chatRoomOverlay","CharX","CharY","Zoom","privateWardrobe","inCustomWardrobe","appearanceBackup","excludeBodyparts","currentWardrobeTargetIsPlayer","playerBackup","ArousalExpressionStages","EventExpressions","ActivityTriggers","automaticExpressions","animationEngineEnabled","resetExpressionQueue","GAME_TIMED_EVENT_TYPE","MANUAL_OVERRIDE_EVENT_TYPE","bceExpressionModifierMap","AUTOMATED_AROUSAL_EVENT_TYPE","DEFAULT_EVENT_TYPE","POST_ORGASM_EVENT_TYPE","bceExpressionsQueue","lastUniqueId","newUniqueId","manualComponents","pushEvent","evt","time","exp","dictHasPlayerTarget","dict","activityTriggers","trigger","matcher","expression","setExpression","n","poseCategories","hasConflicts","pose","faceComponents","expr","lastOrgasm","orgasmCount","wasDefault","PreviousArousal","ArousalMeterDirection","PreviousDirection","types","skippedTypes","component","_1","_2","animation","getPoseCategory","setPoses","poses","poseList","pp","poseNames","poseName","categories","list","AssetGroup","Expression","Timer","Color","CustomArousalExpression","poseFuncs","poseFunc","Pose","oCount","isDefault","queuedExpression","arousal","direction","lastOrgasmAdjustment","orgasms","lastOrgasmBoostDuration","secondsSinceOrgasm","OrgasmRecoveryStage","desiredExpression","desiredPose","nextExpression","trySetNextExpression","priority","j","nextUntil","nextAt","active","nextExpr","durationNow","current","last","qExpr","qPoses","nextId","nextPriority","desiredIsNewerAndInfinite","needsRefresh","poseUpdate","outer","chosenExpression","expressionChosen","face","limit","nextExp","resolvePoseConflicts","maxPriority","maxPriorityPoses","maxPriorityPose","maxId","deleted","conflicts","conflict","basePoseMatcher","newPose","alternateArousal","enjoymentMultiplier","Progress","Factor","progress","autoGhostBroadcast","blindWithoutGlasses","checkBlindness","glasses","BEEP_CLICK_ACTIONS","friendPresenceNotifications","checkFriends","lastFriends","friendMemberNumbers","offlineFriends","onlineFriends","ff","MemberNumber","MemberName","itemAntiCheat","noticesSent","validateNewLockMemberNumber","sourceCharacter","newItem","validateSingleItemChange","oldItem","ignoreLocks","ignoreColors","changes","sourceName","deleteUnneededMetaData","clone","validateMistressLocks","revertChanges","noticeSent","oldItemBundle","processItemBundleToMap","initial","prev","cur","oldItems","newItems","newAndChanges","removed","leashFix","instantMessenger","stripBeepMetadata","container","leftContainer","friendList","rightContainer","messageContainer","messageInput","friendSearch","onlineClass","offlineClass","storageKey","activeChat","unreadSinceOpened","IMloaded","friendMessages","scrollToBottom","friend","saveHistory","history","historyLength","changeActiveChat","friendId","previousFriend","divider","sortIM","addMessage","sent","beep","skipHistory","createdAt","details","line","messageType","messageColor","messageText","author","authorId","handleUnseenFriend","msgs","friendData","memberNumber","loadIM","friendIdStr","friendHistory","hist","search","friendName","f2","notA","notB","aUpdatedAt","bUpdatedAt","au","buttonPosition","hideIM","discreetMode","discreetModeFuncs","discreetModeFunc","isBackground","ignoredImages","backgroundURL","itemBackground","charCount","charsPerRow","viewWidth","viewHeight","opts","charIdx","charX","charY","_space","roomZoom","Y","bgRect","notificationCount","autoStruggle","leashAlways","pastProfiles","noteInput","profiles","notes","readQuota","quota","usage","trimProfiles","num","quotaSafetyCheck","saveProfile","characterBundle","nick","unnecessaryFields","field","char","openCharacter","profile","argums","matches","lines","header","footer","inNotes","noteUpdatedAt","isNote","showNoteInput","note","reason","hideNoteInput","pendingMessages","addToDictionary","dictionary","value","nonce","tag","el","loader","dot","scroll","textarea","hideHiddenItemsIcon","backup","richOnlineProfile","descTextArea","descRich","originalShown","hideOriginalTextArea","ta","showOriginalTextArea","enableRichTextArea","resizeRichTextArea","disableRichTextArea","toggleEditButtonPos","crafting","importPosition","exportPosition","importCraft","action","str","craft","Craft","numericArousalMeters","isExpanded","increasing","activityGoing","vibed","vibedOnEdge","zoom","nicknames","shareAddons","loadedAddons","confirmLeave","chatRoomWhisperFixes","leaveResetTargetTimers","allowCustomEffect","registerFunction","label","err","registerAllFunctions","funcsRegistered"],"mappings":"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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAahCU,EAAa;AAAA;AAAA;AAAA,KAGbV,EAAgC,KAAKI,EAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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"}