const e=typeof globalThis<`u`?globalThis:typeof self<`u`?self:typeof window<`u`?window:global,t=Object.keys,n=Array.isArray;typeof Promise<`u`&&!e.Promise&&(e.Promise=Promise);function r(e,n){return typeof n==`object`&&t(n).forEach(function(t){e[t]=n[t]}),e}const i=Object.getPrototypeOf,a={}.hasOwnProperty;function o(e,t){return a.call(e,t)}function s(e,n){typeof n==`function`&&(n=n(i(e))),(typeof Reflect>`u`?t:Reflect.ownKeys)(n).forEach(t=>{l(e,t,n[t])})}const c=Object.defineProperty;function l(e,t,n,i){c(e,t,r(n&&o(n,`get`)&&typeof n.get==`function`?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function u(e){return{from:function(t){return e.prototype=Object.create(t.prototype),l(e.prototype,`constructor`,e),{extend:s.bind(null,e.prototype)}}}}const d=Object.getOwnPropertyDescriptor;function f(e,t){let n=d(e,t),r;return n||(r=i(e))&&f(r,t)}const p=[].slice;function m(e,t,n){return p.call(e,t,n)}function h(e,t){return t(e)}function g(e){if(!e)throw Error(`Assertion Failed`)}function _(t){e.setImmediate?setImmediate(t):setTimeout(t,0)}function v(e,t){return e.reduce((e,n,r)=>{var i=t(n,r);return i&&(e[i[0]]=i[1]),e},{})}function y(e,t){if(typeof t==`string`&&o(e,t))return e[t];if(!t)return e;if(typeof t!=`string`){for(var n=[],r=0,i=t.length;r<i;++r){var a=y(e,t[r]);n.push(a)}return n}var s=t.indexOf(`.`);if(s!==-1){var c=e[t.substr(0,s)];return c==null?void 0:y(c,t.substr(s+1))}}function b(e,t,r){if(!(!e||t===void 0)&&!(`isFrozen`in Object&&Object.isFrozen(e)))if(typeof t!=`string`&&`length`in t){g(typeof r!=`string`&&`length`in r);for(var i=0,a=t.length;i<a;++i)b(e,t[i],r[i])}else{var s=t.indexOf(`.`);if(s!==-1){var c=t.substr(0,s),l=t.substr(s+1);if(l===``)r===void 0?n(e)&&!isNaN(parseInt(c))?e.splice(c,1):delete e[c]:e[c]=r;else{var u=e[c];(!u||!o(e,c))&&(u=e[c]={}),b(u,l,r)}}else r===void 0?n(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function ee(e,t){typeof t==`string`?b(e,t,void 0):`length`in t&&[].map.call(t,function(t){b(e,t,void 0)})}function te(e){var t={};for(var n in e)o(e,n)&&(t[n]=e[n]);return t}const ne=[].concat;function re(e){return ne.apply([],e)}const ie=`BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey`.split(`,`).concat(re([8,16,32,64].map(e=>[`Int`,`Uint`,`Float`].map(t=>t+e+`Array`)))).filter(t=>e[t]),ae=new Set(ie.map(t=>e[t]));function oe(e){let t={};for(let n in e)if(o(e,n)){let r=e[n];t[n]=!r||typeof r!=`object`||ae.has(r.constructor)?r:oe(r)}return t}function se(e){for(let t in e)if(o(e,t))return!1;return!0}let ce=null;function x(e){ce=new WeakMap;let t=le(e);return ce=null,t}function le(e){if(!e||typeof e!=`object`)return e;let t=ce.get(e);if(t)return t;if(n(e)){t=[],ce.set(e,t);for(var r=0,a=e.length;r<a;++r)t.push(le(e[r]))}else if(ae.has(e.constructor))t=e;else{let n=i(e);for(var s in t=n===Object.prototype?{}:Object.create(n),ce.set(e,t),e)o(e,s)&&(t[s]=le(e[s]))}return t}const{toString:ue}={};function de(e){return ue.call(e).slice(8,-1)}const fe=typeof Symbol<`u`?Symbol.iterator:`@@iterator`,pe=typeof fe==`symbol`?function(e){var t;return e!=null&&(t=e[fe])&&t.apply(e)}:function(){return null};function S(e,t){let n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}const me={};function C(e){var t,r,i,a;if(arguments.length===1){if(n(e))return e.slice();if(this===me&&typeof e==`string`)return[e];if(a=pe(e)){for(r=[];i=a.next(),!i.done;)r.push(i.value);return r}if(e==null)return[e];if(t=e.length,typeof t==`number`){for(r=Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=Array(t);t--;)r[t]=arguments[t];return r}const he=typeof Symbol<`u`?e=>e[Symbol.toStringTag]===`AsyncFunction`:()=>!1;var ge=[`Modify`,`Bulk`,`OpenFailed`,`VersionChange`,`Schema`,`Upgrade`,`InvalidTable`,`MissingAPI`,`NoSuchDatabase`,`InvalidArgument`,`SubTransaction`,`Unsupported`,`Internal`,`DatabaseClosed`,`PrematureCommit`,`ForeignAwait`],_e=[`Unknown`,`Constraint`,`Data`,`TransactionInactive`,`ReadOnly`,`Version`,`NotFound`,`InvalidState`,`InvalidAccess`,`Abort`,`Timeout`,`QuotaExceeded`,`Syntax`,`DataClone`],ve=ge.concat(_e),ye={VersionChanged:`Database version changed by other database connection`,DatabaseClosed:`Database has been closed`,Abort:`Transaction aborted`,TransactionInactive:`Transaction has already completed or failed`,MissingAPI:`IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb`};function be(e,t){this.name=e,this.message=t}u(be).from(Error).extend({toString:function(){return this.name+`: `+this.message}});function xe(e,t){return e+`. Errors: `+Object.keys(t).map(e=>t[e].toString()).filter((e,t,n)=>n.indexOf(e)===t).join(`
`)}function Se(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=xe(e,t)}u(Se).from(be);function Ce(e,t){this.name=`BulkError`,this.failures=Object.keys(t).map(e=>t[e]),this.failuresByPos=t,this.message=xe(e,this.failures)}u(Ce).from(be);var we=ve.reduce((e,t)=>(e[t]=t+`Error`,e),{});const Te=be;var w=ve.reduce((e,t)=>{var n=t+`Error`;function r(e,r){this.name=n,e?typeof e==`string`?(this.message=`${e}${r?`
 `+r:``}`,this.inner=r||null):typeof e==`object`&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=ye[t]||n,this.inner=null)}return u(r).from(Te),e[t]=r,e},{});w.Syntax=SyntaxError,w.Type=TypeError,w.Range=RangeError;var Ee=_e.reduce((e,t)=>(e[t+`Error`]=w[t],e),{});function De(e,t){if(!e||e instanceof be||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ee[e.name])return e;var n=new Ee[e.name](t||e.message,e);return`stack`in e&&l(n,`stack`,{get:function(){return this.inner.stack}}),n}var Oe=ve.reduce((e,t)=>([`Syntax`,`Type`,`Range`].indexOf(t)===-1&&(e[t+`Error`]=w[t]),e),{});Oe.ModifyError=Se,Oe.DexieError=be,Oe.BulkError=Ce;function T(){}function ke(e){return e}function Ae(e,t){return e==null||e===ke?t:function(n){return t(e(n))}}function E(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function je(e,t){return e===T?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?E(r,this.onsuccess):r),i&&(this.onerror=this.onerror?E(i,this.onerror):i),a===void 0?n:a}}function Me(e,t){return e===T?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?E(n,this.onsuccess):n),r&&(this.onerror=this.onerror?E(r,this.onerror):r)}}function Ne(e,t){return e===T?t:function(n){var i=e.apply(this,arguments);r(n,i);var a=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?E(a,this.onsuccess):a),o&&(this.onerror=this.onerror?E(o,this.onerror):o),i===void 0?s===void 0?void 0:s:r(i,s)}}function Pe(e,t){return e===T?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function Fe(e,t){return e===T?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then==`function`){for(var r=this,i=arguments.length,a=Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}var D=typeof location<`u`&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ie(e,t){D=e}var Le={};const Re=100,[ze,Be,Ve]=typeof Promise>`u`?[]:(()=>{let e=Promise.resolve();if(typeof crypto>`u`||!crypto.subtle)return[e,i(e),e];let t=crypto.subtle.digest(`SHA-512`,new Uint8Array([0]));return[t,i(t),e]})(),He=Be&&Be.then,O=ze&&ze.constructor,Ue=!!Ve;function We(){queueMicrotask(at)}var Ge=function(e,t){Xe.push([e,t]),qe&&(We(),qe=!1)},Ke=!0,qe=!0,k=[],Je=[],Ye=ke,A={id:`global`,global:!0,ref:0,unhandleds:[],onunhandled:T,pgp:!1,env:{},finalize:T},j=A,Xe=[],M=0,Ze=[];function N(e){if(typeof this!=`object`)throw TypeError(`Promises must be constructed via new`);this._listeners=[],this._lib=!1;var t=this._PSD=j;if(typeof e!=`function`){if(e!==Le)throw TypeError(`Not a function`);this._state=arguments[1],this._value=arguments[2],this._state===!1&&tt(this,this._value);return}this._state=null,this._value=null,++t.ref,et(this,e)}const Qe={get:function(){var e=j,t=gt;function n(n,r){var i=!e.global&&(e!==j||t!==gt);let a=i&&!L();var o=new N((t,o)=>{rt(this,new $e(Ct(n,e,i,a),Ct(r,e,i,a),t,o,e))});return this._consoleTask&&(o._consoleTask=this._consoleTask),o}return n.prototype=Le,n},set:function(e){l(this,`then`,e&&e.prototype===Le?Qe:{get:function(){return e},set:Qe.set})}};s(N.prototype,{then:Qe,_then:function(e,t){rt(this,new $e(null,null,e,t,j))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t==`function`?this.then(null,e=>e instanceof t?n(e):ft(e)):this.then(null,e=>e&&e.name===t?n(e):ft(e))},finally:function(e){return this.then(t=>N.resolve(e()).then(()=>t),t=>N.resolve(e()).then(()=>ft(t)))},timeout:function(e,t){return e<1/0?new N((n,r)=>{var i=setTimeout(()=>r(new w.Timeout(t)),e);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<`u`&&Symbol.toStringTag&&l(N.prototype,Symbol.toStringTag,`Dexie.Promise`),A.env=St();function $e(e,t,n,r,i){this.onFulfilled=typeof e==`function`?e:null,this.onRejected=typeof t==`function`?t:null,this.resolve=n,this.reject=r,this.psd=i}s(N,{all:function(){var e=C.apply(null,arguments).map(yt);return new N(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach((i,a)=>N.resolve(i).then(n=>{e[a]=n,--r||t(e)},n))})},resolve:e=>{if(e instanceof N)return e;if(e&&typeof e.then==`function`)return new N((t,n)=>{e.then(t,n)});var t=new N(Le,!0,e);return t},reject:ft,race:function(){var e=C.apply(null,arguments).map(yt);return new N((t,n)=>{e.map(e=>N.resolve(e).then(t,n))})},PSD:{get:()=>j,set:e=>j=e},totalEchoes:{get:()=>gt},newPSD:I,usePSD:z,scheduler:{get:()=>Ge,set:e=>{Ge=e}},rejectionMapper:{get:()=>Ye,set:e=>{Ye=e}},follow:(e,t)=>new N((n,r)=>I((t,n)=>{var r=j;r.unhandleds=[],r.onunhandled=n,r.finalize=E(function(){lt(()=>{this.unhandleds.length===0?t():n(this.unhandleds[0])})},r.finalize),e()},t,n,r))}),O&&(O.allSettled&&l(N,`allSettled`,function(){let e=C.apply(null,arguments).map(yt);return new N(t=>{e.length===0&&t([]);let n=e.length,r=Array(n);e.forEach((e,i)=>N.resolve(e).then(e=>r[i]={status:`fulfilled`,value:e},e=>r[i]={status:`rejected`,reason:e}).then(()=>--n||t(r)))})}),O.any&&typeof AggregateError<`u`&&l(N,`any`,function(){let e=C.apply(null,arguments).map(yt);return new N((t,n)=>{e.length===0&&n(AggregateError([]));let r=e.length,i=Array(r);e.forEach((e,a)=>N.resolve(e).then(e=>t(e),e=>{i[a]=e,--r||n(AggregateError(i))}))})}),O.withResolvers&&(N.withResolvers=O.withResolvers));function et(e,t){try{t(t=>{if(e._state===null){if(t===e)throw TypeError(`A promise cannot be resolved with itself.`);var n=e._lib&&ot();t&&typeof t.then==`function`?et(e,(e,n)=>{t instanceof N?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,nt(e)),n&&st()}},tt.bind(null,e))}catch(t){tt(e,t)}}function tt(e,t){if(Je.push(t),e._state===null){var n=e._lib&&ot();t=Ye(t),e._state=!1,e._value=t,ut(e),nt(e),n&&st()}}function nt(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)rt(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),M===0&&(++M,Ge(()=>{--M===0&&ct()},[]))}function rt(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++M,Ge(it,[n,e,t])}function it(e,t,n){try{var r,i=t._value;!t._state&&Je.length&&(Je=[]),r=D&&t._consoleTask?t._consoleTask.run(()=>e(i)):e(i),!t._state&&Je.indexOf(i)===-1&&dt(t),n.resolve(r)}catch(e){n.reject(e)}finally{--M===0&&ct(),--n.psd.ref||n.psd.finalize()}}function at(){z(A,()=>{ot()&&st()})}function ot(){var e=Ke;return Ke=!1,qe=!1,e}function st(){var e,t,n;do for(;Xe.length>0;)for(e=Xe,Xe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(Xe.length>0);Ke=!0,qe=!0}function ct(){var e=k;k=[],e.forEach(e=>{e._PSD.onunhandled.call(null,e._value,e)});for(var t=Ze.slice(0),n=t.length;n;)t[--n]()}function lt(e){function t(){e(),Ze.splice(Ze.indexOf(t),1)}Ze.push(t),++M,Ge(()=>{--M===0&&ct()},[])}function ut(e){k.some(t=>t._value===e._value)||k.push(e)}function dt(e){for(var t=k.length;t;)if(k[--t]._value===e._value){k.splice(t,1);return}}function ft(e){return new N(Le,!1,e)}function P(e,t){var n=j;return function(){var r=ot(),i=j;try{return R(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{R(i,!1),r&&st()}}}const F={awaits:0,echoes:0,id:0};var pt=0,mt=[],ht=0,gt=0,_t=0;function I(e,t,n,i){var a=j,o=Object.create(a);o.parent=a,o.ref=0,o.global=!1,o.id=++_t,A.env,o.env=Ue?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject}:{},t&&r(o,t),++a.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=z(o,e,n,i);return o.ref===0&&o.finalize(),s}function vt(){return F.id||=++pt,++F.awaits,F.echoes+=Re,F.id}function L(){return F.awaits?(--F.awaits===0&&(F.id=0),F.echoes=F.awaits*Re,!0):!1}(``+He).indexOf(`[native code]`)===-1&&(vt=L=T);function yt(e){return F.echoes&&e&&e.constructor===O?(vt(),e.then(e=>(L(),e),e=>(L(),B(e)))):e}function bt(e){++gt,(!F.echoes||--F.echoes===0)&&(F.echoes=F.awaits=F.id=0),mt.push(j),R(e,!0)}function xt(){var e=mt[mt.length-1];mt.pop(),R(e,!1)}function R(t,n){var r=j;if((n?F.echoes&&(!ht++||t!==j):ht&&(!--ht||t!==j))&&queueMicrotask(n?bt.bind(null,t):xt),t!==j&&(j=t,r===A&&(A.env=St()),Ue)){var i=A.env.Promise,a=t.env;(r.global||t.global)&&(Object.defineProperty(e,`Promise`,a.PromiseProp),i.all=a.all,i.race=a.race,i.resolve=a.resolve,i.reject=a.reject,a.allSettled&&(i.allSettled=a.allSettled),a.any&&(i.any=a.any))}}function St(){var t=e.Promise;return Ue?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(e,`Promise`),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function z(e,t,n,r,i){var a=j;try{return R(e,!0),t(n,r,i)}finally{R(a,!1)}}function Ct(e,t,n,r){return typeof e==`function`?function(){var i=j;n&&vt(),R(t,!0);try{return e.apply(this,arguments)}finally{R(i,!1),r&&queueMicrotask(L)}}:e}function wt(e){Promise===O&&F.echoes===0?ht===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}var B=N.reject;function Tt(e,t,n,r){if(!e.idbdb||!e._state.openComplete&&!j.letThrough&&!e._vip){if(e._state.openComplete)return B(new w.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return B(new w.DatabaseClosed);e.open().catch(T)}return e._state.dbReadyPromise.then(()=>Tt(e,t,n,r))}else{var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===we.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn(`Dexie: Need to reopen db`),e.close({disableAutoOpen:!1}),e.open().then(()=>Tt(e,t,n,r))):B(i)}return i._promise(t,(e,t)=>I(()=>(j.trans=i,r(e,t,i)))).then(e=>{if(t===`readwrite`)try{i.idbtrans.commit()}catch{}return t===`readonly`?e:i._completion.then(()=>e)})}}const Et=`4.0.11`,V=`ï¿¿`,Dt=-1/0,H=`Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.`,Ot=`String expected.`,kt=[],At=`__dbnames`,jt=`readonly`,Mt=`readwrite`;function U(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Nt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Pt(e){return typeof e==`string`&&!/\./.test(e)?t=>(t[e]===void 0&&e in t&&(t=x(t),delete t[e]),t):e=>e}function Ft(){throw w.Type()}function W(e,t){try{let n=Rt(e),r=Rt(t);if(n!==r)return n===`Array`?1:r===`Array`?-1:n===`binary`?1:r===`binary`?-1:n===`string`?1:r===`string`?-1:n===`Date`?1:r===`Date`?-1:NaN;switch(n){case`number`:case`Date`:case`string`:return e>t?1:e<t?-1:0;case`binary`:return Lt(zt(e),zt(t));case`Array`:return It(e,t)}}catch{}return NaN}function It(e,t){let n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n){let r=W(e[n],t[n]);if(r!==0)return r}return n===r?0:n<r?-1:1}function Lt(e,t){let n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}function Rt(e){let t=typeof e;if(t!==`object`)return t;if(ArrayBuffer.isView(e))return`binary`;let n=de(e);return n===`ArrayBuffer`?`binary`:n}function zt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Bt=class{_trans(e,t,n){let r=this._tx||j.trans,i=this.name,a=D&&typeof console<`u`&&console.createTask&&console.createTask(`Dexie: ${e===`readonly`?`read`:`write`} ${this.name}`);function o(e,n,r){if(!r.schema[i])throw new w.NotFound(`Table `+i+` not part of transaction`);return t(r.idbtrans,r)}let s=ot();try{let t=r&&r.db._novip===this.db._novip?r===j.trans?r._promise(e,o,n):I(()=>r._promise(e,o,n),{trans:r,transless:j.transless||j}):Tt(this.db,e,[this.name],o);return a&&(t._consoleTask=a,t=t.catch(e=>(console.trace(e),B(e)))),t}finally{s&&st()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):e==null?B(new w.Type(`Invalid argument to Table.get()`)):this._trans(`readonly`,t=>this.core.get({trans:t,key:e}).then(e=>this.hook.reading.fire(e))).then(t)}where(e){if(typeof e==`string`)return new this.db.WhereClause(this,e);if(n(e))return new this.db.WhereClause(this,`[${e.join(`+`)}]`);let r=t(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);let i=this.schema.indexes.concat(this.schema.primKey).filter(e=>{if(e.compound&&r.every(t=>e.keyPath.indexOf(t)>=0)){for(let t=0;t<r.length;++t)if(r.indexOf(e.keyPath[t])===-1)return!1;return!0}return!1}).sort((e,t)=>e.keyPath.length-t.keyPath.length)[0];if(i&&this.db._maxKey!==V){let t=i.keyPath.slice(0,r.length);return this.where(t).equals(t.map(t=>e[t]))}!i&&D&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit from a compound index [${r.join(`+`)}]`);let{idxByName:a}=this.schema;function o(e,t){return W(e,t)===0}let[s,c]=r.reduce(([t,r],i)=>{let s=a[i],c=e[i];return[t||s,t||!s?U(r,s&&s.multi?e=>{let t=y(e,i);return n(t)&&t.some(e=>o(c,e))}:e=>o(c,y(e,i))):r]},[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(c):i?this.filter(c):this.where(r).equals(``)}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,n(e)?`[${e.join(`+`)}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){let{db:t,name:n}=this;this.schema.mappedClass=e,e.prototype instanceof Ft&&(e=class extends e{get db(){return t}table(){return n}});let r=new Set;for(let t=e.prototype;t;t=i(t))Object.getOwnPropertyNames(t).forEach(e=>r.add(e));let a=t=>{if(!t)return t;let n=Object.create(e.prototype);for(let e in t)if(!r.has(e))try{n[e]=t[e]}catch{}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook(`reading`,a),e}defineClass(){function e(e){r(this,e)}return this.mapToClass(e)}add(e,t){let{auto:n,keyPath:r}=this.schema.primKey,i=e;return r&&n&&(i=Pt(r)(e)),this._trans(`readwrite`,e=>this.core.mutate({trans:e,type:`add`,keys:t==null?null:[t],values:[i]})).then(e=>e.numFailures?N.reject(e.failures[0]):e.lastResult).then(t=>{if(r)try{b(e,r,t)}catch{}return t})}update(e,t){if(typeof e==`object`&&!n(e)){let n=y(e,this.schema.primKey.keyPath);return n===void 0?B(new w.InvalidArgument(`Given object does not contain its primary key`)):this.where(`:id`).equals(n).modify(t)}else return this.where(`:id`).equals(e).modify(t)}put(e,t){let{auto:n,keyPath:r}=this.schema.primKey,i=e;return r&&n&&(i=Pt(r)(e)),this._trans(`readwrite`,e=>this.core.mutate({trans:e,type:`put`,values:[i],keys:t==null?null:[t]})).then(e=>e.numFailures?N.reject(e.failures[0]):e.lastResult).then(t=>{if(r)try{b(e,r,t)}catch{}return t})}delete(e){return this._trans(`readwrite`,t=>this.core.mutate({trans:t,type:`delete`,keys:[e]})).then(e=>e.numFailures?N.reject(e.failures[0]):void 0)}clear(){return this._trans(`readwrite`,e=>this.core.mutate({trans:e,type:`deleteRange`,range:Nt})).then(e=>e.numFailures?N.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans(`readonly`,t=>this.core.getMany({keys:e,trans:t}).then(e=>e.map(e=>this.hook.reading.fire(e))))}bulkAdd(e,t,n){let r=Array.isArray(t)?t:void 0;n||=r?void 0:t;let i=n?n.allKeys:void 0;return this._trans(`readwrite`,t=>{let{auto:n,keyPath:a}=this.schema.primKey;if(a&&r)throw new w.InvalidArgument(`bulkAdd(): keys argument invalid on tables with inbound keys`);if(r&&r.length!==e.length)throw new w.InvalidArgument(`Arguments objects and keys must have the same length`);let o=e.length,s=a&&n?e.map(Pt(a)):e;return this.core.mutate({trans:t,type:`add`,keys:r,values:s,wantResults:i}).then(({numFailures:e,results:t,lastResult:n,failures:r})=>{let a=i?t:n;if(e===0)return a;throw new Ce(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,r)})})}bulkPut(e,t,n){let r=Array.isArray(t)?t:void 0;n||=r?void 0:t;let i=n?n.allKeys:void 0;return this._trans(`readwrite`,t=>{let{auto:n,keyPath:a}=this.schema.primKey;if(a&&r)throw new w.InvalidArgument(`bulkPut(): keys argument invalid on tables with inbound keys`);if(r&&r.length!==e.length)throw new w.InvalidArgument(`Arguments objects and keys must have the same length`);let o=e.length,s=a&&n?e.map(Pt(a)):e;return this.core.mutate({trans:t,type:`put`,keys:r,values:s,wantResults:i}).then(({numFailures:e,results:t,lastResult:n,failures:r})=>{let a=i?t:n;if(e===0)return a;throw new Ce(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,r)})})}bulkUpdate(e){let t=this.core,n=e.map(e=>e.key),r=e.map(e=>e.changes),i=[];return this._trans(`readwrite`,a=>t.getMany({trans:a,keys:n,cache:`clone`}).then(o=>{let s=[],c=[];e.forEach(({key:e,changes:t},n)=>{let r=o[n];if(r){for(let n of Object.keys(t)){let i=t[n];if(n===this.schema.primKey.keyPath){if(W(i,e)!==0)throw new w.Constraint(`Cannot update primary key in bulkUpdate()`)}else b(r,n,i)}i.push(n),s.push(e),c.push(r)}});let l=s.length;return t.mutate({trans:a,type:`put`,keys:s,values:c,updates:{keys:n,changeSpecs:r}}).then(({numFailures:e,failures:t})=>{if(e===0)return l;for(let e of Object.keys(t)){let n=i[Number(e)];if(n!=null){let r=t[e];delete t[e],t[n]=r}}throw new Ce(`${this.name}.bulkUpdate(): ${e} of ${l} operations failed`,t)})}))}bulkDelete(e){let t=e.length;return this._trans(`readwrite`,t=>this.core.mutate({trans:t,type:`delete`,keys:e})).then(({numFailures:e,lastResult:n,failures:r})=>{if(e===0)return n;throw new Ce(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)})}};function Vt(e){var r={},i=function(t,n){if(n){for(var i=arguments.length,a=Array(i-1);--i;)a[i-1]=arguments[i];return r[t].subscribe.apply(null,a),e}else if(typeof t==`string`)return r[t]};i.addEventType=s;for(var a=1,o=arguments.length;a<o;++a)s(arguments[a]);return i;function s(e,t,n){if(typeof e==`object`)return c(e);t||=Pe,n||=T;var a={subscribers:[],fire:n,subscribe:function(e){a.subscribers.indexOf(e)===-1&&(a.subscribers.push(e),a.fire=t(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter(function(t){return t!==e}),a.fire=a.subscribers.reduce(t,n)}};return r[e]=i[e]=a,a}function c(e){t(e).forEach(function(t){var r=e[t];if(n(r))s(t,e[t][0],e[t][1]);else if(r===`asap`)var i=s(t,ke,function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];i.subscribers.forEach(function(e){_(function(){e.apply(null,t)})})});else throw new w.InvalidArgument(`Invalid event config`)})}}function Ht(e,t){return u(t).from({prototype:e}),t}function Ut(e){return Ht(Bt.prototype,function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Vt(null,{creating:[je,T],reading:[Ae,ke],updating:[Ne,T],deleting:[Me,T]})})}function Wt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Gt(e,t){e.filter=U(e.filter,t)}function Kt(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>U(r(),t()):t,e.justLimit=n&&!r}function qt(e,t){e.isMatch=U(e.isMatch,t)}function Jt(e,t){if(e.isPrimKey)return t.primaryKey;let n=t.getIndexByKeyPath(e.index);if(!n)throw new w.Schema(`KeyPath `+e.index+` on object store `+t.name+` is not indexed`);return n}function Yt(e,t,n){let r=Jt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir===`prev`,unique:!!e.unique,query:{index:r,range:e.range}})}function Xt(e,t,n,r){let i=e.replayFilter?U(e.filter,e.replayFilter()):e.filter;if(e.or){let a={},s=(e,n,r)=>{if(!i||i(n,r,e=>n.stop(e),e=>n.fail(e))){var s=n.primaryKey,c=``+s;c===`[object ArrayBuffer]`&&(c=``+new Uint8Array(s)),o(a,c)||(a[c]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),Zt(Yt(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}else return Zt(Yt(e,r,n),U(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Zt(e,t,n,r){var i=r?(e,t,i)=>n(r(e),t,i):n,a=P(i);return e.then(e=>{if(e)return e.start(()=>{var n=()=>e.continue();(!t||t(e,e=>n=e,t=>{e.stop(t),n=T},t=>{e.fail(t),n=T}))&&a(e.value,e,e=>n=e),n()})})}var Qt=class{execute(e){let t=this[`@@propmod`];if(t.add!==void 0){let r=t.add;if(n(r))return[...n(e)?e:[],...r].sort();if(typeof r==`number`)return(Number(e)||0)+r;if(typeof r==`bigint`)try{return BigInt(e)+r}catch{return BigInt(0)+r}throw TypeError(`Invalid term ${r}`)}if(t.remove!==void 0){let r=t.remove;if(n(r))return n(e)?e.filter(e=>!r.includes(e)).sort():[];if(typeof r==`number`)return Number(e)-r;if(typeof r==`bigint`)try{return BigInt(e)-r}catch{return BigInt(0)-r}throw TypeError(`Invalid subtrahend ${r}`)}let r=t.replacePrefix?.[0];return r&&typeof e==`string`&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e}constructor(e){this[`@@propmod`]=e}},$t=class{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,B.bind(null,n.error)):n.table._trans(`readonly`,e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,B.bind(null,t.error)):t.table._trans(`readwrite`,e,`locked`)}_addAlgorithm(e){var t=this._ctx;t.algorithm=U(t.algorithm,e)}_iterate(e,t){return Xt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&r(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(n=>Xt(t,e,n,t.table.core))}count(e){return this._read(e=>{let t=this._ctx,n=t.table.core;if(Wt(t,!0))return n.count({trans:e,query:{index:Jt(t,n.schema),range:t.range}}).then(e=>Math.min(e,t.limit));var r=0;return Xt(t,()=>(++r,!1),e,n).then(()=>r)}).then(e)}sortBy(e,t){let n=e.split(`.`).reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o=this._ctx.dir===`next`?1:-1;function s(e,t){var n=a(e,i),r=a(t,i);return W(n,r)*o}return this.toArray(function(e){return e.sort(s)}).then(t)}toArray(e){return this._read(e=>{var t=this._ctx;if(t.dir===`next`&&Wt(t,!0)&&t.limit>0){let{valueMapper:n}=t,r=Jt(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then(({result:e})=>n?e.map(n):e)}else{let n=[];return Xt(t,e=>n.push(e),e,t.table.core).then(()=>n)}},e)}offset(e){var t=this._ctx;return e<=0?this:(t.offset+=e,Wt(t)?Kt(t,()=>{var t=e;return(e,n)=>t===0?!0:t===1?(--t,!1):(n(()=>{e.advance(t),t=0}),!1)}):Kt(t,()=>{var t=e;return()=>--t<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Kt(this._ctx,()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this}until(e,t){return Gt(this._ctx,function(n,r,i){return e(n.value)?(r(i),t):!0}),this}first(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return Gt(this._ctx,function(t){return e(t.value)}),qt(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir===`prev`?`next`:`prev`,this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})}eachUniqueKey(e){return this._ctx.unique=`unique`,this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir===`next`&&Wt(t,!0)&&t.limit>0)return this._read(e=>{var n=Jt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(({result:e})=>e).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique=`unique`,this.keys(e)}firstKey(e){return this.limit(1).keys(function(e){return e[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Gt(this._ctx,function(e){var t=e.primaryKey.toString(),r=o(n,t);return n[t]=!0,!r}),this}modify(e){var n=this._ctx;return this._write(r=>{var i;if(typeof e==`function`)i=e;else{var a=t(e),o=a.length;i=function(t){let n=!1;for(let r=0;r<o;++r){let i=a[r],o=e[i],s=y(t,i);o instanceof Qt?(b(t,i,o.execute(s)),n=!0):s!==o&&(b(t,i,o),n=!0)}return n}}let s=n.table.core,{outbound:c,extractKey:l}=s.schema.primaryKey,u=200,d=this.db._options.modifyChunkSize;d&&(u=typeof d==`object`?d[s.name]||d[`*`]||200:d);let f=[],p=0,m=[],h=(e,n)=>{let{failures:r,numFailures:i}=n;p+=e-i;for(let e of t(r))f.push(r[e])};return this.clone().primaryKeys().then(t=>{let a=Wt(n)&&n.limit===1/0&&(typeof e!=`function`||e===en)&&{index:n.index,range:n.range},o=n=>{let d=Math.min(u,t.length-n);return s.getMany({trans:r,keys:t.slice(n,n+d),cache:`immutable`}).then(f=>{let p=[],m=[],g=c?[]:null,_=[];for(let e=0;e<d;++e){let r=f[e],a={value:x(r),primKey:t[n+e]};i.call(a,a.value,a)!==!1&&(a.value==null?_.push(t[n+e]):!c&&W(l(r),l(a.value))!==0?(_.push(t[n+e]),p.push(a.value)):(m.push(a.value),c&&g.push(t[n+e])))}return Promise.resolve(p.length>0&&s.mutate({trans:r,type:`add`,values:p}).then(e=>{for(let t in e.failures)_.splice(parseInt(t),1);h(p.length,e)})).then(()=>(m.length>0||a&&typeof e==`object`)&&s.mutate({trans:r,type:`put`,keys:g,values:m,criteria:a,changeSpec:typeof e!=`function`&&e,isAdditionalChunk:n>0}).then(e=>h(m.length,e))).then(()=>(_.length>0||a&&e===en)&&s.mutate({trans:r,type:`delete`,keys:_,criteria:a,isAdditionalChunk:n>0}).then(e=>h(_.length,e))).then(()=>t.length>n+d&&o(n+u))})};return o(0).then(()=>{if(f.length>0)throw new Se(`Error modifying one or more objects`,f,p,m);return t.length})})})}delete(){var e=this._ctx,t=e.range;return Wt(e)&&(e.isPrimKey||t.type===3)?this._write(n=>{let{primaryKey:r}=e.table.core.schema,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(t=>e.table.core.mutate({trans:n,type:`deleteRange`,range:i}).then(({failures:e,lastResult:n,results:r,numFailures:i})=>{if(i)throw new Se(`Could not delete some values`,Object.keys(e).map(t=>e[t]),t-i);return t-i}))}):this.modify(en)}};const en=(e,t)=>t.value=null;function tn(e){return Ht($t.prototype,function(t,n){this.db=e;let r=Nt,i=null;if(n)try{r=n()}catch(e){i=e}let a=t._ctx,o=a.table,s=o.hook.reading.fire;this._ctx={table:o,index:a.index,isPrimKey:!a.index||o.schema.primKey.keyPath&&a.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:`next`,unique:``,algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:a.or,valueMapper:s===ke?null:s}})}function nn(e,t){return e<t?-1:e===t?0:1}function rn(e,t){return e>t?-1:e===t?0:1}function G(e,t,n){var r=e instanceof dn?new e.Collection(e):e;return r._ctx.error=n?new n(t):TypeError(t),r}function an(e){return new e.Collection(e,()=>un(``)).limit(0)}function on(e){return e===`next`?e=>e.toUpperCase():e=>e.toLowerCase()}function sn(e){return e===`next`?e=>e.toLowerCase():e=>e.toUpperCase()}function cn(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,c=0;c<o;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],l)<0&&(s=c)}return o<r.length&&a===`next`?e+n.substr(e.length):o<e.length&&a===`prev`?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function ln(e,t,n,r){var i,a,o,s,c,l,u,d=n.length;if(!n.every(e=>typeof e==`string`))return G(e,Ot);function f(e){i=on(e),a=sn(e),o=e===`next`?nn:rn;var t=n.map(function(e){return{lower:a(e),upper:i(e)}}).sort(function(e,t){return o(e.lower,t.lower)});s=t.map(function(e){return e.upper}),c=t.map(function(e){return e.lower}),l=e,u=e===`next`?``:r}f(`next`);var p=new e.Collection(e,()=>K(s[0],c[d-1]+r));p._ondirectionchange=function(e){f(e)};var m=0;return p._addAlgorithm(function(e,n,r){var i=e.key;if(typeof i!=`string`)return!1;var f=a(i);if(t(f,c,m))return!0;for(var p=null,h=m;h<d;++h){var g=cn(i,f,s[h],c[h],o,l);g===null&&p===null?m=h+1:(p===null||o(p,g)>0)&&(p=g)}return n(p===null?r:function(){e.continue(p+u)}),!1}),p}function K(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function un(e){return{type:1,lower:e,upper:e}}var dn=class{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=n!==!1,r=r===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(n||r)&&!(n&&r)?an(this):new this.Collection(this,()=>K(e,t,!n,!r))}catch{return G(this,H)}}equals(e){return e==null?G(this,H):new this.Collection(this,()=>un(e))}above(e){return e==null?G(this,H):new this.Collection(this,()=>K(e,void 0,!0))}aboveOrEqual(e){return e==null?G(this,H):new this.Collection(this,()=>K(e,void 0,!1))}below(e){return e==null?G(this,H):new this.Collection(this,()=>K(void 0,e,!1,!0))}belowOrEqual(e){return e==null?G(this,H):new this.Collection(this,()=>K(void 0,e))}startsWith(e){return typeof e==`string`?this.between(e,e+V,!0,!0):G(this,Ot)}startsWithIgnoreCase(e){return e===``?this.startsWith(e):ln(this,(e,t)=>e.indexOf(t[0])===0,[e],V)}equalsIgnoreCase(e){return ln(this,(e,t)=>e===t[0],[e],``)}anyOfIgnoreCase(){var e=C.apply(me,arguments);return e.length===0?an(this):ln(this,(e,t)=>t.indexOf(e)!==-1,e,``)}startsWithAnyOfIgnoreCase(){var e=C.apply(me,arguments);return e.length===0?an(this):ln(this,(e,t)=>t.some(t=>e.indexOf(t)===0),e,V)}anyOf(){let e=C.apply(me,arguments),t=this._cmp;try{e.sort(t)}catch{return G(this,H)}if(e.length===0)return an(this);let n=new this.Collection(this,()=>K(e[0],e[e.length-1]));n._ondirectionchange=n=>{t=n===`next`?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm((n,i,a)=>{let o=n.key;for(;t(o,e[r])>0;)if(++r,r===e.length)return i(a),!1;return t(o,e[r])===0?!0:(i(()=>{n.continue(e[r])}),!1)}),n}notEqual(e){return this.inAnyRange([[Dt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=C.apply(me,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return G(this,H)}let t=e.reduce((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[Dt,t]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){let n=this._cmp,r=this._ascending,i=this._descending,a=this._min,o=this._max;if(e.length===0)return an(this);if(!e.every(e=>e[0]!==void 0&&e[1]!==void 0&&r(e[0],e[1])<=0))return G(this,`First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower`,w.InvalidArgument);let s=!t||t.includeLowers!==!1,c=t&&t.includeUppers===!0;function l(e,t){let r=0,i=e.length;for(;r<i;++r){let i=e[r];if(n(t[0],i[1])<0&&n(t[1],i[0])>0){i[0]=a(i[0],t[0]),i[1]=o(i[1],t[1]);break}}return r===i&&e.push(t),e}let u=r;function d(e,t){return u(e[0],t[0])}let f;try{f=e.reduce(l,[]),f.sort(d)}catch{return G(this,H)}let p=0,m=c?e=>r(e,f[p][1])>0:e=>r(e,f[p][1])>=0,h=s?e=>i(e,f[p][0])>0:e=>i(e,f[p][0])>=0;function g(e){return!m(e)&&!h(e)}let _=m,v=new this.Collection(this,()=>K(f[0][0],f[f.length-1][1],!s,!c));return v._ondirectionchange=e=>{e===`next`?(_=m,u=r):(_=h,u=i),f.sort(d)},v._addAlgorithm((e,t,n)=>{for(var i=e.key;_(i);)if(++p,p===f.length)return t(n),!1;return g(i)?!0:(this._cmp(i,f[p][1])===0||this._cmp(i,f[p][0])===0||t(()=>{u===r?e.continue(f[p][0]):e.continue(f[p][1])}),!1)}),v}startsWithAnyOf(){let e=C.apply(me,arguments);return e.every(e=>typeof e==`string`)?e.length===0?an(this):this.inAnyRange(e.map(e=>[e,e+V])):G(this,`startsWithAnyOf() only works with strings`)}};function fn(e){return Ht(dn.prototype,function(t,n,r){if(this.db=e,this._ctx={table:t,index:n===`:id`?null:n,or:r},this._cmp=this._ascending=W,this._descending=(e,t)=>W(t,e),this._max=(e,t)=>W(e,t)>0?e:t,this._min=(e,t)=>W(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new w.MissingAPI})}function q(e){return P(function(t){return pn(t),e(t.target.error),!1})}function pn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const mn=`storagemutated`,hn=`x-storagemutated-1`,J=Vt(null,mn);var gn=class{_lock(){return g(!j.global),++this._reculock,this._reculock===1&&!j.global&&(j.lockOwnerFor=this),this}_unlock(){if(g(!j.global),--this._reculock===0)for(j.global||(j.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{z(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&j.lockOwnerFor!==this}create(e){if(!this.mode)return this;let t=this.db.idbdb,n=this.db._state.dbOpenError;if(g(!this.idbtrans),!e&&!t)switch(n&&n.name){case`DatabaseClosedError`:throw new w.DatabaseClosed(n);case`MissingAPIError`:throw new w.MissingAPI(n.message,n);default:throw new w.OpenFailed(n)}if(!this.active)throw new w.TransactionInactive;return g(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=P(t=>{pn(t),this._reject(e.error)}),e.onabort=P(t=>{pn(t),this.active&&this._reject(new w.Abort(e.error)),this.active=!1,this.on(`abort`).fire(t)}),e.oncomplete=P(()=>{this.active=!1,this._resolve(),`mutatedParts`in e&&J.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,n){if(e===`readwrite`&&this.mode!==`readwrite`)return B(new w.ReadOnly(`Transaction is readonly`));if(!this.active)return B(new w.TransactionInactive);if(this._locked())return new N((r,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,i)},j])});if(n)return I(()=>{var e=new N((e,n)=>{this._lock();let r=t(e,n,this);r&&r.then&&r.then(e,n)});return e.finally(()=>this._unlock()),e._lib=!0,e});var r=new N((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)});return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();let n=N.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>n);else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);(function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)})()}var i=t._waitingFor;return new N((e,r)=>{n.then(n=>t._waitingQueue.push(P(e.bind(null,n))),e=>t._waitingQueue.push(P(r.bind(null,e)))).finally(()=>{t._waitingFor===i&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new w.Abort))}table(e){let t=this._memoizedTables||={};if(o(t,e))return t[e];let n=this.schema[e];if(!n)throw new w.NotFound(`Table `+e+` not part of transaction`);let r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}};function _n(e){return Ht(gn.prototype,function(t,n,r,i,a){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Vt(this,`complete`,`error`,`abort`),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new N((e,t)=>{this._resolve=e,this._reject=t}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),B(e)})})}function vn(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?`&`:``)+(r?`*`:``)+(i?`++`:``)+yn(t)}}function yn(e){return typeof e==`string`?e:e?`[`+[].join.call(e,`+`)+`]`:``}function bn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:v(n,e=>[e.name,e])}}function xn(e){return e.length===1?e[0]:e}let Sn=e=>{try{return e.only([[]]),Sn=()=>[[]],[[]]}catch{return Sn=()=>V,V}};function Cn(e){return e==null?()=>void 0:typeof e==`string`?wn(e):t=>y(t,e)}function wn(e){let t=e.split(`.`);return t.length===1?t=>t[e]:t=>y(t,e)}function Tn(e){return[].slice.call(e)}let En=0;function Dn(e){return e==null?`:id`:typeof e==`string`?e:`[${e.join(`+`)}]`}function On(e,t,r){function i(e,t){let r=Tn(e.objectStoreNames);return{schema:{name:e.name,tables:r.map(e=>t.objectStore(e)).map(e=>{let{keyPath:t,autoIncrement:r}=e,i=n(t),a=t==null,o={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:a,compound:i,keyPath:t,autoIncrement:r,unique:!0,extractKey:Cn(t)},indexes:Tn(e.indexNames).map(t=>e.index(t)).map(e=>{let{name:t,unique:r,multiEntry:i,keyPath:a}=e,s=n(a),c={name:t,compound:s,keyPath:a,unique:r,multiEntry:i,extractKey:Cn(a)};return o[Dn(a)]=c,c}),getIndexByKeyPath:e=>o[Dn(e)]};return o[`:id`]=s.primaryKey,t!=null&&(o[Dn(t)]=s.primaryKey),s})},hasGetAll:r.length>0&&`getAll`in t.objectStore(r[0])&&!(typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function a(e){if(e.type===3)return null;if(e.type===4)throw Error(`Cannot convert never type to IDBKeyRange`);let{lower:n,upper:r,lowerOpen:i,upperOpen:a}=e,o=n===void 0?r===void 0?null:t.upperBound(r,!!a):r===void 0?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!a);return o}function o(e){let t=e.name;function n({trans:e,type:n,keys:r,values:i,range:o}){return new Promise((s,c)=>{s=P(s);let l=e.objectStore(t),u=l.keyPath==null,d=n===`put`||n===`add`;if(!d&&n!==`delete`&&n!==`deleteRange`)throw Error(`Invalid operation type: `+n);let{length:f}=r||i||{length:1};if(r&&i&&r.length!==i.length)throw Error(`Given keys array must have same length as given values array.`);if(f===0)return s({numFailures:0,failures:{},results:[],lastResult:void 0});let p,m=[],h=[],g=0,_=e=>{++g,pn(e)};if(n===`deleteRange`){if(o.type===4)return s({numFailures:g,failures:h,results:[],lastResult:void 0});o.type===3?m.push(p=l.clear()):m.push(p=l.delete(a(o)))}else{let[e,t]=d?u?[i,r]:[i,null]:[r,null];if(d)for(let r=0;r<f;++r)m.push(p=t&&t[r]!==void 0?l[n](e[r],t[r]):l[n](e[r])),p.onerror=_;else for(let t=0;t<f;++t)m.push(p=l[n](e[t])),p.onerror=_}let v=e=>{let t=e.target.result;m.forEach((e,t)=>e.error!=null&&(h[t]=e.error)),s({numFailures:g,failures:h,results:n===`delete`?r:m.map(e=>e.result),lastResult:t})};p.onerror=e=>{_(e),v(e)},p.onsuccess=v})}function r({trans:e,values:n,query:r,reverse:i,unique:o}){return new Promise((s,c)=>{s=P(s);let{index:l,range:u}=r,d=e.objectStore(t),f=l.isPrimaryKey?d:d.index(l.name),p=i?o?`prevunique`:`prev`:o?`nextunique`:`next`,m=n||!(`openKeyCursor`in f)?f.openCursor(a(u),p):f.openKeyCursor(a(u),p);m.onerror=q(c),m.onsuccess=P(t=>{let n=m.result;if(!n){s(null);return}n.___id=++En,n.done=!1;let r=n.continue.bind(n),i=n.continuePrimaryKey;i&&=i.bind(n);let a=n.advance.bind(n),o=()=>{throw Error(`Cursor not started`)},l=()=>{throw Error(`Cursor not stopped`)};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=o,n.fail=P(c),n.next=function(){let e=1;return this.start(()=>e--?this.continue():this.stop()).then(()=>this)},n.start=e=>{let t=new Promise((e,t)=>{e=P(e),m.onerror=q(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=l,e(t)}}),o=()=>{if(m.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw Error(`Cursor behind last entry`)},n.stop()};return m.onsuccess=P(e=>{m.onsuccess=o,o()}),n.continue=r,n.continuePrimaryKey=i,n.advance=a,o(),t},s(n)},c)})}function i(e){return n=>new Promise((r,i)=>{r=P(r);let{trans:o,values:s,limit:c,query:l}=n,u=c===1/0?void 0:c,{index:d,range:f}=l,p=o.objectStore(t),m=d.isPrimaryKey?p:p.index(d.name),h=a(f);if(c===0)return r({result:[]});if(e){let e=s?m.getAll(h,u):m.getAllKeys(h,u);e.onsuccess=e=>r({result:e.target.result}),e.onerror=q(i)}else{let e=0,t=s||!(`openKeyCursor`in m)?m.openCursor(h):m.openKeyCursor(h),n=[];t.onsuccess=i=>{let a=t.result;if(!a||(n.push(s?a.value:a.primaryKey),++e===c))return r({result:n});a.continue()},t.onerror=q(i)}})}return{name:t,schema:e,mutate:n,getMany({trans:e,keys:n}){return new Promise((r,i)=>{r=P(r);let a=e.objectStore(t),o=n.length,s=Array(o),c=0,l=0,u,d=e=>{let t=e.target;s[t._pos]=t.result,++l===c&&r(s)},f=q(i);for(let e=0;e<o;++e){let t=n[e];t!=null&&(u=a.get(n[e]),u._pos=e,u.onsuccess=d,u.onerror=f,++c)}c===0&&r(s)})},get({trans:e,key:n}){return new Promise((r,i)=>{r=P(r);let a=e.objectStore(t),o=a.get(n);o.onsuccess=e=>r(e.target.result),o.onerror=q(i)})},query:i(c),openCursor:r,count({query:e,trans:n}){let{index:r,range:i}=e;return new Promise((e,o)=>{let s=n.objectStore(t),c=r.isPrimaryKey?s:s.index(r.name),l=a(i),u=l?c.count(l):c.count();u.onsuccess=P(t=>e(t.target.result)),u.onerror=q(o)})}}}let{schema:s,hasGetAll:c}=i(e,r),l=s.tables.map(e=>o(e)),u={};return l.forEach(e=>u[e.name]=e),{stack:`dbcore`,transaction:e.transaction.bind(e),table(e){let t=u[e];if(!t)throw Error(`Table '${e}' not found`);return u[e]},MIN_KEY:-1/0,MAX_KEY:Sn(t),schema:s}}function kn(e,t){return t.reduce((e,{create:t})=>({...e,...t(e)}),e)}function An(e,t,{IDBKeyRange:n,indexedDB:r},i){let a=kn(On(t,n,i),e.dbcore);return{dbcore:a}}function jn(e,t){let n=t.db,r=An(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(t=>{let n=t.name;e.core.schema.tables.some(e=>e.name===n)&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function Mn(e,t,n,r){n.forEach(n=>{let i=r[n];t.forEach(t=>{let r=f(t,n);(!r||`value`in r&&r.value===void 0)&&(t===e.Transaction.prototype||t instanceof e.Transaction?l(t,n,{get(){return this.table(n)},set(e){c(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function Nn(e,t){t.forEach(t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]})}function Pn(e,t){return e._cfg.version-t._cfg.version}function Fn(e,n,r,i){let a=e._dbSchema;r.objectStoreNames.contains(`$meta`)&&!a.$meta&&(a.$meta=bn(`$meta`,Jn(``)[0],[]),e._storeNames.push(`$meta`));let o=e._createTransaction(`readwrite`,e._storeNames,a);o.create(r),o._completion.catch(i);let s=o._reject.bind(o),c=j.transless||j;I(()=>{if(j.trans=o,j.transless=c,n===0)t(a).forEach(e=>{Bn(r,e,a[e].primKey,a[e].indexes)}),jn(e,r),N.follow(()=>e.on.populate.fire(o)).catch(s);else return jn(e,r),Ln(e,o,n).then(t=>Rn(e,t,o,r)).catch(s)})}function In(e,t){Vn(e._dbSchema,t),t.db.version%10==0&&!t.objectStoreNames.contains(`$meta`)&&t.db.createObjectStore(`$meta`).add(Math.ceil(t.db.version/10-1),`version`);let n=Wn(e,e.idbdb,t);qn(e,e._dbSchema,t);let r=zn(n,e._dbSchema);for(let e of r.change){if(e.change.length||e.recreate){console.warn(`Unable to patch indexes of table ${e.name} because it has changes on the type of index or primary key.`);return}let n=t.objectStore(e.name);e.add.forEach(t=>{D&&console.debug(`Dexie upgrade patch: Creating missing index ${e.name}.${t.src}`),Un(n,t)})}}function Ln(e,t,n){return t.storeNames.includes(`$meta`)?t.table(`$meta`).get(`version`).then(e=>e??n):N.resolve(n)}function Rn(e,n,r,i){let a=[],o=e._versions,s=e._dbSchema=Wn(e,e.idbdb,i),c=o.filter(e=>e._cfg.version>=n);if(c.length===0)return N.resolve();c.forEach(o=>{a.push(()=>{let a=s,c=o._cfg.dbschema;qn(e,a,i),qn(e,c,i),s=e._dbSchema=c;let l=zn(a,c);l.add.forEach(e=>{Bn(i,e[0],e[1].primKey,e[1].indexes)}),l.change.forEach(e=>{if(e.recreate)throw new w.Upgrade(`Not yet support for changing primary key`);{let t=i.objectStore(e.name);e.add.forEach(e=>Un(t,e)),e.change.forEach(e=>{t.deleteIndex(e.name),Un(t,e)}),e.del.forEach(e=>t.deleteIndex(e))}});let u=o._cfg.contentUpgrade;if(u&&o._cfg.version>n){jn(e,i),r._memoizedTables={};let n=te(c);l.del.forEach(e=>{n[e]=a[e]}),Nn(e,[e.Transaction.prototype]),Mn(e,[e.Transaction.prototype],t(n),n),r.schema=n;let o=he(u);o&&vt();let s,d=N.follow(()=>{if(s=u(r),s&&o){var e=L.bind(null,null);s.then(e,e)}});return s&&typeof s.then==`function`?N.resolve(s):d.then(()=>s)}}),a.push(t=>{let n=o._cfg.dbschema;Hn(n,t),Nn(e,[e.Transaction.prototype]),Mn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}),a.push(t=>{e.idbdb.objectStoreNames.contains(`$meta`)&&(Math.ceil(e.idbdb.version/10)===o._cfg.version?(e.idbdb.deleteObjectStore(`$meta`),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(e=>e!==`$meta`)):t.objectStore(`$meta`).put(o._cfg.version,`version`))})});function l(){return a.length?N.resolve(a.shift()(r.idbtrans)).then(l):N.resolve()}return l().then(()=>{Vn(s,i)})}function zn(e,t){let n={del:[],add:[],change:[]},r;for(r in e)t[r]||n.del.push(r);for(r in t){let i=e[r],a=t[r];if(!i)n.add.push([r,a]);else{let e={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(``+(i.primKey.keyPath||``)!=``+(a.primKey.keyPath||``)||i.primKey.auto!==a.primKey.auto)e.recreate=!0,n.change.push(e);else{let t=i.idxByName,r=a.idxByName,o;for(o in t)r[o]||e.del.push(o);for(o in r){let n=t[o],i=r[o];n?n.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}}return n}function Bn(e,t,n,r){let i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(e=>Un(i,e)),i}function Vn(e,n){t(e).forEach(t=>{n.db.objectStoreNames.contains(t)||(D&&console.debug(`Dexie: Creating missing table`,t),Bn(n,t,e[t].primKey,e[t].indexes))})}function Hn(e,t){[].slice.call(t.db.objectStoreNames).forEach(n=>e[n]==null&&t.db.deleteObjectStore(n))}function Un(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Wn(e,t,n){let r={},i=m(t.objectStoreNames,0);return i.forEach(e=>{let t=n.objectStore(e),i=t.keyPath,a=vn(yn(i),i||``,!0,!1,!!t.autoIncrement,i&&typeof i!=`string`,!0),o=[];for(let e=0;e<t.indexNames.length;++e){let n=t.index(t.indexNames[e]);i=n.keyPath;var s=vn(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&typeof i!=`string`,!1);o.push(s)}r[e]=bn(e,a,o)}),r}function Gn(e,n,r){e.verno=n.version/10;let i=e._dbSchema=Wn(e,n,r);e._storeNames=m(n.objectStoreNames,0),Mn(e,[e._allTables],t(i),i)}function Kn(e,t){let n=Wn(e,e.idbdb,t),r=zn(n,e._dbSchema);return!(r.add.length||r.change.some(e=>e.add.length||e.change.length))}function qn(t,n,r){let i=r.db.objectStoreNames;for(let e=0;e<i.length;++e){let a=i[e],o=r.objectStore(a);t._hasGetAll=`getAll`in o;for(let e=0;e<o.indexNames.length;++e){let t=o.indexNames[e],r=o.index(t).keyPath,i=typeof r==`string`?r:`[`+m(r).join(`+`)+`]`;if(n[a]){let e=n[a].idxByName[i];e&&(e.name=t,delete n[a].idxByName[i],n[a].idxByName[t]=e)}}}typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&e.WorkerGlobalScope&&e instanceof e.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Jn(e){return e.split(`,`).map((e,t)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,``),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split(`+`):r;return vn(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),n(i),t===0)})}var Yn=class{_parseStoresSpec(e,n){t(e).forEach(t=>{if(e[t]!==null){var r=Jn(e[t]),i=r.shift();if(i.unique=!0,i.multi)throw new w.Schema(`Primary key cannot be multi-valued`);r.forEach(e=>{if(e.auto)throw new w.Schema(`Only primary key can be marked as autoIncrement (++)`);if(!e.keyPath)throw new w.Schema(`Index must have a name and cannot be an empty string`)}),n[t]=bn(t,i,r)}})}stores(e){let n=this.db;this._cfg.storesSource=this._cfg.storesSource?r(this._cfg.storesSource,e):e;let i=n._versions,a={},o={};return i.forEach(e=>{r(a,e._cfg.storesSource),o=e._cfg.dbschema={},e._parseStoresSpec(a,o)}),n._dbSchema=o,Nn(n,[n._allTables,n,n.Transaction.prototype]),Mn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],t(o),o),n._storeNames=t(o),this}upgrade(e){return this._cfg.contentUpgrade=Fe(this._cfg.contentUpgrade||T,e),this}};function Xn(e){return Ht(Yn.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Zn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Yr(At,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:`name`})),n.table(`dbnames`)}function Qn(e){return e&&typeof e.databases==`function`}function $n({indexedDB:e,IDBKeyRange:t}){return Qn(e)?Promise.resolve(e.databases()).then(e=>e.map(e=>e.name).filter(e=>e!==At)):Zn(e,t).toCollection().primaryKeys()}function er({indexedDB:e,IDBKeyRange:t},n){!Qn(e)&&n!==At&&Zn(e,t).put({name:n}).catch(T)}function tr({indexedDB:e,IDBKeyRange:t},n){!Qn(e)&&n!==At&&Zn(e,t).delete(n).catch(T)}function nr(e){return I(function(){return j.letThrough=!0,e()})}function rr(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var t;return new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)})}function ir(e){return!(`from`in e)}const Y=function(e,t){if(this)r(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{let t=new Y;return e&&`d`in e&&r(t,e),t}};s(Y.prototype,{add(e){return or(this,e),this},addKey(e){return ar(this,e,e),this},addKeys(e){return e.forEach(e=>ar(this,e,e)),this},hasKey(e){let t=cr(this).next(e).value;return t&&W(t.from,e)<=0&&W(t.to,e)>=0},[fe](){return cr(this)}});function ar(e,t,n){let i=W(t,n);if(isNaN(i))return;if(i>0)throw RangeError();if(ir(e))return r(e,{from:t,to:n,d:1});let a=e.l,o=e.r;if(W(n,e.from)<0)return a?ar(a,t,n):e.l={from:t,to:n,d:1,l:null,r:null},lr(e);if(W(t,e.to)>0)return o?ar(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},lr(e);W(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),W(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);let s=!e.r;a&&!e.l&&or(e,a),o&&s&&or(e,o)}function or(e,t){function n(e,{from:t,to:r,l:i,r:a}){ar(e,t,r),i&&n(e,i),a&&n(e,a)}ir(t)||n(e,t)}function sr(e,t){let n=cr(t),r=n.next();if(r.done)return!1;let i=r.value,a=cr(e),o=a.next(i.from),s=o.value;for(;!r.done&&!o.done;){if(W(s.from,i.to)<=0&&W(s.to,i.from)>=0)return!0;W(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function cr(e){let t=ir(e)?null:{s:0,n:e};return{next(e){let n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&W(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||W(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function lr(e){let t=(e.r?.d||0)-(e.l?.d||0),n=t>1?`r`:t<-1?`l`:``;if(n){let t=n===`r`?`l`:`r`,r={...e},i=e[n];e.from=i.from,e.to=i.to,e[n]=i[n],r[n]=i[t],e[t]=r,r.d=ur(r)}e.d=ur(e)}function ur({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}function dr(e,n){return t(n).forEach(t=>{e[t]?or(e[t],n[t]):e[t]=oe(n[t])}),e}function fr(e,t){return e.all||t.all||Object.keys(e).some(n=>t[n]&&sr(t[n],e[n]))}const X={};let pr={},mr=!1;function hr(e,t=!1){dr(pr,e),mr||(mr=!0,setTimeout(()=>{mr=!1;let e=pr;pr={},gr(e,!1)},0))}function gr(e,t=!1){let n=new Set;if(e.all)for(let r of Object.values(X))_r(r,e,n,t);else for(let r in e){let i=/^idb\:\/\/(.*)\/(.*)\//.exec(r);if(i){let[,r,a]=i,o=X[`idb://${r}/${a}`];o&&_r(o,e,n,t)}}n.forEach(e=>e())}function _r(e,t,n,r){let i=[];for(let[a,o]of Object.entries(e.queries.query)){let e=[];for(let i of o)fr(t,i.obsSet)?i.subscribers.forEach(e=>n.add(e)):r&&e.push(i);r&&i.push([a,e])}if(r)for(let[t,n]of i)e.queries.query[t]=n}function vr(e){let t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?B(t.dbOpenError):e);t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;let r=t.openCanceller,i=Math.round(e.verno*10),a=!1;function o(){if(t.openCanceller!==r)throw new w.DatabaseClosed(`db.open() was cancelled`)}let s=t.dbReadyResolve,c=null,l=!1,u=()=>new N((r,s)=>{if(o(),!n)throw new w.MissingAPI;let d=e.name,f=t.autoSchema||!i?n.open(d):n.open(d,i);if(!f)throw new w.MissingAPI;f.onerror=q(s),f.onblocked=P(e._fireOnBlocked),f.onupgradeneeded=P(r=>{if(c=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=pn,c.abort(),f.result.close();let e=n.deleteDatabase(d);e.onsuccess=e.onerror=P(()=>{s(new w.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{c.onerror=q(s);let t=r.oldVersion>2**62?0:r.oldVersion;l=t<1,e.idbdb=f.result,a&&In(e,c),Fn(e,t/10,c,s)}},s),f.onsuccess=P(()=>{c=null;let n=e.idbdb=f.result,o=m(n.objectStoreNames);if(o.length>0)try{let s=n.transaction(xn(o),`readonly`);if(t.autoSchema)Gn(e,n,s);else if(qn(e,e._dbSchema,s),!Kn(e,s)&&!a)return console.warn(`Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.`),n.close(),i=n.version+1,a=!0,r(u());jn(e,s)}catch{}kt.push(e),n.onversionchange=P(n=>{t.vcFired=!0,e.on(`versionchange`).fire(n)}),n.onclose=P(t=>{e.on(`close`).fire(t)}),l&&er(e._deps,d),r()},s)}).catch(e=>{switch(e?.name){case`UnknownError`:if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn(`Dexie: Workaround for Chrome UnknownError on open()`),u();break;case`VersionError`:if(i>0)return i=0,u();break}return N.reject(e)});return N.race([r,(typeof navigator>`u`?N.resolve():rr()).then(u)]).then(()=>(o(),t.onReadyBeingFired=[],N.resolve(nr(()=>e.on.ready.fire(e.vip))).then(function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(Fe,T);return t.onReadyBeingFired=[],N.resolve(nr(()=>r(e.vip))).then(n)}}))).finally(()=>{t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(n=>{t.dbOpenError=n;try{c&&c.abort()}catch{}return r===t.openCanceller&&e._close(),B(n)}).finally(()=>{t.openComplete=!0,s()}).then(()=>{if(l){let t={};e.tables.forEach(n=>{n.schema.indexes.forEach(r=>{r.name&&(t[`idb://${e.name}/${n.name}/${r.name}`]=new Y(-1/0,[[[]]]))}),t[`idb://${e.name}/${n.name}/`]=t[`idb://${e.name}/${n.name}/:dels`]=new Y(-1/0,[[[]]])}),J(mn).fire(t),gr(t,!0)}return e})}function yr(e){var t=t=>e.next(t),r=t=>e.throw(t),i=o(t),a=o(r);function o(e){return t=>{var r=e(t),o=r.value;return r.done?o:!o||typeof o.then!=`function`?n(o)?Promise.all(o).then(i,a):i(o):o.then(i,a)}}return o(t)()}function br(e,t,n){var r=arguments.length;if(r<2)throw new w.InvalidArgument(`Too few arguments`);for(var i=Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=re(i);return[e,a,n]}function xr(e,t,n,r,i){return N.resolve().then(()=>{let a=j.transless||j,o=e._createTransaction(t,n,e._dbSchema,r);o.explicit=!0;let s={trans:o,transless:a};if(r)o.idbtrans=r.idbtrans;else try{o.create(),o.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===we.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn(`Dexie: Need to reopen db`),e.close({disableAutoOpen:!1}),e.open().then(()=>xr(e,t,n,null,i))):B(r)}let c=he(i);c&&vt();let l,u=N.follow(()=>{if(l=i.call(o,o),l)if(c){var e=L.bind(null,null);l.then(e,e)}else typeof l.next==`function`&&typeof l.throw==`function`&&(l=yr(l))},s);return(l&&typeof l.then==`function`?N.resolve(l).then(e=>o.active?e:B(new w.PrematureCommit(`Transaction committed too early. See http://bit.ly/2kdckMn`))):u.then(()=>l)).then(e=>(r&&o._resolve(),o._completion.then(()=>e))).catch(e=>(o._reject(e),B(e)))})}function Sr(e,t,r){let i=n(e)?e.slice():[e];for(let e=0;e<r;++e)i.push(t);return i}function Cr(e){return{...e,table(t){let n=e.table(t),{schema:r}=n,i={},a=[];function o(e,t,n){let r=Dn(e),s=i[r]=i[r]||[],c=e==null?0:typeof e==`string`?1:e.length,l=t>0,u={...n,name:l?`${r}(virtual-from:${n.name})`:n.name,lowLevelIndex:n,isVirtual:l,keyTail:t,keyLength:c,extractKey:Cn(e),unique:!l&&n.unique};if(s.push(u),u.isPrimaryKey||a.push(u),c>1){let r=c===2?e[0]:e.slice(0,c-1);o(r,t+1,n)}return s.sort((e,t)=>e.keyTail-t.keyTail),u}let s=o(r.primaryKey.keyPath,0,r.primaryKey);i[`:id`]=[s];for(let e of r.indexes)o(e.keyPath,0,e);function c(e){let t=i[Dn(e)];return t&&t[0]}function l(t,n){return{type:t.type===1?2:t.type,lower:Sr(t.lower,t.lowerOpen?e.MAX_KEY:e.MIN_KEY,n),lowerOpen:!0,upper:Sr(t.upper,t.upperOpen?e.MIN_KEY:e.MAX_KEY,n),upperOpen:!0}}function u(e){let t=e.query.index;return t.isVirtual?{...e,query:{index:t.lowLevelIndex,range:l(e.query.range,t.keyTail)}}:e}let d={...n,schema:{...r,primaryKey:s,indexes:a,getIndexByKeyPath:c},count(e){return n.count(u(e))},query(e){return n.query(u(e))},openCursor(t){let{keyTail:r,isVirtual:i,keyLength:a}=t.query.index;if(!i)return n.openCursor(t);function o(n){function i(i){i==null?t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue():n.continue(Sr(i,t.reverse?e.MAX_KEY:e.MIN_KEY,r))}let o=Object.create(n,{continue:{value:i},continuePrimaryKey:{value(t,i){n.continuePrimaryKey(Sr(t,e.MAX_KEY,r),i)}},primaryKey:{get(){return n.primaryKey}},key:{get(){let e=n.key;return a===1?e[0]:e.slice(0,a)}},value:{get(){return n.value}}});return o}return n.openCursor(u(t)).then(e=>e&&o(e))}};return d}}}const wr={stack:`dbcore`,name:`VirtualIndexMiddleware`,level:1,create:Cr};function Tr(e,n,r,i){return r||={},i||=``,t(e).forEach(t=>{if(!o(n,t))r[i+t]=void 0;else{var a=e[t],s=n[t];if(typeof a==`object`&&typeof s==`object`&&a&&s){let e=de(a),o=de(s);e===o?e===`Object`?Tr(a,s,r,i+t+`.`):a!==s&&(r[i+t]=n[t]):r[i+t]=n[t]}else a!==s&&(r[i+t]=n[t])}}),t(n).forEach(t=>{o(e,t)||(r[i+t]=n[t])}),r}function Er(e,t){return t.type===`delete`?t.keys:t.keys||t.values.map(e.extractKey)}const Dr={stack:`dbcore`,name:`HooksMiddleware`,level:2,create:e=>({...e,table(t){let n=e.table(t),{primaryKey:r}=n.schema,i={...n,mutate(e){let i=j.trans,{deleting:a,creating:s,updating:c}=i.table(t).hook;switch(e.type){case`add`:if(s.fire===T)break;return i._promise(`readwrite`,()=>l(e),!0);case`put`:if(s.fire===T&&c.fire===T)break;return i._promise(`readwrite`,()=>l(e),!0);case`delete`:if(a.fire===T)break;return i._promise(`readwrite`,()=>l(e),!0);case`deleteRange`:if(a.fire===T)break;return i._promise(`readwrite`,()=>u(e),!0)}return n.mutate(e);function l(e){let t=j.trans,i=e.keys||Er(r,e);if(!i)throw Error(`Keys missing`);return e=e.type===`add`||e.type===`put`?{...e,keys:i}:{...e},e.type!==`delete`&&(e.values=[...e.values]),e.keys&&=[...e.keys],Or(n,e,i).then(l=>{let u=i.map((n,i)=>{let u=l[i],d={onerror:null,onsuccess:null};if(e.type===`delete`)a.fire.call(d,n,u,t);else if(e.type===`add`||u===void 0){let a=s.fire.call(d,n,e.values[i],t);n==null&&a!=null&&(n=a,e.keys[i]=n,r.outbound||b(e.values[i],r.keyPath,n))}else{let r=Tr(u,e.values[i]),a=c.fire.call(d,r,n,u,t);if(a){let t=e.values[i];Object.keys(a).forEach(e=>{o(t,e)?t[e]=a[e]:b(t,e,a[e])})}}return d});return n.mutate(e).then(({failures:t,results:n,numFailures:r,lastResult:a})=>{for(let r=0;r<i.length;++r){let a=n?n[r]:i[r],o=u[r];a==null?o.onerror&&o.onerror(t[r]):o.onsuccess&&o.onsuccess(e.type===`put`&&l[r]?e.values[r]:a)}return{failures:t,results:n,numFailures:r,lastResult:a}}).catch(e=>(u.forEach(t=>t.onerror&&t.onerror(e)),Promise.reject(e)))})}function u(e){return d(e.trans,e.range,1e4)}function d(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then(({result:n})=>l({type:`delete`,keys:n,trans:e}).then(r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:d(e,{...t,lower:n[n.length-1],lowerOpen:!0},i)))}}};return i}})};function Or(e,t,n){return t.type===`add`?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:`immutable`})}function kr(e,t,n){try{if(!t||t.keys.length<e.length)return null;let r=[];for(let i=0,a=0;i<t.keys.length&&a<e.length;++i)W(t.keys[i],e[a])===0&&(r.push(n?x(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}const Ar={stack:`dbcore`,level:-1,create:e=>({table:t=>{let n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);let t=kr(e.keys,e.trans._cache,e.cache===`clone`);return t?N.resolve(t):n.getMany(e).then(t=>(e.trans._cache={keys:e.keys,values:e.cache===`clone`?x(t):t},t))},mutate:e=>(e.type!==`add`&&(e.trans._cache=null),n.mutate(e))}}})};function jr(e,t){return e.trans.mode===`readonly`&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!==`disabled`&&!t.schema.primaryKey.outbound}function Mr(e,t){switch(e){case`query`:return t.values&&!t.unique;case`get`:return!1;case`getMany`:return!1;case`count`:return!1;case`openCursor`:return!1}}const Nr={stack:`dbcore`,level:0,name:`Observability`,create:e=>{let r=e.schema.name,i=new Y(e.MIN_KEY,e.MAX_KEY);return{...e,transaction:(t,n,r)=>{if(j.subscr&&n!==`readonly`)throw new w.ReadOnly(`Readwrite transaction in liveQuery context. Querier source: ${j.querier}`);return e.transaction(t,n,r)},table:a=>{let o=e.table(a),{schema:s}=o,{primaryKey:c,indexes:l}=s,{extractKey:u,outbound:d}=c,f=c.autoIncrement&&l.filter(e=>e.compound&&e.keyPath.includes(c.keyPath)),p={...o,mutate:t=>{let l=t.trans,u=t.mutatedParts||={},d=e=>{let t=`idb://${r}/${a}/${e}`;return u[t]||(u[t]=new Y)},p=d(``),m=d(`:dels`),{type:h}=t,[g,_]=t.type===`deleteRange`?[t.range]:t.type===`delete`?[t.keys]:t.values.length<50?[Er(c,t).filter(e=>e),t.values]:[],v=t.trans._cache;if(n(g)){p.addKeys(g);let e=h===`delete`||g.length===_.length?kr(g,v):null;e||m.addKeys(g),(e||_)&&Pr(d,s,e,_)}else if(g){let t={from:g.lower??e.MIN_KEY,to:g.upper??e.MAX_KEY};m.add(t),p.add(t)}else p.add(i),m.add(i),s.indexes.forEach(e=>d(e.name).add(i));return o.mutate(t).then(e=>(g&&(t.type===`add`||t.type===`put`)&&(p.addKeys(e.results),f&&f.forEach(n=>{let r=t.values.map(e=>n.extractKey(e)),i=n.keyPath.findIndex(e=>e===c.keyPath);for(let t=0,n=e.results.length;t<n;++t)r[t][i]=e.results[t];d(n.name).addKeys(r)})),l.mutatedParts=dr(l.mutatedParts||{},u),e))}},m=({query:{index:t,range:n}})=>[t,new Y(n.lower??e.MIN_KEY,n.upper??e.MAX_KEY)],h={get:e=>[c,new Y(e.key)],getMany:e=>[c,new Y().addKeys(e.keys)],count:m,query:m,openCursor:m};return t(h).forEach(e=>{p[e]=function(t){let{subscr:n}=j,s=!!n,c=jr(j,o)&&Mr(e,t),l=c?t.obsSet={}:n;if(s){let n=e=>{let t=`idb://${r}/${a}/${e}`;return l[t]||(l[t]=new Y)},s=n(``),c=n(`:dels`),[f,p]=h[e](t);if(e===`query`&&f.isPrimaryKey&&!t.values?c.add(p):n(f.name||``).add(p),!f.isPrimaryKey)if(e===`count`)c.add(i);else{let n=e===`query`&&d&&t.values&&o.query({...t,values:!1});return o[e].apply(this,arguments).then(r=>{if(e===`query`){if(d&&t.values)return n.then(({result:e})=>(s.addKeys(e),r));let e=t.values?r.result.map(u):r.result;t.values?s.addKeys(e):c.addKeys(e)}else if(e===`openCursor`){let e=r,n=t.values;return e&&Object.create(e,{key:{get(){return c.addKey(e.primaryKey),e.key}},primaryKey:{get(){let t=e.primaryKey;return c.addKey(t),t}},value:{get(){return n&&s.addKey(e.primaryKey),e.value}}})}return r})}}return o[e].apply(this,arguments)}}),p}}}};function Pr(e,t,r,i){function a(t){let a=e(t.name||``);function o(e){return e==null?null:t.extractKey(e)}let s=e=>t.multiEntry&&n(e)?e.forEach(e=>a.addKey(e)):a.addKey(e);(r||i).forEach((e,t)=>{let n=r&&o(r[t]),a=i&&o(i[t]);W(n,a)!==0&&(n!=null&&s(n),a!=null&&s(a))})}t.indexes.forEach(a)}function Fr(e,t,r){if(r.numFailures===0)return t;if(t.type===`deleteRange`)return null;let i=t.keys?t.keys.length:`values`in t&&t.values?t.values.length:1;if(r.numFailures===i)return null;let a={...t};return n(a.keys)&&(a.keys=a.keys.filter((e,t)=>!(t in r.failures))),`values`in a&&n(a.values)&&(a.values=a.values.filter((e,t)=>!(t in r.failures))),a}function Ir(e,t){return t.lower===void 0?!0:t.lowerOpen?W(e,t.lower)>0:W(e,t.lower)>=0}function Lr(e,t){return t.upper===void 0?!0:t.upperOpen?W(e,t.upper)<0:W(e,t.upper)<=0}function Rr(e,t){return Ir(e,t)&&Lr(e,t)}function zr(e,t,r,i,a,o){if(!r||r.length===0)return e;let s=t.query.index,{multiEntry:c}=s,l=t.query.range,u=i.schema.primaryKey,d=u.extractKey,f=s.extractKey,p=(s.lowLevelIndex||s).extractKey,m=r.reduce((e,r)=>{let i=e,a=[];if(r.type===`add`||r.type===`put`){let e=new Y;for(let t=r.values.length-1;t>=0;--t){let i=r.values[t],o=d(i);if(e.hasKey(o))continue;let s=f(i);(c&&n(s)?s.some(e=>Rr(e,l)):Rr(s,l))&&(e.addKey(o),a.push(i))}}switch(r.type){case`add`:{let n=new Y().addKeys(t.values?e.map(e=>d(e)):e);i=e.concat(t.values?a.filter(e=>{let t=d(e);return n.hasKey(t)?!1:(n.addKey(t),!0)}):a.map(e=>d(e)).filter(e=>n.hasKey(e)?!1:(n.addKey(e),!0)));break}case`put`:{let n=new Y().addKeys(r.values.map(e=>d(e)));i=e.filter(e=>!n.hasKey(t.values?d(e):e)).concat(t.values?a:a.map(e=>d(e)));break}case`delete`:let n=new Y().addKeys(r.keys);i=e.filter(e=>!n.hasKey(t.values?d(e):e));break;case`deleteRange`:let o=r.range;i=e.filter(e=>!Rr(d(e),o));break}return i},e);return m===e?e:(m.sort((e,t)=>W(p(e),p(t))||W(d(e),d(t))),t.limit&&t.limit<1/0&&(m.length>t.limit?m.length=t.limit:e.length===t.limit&&m.length<t.limit&&(a.dirty=!0)),o?Object.freeze(m):m)}function Br(e,t){return W(e.lower,t.lower)===0&&W(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Vr(e,t,n,r){if(e===void 0)return t===void 0?0:-1;if(t===void 0)return 1;let i=W(e,t);if(i===0){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function Hr(e,t,n,r){if(e===void 0)return t===void 0?0:1;if(t===void 0)return-1;let i=W(e,t);if(i===0){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Ur(e,t){return Vr(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&Hr(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Wr(e,t,n,r){let i=X[`idb://${e}/${t}`];if(!i)return[];let a=i.queries[n];if(!a)return[null,!1,i,null];let o=r.query?r.query.index.name:null,s=a[o||``];if(!s)return[null,!1,i,null];switch(n){case`query`:let e=s.find(e=>e.req.limit===r.limit&&e.req.values===r.values&&Br(e.req.query.range,r.query.range));if(e)return[e,!0,i,s];let t=s.find(e=>{let t=`limit`in e.req?e.req.limit:1/0;return t>=r.limit&&(r.values?e.req.values:!0)&&Ur(e.req.query.range,r.query.range)});return[t,!1,i,s];case`count`:let n=s.find(e=>Br(e.req.query.range,r.query.range));return[n,!!n,i,s]}}function Gr(e,t,n,r){e.subscribers.add(n),r.addEventListener(`abort`,()=>{e.subscribers.delete(n),e.subscribers.size===0&&Kr(e,t)})}function Kr(e,t){setTimeout(()=>{e.subscribers.size===0&&S(t,e)},3e3)}const qr={stack:`dbcore`,level:0,name:`Cache`,create:e=>{let t=e.schema.name,n={...e,transaction:(n,r,i)=>{let a=e.transaction(n,r,i);if(r===`readwrite`){let i=new AbortController,{signal:o}=i,s=o=>()=>{if(i.abort(),r===`readwrite`){let r=new Set;for(let i of n){let n=X[`idb://${t}/${i}`];if(n){let t=e.table(i),s=n.optimisticOps.filter(e=>e.trans===a);if(a._explicit&&o&&a.mutatedParts)for(let e of Object.values(n.queries.query))for(let t of e.slice())fr(t.obsSet,a.mutatedParts)&&(S(e,t),t.subscribers.forEach(e=>r.add(e)));else if(s.length>0){n.optimisticOps=n.optimisticOps.filter(e=>e.trans!==a);for(let e of Object.values(n.queries.query))for(let n of e.slice())if(n.res!=null&&a.mutatedParts)if(o&&!n.dirty){let i=Object.isFrozen(n.res),a=zr(n.res,n.req,s,t,n,i);n.dirty?(S(e,n),n.subscribers.forEach(e=>r.add(e))):a!==n.res&&(n.res=a,n.promise=N.resolve({result:a}))}else n.dirty&&S(e,n),n.subscribers.forEach(e=>r.add(e))}}}r.forEach(e=>e())}};a.addEventListener(`abort`,s(!1),{signal:o}),a.addEventListener(`error`,s(!1),{signal:o}),a.addEventListener(`complete`,s(!0),{signal:o})}return a},table(n){let r=e.table(n),i=r.schema.primaryKey,a={...r,mutate(e){let a=j.trans;if(i.outbound||a.db._options.cache===`disabled`||a.explicit||a.idbtrans.mode!==`readwrite`)return r.mutate(e);let o=X[`idb://${t}/${n}`];if(!o)return r.mutate(e);let s=r.mutate(e);return(e.type===`add`||e.type===`put`)&&(e.values.length>=50||Er(i,e).some(e=>e==null))?s.then(t=>{let n={...e,values:e.values.map((e,n)=>{if(t.failures[n])return e;let r=i.keyPath?.includes(`.`)?x(e):{...e};return b(r,i.keyPath,t.results[n]),r})},r=Fr(o,n,t);o.optimisticOps.push(r),queueMicrotask(()=>e.mutatedParts&&hr(e.mutatedParts))}):(o.optimisticOps.push(e),e.mutatedParts&&hr(e.mutatedParts),s.then(t=>{if(t.numFailures>0){S(o.optimisticOps,e);let n=Fr(o,e,t);n&&o.optimisticOps.push(n),e.mutatedParts&&hr(e.mutatedParts)}}),s.catch(()=>{S(o.optimisticOps,e),e.mutatedParts&&hr(e.mutatedParts)})),s},query(e){if(!jr(j,r)||!Mr(`query`,e))return r.query(e);let i=j.trans?.db._options.cache===`immutable`,{requery:a,signal:o}=j,[s,c,l,u]=Wr(t,n,`query`,e);if(s&&c)s.obsSet=e.obsSet;else{let a=r.query(e).then(e=>{let t=e.result;if(s&&(s.res=t),i){for(let e=0,n=t.length;e<n;++e)Object.freeze(t[e]);Object.freeze(t)}else e.result=x(t);return e}).catch(e=>(u&&s&&S(u,s),Promise.reject(e)));s={obsSet:e.obsSet,promise:a,subscribers:new Set,type:`query`,req:e,dirty:!1},u?u.push(s):(u=[s],l||=X[`idb://${t}/${n}`]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}},l.queries.query[e.query.index.name||``]=u)}return Gr(s,u,a,o),s.promise.then(t=>({result:zr(t.result,e,l?.optimisticOps,r,s,i)}))}};return a}};return n}};function Jr(e,t){return new Proxy(e,{get(e,n,r){return n===`db`?t:Reflect.get(e,n,r)}})}var Yr=class e{constructor(t,n){this._middlewares={},this.verno=0;let r=e.dependencies;this._options=n={addons:e.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:`cloned`,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};let{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:T,dbReadyPromise:null,cancelOpen:T,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};a.dbReadyPromise=new N(e=>{a.dbReadyResolve=e}),a.openCanceller=new N((e,t)=>{a.cancelOpen=t}),this._state=a,this.name=t,this.on=Vt(this,`populate`,`blocked`,`versionchange`,`close`,{ready:[Fe,T]}),this.on.ready.subscribe=h(this.on.ready.subscribe,t=>(n,r)=>{e.vip(()=>{let e=this._state;if(e.openComplete)e.dbOpenError||N.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);let e=this;r||t(function t(){e.on.ready.unsubscribe(n),e.on.ready.unsubscribe(t)})}})}),this.Collection=tn(this),this.Table=Ut(this),this.Transaction=_n(this),this.Version=Xn(this),this.WhereClause=fn(this),this.on(`versionchange`,e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close({disableAutoOpen:!1})}),this.on(`blocked`,e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)}),this._maxKey=Sn(n.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on(`blocked`).fire(e),kt.filter(e=>e.name===this.name&&e!==this&&!e._state.vcFired).map(t=>t.on(`versionchange`).fire(e))},this.use(Ar),this.use(qr),this.use(Nr),this.use(wr),this.use(Dr);let o=new Proxy(this,{get:(e,t,n)=>{if(t===`_vip`)return!0;if(t===`table`)return e=>Jr(this.table(e),o);let r=Reflect.get(e,t,n);return r instanceof Bt?Jr(r,o):t===`tables`?r.map(e=>Jr(e,o)):t===`_createTransaction`?function(){let e=r.apply(this,arguments);return Jr(e,o)}:r}});this.vip=o,i.forEach(e=>e(this))}version(e){if(isNaN(e)||e<.1)throw new w.Type(`Given version is not a positive number`);if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new w.Schema(`Cannot add version when database is open`);this.verno=Math.max(this.verno,e);let t=this._versions;var n=t.filter(t=>t._cfg.version===e)[0];return n||(n=new this.Version(e),t.push(n),t.sort(Pn),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||j.letThrough||this._vip)?e():new N((e,t)=>{if(this._state.openComplete)return t(new w.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._state.autoOpen){t(new w.DatabaseClosed);return}this.open().catch(T)}this._state.dbReadyPromise.then(e,t)}).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});let i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:n??10,name:r}),i.sort((e,t)=>e.level-t.level),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(e=>n?e.create!==n:t?e.name!==t:!1)),this}open(){return z(A,()=>vr(this))}_close(){let e=this._state,t=kt.indexOf(this);if(t>=0&&kt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new N(t=>{e.dbReadyResolve=t}),e.openCanceller=new N((t,n)=>{e.cancelOpen=n}))}close({disableAutoOpen:e}={disableAutoOpen:!0}){let t=this._state;e?(t.isBeingOpened&&t.cancelOpen(new w.DatabaseClosed),this._close(),t.autoOpen=!1,t.dbOpenError=new w.DatabaseClosed):(this._close(),t.autoOpen=this._options.autoOpen||t.isBeingOpened,t.openComplete=!1,t.dbOpenError=null)}delete(e={disableAutoOpen:!0}){let t=arguments.length>0&&typeof arguments[0]!=`object`,n=this._state;return new N((r,i)=>{let a=()=>{this.close(e);var t=this._deps.indexedDB.deleteDatabase(this.name);t.onsuccess=P(()=>{tr(this._deps,this.name),r()}),t.onerror=q(i),t.onblocked=this._fireOnBlocked};if(t)throw new w.InvalidArgument(`Invalid closeOptions argument to db.delete()`);n.isBeingOpened?n.dbReadyPromise.then(a):a()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name===`DatabaseClosed`}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return t(this._allTables).map(e=>this._allTables[e])}transaction(){let e=br.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=j.trans;(!r||r.db!==this||e.indexOf(`!`)!==-1)&&(r=null);let i=e.indexOf(`?`)!==-1;e=e.replace(`!`,``).replace(`?`,``);let a,o;try{if(o=t.map(e=>{var t=e instanceof this.Table?e.name:e;if(typeof t!=`string`)throw TypeError(`Invalid table argument to Dexie.transaction(). Only Table or String are allowed`);return t}),e==`r`||e===jt)a=jt;else if(e==`rw`||e==Mt)a=Mt;else throw new w.InvalidArgument(`Invalid transaction mode: `+e);if(r){if(r.mode===jt&&a===Mt)if(i)r=null;else throw new w.SubTransaction(`Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY`);r&&o.forEach(e=>{if(r&&r.storeNames.indexOf(e)===-1)if(i)r=null;else throw new w.SubTransaction(`Table `+e+` not included in parent transaction.`)}),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,(t,n)=>{n(e)}):B(e)}let s=xr.bind(null,this,a,o,r,n);return r?r._promise(a,s,`lock`):j.trans?z(j.transless,()=>this._whenReady(s)):this._whenReady(s)}table(e){if(!o(this._allTables,e))throw new w.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}};const Xr=typeof Symbol<`u`&&`observable`in Symbol?Symbol.observable:`@@observable`;var Zr=class{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(!e||typeof e==`function`?{next:e,error:t,complete:n}:e)}[Xr](){return this}};let Qr;try{Qr={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange}}catch{Qr={indexedDB:null,IDBKeyRange:null}}function $r(e){let t=!1,n,r=new Zr(r=>{let i=he(e);function a(t){let n=ot();try{i&&vt();let n=I(e,t);return i&&(n=n.finally(L)),n}finally{n&&st()}}let o=!1,s,c={},l={},u={get closed(){return o},unsubscribe:()=>{o||(o=!0,s&&s.abort(),d&&J.storagemutated.unsubscribe(m))}};r.start&&r.start(u);let d=!1,f=()=>wt(h);function p(){return fr(l,c)}let m=e=>{dr(c,e),p()&&f()},h=()=>{if(o||!Qr.indexedDB)return;c={};let i={};s&&s.abort(),s=new AbortController;let u={subscr:i,signal:s.signal,requery:f,querier:e,trans:null},p=a(u);Promise.resolve(p).then(e=>{t=!0,n=e,!(o||u.signal.aborted)&&(c={},l=i,!se(l)&&!d&&(J(mn,m),d=!0),wt(()=>!o&&r.next&&r.next(e)))},e=>{t=!1,[`DatabaseClosedError`,`AbortError`].includes(e?.name)||o||wt(()=>{o||r.error&&r.error(e)})})};return setTimeout(f,0),u});return r.hasValue=()=>t,r.getValue=()=>n,r}const Z=Yr;s(Z,{...Oe,delete(e){let t=new Z(e,{addons:[]});return t.delete()},exists(e){return new Z(e,{addons:[]}).open().then(e=>(e.close(),!0)).catch(`NoSuchDatabaseError`,()=>!1)},getDatabaseNames(e){try{return $n(Z.dependencies).then(e)}catch{return B(new w.MissingAPI)}},defineClass(){function e(e){r(this,e)}return e},ignoreTransaction(e){return j.trans?z(j.transless,e):e()},vip:nr,async:function(e){return function(){try{var t=yr(e.apply(this,arguments));return!t||typeof t.then!=`function`?N.resolve(t):t}catch(e){return B(e)}}},spawn:function(e,t,n){try{var r=yr(e.apply(n,t||[]));return!r||typeof r.then!=`function`?N.resolve(r):r}catch(e){return B(e)}},currentTransaction:{get:()=>j.trans||null},waitFor:function(e,t){let n=N.resolve(typeof e==`function`?Z.ignoreTransaction(e):e).timeout(t||6e4);return j.trans?j.trans.waitFor(n):n},Promise:N,debug:{get:()=>D,set:e=>{Ie(e)}},derive:u,extend:r,props:s,override:h,Events:Vt,on:J,liveQuery:$r,extendObservabilitySet:dr,getByKeyPath:y,setByKeyPath:b,delByKeyPath:ee,shallowClone:te,deepClone:x,getObjectDiff:Tr,cmp:W,asap:_,minKey:Dt,addons:[],connections:kt,errnames:we,dependencies:Qr,cache:X,semVer:Et,version:Et.split(`.`).map(e=>parseInt(e)).reduce((e,t,n)=>e+t/10**(n*2))}),Z.maxKey=Sn(Z.dependencies.IDBKeyRange),typeof dispatchEvent<`u`&&typeof addEventListener<`u`&&(J(mn,e=>{if(!Q){let t;t=new CustomEvent(hn,{detail:e}),Q=!0,dispatchEvent(t),Q=!1}}),addEventListener(hn,({detail:e})=>{Q||ei(e)}));function ei(e){let t=Q;try{Q=!0,J.storagemutated.fire(e),gr(e,!0)}finally{Q=t}}let Q=!1,$,ti=()=>{};typeof BroadcastChannel<`u`&&(ti=()=>{$=new BroadcastChannel(hn),$.onmessage=e=>e.data&&ei(e.data)},ti(),typeof $.unref==`function`&&$.unref(),J(mn,e=>{Q||$.postMessage(e)})),typeof addEventListener<`u`&&(addEventListener(`pagehide`,e=>{if(!Yr.disableBfCache&&e.persisted){D&&console.debug(`Dexie: handling persisted pagehide`),$?.close();for(let e of kt)e.close({disableAutoOpen:!1})}}),addEventListener(`pageshow`,e=>{!Yr.disableBfCache&&e.persisted&&(D&&console.debug(`Dexie: handling persisted pageshow`),ti(),ei({all:new Y(-1/0,[[]])}))})),N.rejectionMapper=De,Ie(D);export{Yr as Dexie};
//# sourceMappingURL=dexie.js.map