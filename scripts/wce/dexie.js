/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Tn=function(e,n){return Tn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Tn(e,n)};function br(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");Tn(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var I=function(){return I=Object.assign||function(n){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},I.apply(this,arguments)};function rn(e,n,t){for(var r=0,i=n.length,a;r<i;r++)(a||!(r in n))&&(a||(a=Array.prototype.slice.call(n,0,r)),a[r]=n[r]);return e.concat(a||Array.prototype.slice.call(n))}var U=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,z=Object.keys,N=Array.isArray;typeof Promise<"u"&&!U.Promise&&(U.Promise=Promise);function H(e,n){return typeof n!="object"||z(n).forEach(function(t){e[t]=n[t]}),e}var Ae=Object.getPrototypeOf,wr={}.hasOwnProperty;function $(e,n){return wr.call(e,n)}function Oe(e,n){typeof n=="function"&&(n=n(Ae(e))),(typeof Reflect>"u"?z:Reflect.ownKeys)(n).forEach(function(t){se(e,t,n[t])})}var Kt=Object.defineProperty;function se(e,n,t,r){Kt(e,n,H(t&&$(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function De(e){return{from:function(n){return e.prototype=Object.create(n.prototype),se(e.prototype,"constructor",e),{extend:Oe.bind(null,e.prototype)}}}}var _r=Object.getOwnPropertyDescriptor;function St(e,n){var t=_r(e,n),r;return t||(r=Ae(e))&&St(r,n)}var xr=[].slice;function an(e,n,t){return xr.call(e,n,t)}function At(e,n){return n(e)}function Ve(e){if(!e)throw new Error("Assertion Failed")}function Ot(e){U.setImmediate?setImmediate(e):setTimeout(e,0)}function Er(e,n){return e.reduce(function(t,r,i){var a=n(r,i);return a&&(t[a[0]]=a[1]),t},{})}function re(e,n){if(typeof n=="string"&&$(e,n))return e[n];if(!n)return e;if(typeof n!="string"){for(var t=[],r=0,i=n.length;r<i;++r){var a=re(e,n[r]);t.push(a)}return t}var u=n.indexOf(".");if(u!==-1){var o=e[n.substr(0,u)];return o==null?void 0:re(o,n.substr(u+1))}}function Q(e,n,t){if(!(!e||n===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof n!="string"&&"length"in n){Ve(typeof t!="string"&&"length"in t);for(var r=0,i=n.length;r<i;++r)Q(e,n[r],t[r])}else{var a=n.indexOf(".");if(a!==-1){var u=n.substr(0,a),o=n.substr(a+1);if(o==="")t===void 0?N(e)&&!isNaN(parseInt(u))?e.splice(u,1):delete e[u]:e[u]=t;else{var s=e[u];(!s||!$(e,u))&&(s=e[u]={}),Q(s,o,t)}}else t===void 0?N(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=t}}function kr(e,n){typeof n=="string"?Q(e,n,void 0):"length"in n&&[].map.call(n,function(t){Q(e,t,void 0)})}function Dt(e){var n={};for(var t in e)$(e,t)&&(n[t]=e[t]);return n}var Kr=[].concat;function Ct(e){return Kr.apply([],e)}var Sr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ct([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return U[e]}),Pt=new Set(Sr.map(function(e){return U[e]}));function Tt(e){var n={};for(var t in e)if($(e,t)){var r=e[t];n[t]=!r||typeof r!="object"||Pt.has(r.constructor)?r:Tt(r)}return n}function Ar(e){for(var n in e)if($(e,n))return!1;return!0}var ze=null;function ce(e){ze=new WeakMap;var n=In(e);return ze=null,n}function In(e){if(!e||typeof e!="object")return e;var n=ze.get(e);if(n)return n;if(N(e)){n=[],ze.set(e,n);for(var t=0,r=e.length;t<r;++t)n.push(In(e[t]))}else if(Pt.has(e.constructor))n=e;else{var i=Ae(e);n=i===Object.prototype?{}:Object.create(i),ze.set(e,n);for(var a in e)$(e,a)&&(n[a]=In(e[a]))}return n}var Or={}.toString;function Rn(e){return Or.call(e).slice(8,-1)}var Bn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Dr=typeof Bn=="symbol"?function(e){var n;return e!=null&&(n=e[Bn])&&n.apply(e)}:function(){return null};function ge(e,n){var t=e.indexOf(n);return t>=0&&e.splice(t,1),t>=0}var Ce={};function ie(e){var n,t,r,i;if(arguments.length===1){if(N(e))return e.slice();if(this===Ce&&typeof e=="string")return[e];if(i=Dr(e)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(e==null)return[e];if(n=e.length,typeof n=="number"){for(t=new Array(n);n--;)t[n]=e[n];return t}return[e]}for(n=arguments.length,t=new Array(n);n--;)t[n]=arguments[n];return t}var Mn=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Cr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],It=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Fn=Cr.concat(It),Pr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Pe(e,n){this.name=e,this.message=n}De(Pe).from(Error).extend({toString:function(){return this.name+": "+this.message}});function Rt(e,n){return e+". Errors: "+Object.keys(n).map(function(t){return n[t].toString()}).filter(function(t,r,i){return i.indexOf(t)===r}).join(`
`)}function un(e,n,t,r){this.failures=n,this.failedKeys=r,this.successCount=t,this.message=Rt(e,n)}De(un).from(Pe);function Te(e,n){this.name="BulkError",this.failures=Object.keys(n).map(function(t){return n[t]}),this.failuresByPos=n,this.message=Rt(e,this.failures)}De(Te).from(Pe);var jn=Fn.reduce(function(e,n){return e[n]=n+"Error",e},{}),Tr=Pe,O=Fn.reduce(function(e,n){var t=n+"Error";function r(i,a){this.name=t,i?typeof i=="string"?(this.message="".concat(i).concat(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=Pr[n]||t,this.inner=null)}return De(r).from(Tr),e[n]=r,e},{});O.Syntax=SyntaxError,O.Type=TypeError,O.Range=RangeError;var Bt=It.reduce(function(e,n){return e[n+"Error"]=O[n],e},{});function Ir(e,n){if(!e||e instanceof Pe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Bt[e.name])return e;var t=new Bt[e.name](n||e.message,e);return"stack"in e&&se(t,"stack",{get:function(){return this.inner.stack}}),t}var on=Fn.reduce(function(e,n){return["Syntax","Type","Range"].indexOf(n)===-1&&(e[n+"Error"]=O[n]),e},{});on.ModifyError=un,on.DexieError=Pe,on.BulkError=Te;function F(){}function We(e){return e}function Rr(e,n){return e==null||e===We?n:function(t){return n(e(t))}}function be(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function Br(e,n){return e===F?n:function(){var t=e.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?be(r,this.onsuccess):r),i&&(this.onerror=this.onerror?be(i,this.onerror):i),a!==void 0?a:t}}function Mr(e,n){return e===F?n:function(){e.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?be(t,this.onsuccess):t),r&&(this.onerror=this.onerror?be(r,this.onerror):r)}}function Fr(e,n){return e===F?n:function(t){var r=e.apply(this,arguments);H(t,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?be(i,this.onsuccess):i),a&&(this.onerror=this.onerror?be(a,this.onerror):a),r===void 0?u===void 0?void 0:u:H(r,u)}}function jr(e,n){return e===F?n:function(){return n.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function Nn(e,n){return e===F?n:function(){var t=e.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return t.then(function(){return n.apply(r,a)})}return n.apply(this,arguments)}}var ne=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Mt(e,n){ne=e}var Ue={},Ft=100,Ln=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Ae(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,Ae(n),e]}(),jt=Ln[0],Nt=Ln[1],Nr=Ln[2],Lr=Nt&&Nt.then,Ye=jt&&jt.constructor,Vn=!!Nr;function Vr(){queueMicrotask(Wr)}var $e=function(e,n){He.push([e,n]),sn&&(Vr(),sn=!1)},zn=!0,sn=!0,we=[],cn=[],Wn=We,le={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:F,pgp:!1,env:{},finalize:F},S=le,He=[],_e=0,ln=[];function E(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var n=this._PSD=S;if(typeof e!="function"){if(e!==Ue)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Yn(this,this._value);return}this._state=null,this._value=null,++n.ref,Vt(this,e)}var Un={get:function(){var e=S,n=vn;function t(r,i){var a=this,u=!e.global&&(e!==S||n!==vn),o=u&&!he(),s=new E(function(c,h){$n(a,new Lt(Ut(r,e,u,o),Ut(i,e,u,o),c,h,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return t.prototype=Ue,t},set:function(e){se(this,"then",e&&e.prototype===Ue?Un:{get:function(){return e},set:Un.set})}};Oe(E.prototype,{then:Un,_then:function(e,n){$n(this,new Lt(null,null,e,n,S))},catch:function(e){if(arguments.length===1)return this.then(null,e);var n=arguments[0],t=arguments[1];return typeof n=="function"?this.then(null,function(r){return r instanceof n?t(r):fn(r)}):this.then(null,function(r){return r&&r.name===n?t(r):fn(r)})},finally:function(e){return this.then(function(n){return E.resolve(e()).then(function(){return n})},function(n){return E.resolve(e()).then(function(){return fn(n)})})},timeout:function(e,n){var t=this;return e<1/0?new E(function(r,i){var a=setTimeout(function(){return i(new O.Timeout(n))},e);t.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&se(E.prototype,Symbol.toStringTag,"Dexie.Promise"),le.env=Wt();function Lt(e,n,t,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof n=="function"?n:null,this.resolve=t,this.reject=r,this.psd=i}Oe(E,{all:function(){var e=ie.apply(null,arguments).map(pn);return new E(function(n,t){e.length===0&&n([]);var r=e.length;e.forEach(function(i,a){return E.resolve(i).then(function(u){e[a]=u,--r||n(e)},t)})})},resolve:function(e){if(e instanceof E)return e;if(e&&typeof e.then=="function")return new E(function(t,r){e.then(t,r)});var n=new E(Ue,!0,e);return n},reject:fn,race:function(){var e=ie.apply(null,arguments).map(pn);return new E(function(n,t){e.map(function(r){return E.resolve(r).then(n,t)})})},PSD:{get:function(){return S},set:function(e){return S=e}},totalEchoes:{get:function(){return vn}},newPSD:fe,usePSD:xe,scheduler:{get:function(){return $e},set:function(e){$e=e}},rejectionMapper:{get:function(){return Wn},set:function(e){Wn=e}},follow:function(e,n){return new E(function(t,r){return fe(function(i,a){var u=S;u.unhandleds=[],u.onunhandled=a,u.finalize=be(function(){var o=this;Ur(function(){o.unhandleds.length===0?i():a(o.unhandleds[0])})},u.finalize),e()},n,t,r)})}}),Ye&&(Ye.allSettled&&se(E,"allSettled",function(){var e=ie.apply(null,arguments).map(pn);return new E(function(n){e.length===0&&n([]);var t=e.length,r=new Array(t);e.forEach(function(i,a){return E.resolve(i).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--t||n(r)})})})}),Ye.any&&typeof AggregateError<"u"&&se(E,"any",function(){var e=ie.apply(null,arguments).map(pn);return new E(function(n,t){e.length===0&&t(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,u){return E.resolve(a).then(function(o){return n(o)},function(o){i[u]=o,--r||t(new AggregateError(i))})})})}));function Vt(e,n){try{n(function(t){if(e._state===null){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Ie();t&&typeof t.then=="function"?Vt(e,function(i,a){t instanceof E?t._then(i,a):t.then(i,a)}):(e._state=!0,e._value=t,zt(e)),r&&Re()}},Yn.bind(null,e))}catch(t){Yn(e,t)}}function Yn(e,n){if(cn.push(n),e._state===null){var t=e._lib&&Ie();n=Wn(n),e._state=!1,e._value=n,Yr(e),zt(e),t&&Re()}}function zt(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)$n(e,n[t]);var i=e._PSD;--i.ref||i.finalize(),_e===0&&(++_e,$e(function(){--_e===0&&Hn()},[]))}function $n(e,n){if(e._state===null){e._listeners.push(n);return}var t=e._state?n.onFulfilled:n.onRejected;if(t===null)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++_e,$e(zr,[t,e,n])}function zr(e,n,t){try{var r,i=n._value;!n._state&&cn.length&&(cn=[]),r=ne&&n._consoleTask?n._consoleTask.run(function(){return e(i)}):e(i),!n._state&&cn.indexOf(i)===-1&&$r(n),t.resolve(r)}catch(a){t.reject(a)}finally{--_e===0&&Hn(),--t.psd.ref||t.psd.finalize()}}function Wr(){xe(le,function(){Ie()&&Re()})}function Ie(){var e=zn;return zn=!1,sn=!1,e}function Re(){var e,n,t;do for(;He.length>0;)for(e=He,He=[],t=e.length,n=0;n<t;++n){var r=e[n];r[0].apply(null,r[1])}while(He.length>0);zn=!0,sn=!0}function Hn(){var e=we;we=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var n=ln.slice(0),t=n.length;t;)n[--t]()}function Ur(e){function n(){e(),ln.splice(ln.indexOf(n),1)}ln.push(n),++_e,$e(function(){--_e===0&&Hn()},[])}function Yr(e){we.some(function(n){return n._value===e._value})||we.push(e)}function $r(e){for(var n=we.length;n;)if(we[--n]._value===e._value){we.splice(n,1);return}}function fn(e){return new E(Ue,!1,e)}function j(e,n){var t=S;return function(){var r=Ie(),i=S;try{return de(t,!0),e.apply(this,arguments)}catch(a){n&&n(a)}finally{de(i,!1),r&&Re()}}}var W={awaits:0,echoes:0,id:0},Hr=0,hn=[],dn=0,vn=0,Qr=0;function fe(e,n,t,r){var i=S,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++Qr,le.env,a.env=Vn?{Promise:E,PromiseProp:{value:E,configurable:!0,writable:!0},all:E.all,race:E.race,allSettled:E.allSettled,any:E.any,resolve:E.resolve,reject:E.reject}:{},n&&H(a,n),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=xe(a,e,t,r);return a.ref===0&&a.finalize(),u}function Be(){return W.id||(W.id=++Hr),++W.awaits,W.echoes+=Ft,W.id}function he(){return W.awaits?(--W.awaits===0&&(W.id=0),W.echoes=W.awaits*Ft,!0):!1}(""+Lr).indexOf("[native code]")===-1&&(Be=he=F);function pn(e){return W.echoes&&e&&e.constructor===Ye?(Be(),e.then(function(n){return he(),n},function(n){return he(),L(n)})):e}function Gr(e){++vn,(!W.echoes||--W.echoes===0)&&(W.echoes=W.awaits=W.id=0),hn.push(S),de(e,!0)}function Xr(){var e=hn[hn.length-1];hn.pop(),de(e,!1)}function de(e,n){var t=S;if((n?W.echoes&&(!dn++||e!==S):dn&&(!--dn||e!==S))&&queueMicrotask(n?Gr.bind(null,e):Xr),e!==S&&(S=e,t===le&&(le.env=Wt()),Vn)){var r=le.env.Promise,i=e.env;(t.global||e.global)&&(Object.defineProperty(U,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Wt(){var e=U.Promise;return Vn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(U,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function xe(e,n,t,r,i){var a=S;try{return de(e,!0),n(t,r,i)}finally{de(a,!1)}}function Ut(e,n,t,r){return typeof e!="function"?e:function(){var i=S;t&&Be(),de(n,!0);try{return e.apply(this,arguments)}finally{de(i,!1),r&&queueMicrotask(he)}}}function Qn(e){Promise===Ye&&W.echoes===0?dn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}var L=E.reject;function Gn(e,n,t,r){if(!e.idbdb||!e._state.openComplete&&!S.letThrough&&!e._vip){if(e._state.openComplete)return L(new O.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return L(new O.DatabaseClosed);e.open().catch(F)}return e._state.dbReadyPromise.then(function(){return Gn(e,n,t,r)})}else{var i=e._createTransaction(n,t,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(a){return a.name===jn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return Gn(e,n,t,r)})):L(a)}return i._promise(n,function(a,u){return fe(function(){return S.trans=i,r(a,u,i)})}).then(function(a){if(n==="readwrite")try{i.idbtrans.commit()}catch{}return n==="readonly"?a:i._completion.then(function(){return a})})}}var Yt="4.0.5",Ee="\uFFFF",Xn=-1/0,ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",$t="String expected.",Me=[],yn="__dbnames",Jn="readonly",Zn="readwrite";function ke(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var Ht={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function mn(e){return typeof e=="string"&&!/\./.test(e)?function(n){return n[e]===void 0&&e in n&&(n=ce(n),delete n[e]),n}:function(n){return n}}function Qt(){throw O.Type()}function B(e,n){try{var t=Gt(e),r=Gt(n);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return e>n?1:e<n?-1:0;case"binary":return Zr(Xt(e),Xt(n));case"Array":return Jr(e,n)}}catch{}return NaN}function Jr(e,n){for(var t=e.length,r=n.length,i=t<r?t:r,a=0;a<i;++a){var u=B(e[a],n[a]);if(u!==0)return u}return t===r?0:t<r?-1:1}function Zr(e,n){for(var t=e.length,r=n.length,i=t<r?t:r,a=0;a<i;++a)if(e[a]!==n[a])return e[a]<n[a]?-1:1;return t===r?0:t<r?-1:1}function Gt(e){var n=typeof e;if(n!=="object")return n;if(ArrayBuffer.isView(e))return"binary";var t=Rn(e);return t==="ArrayBuffer"?"binary":t}function Xt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Jt=function(){function e(){}return e.prototype._trans=function(n,t,r){var i=this._tx||S.trans,a=this.name,u=ne&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function o(h,l,v){if(!v.schema[a])throw new O.NotFound("Table "+a+" not part of transaction");return t(v.idbtrans,v)}var s=Ie();try{var c=i&&i.db._novip===this.db._novip?i===S.trans?i._promise(n,o,r):fe(function(){return i._promise(n,o,r)},{trans:i,transless:S.transless||S}):Gn(this.db,n,[this.name],o);return u&&(c._consoleTask=u,c=c.catch(function(h){return console.trace(h),L(h)})),c}finally{s&&Re()}},e.prototype.get=function(n,t){var r=this;return n&&n.constructor===Object?this.where(n).first(t):n==null?L(new O.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:n}).then(function(a){return r.hook.reading.fire(a)})}).then(t)},e.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(N(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var t=z(n);if(t.length===1)return this.where(t[0]).equals(n[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(l){if(l.compound&&t.every(function(_){return l.keyPath.indexOf(_)>=0})){for(var v=0;v<t.length;++v)if(t.indexOf(l.keyPath[v])===-1)return!1;return!0}return!1}).sort(function(l,v){return l.keyPath.length-v.keyPath.length})[0];if(r&&this.db._maxKey!==Ee){var i=r.keyPath.slice(0,t.length);return this.where(i).equals(i.map(function(l){return n[l]}))}!r&&ne&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var a=this.schema.idxByName,u=this.db._deps.indexedDB;function o(l,v){return u.cmp(l,v)===0}var s=t.reduce(function(l,v){var _=l[0],f=l[1],d=a[v],y=n[v];return[_||d,_||!d?ke(f,d&&d.multi?function(m){var b=re(m,v);return N(b)&&b.some(function(g){return o(y,g)})}:function(m){return o(y,re(m,v))}):f]},[null,null]),c=s[0],h=s[1];return c?this.where(c.name).equals(n[c.keyPath]).filter(h):r?this.filter(h):this.where(t).equals("")},e.prototype.filter=function(n){return this.toCollection().and(n)},e.prototype.count=function(n){return this.toCollection().count(n)},e.prototype.offset=function(n){return this.toCollection().offset(n)},e.prototype.limit=function(n){return this.toCollection().limit(n)},e.prototype.each=function(n){return this.toCollection().each(n)},e.prototype.toArray=function(n){return this.toCollection().toArray(n)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,N(n)?"[".concat(n.join("+"),"]"):n))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(n){var t=this,r=t.db,i=t.name;this.schema.mappedClass=n,n.prototype instanceof Qt&&(n=function(s){br(c,s);function c(){return s!==null&&s.apply(this,arguments)||this}return Object.defineProperty(c.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),c.prototype.table=function(){return i},c}(n));for(var a=new Set,u=n.prototype;u;u=Ae(u))Object.getOwnPropertyNames(u).forEach(function(s){return a.add(s)});var o=function(s){if(!s)return s;var c=Object.create(n.prototype);for(var h in s)if(!a.has(h))try{c[h]=s[h]}catch{}return c};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),n},e.prototype.defineClass=function(){function n(t){H(this,t)}return this.mapToClass(n)},e.prototype.add=function(n,t){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=n;return u&&a&&(o=mn(u)(n)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"add",keys:t!=null?[t]:null,values:[o]})}).then(function(s){return s.numFailures?E.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{Q(n,u,s)}catch{}return s})},e.prototype.update=function(n,t){if(typeof n=="object"&&!N(n)){var r=re(n,this.schema.primKey.keyPath);return r===void 0?L(new O.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(n).modify(t)},e.prototype.put=function(n,t){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=n;return u&&a&&(o=mn(u)(n)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"put",values:[o],keys:t!=null?[t]:null})}).then(function(s){return s.numFailures?E.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{Q(n,u,s)}catch{}return s})},e.prototype.delete=function(n){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[n]})}).then(function(r){return r.numFailures?E.reject(r.failures[0]):void 0})},e.prototype.clear=function(){var n=this;return this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"deleteRange",range:Ht})}).then(function(t){return t.numFailures?E.reject(t.failures[0]):void 0})},e.prototype.bulkGet=function(n){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:n,trans:r}).then(function(i){return i.map(function(a){return t.hook.reading.fire(a)})})})},e.prototype.bulkAdd=function(n,t,r){var i=this,a=Array.isArray(t)?t:void 0;r=r||(a?void 0:t);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,h=s.keyPath;if(h&&a)throw new O.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==n.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");var l=n.length,v=h&&c?n.map(mn(h)):n;return i.core.mutate({trans:o,type:"add",keys:a,values:v,wantResults:u}).then(function(_){var f=_.numFailures,d=_.results,y=_.lastResult,m=_.failures,b=u?d:y;if(f===0)return b;throw new Te("".concat(i.name,".bulkAdd(): ").concat(f," of ").concat(l," operations failed"),m)})})},e.prototype.bulkPut=function(n,t,r){var i=this,a=Array.isArray(t)?t:void 0;r=r||(a?void 0:t);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,h=s.keyPath;if(h&&a)throw new O.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==n.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");var l=n.length,v=h&&c?n.map(mn(h)):n;return i.core.mutate({trans:o,type:"put",keys:a,values:v,wantResults:u}).then(function(_){var f=_.numFailures,d=_.results,y=_.lastResult,m=_.failures,b=u?d:y;if(f===0)return b;throw new Te("".concat(i.name,".bulkPut(): ").concat(f," of ").concat(l," operations failed"),m)})})},e.prototype.bulkUpdate=function(n){var t=this,r=this.core,i=n.map(function(o){return o.key}),a=n.map(function(o){return o.changes}),u=[];return this._trans("readwrite",function(o){return r.getMany({trans:o,keys:i,cache:"clone"}).then(function(s){var c=[],h=[];n.forEach(function(v,_){var f=v.key,d=v.changes,y=s[_];if(y){for(var m=0,b=Object.keys(d);m<b.length;m++){var g=b[m],w=d[g];if(g===t.schema.primKey.keyPath){if(B(w,f)!==0)throw new O.Constraint("Cannot update primary key in bulkUpdate()")}else Q(y,g,w)}u.push(_),c.push(f),h.push(y)}});var l=c.length;return r.mutate({trans:o,type:"put",keys:c,values:h,updates:{keys:i,changeSpecs:a}}).then(function(v){var _=v.numFailures,f=v.failures;if(_===0)return l;for(var d=0,y=Object.keys(f);d<y.length;d++){var m=y[d],b=u[Number(m)];if(b!=null){var g=f[m];delete f[m],f[b]=g}}throw new Te("".concat(t.name,".bulkUpdate(): ").concat(_," of ").concat(l," operations failed"),f)})})})},e.prototype.bulkDelete=function(n){var t=this,r=n.length;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:n})}).then(function(i){var a=i.numFailures,u=i.lastResult,o=i.failures;if(a===0)return u;throw new Te("".concat(t.name,".bulkDelete(): ").concat(a," of ").concat(r," operations failed"),o)})},e}();function Qe(e){var n={},t=function(o,s){if(s){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return n[o].subscribe.apply(null,h),e}else if(typeof o=="string")return n[o]};t.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return t;function a(o,s,c){if(typeof o=="object")return u(o);s||(s=jr),c||(c=F);var h={subscribers:[],fire:c,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=s(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(v){return v!==l}),h.fire=h.subscribers.reduce(s,c)}};return n[o]=t[o]=h,h}function u(o){z(o).forEach(function(s){var c=o[s];if(N(c))a(s,o[s][0],o[s][1]);else if(c==="asap")var h=a(s,We,function(){for(var v=arguments.length,_=new Array(v);v--;)_[v]=arguments[v];h.subscribers.forEach(function(f){Ot(function(){f.apply(null,_)})})});else throw new O.InvalidArgument("Invalid event config")})}}function Ge(e,n){return De(n).from({prototype:e}),n}function qr(e){return Ge(Jt.prototype,function(t,r,i){this.db=e,this._tx=i,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:Qe(null,{creating:[Br,F],reading:[Rr,We],updating:[Fr,F],deleting:[Mr,F]})})}function Fe(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function qn(e,n){e.filter=ke(e.filter,n)}function et(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return ke(r(),n())}:n,e.justLimit=t&&!r}function ei(e,n){e.isMatch=ke(e.isMatch,n)}function gn(e,n){if(e.isPrimKey)return n.primaryKey;var t=n.getIndexByKeyPath(e.index);if(!t)throw new O.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return t}function Zt(e,n,t){var r=gn(e,n.schema);return n.openCursor({trans:t,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function bn(e,n,t,r){var i=e.replayFilter?ke(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},u=function(o,s,c){if(!i||i(s,c,function(v){return s.stop(v)},function(v){return s.fail(v)})){var h=s.primaryKey,l=""+h;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),$(a,l)||(a[l]=!0,n(o,s,c))}};return Promise.all([e.or._iterate(u,t),qt(Zt(e,r,t),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}else return qt(Zt(e,r,t),ke(e.algorithm,i),n,!e.keysOnly&&e.valueMapper)}function qt(e,n,t,r){var i=r?function(u,o,s){return t(r(u),o,s)}:t,a=j(i);return e.then(function(u){if(u)return u.start(function(){var o=function(){return u.continue()};(!n||n(u,function(s){return o=s},function(s){u.stop(s),o=F},function(s){u.fail(s),o=F}))&&a(u.value,u,function(s){return o=s}),o()})})}var er=function(){function e(n){Object.assign(this,n)}return e.prototype.execute=function(n){var t;if(this.add!==void 0){var r=this.add;if(N(r))return rn(rn([],N(n)?n:[],!0),r).sort();if(typeof r=="number")return(Number(n)||0)+r;if(typeof r=="bigint")try{return BigInt(n)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(this.remove!==void 0){var i=this.remove;if(N(i))return N(n)?n.filter(function(u){return!i.includes(u)}).sort():[];if(typeof i=="number")return Number(n)-i;if(typeof i=="bigint")try{return BigInt(n)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}var a=(t=this.replacePrefix)===null||t===void 0?void 0:t[0];return a&&typeof n=="string"&&n.startsWith(a)?this.replacePrefix[1]+n.substring(a.length):n},e}(),ni=function(){function e(){}return e.prototype._read=function(n,t){var r=this._ctx;return r.error?r.table._trans(null,L.bind(null,r.error)):r.table._trans("readonly",n).then(t)},e.prototype._write=function(n){var t=this._ctx;return t.error?t.table._trans(null,L.bind(null,t.error)):t.table._trans("readwrite",n,"locked")},e.prototype._addAlgorithm=function(n){var t=this._ctx;t.algorithm=ke(t.algorithm,n)},e.prototype._iterate=function(n,t){return bn(this._ctx,n,t,this._ctx.table.core)},e.prototype.clone=function(n){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return n&&H(r,n),t._ctx=r,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(n){var t=this._ctx;return this._read(function(r){return bn(t,n,r,t.table.core)})},e.prototype.count=function(n){var t=this;return this._read(function(r){var i=t._ctx,a=i.table.core;if(Fe(i,!0))return a.count({trans:r,query:{index:gn(i,a.schema),range:i.range}}).then(function(o){return Math.min(o,i.limit)});var u=0;return bn(i,function(){return++u,!1},r,a).then(function(){return u})}).then(n)},e.prototype.sortBy=function(n,t){var r=n.split(".").reverse(),i=r[0],a=r.length-1;function u(c,h){return h?u(c[r[h]],h-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function s(c,h){var l=u(c,a),v=u(h,a);return l<v?-o:l>v?o:0}return this.toArray(function(c){return c.sort(s)}).then(t)},e.prototype.toArray=function(n){var t=this;return this._read(function(r){var i=t._ctx;if(i.dir==="next"&&Fe(i,!0)&&i.limit>0){var a=i.valueMapper,u=gn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:u,range:i.range}}).then(function(s){var c=s.result;return a?c.map(a):c})}else{var o=[];return bn(i,function(s){return o.push(s)},r,i.table.core).then(function(){return o})}},n)},e.prototype.offset=function(n){var t=this._ctx;return n<=0?this:(t.offset+=n,Fe(t)?et(t,function(){var r=n;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):et(t,function(){var r=n;return function(){return--r<0}}),this)},e.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),et(this._ctx,function(){var t=n;return function(r,i,a){return--t<=0&&i(a),t>=0}},!0),this},e.prototype.until=function(n,t){return qn(this._ctx,function(r,i,a){return n(r.value)?(i(a),t):!0}),this},e.prototype.first=function(n){return this.limit(1).toArray(function(t){return t[0]}).then(n)},e.prototype.last=function(n){return this.reverse().first(n)},e.prototype.filter=function(n){return qn(this._ctx,function(t){return n(t.value)}),ei(this._ctx,n),this},e.prototype.and=function(n){return this.filter(n)},e.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(n){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){n(i.key,i)})},e.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},e.prototype.eachPrimaryKey=function(n){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){n(i.primaryKey,i)})},e.prototype.keys=function(n){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(n)},e.prototype.primaryKeys=function(n){var t=this._ctx;if(t.dir==="next"&&Fe(t,!0)&&t.limit>0)return this._read(function(i){var a=gn(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:a,range:t.range}})}).then(function(i){var a=i.result;return a}).then(n);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(n)},e.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},e.prototype.firstKey=function(n){return this.limit(1).keys(function(t){return t[0]}).then(n)},e.prototype.lastKey=function(n){return this.reverse().firstKey(n)},e.prototype.distinct=function(){var n=this._ctx,t=n.index&&n.table.schema.idxByName[n.index];if(!t||!t.multi)return this;var r={};return qn(this._ctx,function(i){var a=i.primaryKey.toString(),u=$(r,a);return r[a]=!0,!u}),this},e.prototype.modify=function(n){var t=this,r=this._ctx;return this._write(function(i){var a;if(typeof n=="function")a=n;else{var u=z(n),o=u.length;a=function(m){for(var b=!1,g=0;g<o;++g){var w=u[g],p=n[w],x=re(m,w);p instanceof er?(Q(m,w,p.execute(x)),b=!0):x!==p&&(Q(m,w,p),b=!0)}return b}}var s=r.table.core,c=s.schema.primaryKey,h=c.outbound,l=c.extractKey,v=t.db._options.modifyChunkSize||200,_=[],f=0,d=[],y=function(m,b){var g=b.failures,w=b.numFailures;f+=m-w;for(var p=0,x=z(g);p<x.length;p++){var k=x[p];_.push(g[k])}};return t.clone().primaryKeys().then(function(m){var b=function(g){var w=Math.min(v,m.length-g);return s.getMany({trans:i,keys:m.slice(g,g+w),cache:"immutable"}).then(function(p){for(var x=[],k=[],K=h?[]:null,A=[],T=0;T<w;++T){var C=p[T],R={value:ce(C),primKey:m[g+T]};a.call(R,R.value,R)!==!1&&(R.value==null?A.push(m[g+T]):!h&&B(l(C),l(R.value))!==0?(A.push(m[g+T]),x.push(R.value)):(k.push(R.value),h&&K.push(m[g+T])))}var P=Fe(r)&&r.limit===1/0&&(typeof n!="function"||n===nt)&&{index:r.index,range:r.range};return Promise.resolve(x.length>0&&s.mutate({trans:i,type:"add",values:x}).then(function(M){for(var D in M.failures)A.splice(parseInt(D),1);y(x.length,M)})).then(function(){return(k.length>0||P&&typeof n=="object")&&s.mutate({trans:i,type:"put",keys:K,values:k,criteria:P,changeSpec:typeof n!="function"&&n}).then(function(M){return y(k.length,M)})}).then(function(){return(A.length>0||P&&n===nt)&&s.mutate({trans:i,type:"delete",keys:A,criteria:P}).then(function(M){return y(A.length,M)})}).then(function(){return m.length>g+w&&b(g+v)})})};return b(0).then(function(){if(_.length>0)throw new un("Error modifying one or more objects",_,f,d);return m.length})})})},e.prototype.delete=function(){var n=this._ctx,t=n.range;return Fe(n)&&(n.isPrimKey||t.type===3)?this._write(function(r){var i=n.table.core.schema.primaryKey,a=t;return n.table.core.count({trans:r,query:{index:i,range:a}}).then(function(u){return n.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(o){var s=o.failures;o.lastResult,o.results;var c=o.numFailures;if(c)throw new un("Could not delete some values",Object.keys(s).map(function(h){return s[h]}),u-c);return u-c})})}):this.modify(nt)},e}(),nt=function(e,n){return n.value=null};function ti(e){return Ge(ni.prototype,function(t,r){this.db=e;var i=Ht,a=null;if(r)try{i=r()}catch(c){a=c}var u=t._ctx,o=u.table,s=o.hook.reading.fire;this._ctx={table:o,index:u.index,isPrimKey:!u.index||o.schema.primKey.keyPath&&u.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:u.or,valueMapper:s!==We?s:null}})}function ri(e,n){return e<n?-1:e===n?0:1}function ii(e,n){return e>n?-1:e===n?0:1}function G(e,n,t){var r=e instanceof tr?new e.Collection(e):e;return r._ctx.error=t?new t(n):new TypeError(n),r}function je(e){return new e.Collection(e,function(){return nr("")}).limit(0)}function ai(e){return e==="next"?function(n){return n.toUpperCase()}:function(n){return n.toLowerCase()}}function ui(e){return e==="next"?function(n){return n.toLowerCase()}:function(n){return n.toUpperCase()}}function oi(e,n,t,r,i,a){for(var u=Math.min(e.length,r.length),o=-1,s=0;s<u;++s){var c=n[s];if(c!==r[s])return i(e[s],t[s])<0?e.substr(0,s)+t[s]+t.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+t.substr(s+1):o>=0?e.substr(0,o)+n[o]+t.substr(o+1):null;i(e[s],c)<0&&(o=s)}return u<r.length&&a==="next"?e+t.substr(e.length):u<e.length&&a==="prev"?e.substr(0,t.length):o<0?null:e.substr(0,o)+r[o]+t.substr(o+1)}function wn(e,n,t,r){var i,a,u,o,s,c,h,l=t.length;if(!t.every(function(d){return typeof d=="string"}))return G(e,$t);function v(d){i=ai(d),a=ui(d),u=d==="next"?ri:ii;var y=t.map(function(m){return{lower:a(m),upper:i(m)}}).sort(function(m,b){return u(m.lower,b.lower)});o=y.map(function(m){return m.upper}),s=y.map(function(m){return m.lower}),c=d,h=d==="next"?"":r}v("next");var _=new e.Collection(e,function(){return ve(o[0],s[l-1]+r)});_._ondirectionchange=function(d){v(d)};var f=0;return _._addAlgorithm(function(d,y,m){var b=d.key;if(typeof b!="string")return!1;var g=a(b);if(n(g,s,f))return!0;for(var w=null,p=f;p<l;++p){var x=oi(b,g,o[p],s[p],u,c);x===null&&w===null?f=p+1:(w===null||u(w,x)>0)&&(w=x)}return y(w!==null?function(){d.continue(w+h)}:m),!1}),_}function ve(e,n,t,r){return{type:2,lower:e,upper:n,lowerOpen:t,upperOpen:r}}function nr(e){return{type:1,lower:e,upper:e}}var tr=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(n,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(n,t)>0||this._cmp(n,t)===0&&(r||i)&&!(r&&i)?je(this):new this.Collection(this,function(){return ve(n,t,!r,!i)})}catch{return G(this,ae)}},e.prototype.equals=function(n){return n==null?G(this,ae):new this.Collection(this,function(){return nr(n)})},e.prototype.above=function(n){return n==null?G(this,ae):new this.Collection(this,function(){return ve(n,void 0,!0)})},e.prototype.aboveOrEqual=function(n){return n==null?G(this,ae):new this.Collection(this,function(){return ve(n,void 0,!1)})},e.prototype.below=function(n){return n==null?G(this,ae):new this.Collection(this,function(){return ve(void 0,n,!1,!0)})},e.prototype.belowOrEqual=function(n){return n==null?G(this,ae):new this.Collection(this,function(){return ve(void 0,n)})},e.prototype.startsWith=function(n){return typeof n!="string"?G(this,$t):this.between(n,n+Ee,!0,!0)},e.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):wn(this,function(t,r){return t.indexOf(r[0])===0},[n],Ee)},e.prototype.equalsIgnoreCase=function(n){return wn(this,function(t,r){return t===r[0]},[n],"")},e.prototype.anyOfIgnoreCase=function(){var n=ie.apply(Ce,arguments);return n.length===0?je(this):wn(this,function(t,r){return r.indexOf(t)!==-1},n,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var n=ie.apply(Ce,arguments);return n.length===0?je(this):wn(this,function(t,r){return r.some(function(i){return t.indexOf(i)===0})},n,Ee)},e.prototype.anyOf=function(){var n=this,t=ie.apply(Ce,arguments),r=this._cmp;try{t.sort(r)}catch{return G(this,ae)}if(t.length===0)return je(this);var i=new this.Collection(this,function(){return ve(t[0],t[t.length-1])});i._ondirectionchange=function(u){r=u==="next"?n._ascending:n._descending,t.sort(r)};var a=0;return i._addAlgorithm(function(u,o,s){for(var c=u.key;r(c,t[a])>0;)if(++a,a===t.length)return o(s),!1;return r(c,t[a])===0?!0:(o(function(){u.continue(t[a])}),!1)}),i},e.prototype.notEqual=function(n){return this.inAnyRange([[Xn,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var n=ie.apply(Ce,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return G(this,ae)}var t=n.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Xn,i]]},null);return t.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(n,t){var r=this,i=this._cmp,a=this._ascending,u=this._descending,o=this._min,s=this._max;if(n.length===0)return je(this);if(!n.every(function(p){return p[0]!==void 0&&p[1]!==void 0&&a(p[0],p[1])<=0}))return G(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",O.InvalidArgument);var c=!t||t.includeLowers!==!1,h=t&&t.includeUppers===!0;function l(p,x){for(var k=0,K=p.length;k<K;++k){var A=p[k];if(i(x[0],A[1])<0&&i(x[1],A[0])>0){A[0]=o(A[0],x[0]),A[1]=s(A[1],x[1]);break}}return k===K&&p.push(x),p}var v=a;function _(p,x){return v(p[0],x[0])}var f;try{f=n.reduce(l,[]),f.sort(_)}catch{return G(this,ae)}var d=0,y=h?function(p){return a(p,f[d][1])>0}:function(p){return a(p,f[d][1])>=0},m=c?function(p){return u(p,f[d][0])>0}:function(p){return u(p,f[d][0])>=0};function b(p){return!y(p)&&!m(p)}var g=y,w=new this.Collection(this,function(){return ve(f[0][0],f[f.length-1][1],!c,!h)});return w._ondirectionchange=function(p){p==="next"?(g=y,v=a):(g=m,v=u),f.sort(_)},w._addAlgorithm(function(p,x,k){for(var K=p.key;g(K);)if(++d,d===f.length)return x(k),!1;return b(K)?!0:(r._cmp(K,f[d][1])===0||r._cmp(K,f[d][0])===0||x(function(){v===a?p.continue(f[d][0]):p.continue(f[d][1])}),!1)}),w},e.prototype.startsWithAnyOf=function(){var n=ie.apply(Ce,arguments);return n.every(function(t){return typeof t=="string"})?n.length===0?je(this):this.inAnyRange(n.map(function(t){return[t,t+Ee]})):G(this,"startsWithAnyOf() only works with strings")},e}();function si(e){return Ge(tr.prototype,function(t,r,i){if(this.db=e,this._ctx={table:t,index:r===":id"?null:r,or:i},this._cmp=this._ascending=B,this._descending=function(a,u){return B(u,a)},this._max=function(a,u){return B(a,u)>0?a:u},this._min=function(a,u){return B(a,u)<0?a:u},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new O.MissingAPI})}function te(e){return j(function(n){return Xe(n),e(n.target.error),!1})}function Xe(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Je="storagemutated",tt="x-storagemutated-1",pe=Qe(null,Je),ci=function(){function e(){}return e.prototype._lock=function(){return Ve(!S.global),++this._reculock,this._reculock===1&&!S.global&&(S.lockOwnerFor=this),this},e.prototype._unlock=function(){if(Ve(!S.global),--this._reculock===0)for(S.global||(S.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var n=this._blockedFuncs.shift();try{xe(n[1],n[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&S.lockOwnerFor!==this},e.prototype.create=function(n){var t=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Ve(!this.idbtrans),!n&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new O.DatabaseClosed(i);case"MissingAPIError":throw new O.MissingAPI(i.message,i);default:throw new O.OpenFailed(i)}if(!this.active)throw new O.TransactionInactive;return Ve(this._completion._state===null),n=this.idbtrans=n||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),n.onerror=j(function(a){Xe(a),t._reject(n.error)}),n.onabort=j(function(a){Xe(a),t.active&&t._reject(new O.Abort(n.error)),t.active=!1,t.on("abort").fire(a)}),n.oncomplete=j(function(){t.active=!1,t._resolve(),"mutatedParts"in n&&pe.storagemutated.fire(n.mutatedParts)}),this},e.prototype._promise=function(n,t,r){var i=this;if(n==="readwrite"&&this.mode!=="readwrite")return L(new O.ReadOnly("Transaction is readonly"));if(!this.active)return L(new O.TransactionInactive);if(this._locked())return new E(function(u,o){i._blockedFuncs.push([function(){i._promise(n,t,r).then(u,o)},S])});if(r)return fe(function(){var u=new E(function(o,s){i._lock();var c=t(o,s,i);c&&c.then&&c.then(o,s)});return u.finally(function(){return i._unlock()}),u._lib=!0,u});var a=new E(function(u,o){var s=t(u,o,i);s&&s.then&&s.then(u,o)});return a._lib=!0,a},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(n){var t=this._root(),r=E.resolve(n);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return r});else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function u(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var a=t._waitingFor;return new E(function(u,o){r.then(function(s){return t._waitingQueue.push(j(u.bind(null,s)))},function(s){return t._waitingQueue.push(j(o.bind(null,s)))}).finally(function(){t._waitingFor===a&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new O.Abort))},e.prototype.table=function(n){var t=this._memoizedTables||(this._memoizedTables={});if($(t,n))return t[n];var r=this.schema[n];if(!r)throw new O.NotFound("Table "+n+" not part of transaction");var i=new this.db.Table(n,r,this);return i.core=this.db.core.table(n),t[n]=i,i},e}();function li(e){return Ge(ci.prototype,function(t,r,i,a,u){var o=this;this.db=e,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=Qe(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new E(function(s,c){o._resolve=s,o._reject=c}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(s){var c=o.active;return o.active=!1,o.on.error.fire(s),o.parent?o.parent._reject(s):c&&o.idbtrans&&o.idbtrans.abort(),L(s)})})}function rt(e,n,t,r,i,a,u){return{name:e,keyPath:n,unique:t,multi:r,auto:i,compound:a,src:(t&&!u?"&":"")+(r?"*":"")+(i?"++":"")+rr(n)}}function rr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function it(e,n,t){return{name:e,primKey:n,indexes:t,mappedClass:null,idxByName:Er(t,function(r){return[r.name,r]})}}function fi(e){return e.length===1?e[0]:e}var Ze=function(e){try{return e.only([[]]),Ze=function(){return[[]]},[[]]}catch{return Ze=function(){return Ee},Ee}};function at(e){return e==null?function(){}:typeof e=="string"?hi(e):function(n){return re(n,e)}}function hi(e){var n=e.split(".");return n.length===1?function(t){return t[e]}:function(t){return re(t,e)}}function ir(e){return[].slice.call(e)}var di=0;function qe(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function vi(e,n,t){function r(l,v){var _=ir(l.objectStoreNames);return{schema:{name:l.name,tables:_.map(function(f){return v.objectStore(f)}).map(function(f){var d=f.keyPath,y=f.autoIncrement,m=N(d),b=d==null,g={},w={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b,compound:m,keyPath:d,autoIncrement:y,unique:!0,extractKey:at(d)},indexes:ir(f.indexNames).map(function(p){return f.index(p)}).map(function(p){var x=p.name,k=p.unique,K=p.multiEntry,A=p.keyPath,T=N(A),C={name:x,compound:T,keyPath:A,unique:k,multiEntry:K,extractKey:at(A)};return g[qe(A)]=C,C}),getIndexByKeyPath:function(p){return g[qe(p)]}};return g[":id"]=w.primaryKey,d!=null&&(g[qe(d)]=w.primaryKey),w})},hasGetAll:_.length>0&&"getAll"in v.objectStore(_[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var v=l.lower,_=l.upper,f=l.lowerOpen,d=l.upperOpen,y=v===void 0?_===void 0?null:n.upperBound(_,!!d):_===void 0?n.lowerBound(v,!!f):n.bound(v,_,!!f,!!d);return y}function a(l){var v=l.name;function _(y){var m=y.trans,b=y.type,g=y.keys,w=y.values,p=y.range;return new Promise(function(x,k){x=j(x);var K=m.objectStore(v),A=K.keyPath==null,T=b==="put"||b==="add";if(!T&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);var C=(g||w||{length:1}).length;if(g&&w&&g.length!==w.length)throw new Error("Given keys array must have same length as given values array.");if(C===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});var R,P=[],M=[],D=0,V=function(ee){++D,Xe(ee)};if(b==="deleteRange"){if(p.type===4)return x({numFailures:D,failures:M,results:[],lastResult:void 0});p.type===3?P.push(R=K.clear()):P.push(R=K.delete(i(p)))}else{var J=T?A?[w,g]:[w,null]:[g,null],ue=J[0],q=J[1];if(T)for(var X=0;X<C;++X)P.push(R=q&&q[X]!==void 0?K[b](ue[X],q[X]):K[b](ue[X])),R.onerror=V;else for(var X=0;X<C;++X)P.push(R=K[b](ue[X])),R.onerror=V}var oe=function(ee){var Le=ee.target.result;P.forEach(function(Z,tn){return Z.error!=null&&(M[tn]=Z.error)}),x({numFailures:D,failures:M,results:b==="delete"?g:P.map(function(Z){return Z.result}),lastResult:Le})};R.onerror=function(ee){V(ee),oe(ee)},R.onsuccess=oe})}function f(y){var m=y.trans,b=y.values,g=y.query,w=y.reverse,p=y.unique;return new Promise(function(x,k){x=j(x);var K=g.index,A=g.range,T=m.objectStore(v),C=K.isPrimaryKey?T:T.index(K.name),R=w?p?"prevunique":"prev":p?"nextunique":"next",P=b||!("openKeyCursor"in C)?C.openCursor(i(A),R):C.openKeyCursor(i(A),R);P.onerror=te(k),P.onsuccess=j(function(M){var D=P.result;if(!D){x(null);return}D.___id=++di,D.done=!1;var V=D.continue.bind(D),J=D.continuePrimaryKey;J&&(J=J.bind(D));var ue=D.advance.bind(D),q=function(){throw new Error("Cursor not started")},X=function(){throw new Error("Cursor not stopped")};D.trans=m,D.stop=D.continue=D.continuePrimaryKey=D.advance=q,D.fail=j(k),D.next=function(){var oe=this,ee=1;return this.start(function(){return ee--?oe.continue():oe.stop()}).then(function(){return oe})},D.start=function(oe){var ee=new Promise(function(Z,tn){Z=j(Z),P.onerror=te(tn),D.fail=tn,D.stop=function(gr){D.stop=D.continue=D.continuePrimaryKey=D.advance=X,Z(gr)}}),Le=function(){if(P.result)try{oe()}catch(Z){D.fail(Z)}else D.done=!0,D.start=function(){throw new Error("Cursor behind last entry")},D.stop()};return P.onsuccess=j(function(Z){P.onsuccess=Le,Le()}),D.continue=V,D.continuePrimaryKey=J,D.advance=ue,Le(),ee},x(D)},k)})}function d(y){return function(m){return new Promise(function(b,g){b=j(b);var w=m.trans,p=m.values,x=m.limit,k=m.query,K=x===1/0?void 0:x,A=k.index,T=k.range,C=w.objectStore(v),R=A.isPrimaryKey?C:C.index(A.name),P=i(T);if(x===0)return b({result:[]});if(y){var M=p?R.getAll(P,K):R.getAllKeys(P,K);M.onsuccess=function(ue){return b({result:ue.target.result})},M.onerror=te(g)}else{var D=0,V=p||!("openKeyCursor"in R)?R.openCursor(P):R.openKeyCursor(P),J=[];V.onsuccess=function(ue){var q=V.result;if(!q)return b({result:J});if(J.push(p?q.value:q.primaryKey),++D===x)return b({result:J});q.continue()},V.onerror=te(g)}})}}return{name:v,schema:l,mutate:_,getMany:function(y){var m=y.trans,b=y.keys;return new Promise(function(g,w){g=j(g);for(var p=m.objectStore(v),x=b.length,k=new Array(x),K=0,A=0,T,C=function(D){var V=D.target;(k[V._pos]=V.result)!=null,++A===K&&g(k)},R=te(w),P=0;P<x;++P){var M=b[P];M!=null&&(T=p.get(b[P]),T._pos=P,T.onsuccess=C,T.onerror=R,++K)}K===0&&g(k)})},get:function(y){var m=y.trans,b=y.key;return new Promise(function(g,w){g=j(g);var p=m.objectStore(v),x=p.get(b);x.onsuccess=function(k){return g(k.target.result)},x.onerror=te(w)})},query:d(s),openCursor:f,count:function(y){var m=y.query,b=y.trans,g=m.index,w=m.range;return new Promise(function(p,x){var k=b.objectStore(v),K=g.isPrimaryKey?k:k.index(g.name),A=i(w),T=A?K.count(A):K.count();T.onsuccess=j(function(C){return p(C.target.result)}),T.onerror=te(x)})}}}var u=r(e,t),o=u.schema,s=u.hasGetAll,c=o.tables.map(function(l){return a(l)}),h={};return c.forEach(function(l){return h[l.name]=l}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(l){var v=h[l];if(!v)throw new Error("Table '".concat(l,"' not found"));return h[l]},MIN_KEY:-1/0,MAX_KEY:Ze(n),schema:o}}function pi(e,n){return n.reduce(function(t,r){var i=r.create;return I(I({},t),i(t))},e)}function yi(e,n,t,r){var i=t.IDBKeyRange;t.indexedDB;var a=pi(vi(n,i,r),e.dbcore);return{dbcore:a}}function _n(e,n){var t=n.db,r=yi(e._middlewares,t,e._deps,n);e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(u){return u.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function xn(e,n,t,r){t.forEach(function(i){var a=r[i];n.forEach(function(u){var o=St(u,i);(!o||"value"in o&&o.value===void 0)&&(u===e.Transaction.prototype||u instanceof e.Transaction?se(u,i,{get:function(){return this.table(i)},set:function(s){Kt(this,i,{value:s,writable:!0,configurable:!0,enumerable:!0})}}):u[i]=new e.Table(i,a))})})}function ut(e,n){n.forEach(function(t){for(var r in t)t[r]instanceof e.Table&&delete t[r]})}function mi(e,n){return e._cfg.version-n._cfg.version}function gi(e,n,t,r){var i=e._dbSchema;t.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=it("$meta",ur("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(t),a._completion.catch(r);var u=a._reject.bind(a),o=S.transless||S;fe(function(){if(S.trans=a,S.transless=o,n===0)z(i).forEach(function(s){st(t,s,i[s].primKey,i[s].indexes)}),_n(e,t),E.follow(function(){return e.on.populate.fire(a)}).catch(u);else return _n(e,t),wi(e,a,n).then(function(s){return _i(e,s,a,t)}).catch(u)})}function bi(e,n){ar(e._dbSchema,n),n.db.version%10===0&&!n.objectStoreNames.contains("$meta")&&n.db.createObjectStore("$meta").add(Math.ceil(n.db.version/10-1),"version");var t=kn(e,e.idbdb,n);Kn(e,e._dbSchema,n);for(var r=ot(t,e._dbSchema),i=function(c){if(c.change.length||c.recreate)return console.warn("Unable to patch indexes of table ".concat(c.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=n.objectStore(c.name);c.add.forEach(function(l){ne&&console.debug("Dexie upgrade patch: Creating missing index ".concat(c.name,".").concat(l.src)),En(h,l)})},a=0,u=r.change;a<u.length;a++){var o=u[a],s=i(o);if(typeof s=="object")return s.value}}function wi(e,n,t){return n.storeNames.includes("$meta")?n.table("$meta").get("version").then(function(r){return r??t}):E.resolve(t)}function _i(e,n,t,r){var i=[],a=e._versions,u=e._dbSchema=kn(e,e.idbdb,r),o=a.filter(function(c){return c._cfg.version>=n});if(o.length===0)return E.resolve();o.forEach(function(c){i.push(function(){var h=u,l=c._cfg.dbschema;Kn(e,h,r),Kn(e,l,r),u=e._dbSchema=l;var v=ot(h,l);v.add.forEach(function(b){st(r,b[0],b[1].primKey,b[1].indexes)}),v.change.forEach(function(b){if(b.recreate)throw new O.Upgrade("Not yet support for changing primary key");var g=r.objectStore(b.name);b.add.forEach(function(w){return En(g,w)}),b.change.forEach(function(w){g.deleteIndex(w.name),En(g,w)}),b.del.forEach(function(w){return g.deleteIndex(w)})});var _=c._cfg.contentUpgrade;if(_&&c._cfg.version>n){_n(e,r),t._memoizedTables={};var f=Dt(l);v.del.forEach(function(b){f[b]=h[b]}),ut(e,[e.Transaction.prototype]),xn(e,[e.Transaction.prototype],z(f),f),t.schema=f;var d=Mn(_);d&&Be();var y,m=E.follow(function(){if(y=_(t),y&&d){var b=he.bind(null,null);y.then(b,b)}});return y&&typeof y.then=="function"?E.resolve(y):m.then(function(){return y})}}),i.push(function(h){var l=c._cfg.dbschema;xi(l,h),ut(e,[e.Transaction.prototype]),xn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),t.schema=e._dbSchema}),i.push(function(h){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===c._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(l){return l!=="$meta"})):h.objectStore("$meta").put(c._cfg.version,"version"))})});function s(){return i.length?E.resolve(i.shift()(t.idbtrans)).then(s):E.resolve()}return s().then(function(){ar(u,r)})}function ot(e,n){var t={del:[],add:[],change:[]},r;for(r in e)n[r]||t.del.push(r);for(r in n){var i=e[r],a=n[r];if(!i)t.add.push([r,a]);else{var u={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)u.recreate=!0,t.change.push(u);else{var o=i.idxByName,s=a.idxByName,c=void 0;for(c in o)s[c]||u.del.push(c);for(c in s){var h=o[c],l=s[c];h?h.src!==l.src&&u.change.push(l):u.add.push(l)}(u.del.length>0||u.add.length>0||u.change.length>0)&&t.change.push(u)}}}return t}function st(e,n,t,r){var i=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(function(a){return En(i,a)}),i}function ar(e,n){z(e).forEach(function(t){n.db.objectStoreNames.contains(t)||(ne&&console.debug("Dexie: Creating missing table",t),st(n,t,e[t].primKey,e[t].indexes))})}function xi(e,n){[].slice.call(n.db.objectStoreNames).forEach(function(t){return e[t]==null&&n.db.deleteObjectStore(t)})}function En(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function kn(e,n,t){var r={},i=an(n.objectStoreNames,0);return i.forEach(function(a){for(var u=t.objectStore(a),o=u.keyPath,s=rt(rr(o),o||"",!0,!1,!!u.autoIncrement,o&&typeof o!="string",!0),c=[],h=0;h<u.indexNames.length;++h){var l=u.index(u.indexNames[h]);o=l.keyPath;var v=rt(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);c.push(v)}r[a]=it(a,s,c)}),r}function Ei(e,n,t){e.verno=n.version/10;var r=e._dbSchema=kn(e,n,t);e._storeNames=an(n.objectStoreNames,0),xn(e,[e._allTables],z(r),r)}function ki(e,n){var t=kn(e,e.idbdb,n),r=ot(t,e._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function Kn(e,n,t){for(var r=t.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],u=t.objectStore(a);e._hasGetAll="getAll"in u;for(var o=0;o<u.indexNames.length;++o){var s=u.indexNames[o],c=u.index(s).keyPath,h=typeof c=="string"?c:"["+an(c).join("+")+"]";if(n[a]){var l=n[a].idxByName[h];l&&(l.name=s,delete n[a].idxByName[h],n[a].idxByName[s]=l)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&U.WorkerGlobalScope&&U instanceof U.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function ur(e){return e.split(",").map(function(n,t){n=n.trim();var r=n.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return rt(r,i||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),N(i),t===0)})}var Ki=function(){function e(){}return e.prototype._parseStoresSpec=function(n,t){z(n).forEach(function(r){if(n[r]!==null){var i=ur(n[r]),a=i.shift();if(a.unique=!0,a.multi)throw new O.Schema("Primary key cannot be multi-valued");i.forEach(function(u){if(u.auto)throw new O.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new O.Schema("Index must have a name and cannot be an empty string")}),t[r]=it(r,a,i)}})},e.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?H(this._cfg.storesSource,n):n;var r=t._versions,i={},a={};return r.forEach(function(u){H(i,u._cfg.storesSource),a=u._cfg.dbschema={},u._parseStoresSpec(i,a)}),t._dbSchema=a,ut(t,[t._allTables,t,t.Transaction.prototype]),xn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],z(a),a),t._storeNames=z(a),this},e.prototype.upgrade=function(n){return this._cfg.contentUpgrade=Nn(this._cfg.contentUpgrade||F,n),this},e}();function Si(e){return Ge(Ki.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function ct(e,n){var t=e._dbNamesDB;return t||(t=e._dbNamesDB=new Ne(yn,{addons:[],indexedDB:e,IDBKeyRange:n}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function lt(e){return e&&typeof e.databases=="function"}function Ai(e){var n=e.indexedDB,t=e.IDBKeyRange;return lt(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==yn})}):ct(n,t).toCollection().primaryKeys()}function Oi(e,n){var t=e.indexedDB,r=e.IDBKeyRange;!lt(t)&&n!==yn&&ct(t,r).put({name:n}).catch(F)}function Di(e,n){var t=e.indexedDB,r=e.IDBKeyRange;!lt(t)&&n!==yn&&ct(t,r).delete(n).catch(F)}function ft(e){return fe(function(){return S.letThrough=!0,e()})}function Ci(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var n;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};n=setInterval(r,100),r()}).finally(function(){return clearInterval(n)})}var ht;function dt(e){return!("from"in e)}var Y=function(e,n){if(this)H(this,arguments.length?{d:1,from:e,to:arguments.length>1?n:e}:{d:0});else{var t=new Y;return e&&"d"in e&&H(t,e),t}};Oe(Y.prototype,(ht={add:function(e){return nn(this,e),this},addKey:function(e){return en(this,e,e),this},addKeys:function(e){var n=this;return e.forEach(function(t){return en(n,t,t)}),this}},ht[Bn]=function(){return vt(this)},ht));function en(e,n,t){var r=B(n,t);if(!isNaN(r)){if(r>0)throw RangeError();if(dt(e))return H(e,{from:n,to:t,d:1});var i=e.l,a=e.r;if(B(t,e.from)<0)return i?en(i,n,t):e.l={from:n,to:t,d:1,l:null,r:null},or(e);if(B(n,e.to)>0)return a?en(a,n,t):e.r={from:n,to:t,d:1,l:null,r:null},or(e);B(n,e.from)<0&&(e.from=n,e.l=null,e.d=a?a.d+1:1),B(t,e.to)>0&&(e.to=t,e.r=null,e.d=e.l?e.l.d+1:1);var u=!e.r;i&&!e.l&&nn(e,i),a&&u&&nn(e,a)}}function nn(e,n){function t(r,i){var a=i.from,u=i.to,o=i.l,s=i.r;en(r,a,u),o&&t(r,o),s&&t(r,s)}dt(n)||t(e,n)}function Sn(e,n){var t=vt(n),r=t.next();if(r.done)return!1;for(var i=r.value,a=vt(e),u=a.next(i.from),o=u.value;!r.done&&!u.done;){if(B(o.from,i.to)<=0&&B(o.to,i.from)>=0)return!0;B(i.from,o.from)<0?i=(r=t.next(o.from)).value:o=(u=a.next(i.from)).value}return!1}function vt(e){var n=dt(e)?null:{s:0,n:e};return{next:function(t){for(var r=arguments.length>0;n;)switch(n.s){case 0:if(n.s=1,r)for(;n.n.l&&B(t,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!r||B(t,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function or(e){var n,t,r=(((n=e.r)===null||n===void 0?void 0:n.d)||0)-(((t=e.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",u=I({},e),o=e[i];e.from=o.from,e.to=o.to,e[i]=o[i],u[i]=o[a],e[a]=u,u.d=sr(u)}e.d=sr(e)}function sr(e){var n=e.r,t=e.l;return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}function An(e,n){return z(n).forEach(function(t){e[t]?nn(e[t],n[t]):e[t]=Tt(n[t])}),e}function pt(e,n){return e.all||n.all||Object.keys(e).some(function(t){return n[t]&&Sn(n[t],e[t])})}var Ke={},yt={},mt=!1;function On(e,n){An(yt,e),mt||(mt=!0,setTimeout(function(){mt=!1;var t=yt;yt={},gt(t,!1)},0))}function gt(e,n){n===void 0&&(n=!1);var t=new Set;if(e.all)for(var r=0,i=Object.values(Ke);r<i.length;r++){var a=i[r];cr(a,e,t,n)}else for(var u in e){var o=/^idb\:\/\/(.*)\/(.*)\//.exec(u);if(o){var s=o[1],c=o[2],a=Ke["idb://".concat(s,"/").concat(c)];a&&cr(a,e,t,n)}}t.forEach(function(h){return h()})}function cr(e,n,t,r){for(var i=[],a=0,u=Object.entries(e.queries.query);a<u.length;a++){for(var o=u[a],s=o[0],c=o[1],h=[],l=0,v=c;l<v.length;l++){var _=v[l];pt(n,_.obsSet)?_.subscribers.forEach(function(m){return t.add(m)}):r&&h.push(_)}r&&i.push([s,h])}if(r)for(var f=0,d=i;f<d.length;f++){var y=d[f],s=y[0],h=y[1];e.queries.query[s]=h}}function Pi(e){var n=e._state,t=e._deps.indexedDB;if(n.isBeingOpened||e.idbdb)return n.dbReadyPromise.then(function(){return n.dbOpenError?L(n.dbOpenError):e});n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;var r=n.openCanceller,i=Math.round(e.verno*10),a=!1;function u(){if(n.openCanceller!==r)throw new O.DatabaseClosed("db.open() was cancelled")}var o=n.dbReadyResolve,s=null,c=!1,h=function(){return new E(function(l,v){if(u(),!t)throw new O.MissingAPI;var _=e.name,f=n.autoSchema||!i?t.open(_):t.open(_,i);if(!f)throw new O.MissingAPI;f.onerror=te(v),f.onblocked=j(e._fireOnBlocked),f.onupgradeneeded=j(function(d){if(s=f.transaction,n.autoSchema&&!e._options.allowEmptyDB){f.onerror=Xe,s.abort(),f.result.close();var y=t.deleteDatabase(_);y.onsuccess=y.onerror=j(function(){v(new O.NoSuchDatabase("Database ".concat(_," doesnt exist")))})}else{s.onerror=te(v);var m=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;c=m<1,e.idbdb=f.result,a&&bi(e,s),gi(e,m/10,s,v)}},v),f.onsuccess=j(function(){s=null;var d=e.idbdb=f.result,y=an(d.objectStoreNames);if(y.length>0)try{var m=d.transaction(fi(y),"readonly");if(n.autoSchema)Ei(e,d,m);else if(Kn(e,e._dbSchema,m),!ki(e,m)&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),d.close(),i=d.version+1,a=!0,l(h());_n(e,m)}catch{}Me.push(e),d.onversionchange=j(function(b){n.vcFired=!0,e.on("versionchange").fire(b)}),d.onclose=j(function(b){e.on("close").fire(b)}),c&&Oi(e._deps,_),l()},v)}).catch(function(l){switch(l?.name){case"UnknownError":if(n.PR1398_maxLoop>0)return n.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(i>0)return i=0,h();break}return E.reject(l)})};return E.race([r,(typeof navigator>"u"?E.resolve():Ci()).then(h)]).then(function(){return u(),n.onReadyBeingFired=[],E.resolve(ft(function(){return e.on.ready.fire(e.vip)})).then(function l(){if(n.onReadyBeingFired.length>0){var v=n.onReadyBeingFired.reduce(Nn,F);return n.onReadyBeingFired=[],E.resolve(ft(function(){return v(e.vip)})).then(l)}})}).finally(function(){n.openCanceller===r&&(n.onReadyBeingFired=null,n.isBeingOpened=!1)}).catch(function(l){n.dbOpenError=l;try{s&&s.abort()}catch{}return r===n.openCanceller&&e._close(),L(l)}).finally(function(){n.openComplete=!0,o()}).then(function(){if(c){var l={};e.tables.forEach(function(v){v.schema.indexes.forEach(function(_){_.name&&(l["idb://".concat(e.name,"/").concat(v.name,"/").concat(_.name)]=new Y(-1/0,[[[]]]))}),l["idb://".concat(e.name,"/").concat(v.name,"/")]=l["idb://".concat(e.name,"/").concat(v.name,"/:dels")]=new Y(-1/0,[[[]]])}),pe(Je).fire(l),gt(l,!0)}return e})}function bt(e){var n=function(u){return e.next(u)},t=function(u){return e.throw(u)},r=a(n),i=a(t);function a(u){return function(o){var s=u(o),c=s.value;return s.done?c:!c||typeof c.then!="function"?N(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(n)()}function Ti(e,n,t){var r=arguments.length;if(r<2)throw new O.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var a=Ct(i);return[e,a,t]}function lr(e,n,t,r,i){return E.resolve().then(function(){var a=S.transless||S,u=e._createTransaction(n,t,e._dbSchema,r);u.explicit=!0;var o={trans:u,transless:a};if(r)u.idbtrans=r.idbtrans;else try{u.create(),u.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(l){return l.name===jn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return lr(e,n,t,null,i)})):L(l)}var s=Mn(i);s&&Be();var c,h=E.follow(function(){if(c=i.call(u,u),c)if(s){var l=he.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=bt(c))},o);return(c&&typeof c.then=="function"?E.resolve(c).then(function(l){return u.active?l:L(new O.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):h.then(function(){return c})).then(function(l){return r&&u._resolve(),u._completion.then(function(){return l})}).catch(function(l){return u._reject(l),L(l)})})}function Dn(e,n,t){for(var r=N(e)?e.slice():[e],i=0;i<t;++i)r.push(n);return r}function Ii(e){return I(I({},e),{table:function(n){var t=e.table(n),r=t.schema,i={},a=[];function u(d,y,m){var b=qe(d),g=i[b]=i[b]||[],w=d==null?0:typeof d=="string"?1:d.length,p=y>0,x=I(I({},m),{name:p?"".concat(b,"(virtual-from:").concat(m.name,")"):m.name,lowLevelIndex:m,isVirtual:p,keyTail:y,keyLength:w,extractKey:at(d),unique:!p&&m.unique});if(g.push(x),x.isPrimaryKey||a.push(x),w>1){var k=w===2?d[0]:d.slice(0,w-1);u(k,y+1,m)}return g.sort(function(K,A){return K.keyTail-A.keyTail}),x}var o=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(var s=0,c=r.indexes;s<c.length;s++){var h=c[s];u(h.keyPath,0,h)}function l(d){var y=i[qe(d)];return y&&y[0]}function v(d,y){return{type:d.type===1?2:d.type,lower:Dn(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:Dn(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0}}function _(d){var y=d.query.index;return y.isVirtual?I(I({},d),{query:{index:y.lowLevelIndex,range:v(d.query.range,y.keyTail)}}):d}var f=I(I({},t),{schema:I(I({},r),{primaryKey:o,indexes:a,getIndexByKeyPath:l}),count:function(d){return t.count(_(d))},query:function(d){return t.query(_(d))},openCursor:function(d){var y=d.query.index,m=y.keyTail,b=y.isVirtual,g=y.keyLength;if(!b)return t.openCursor(d);function w(p){function x(K){K!=null?p.continue(Dn(K,d.reverse?e.MAX_KEY:e.MIN_KEY,m)):d.unique?p.continue(p.key.slice(0,g).concat(d.reverse?e.MIN_KEY:e.MAX_KEY,m)):p.continue()}var k=Object.create(p,{continue:{value:x},continuePrimaryKey:{value:function(K,A){p.continuePrimaryKey(Dn(K,e.MAX_KEY,m),A)}},primaryKey:{get:function(){return p.primaryKey}},key:{get:function(){var K=p.key;return g===1?K[0]:K.slice(0,g)}},value:{get:function(){return p.value}}});return k}return t.openCursor(_(d)).then(function(p){return p&&w(p)})}});return f}})}var Ri={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Ii};function wt(e,n,t,r){return t=t||{},r=r||"",z(e).forEach(function(i){if(!$(n,i))t[r+i]=void 0;else{var a=e[i],u=n[i];if(typeof a=="object"&&typeof u=="object"&&a&&u){var o=Rn(a),s=Rn(u);o!==s?t[r+i]=n[i]:o==="Object"?wt(a,u,t,r+i+"."):a!==u&&(t[r+i]=n[i])}else a!==u&&(t[r+i]=n[i])}}),z(n).forEach(function(i){$(e,i)||(t[r+i]=n[i])}),t}function _t(e,n){return n.type==="delete"?n.keys:n.keys||n.values.map(e.extractKey)}var Bi={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return I(I({},e),{table:function(n){var t=e.table(n),r=t.schema.primaryKey,i=I(I({},t),{mutate:function(a){var u=S.trans,o=u.table(n).hook,s=o.deleting,c=o.creating,h=o.updating;switch(a.type){case"add":if(c.fire===F)break;return u._promise("readwrite",function(){return l(a)},!0);case"put":if(c.fire===F&&h.fire===F)break;return u._promise("readwrite",function(){return l(a)},!0);case"delete":if(s.fire===F)break;return u._promise("readwrite",function(){return l(a)},!0);case"deleteRange":if(s.fire===F)break;return u._promise("readwrite",function(){return v(a)},!0)}return t.mutate(a);function l(f){var d=S.trans,y=f.keys||_t(r,f);if(!y)throw new Error("Keys missing");return f=f.type==="add"||f.type==="put"?I(I({},f),{keys:y}):I({},f),f.type!=="delete"&&(f.values=rn([],f.values)),f.keys&&(f.keys=rn([],f.keys)),Mi(t,f,y).then(function(m){var b=y.map(function(g,w){var p=m[w],x={onerror:null,onsuccess:null};if(f.type==="delete")s.fire.call(x,g,p,d);else if(f.type==="add"||p===void 0){var k=c.fire.call(x,g,f.values[w],d);g==null&&k!=null&&(g=k,f.keys[w]=g,r.outbound||Q(f.values[w],r.keyPath,g))}else{var K=wt(p,f.values[w]),A=h.fire.call(x,K,g,p,d);if(A){var T=f.values[w];Object.keys(A).forEach(function(C){$(T,C)?T[C]=A[C]:Q(T,C,A[C])})}}return x});return t.mutate(f).then(function(g){for(var w=g.failures,p=g.results,x=g.numFailures,k=g.lastResult,K=0;K<y.length;++K){var A=p?p[K]:y[K],T=b[K];A==null?T.onerror&&T.onerror(w[K]):T.onsuccess&&T.onsuccess(f.type==="put"&&m[K]?f.values[K]:A)}return{failures:w,results:p,numFailures:x,lastResult:k}}).catch(function(g){return b.forEach(function(w){return w.onerror&&w.onerror(g)}),Promise.reject(g)})})}function v(f){return _(f.trans,f.range,1e4)}function _(f,d,y){return t.query({trans:f,values:!1,query:{index:r,range:d},limit:y}).then(function(m){var b=m.result;return l({type:"delete",keys:b,trans:f}).then(function(g){return g.numFailures>0?Promise.reject(g.failures[0]):b.length<y?{failures:[],numFailures:0,lastResult:void 0}:_(f,I(I({},d),{lower:b[b.length-1],lowerOpen:!0}),y)})})}}});return i}})}};function Mi(e,n,t){return n.type==="add"?Promise.resolve([]):e.getMany({trans:n.trans,keys:t,cache:"immutable"})}function fr(e,n,t){try{if(!n||n.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<n.keys.length&&a<e.length;++i)B(n.keys[i],e[a])===0&&(r.push(t?ce(n.values[i]):n.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Fi={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var t=e.table(n);return I(I({},t),{getMany:function(r){if(!r.cache)return t.getMany(r);var i=fr(r.keys,r.trans._cache,r.cache==="clone");return i?E.resolve(i):t.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?ce(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),t.mutate(r)}})}}}};function hr(e,n){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!n.schema.primaryKey.outbound}function dr(e,n){switch(e){case"query":return n.values&&!n.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var ji={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,t=new Y(e.MIN_KEY,e.MAX_KEY);return I(I({},e),{transaction:function(r,i,a){if(S.subscr&&i!=="readonly")throw new O.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(S.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,u=a.primaryKey,o=a.indexes,s=u.extractKey,c=u.outbound,h=u.autoIncrement&&o.filter(function(f){return f.compound&&f.keyPath.includes(u.keyPath)}),l=I(I({},i),{mutate:function(f){var d=f.trans,y=f.mutatedParts||(f.mutatedParts={}),m=function(C){var R="idb://".concat(n,"/").concat(r,"/").concat(C);return y[R]||(y[R]=new Y)},b=m(""),g=m(":dels"),w=f.type,p=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[_t(u,f).filter(function(C){return C}),f.values]:[],x=p[0],k=p[1],K=f.trans._cache;if(N(x)){b.addKeys(x);var A=w==="delete"||x.length===k.length?fr(x,K):null;A||g.addKeys(x),(A||k)&&Ni(m,a,A,k)}else if(x){var T={from:x.lower,to:x.upper};g.add(T),b.add(T)}else b.add(t),g.add(t),a.indexes.forEach(function(C){return m(C.name).add(t)});return i.mutate(f).then(function(C){return x&&(f.type==="add"||f.type==="put")&&(b.addKeys(C.results),h&&h.forEach(function(R){var P=f.values.map(function(D){return R.extractKey(D)}),M=R.keyPath.findIndex(function(D){return D===u.keyPath});C.results.forEach(function(D){return P[M]=D}),m(R.name).addKeys(P)})),d.mutatedParts=An(d.mutatedParts||{},y),C})}}),v=function(f){var d,y,m=f.query,b=m.index,g=m.range;return[b,new Y((d=g.lower)!==null&&d!==void 0?d:e.MIN_KEY,(y=g.upper)!==null&&y!==void 0?y:e.MAX_KEY)]},_={get:function(f){return[u,new Y(f.key)]},getMany:function(f){return[u,new Y().addKeys(f.keys)]},count:v,query:v,openCursor:v};return z(_).forEach(function(f){l[f]=function(d){var y=S.subscr,m=!!y,b=hr(S,i)&&dr(f,d),g=b?d.obsSet={}:y;if(m){var w=function(C){var R="idb://".concat(n,"/").concat(r,"/").concat(C);return g[R]||(g[R]=new Y)},p=w(""),x=w(":dels"),k=_[f](d),K=k[0],A=k[1];if(f==="query"&&K.isPrimaryKey&&!d.values?x.add(A):w(K.name||"").add(A),!K.isPrimaryKey)if(f==="count")x.add(t);else{var T=f==="query"&&c&&d.values&&i.query(I(I({},d),{values:!1}));return i[f].apply(this,arguments).then(function(C){if(f==="query"){if(c&&d.values)return T.then(function(D){var V=D.result;return p.addKeys(V),C});var R=d.values?C.result.map(s):C.result;d.values?p.addKeys(R):x.addKeys(R)}else if(f==="openCursor"){var P=C,M=d.values;return P&&Object.create(P,{key:{get:function(){return x.addKey(P.primaryKey),P.key}},primaryKey:{get:function(){var D=P.primaryKey;return x.addKey(D),D}},value:{get:function(){return M&&p.addKey(P.primaryKey),P.value}}})}return C})}}return i[f].apply(this,arguments)}}),l}})}};function Ni(e,n,t,r){function i(a){var u=e(a.name||"");function o(c){return c!=null?a.extractKey(c):null}var s=function(c){return a.multiEntry&&N(c)?c.forEach(function(h){return u.addKey(h)}):u.addKey(c)};(t||r).forEach(function(c,h){var l=t&&o(t[h]),v=r&&o(r[h]);B(l,v)!==0&&(l!=null&&s(l),v!=null&&s(v))})}n.indexes.forEach(i)}function vr(e,n,t){if(t.numFailures===0)return n;if(n.type==="deleteRange")return null;var r=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;if(t.numFailures===r)return null;var i=I({},n);return N(i.keys)&&(i.keys=i.keys.filter(function(a,u){return!(u in t.failures)})),"values"in i&&N(i.values)&&(i.values=i.values.filter(function(a,u){return!(u in t.failures)})),i}function Li(e,n){return n.lower===void 0?!0:n.lowerOpen?B(e,n.lower)>0:B(e,n.lower)>=0}function Vi(e,n){return n.upper===void 0?!0:n.upperOpen?B(e,n.upper)<0:B(e,n.upper)<=0}function xt(e,n){return Li(e,n)&&Vi(e,n)}function pr(e,n,t,r,i,a){if(!t||t.length===0)return e;var u=n.query.index,o=u.multiEntry,s=n.query.range,c=r.schema.primaryKey,h=c.extractKey,l=u.extractKey,v=(u.lowLevelIndex||u).extractKey,_=t.reduce(function(f,d){var y=f,m=d.type==="add"||d.type==="put"?d.values.filter(function(p){var x=l(p);return o&&N(x)?x.some(function(k){return xt(k,s)}):xt(x,s)}).map(function(p){return p=ce(p),a&&Object.freeze(p),p}):[];switch(d.type){case"add":y=f.concat(n.values?m:m.map(function(p){return h(p)}));break;case"put":var b=new Y().addKeys(d.values.map(function(p){return h(p)}));y=f.filter(function(p){var x=n.values?h(p):p;return!Sn(new Y(x),b)}).concat(n.values?m:m.map(function(p){return h(p)}));break;case"delete":var g=new Y().addKeys(d.keys);y=f.filter(function(p){var x=n.values?h(p):p;return!Sn(new Y(x),g)});break;case"deleteRange":var w=d.range;y=f.filter(function(p){return!xt(h(p),w)});break}return y},e);return _===e?e:(_.sort(function(f,d){return B(v(f),v(d))||B(h(f),h(d))}),n.limit&&n.limit<1/0&&(_.length>n.limit?_.length=n.limit:e.length===n.limit&&_.length<n.limit&&(i.dirty=!0)),a?Object.freeze(_):_)}function yr(e,n){return B(e.lower,n.lower)===0&&B(e.upper,n.upper)===0&&!!e.lowerOpen==!!n.lowerOpen&&!!e.upperOpen==!!n.upperOpen}function zi(e,n,t,r){if(e===void 0)return n!==void 0?-1:0;if(n===void 0)return 1;var i=B(e,n);if(i===0){if(t&&r)return 0;if(t)return 1;if(r)return-1}return i}function Wi(e,n,t,r){if(e===void 0)return n!==void 0?1:0;if(n===void 0)return-1;var i=B(e,n);if(i===0){if(t&&r)return 0;if(t)return-1;if(r)return 1}return i}function Ui(e,n){return zi(e.lower,n.lower,e.lowerOpen,n.lowerOpen)<=0&&Wi(e.upper,n.upper,e.upperOpen,n.upperOpen)>=0}function Yi(e,n,t,r){var i=Ke["idb://".concat(e,"/").concat(n)];if(!i)return[];var a=i.queries[t];if(!a)return[null,!1,i,null];var u=r.query?r.query.index.name:null,o=a[u||""];if(!o)return[null,!1,i,null];switch(t){case"query":var s=o.find(function(l){return l.req.limit===r.limit&&l.req.values===r.values&&yr(l.req.query.range,r.query.range)});if(s)return[s,!0,i,o];var c=o.find(function(l){var v="limit"in l.req?l.req.limit:1/0;return v>=r.limit&&(r.values?l.req.values:!0)&&Ui(l.req.query.range,r.query.range)});return[c,!1,i,o];case"count":var h=o.find(function(l){return yr(l.req.query.range,r.query.range)});return[h,!!h,i,o]}}function $i(e,n,t,r){e.subscribers.add(t),r.addEventListener("abort",function(){e.subscribers.delete(t),e.subscribers.size===0&&Hi(e,n)})}function Hi(e,n){setTimeout(function(){e.subscribers.size===0&&ge(n,e)},3e3)}var Qi={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name,t=I(I({},e),{transaction:function(r,i,a){var u=e.transaction(r,i,a);if(i==="readwrite"){var o=new AbortController,s=o.signal,c=function(h){return function(){if(o.abort(),i==="readwrite"){for(var l=new Set,v=0,_=r;v<_.length;v++){var f=_[v],d=Ke["idb://".concat(n,"/").concat(f)];if(d){var y=e.table(f),m=d.optimisticOps.filter(function(M){return M.trans===u});if(u._explicit&&h&&u.mutatedParts)for(var b=0,g=Object.values(d.queries.query);b<g.length;b++)for(var w=g[b],p=0,x=w.slice();p<x.length;p++){var k=x[p];pt(k.obsSet,u.mutatedParts)&&(ge(w,k),k.subscribers.forEach(function(M){return l.add(M)}))}else if(m.length>0){d.optimisticOps=d.optimisticOps.filter(function(M){return M.trans!==u});for(var K=0,A=Object.values(d.queries.query);K<A.length;K++)for(var w=A[K],T=0,C=w.slice();T<C.length;T++){var k=C[T];if(k.res!=null&&u.mutatedParts)if(h&&!k.dirty){var R=Object.isFrozen(k.res),P=pr(k.res,k.req,m,y,k,R);k.dirty?(ge(w,k),k.subscribers.forEach(function(V){return l.add(V)})):P!==k.res&&(k.res=P,k.promise=E.resolve({result:P}))}else k.dirty&&ge(w,k),k.subscribers.forEach(function(V){return l.add(V)})}}}}l.forEach(function(M){return M()})}}};u.addEventListener("abort",c(!1),{signal:s}),u.addEventListener("error",c(!1),{signal:s}),u.addEventListener("complete",c(!0),{signal:s})}return u},table:function(r){var i=e.table(r),a=i.schema.primaryKey,u=I(I({},i),{mutate:function(o){var s=S.trans;if(a.outbound||s.db._options.cache==="disabled"||s.explicit)return i.mutate(o);var c=Ke["idb://".concat(n,"/").concat(r)];if(!c)return i.mutate(o);var h=i.mutate(o);return(o.type==="add"||o.type==="put")&&(o.values.length>=50||_t(a,o).some(function(l){return l==null}))?h.then(function(l){var v=I(I({},o),{values:o.values.map(function(f,d){var y,m=!((y=a.keyPath)===null||y===void 0)&&y.includes(".")?ce(f):I({},f);return Q(m,a.keyPath,l.results[d]),m})}),_=vr(c,v,l);c.optimisticOps.push(_),queueMicrotask(function(){return o.mutatedParts&&On(o.mutatedParts)})}):(c.optimisticOps.push(o),o.mutatedParts&&On(o.mutatedParts),h.then(function(l){if(l.numFailures>0){ge(c.optimisticOps,o);var v=vr(c,o,l);v&&c.optimisticOps.push(v),o.mutatedParts&&On(o.mutatedParts)}}),h.catch(function(){ge(c.optimisticOps,o),o.mutatedParts&&On(o.mutatedParts)})),h},query:function(o){var s;if(!hr(S,i)||!dr("query",o))return i.query(o);var c=((s=S.trans)===null||s===void 0?void 0:s.db._options.cache)==="immutable",h=S,l=h.requery,v=h.signal,_=Yi(n,r,"query",o),f=_[0],d=_[1],y=_[2],m=_[3];if(f&&d)f.obsSet=o.obsSet;else{var b=i.query(o).then(function(g){var w=g.result;if(f&&(f.res=w),c){for(var p=0,x=w.length;p<x;++p)Object.freeze(w[p]);Object.freeze(w)}else g.result=ce(w);return g}).catch(function(g){return m&&f&&ge(m,f),Promise.reject(g)});f={obsSet:o.obsSet,promise:b,subscribers:new Set,type:"query",req:o,dirty:!1},m?m.push(f):(m=[f],y||(y=Ke["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),y.queries.query[o.query.index.name||""]=m)}return $i(f,m,l,v),f.promise.then(function(g){return{result:pr(g.result,o,y?.optimisticOps,i,f,c)}})}});return u}});return t}};function Cn(e,n){return new Proxy(e,{get:function(t,r,i){return r==="db"?n:Reflect.get(t,r,i)}})}var Ne=function(){function e(n,t){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=t=I({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};var a=t.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};u.dbReadyPromise=new E(function(s){u.dbReadyResolve=s}),u.openCanceller=new E(function(s,c){u.cancelOpen=c}),this._state=u,this.name=n,this.on=Qe(this,"populate","blocked","versionchange","close",{ready:[Nn,F]}),this.on.ready.subscribe=At(this.on.ready.subscribe,function(s){return function(c,h){e.vip(function(){var l=r._state;if(l.openComplete)l.dbOpenError||E.resolve().then(c),h&&s(c);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(c),h&&s(c);else{s(c);var v=r;h||s(function _(){v.on.ready.unsubscribe(c),v.on.ready.unsubscribe(_)})}})}}),this.Collection=ti(this),this.Table=qr(this),this.Transaction=li(this),this.Version=Si(this),this.WhereClause=si(this),this.on("versionchange",function(s){s.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(s.oldVersion/10))}),this._maxKey=Ze(t.IDBKeyRange),this._createTransaction=function(s,c,h,l){return new r.Transaction(s,c,h,r._options.chromeTransactionDurability,l)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),Me.filter(function(c){return c.name===r.name&&c!==r&&!c._state.vcFired}).map(function(c){return c.on("versionchange").fire(s)})},this.use(Fi),this.use(Qi),this.use(ji),this.use(Ri),this.use(Bi);var o=new Proxy(this,{get:function(s,c,h){if(c==="_vip")return!0;if(c==="table")return function(v){return Cn(r.table(v),o)};var l=Reflect.get(s,c,h);return l instanceof Jt?Cn(l,o):c==="tables"?l.map(function(v){return Cn(v,o)}):c==="_createTransaction"?function(){var v=l.apply(this,arguments);return Cn(v,o)}:l}});this.vip=o,a.forEach(function(s){return s(r)})}return e.prototype.version=function(n){if(isNaN(n)||n<.1)throw new O.Type("Given version is not a positive number");if(n=Math.round(n*10)/10,this.idbdb||this._state.isBeingOpened)throw new O.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var t=this._versions,r=t.filter(function(i){return i._cfg.version===n})[0];return r||(r=new this.Version(n),t.push(r),t.sort(mi),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(n){var t=this;return this.idbdb&&(this._state.openComplete||S.letThrough||this._vip)?n():new E(function(r,i){if(t._state.openComplete)return i(new O.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen){i(new O.DatabaseClosed);return}t.open().catch(F)}t._state.dbReadyPromise.then(r,i)}).then(n)},e.prototype.use=function(n){var t=n.stack,r=n.create,i=n.level,a=n.name;a&&this.unuse({stack:t,name:a});var u=this._middlewares[t]||(this._middlewares[t]=[]);return u.push({stack:t,create:r,level:i??10,name:a}),u.sort(function(o,s){return o.level-s.level}),this},e.prototype.unuse=function(n){var t=n.stack,r=n.name,i=n.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},e.prototype.open=function(){var n=this;return xe(le,function(){return Pi(n)})},e.prototype._close=function(){var n=this._state,t=Me.indexOf(this);if(t>=0&&Me.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new E(function(r){n.dbReadyResolve=r}),n.openCanceller=new E(function(r,i){n.cancelOpen=i}))},e.prototype.close=function(n){var t=n===void 0?{disableAutoOpen:!0}:n,r=t.disableAutoOpen,i=this._state;r?(i.isBeingOpened&&i.cancelOpen(new O.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new O.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},e.prototype.delete=function(n){var t=this;n===void 0&&(n={disableAutoOpen:!0});var r=arguments.length>0&&typeof arguments[0]!="object",i=this._state;return new E(function(a,u){var o=function(){t.close(n);var s=t._deps.indexedDB.deleteDatabase(t.name);s.onsuccess=j(function(){Di(t._deps,t.name),a()}),s.onerror=te(u),s.onblocked=t._fireOnBlocked};if(r)throw new O.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(o):o()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var n=this;return z(this._allTables).map(function(t){return n._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var n=Ti.apply(this,arguments);return this._transaction.apply(this,n)},e.prototype._transaction=function(n,t,r){var i=this,a=S.trans;(!a||a.db!==this||n.indexOf("!")!==-1)&&(a=null);var u=n.indexOf("?")!==-1;n=n.replace("!","").replace("?","");var o,s;try{if(s=t.map(function(h){var l=h instanceof i.Table?h.name:h;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),n=="r"||n===Jn)o=Jn;else if(n=="rw"||n==Zn)o=Zn;else throw new O.InvalidArgument("Invalid transaction mode: "+n);if(a){if(a.mode===Jn&&o===Zn)if(u)a=null;else throw new O.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&s.forEach(function(h){if(a&&a.storeNames.indexOf(h)===-1)if(u)a=null;else throw new O.SubTransaction("Table "+h+" not included in parent transaction.")}),u&&a&&!a.active&&(a=null)}}catch(h){return a?a._promise(null,function(l,v){v(h)}):L(h)}var c=lr.bind(null,this,o,s,a,r);return a?a._promise(o,c,"lock"):S.trans?xe(S.transless,function(){return i._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(n){if(!$(this._allTables,n))throw new O.InvalidTable("Table ".concat(n," does not exist"));return this._allTables[n]},e}(),Gi=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Xi=function(){function e(n){this._subscribe=n}return e.prototype.subscribe=function(n,t,r){return this._subscribe(!n||typeof n=="function"?{next:n,error:t,complete:r}:n)},e.prototype[Gi]=function(){return this},e}(),Pn;try{Pn={indexedDB:U.indexedDB||U.mozIndexedDB||U.webkitIndexedDB||U.msIndexedDB,IDBKeyRange:U.IDBKeyRange||U.webkitIDBKeyRange}}catch{Pn={indexedDB:null,IDBKeyRange:null}}function mr(e){var n=!1,t,r=new Xi(function(i){var a=Mn(e);function u(m){var b=Ie();try{a&&Be();var g=fe(e,m);return a&&(g=g.finally(he)),g}finally{b&&Re()}}var o=!1,s,c={},h={},l={get closed(){return o},unsubscribe:function(){o||(o=!0,s&&s.abort(),v&&pe.storagemutated.unsubscribe(d))}};i.start&&i.start(l);var v=!1,_=function(){return Qn(y)};function f(){return pt(h,c)}var d=function(m){An(c,m),f()&&_()},y=function(){if(!(o||!Pn.indexedDB)){c={};var m={};s&&s.abort(),s=new AbortController;var b={subscr:m,signal:s.signal,requery:_,querier:e,trans:null},g=u(b);Promise.resolve(g).then(function(w){n=!0,t=w,!(o||b.signal.aborted)&&(c={},h=m,!Ar(h)&&!v&&(pe(Je,d),v=!0),Qn(function(){return!o&&i.next&&i.next(w)}))},function(w){n=!1,["DatabaseClosedError","AbortError"].includes(w?.name)||o||Qn(function(){o||i.error&&i.error(w)})})}};return setTimeout(_,0),l});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var Se=Ne;Oe(Se,I(I({},on),{delete:function(e){var n=new Se(e,{addons:[]});return n.delete()},exists:function(e){return new Se(e,{addons:[]}).open().then(function(n){return n.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return Ai(Se.dependencies).then(e)}catch{return L(new O.MissingAPI)}},defineClass:function(){function e(n){H(this,n)}return e},ignoreTransaction:function(e){return S.trans?xe(S.transless,e):e()},vip:ft,async:function(e){return function(){try{var n=bt(e.apply(this,arguments));return!n||typeof n.then!="function"?E.resolve(n):n}catch(t){return L(t)}}},spawn:function(e,n,t){try{var r=bt(e.apply(t,n||[]));return!r||typeof r.then!="function"?E.resolve(r):r}catch(i){return L(i)}},currentTransaction:{get:function(){return S.trans||null}},waitFor:function(e,n){var t=E.resolve(typeof e=="function"?Se.ignoreTransaction(e):e).timeout(n||6e4);return S.trans?S.trans.waitFor(t):t},Promise:E,debug:{get:function(){return ne},set:function(e){Mt(e)}},derive:De,extend:H,props:Oe,override:At,Events:Qe,on:pe,liveQuery:mr,extendObservabilitySet:An,getByKeyPath:re,setByKeyPath:Q,delByKeyPath:kr,shallowClone:Dt,deepClone:ce,getObjectDiff:wt,cmp:B,asap:Ot,minKey:Xn,addons:[],connections:Me,errnames:jn,dependencies:Pn,cache:Ke,semVer:Yt,version:Yt.split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,t){return e+n/Math.pow(10,t*2)})})),Se.maxKey=Ze(Se.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(pe(Je,function(e){if(!ye){var n;n=new CustomEvent(tt,{detail:e}),ye=!0,dispatchEvent(n),ye=!1}}),addEventListener(tt,function(e){var n=e.detail;ye||Et(n)}));function Et(e){var n=ye;try{ye=!0,pe.storagemutated.fire(e),gt(e,!0)}finally{ye=n}}var ye=!1,me,kt=function(){};typeof BroadcastChannel<"u"&&(kt=function(){me=new BroadcastChannel(tt),me.onmessage=function(e){return e.data&&Et(e.data)}},kt(),typeof me.unref=="function"&&me.unref(),pe(Je,function(e){ye||me.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ne.disableBfCache&&e.persisted){ne&&console.debug("Dexie: handling persisted pagehide"),me?.close();for(var n=0,t=Me;n<t.length;n++){var r=t[n];r.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(e){!Ne.disableBfCache&&e.persisted&&(ne&&console.debug("Dexie: handling persisted pageshow"),kt(),Et({all:new Y(-1/0,[[]])}))})),E.rejectionMapper=Ir,Mt(ne);export{Ne as Dexie,Qt as Entity,er as PropModification,Y as RangeSet,B as cmp,Ne as default,mr as liveQuery,nn as mergeRanges,Sn as rangesOverlap};
//# sourceMappingURL=dexie.js.map
