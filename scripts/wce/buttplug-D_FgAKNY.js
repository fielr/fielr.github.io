var ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ge(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ue={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function i(p,g,f){this.fn=p,this.context=g,this.once=f||!1}function u(p,g,f,_,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var O=new i(f,_||p,h),R=e?e+g:g;return p._events[R]?p._events[R].fn?p._events[R]=[p._events[R],O]:p._events[R].push(O):(p._events[R]=O,p._eventsCount++),p}function a(p,g){--p._eventsCount===0?p._events=new n:delete p._events[g]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var p=[],g,f;if(this._eventsCount===0)return p;for(f in g=this._events)t.call(g,f)&&p.push(e?f.slice(1):f);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(g)):p},d.prototype.listeners=function(p){var g=e?e+p:p,f=this._events[g];if(!f)return[];if(f.fn)return[f.fn];for(var _=0,h=f.length,O=new Array(h);_<h;_++)O[_]=f[_].fn;return O},d.prototype.listenerCount=function(p){var g=e?e+p:p,f=this._events[g];return f?f.fn?1:f.length:0},d.prototype.emit=function(p,g,f,_,h,O){var R=e?e+p:p;if(!this._events[R])return!1;var m=this._events[R],x=arguments.length,L,C;if(m.fn){switch(m.once&&this.removeListener(p,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,g),!0;case 3:return m.fn.call(m.context,g,f),!0;case 4:return m.fn.call(m.context,g,f,_),!0;case 5:return m.fn.call(m.context,g,f,_,h),!0;case 6:return m.fn.call(m.context,g,f,_,h,O),!0}for(C=1,L=new Array(x-1);C<x;C++)L[C-1]=arguments[C];m.fn.apply(m.context,L)}else{var D=m.length,j;for(C=0;C<D;C++)switch(m[C].once&&this.removeListener(p,m[C].fn,void 0,!0),x){case 1:m[C].fn.call(m[C].context);break;case 2:m[C].fn.call(m[C].context,g);break;case 3:m[C].fn.call(m[C].context,g,f);break;case 4:m[C].fn.call(m[C].context,g,f,_);break;default:if(!L)for(j=1,L=new Array(x-1);j<x;j++)L[j-1]=arguments[j];m[C].fn.apply(m[C].context,L)}}return!0},d.prototype.on=function(p,g,f){return u(this,p,g,f,!1)},d.prototype.once=function(p,g,f){return u(this,p,g,f,!0)},d.prototype.removeListener=function(p,g,f,_){var h=e?e+p:p;if(!this._events[h])return this;if(!g)return a(this,h),this;var O=this._events[h];if(O.fn)O.fn===g&&(!_||O.once)&&(!f||O.context===f)&&a(this,h);else{for(var R=0,m=[],x=O.length;R<x;R++)(O[R].fn!==g||_&&!O[R].once||f&&O[R].context!==f)&&m.push(O[R]);m.length?this._events[h]=m.length===1?m[0]:m:a(this,h)}return this},d.prototype.removeAllListeners=function(p){var g;return p?(g=e?e+p:p,this._events[g]&&a(this,g)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,r.exports=d})(ue);var Ve=ue.exports;const wt=Ge(Ve);/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */var qt=(r=>(r[r.Off=0]="Off",r[r.Error=1]="Error",r[r.Warn=2]="Warn",r[r.Info=3]="Info",r[r.Debug=4]="Debug",r[r.Trace=5]="Trace",r))(qt||{});class pe{constructor(t,e){const n=new Date,i=n.getHours(),u=n.getMinutes(),a=n.getSeconds();this.timestamp=`${i}:${u}:${a}`,this.logMessage=t,this.logLevel=e}get Message(){return this.logMessage}get LogLevel(){return this.logLevel}get Timestamp(){return this.timestamp}get FormattedMessage(){return`${qt[this.logLevel]} : ${this.timestamp} : ${this.logMessage}`}}const de=class Wt extends wt{constructor(){super(),this.maximumConsoleLogLevel=0,this.maximumEventLogLevel=0}static get Logger(){return Wt.sLogger===void 0&&(Wt.sLogger=new Wt),this.sLogger}get MaximumConsoleLogLevel(){return this.maximumConsoleLogLevel}set MaximumConsoleLogLevel(t){this.maximumConsoleLogLevel=t}get MaximumEventLogLevel(){return this.maximumEventLogLevel}set MaximumEventLogLevel(t){this.maximumEventLogLevel=t}Error(t){this.AddLogMessage(t,1)}Warn(t){this.AddLogMessage(t,2)}Info(t){this.AddLogMessage(t,3)}Debug(t){this.AddLogMessage(t,4)}Trace(t){this.AddLogMessage(t,5)}AddLogMessage(t,e){if(e>this.maximumEventLogLevel&&e>this.maximumConsoleLogLevel)return;const n=new pe(t,e);e<=this.maximumConsoleLogLevel&&console.log(n.FormattedMessage),e<=this.maximumEventLogLevel&&this.emit("log",n)}};de.sLogger=void 0;let he=de;var b;(function(r){r[r.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",r[r.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",r[r.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"})(b||(b={}));var We=function(){function r(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return r.prototype.addTypeMetadata=function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)},r.prototype.addTransformMetadata=function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)},r.prototype.addExposeMetadata=function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)},r.prototype.addExcludeMetadata=function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)},r.prototype.findTransformMetadatas=function(t,e,n){return this.findMetadatas(this._transformMetadatas,t,e).filter(function(i){return!i.options||i.options.toClassOnly===!0&&i.options.toPlainOnly===!0?!0:i.options.toClassOnly===!0?n===b.CLASS_TO_CLASS||n===b.PLAIN_TO_CLASS:i.options.toPlainOnly===!0?n===b.CLASS_TO_PLAIN:!0})},r.prototype.findExcludeMetadata=function(t,e){return this.findMetadata(this._excludeMetadatas,t,e)},r.prototype.findExposeMetadata=function(t,e){return this.findMetadata(this._exposeMetadatas,t,e)},r.prototype.findExposeMetadataByCustomName=function(t,e){return this.getExposedMetadatas(t).find(function(n){return n.options&&n.options.name===e})},r.prototype.findTypeMetadata=function(t,e){return this.findMetadata(this._typeMetadatas,t,e)},r.prototype.getStrategy=function(t){var e=this._excludeMetadatas.get(t),n=e&&e.get(void 0),i=this._exposeMetadatas.get(t),u=i&&i.get(void 0);return n&&u||!n&&!u?"none":n?"excludeAll":"exposeAll"},r.prototype.getExposedMetadatas=function(t){return this.getMetadata(this._exposeMetadatas,t)},r.prototype.getExcludedMetadatas=function(t){return this.getMetadata(this._excludeMetadatas,t)},r.prototype.getExposedProperties=function(t,e){return this.getExposedMetadatas(t).filter(function(n){return!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?e===b.CLASS_TO_CLASS||e===b.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?e===b.CLASS_TO_PLAIN:!0}).map(function(n){return n.propertyName})},r.prototype.getExcludedProperties=function(t,e){return this.getExcludedMetadatas(t).filter(function(n){return!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?e===b.CLASS_TO_CLASS||e===b.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?e===b.CLASS_TO_PLAIN:!0}).map(function(n){return n.propertyName})},r.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},r.prototype.getMetadata=function(t,e){var n=t.get(e),i;n&&(i=Array.from(n.values()).filter(function(_){return _.propertyName!==void 0}));for(var u=[],a=0,d=this.getAncestors(e);a<d.length;a++){var p=d[a],g=t.get(p);if(g){var f=Array.from(g.values()).filter(function(_){return _.propertyName!==void 0});u.push.apply(u,f)}}return u.concat(i||[])},r.prototype.findMetadata=function(t,e,n){var i=t.get(e);if(i){var u=i.get(n);if(u)return u}for(var a=0,d=this.getAncestors(e);a<d.length;a++){var p=d[a],g=t.get(p);if(g){var f=g.get(n);if(f)return f}}},r.prototype.findMetadatas=function(t,e,n){var i=t.get(e),u;i&&(u=i.get(n));for(var a=[],d=0,p=this.getAncestors(e);d<p.length;d++){var g=p[d],f=t.get(g);f&&f.has(n)&&a.push.apply(a,f.get(n))}return a.slice().reverse().concat((u||[]).slice().reverse())},r.prototype.getAncestors=function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var e=[],n=Object.getPrototypeOf(t.prototype.constructor);typeof n.prototype<"u";n=Object.getPrototypeOf(n.prototype.constructor))e.push(n);this._ancestorsMap.set(t,e)}return this._ancestorsMap.get(t)},r}(),U=new We;function Ke(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function ze(r){return r!==null&&typeof r=="object"&&typeof r.then=="function"}var le=globalThis&&globalThis.__spreadArray||function(r,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,u;n<i;n++)(u||!(n in t))&&(u||(u=Array.prototype.slice.call(t,0,n)),u[n]=t[n]);return r.concat(u||Array.prototype.slice.call(t))};function Je(r){var t=new r;return!(t instanceof Set)&&!("push"in t)?[]:t}var at=function(){function r(t,e){this.transformationType=t,this.options=e,this.recursionStack=new Set}return r.prototype.transform=function(t,e,n,i,u,a){var d=this;if(a===void 0&&(a=0),Array.isArray(e)||e instanceof Set){var p=i&&this.transformationType===b.PLAIN_TO_CLASS?Je(i):[];return e.forEach(function(x,L){var C=t?t[L]:void 0;if(!d.options.enableCircularCheck||!d.isCircular(x)){var D=void 0;if(typeof n!="function"&&n&&n.options&&n.options.discriminator&&n.options.discriminator.property&&n.options.discriminator.subTypes){if(d.transformationType===b.PLAIN_TO_CLASS){D=n.options.discriminator.subTypes.find(function(Y){return Y.name===x[n.options.discriminator.property]});var j={newObject:p,object:x,property:void 0},A=n.typeFunction(j);D===void 0?D=A:D=D.value,n.options.keepDiscriminatorProperty||delete x[n.options.discriminator.property]}d.transformationType===b.CLASS_TO_CLASS&&(D=x.constructor),d.transformationType===b.CLASS_TO_PLAIN&&(x[n.options.discriminator.property]=n.options.discriminator.subTypes.find(function(Y){return Y.value===x.constructor}).name)}else D=n;var B=d.transform(C,x,D,void 0,x instanceof Map,a+1);p instanceof Set?p.add(B):p.push(B)}else d.transformationType===b.CLASS_TO_CLASS&&(p instanceof Set?p.add(x):p.push(x))}),p}else{if(n===String&&!u)return e==null?e:String(e);if(n===Number&&!u)return e==null?e:Number(e);if(n===Boolean&&!u)return e==null?e:!!e;if((n===Date||e instanceof Date)&&!u)return e instanceof Date?new Date(e.valueOf()):e==null?e:new Date(e);if(Ke().Buffer&&(n===Buffer||e instanceof Buffer)&&!u)return e==null?e:Buffer.from(e);if(ze(e)&&!u)return new Promise(function(x,L){e.then(function(C){return x(d.transform(void 0,C,n,void 0,void 0,a+1))},L)});if(!u&&e!==null&&typeof e=="object"&&typeof e.then=="function")return e;if(typeof e=="object"&&e!==null){!n&&e.constructor!==Object&&(!Array.isArray(e)&&e.constructor===Array||(n=e.constructor)),!n&&t&&(n=t.constructor),this.options.enableCircularCheck&&this.recursionStack.add(e);var g=this.getKeys(n,e,u),f=t||{};!t&&(this.transformationType===b.PLAIN_TO_CLASS||this.transformationType===b.CLASS_TO_CLASS)&&(u?f=new Map:n?f=new n:f={});for(var _=function(x){if(x==="__proto__"||x==="constructor")return"continue";var L=x,C=x,D=x;if(!h.options.ignoreDecorators&&n){if(h.transformationType===b.PLAIN_TO_CLASS){var j=U.findExposeMetadataByCustomName(n,x);j&&(D=j.propertyName,C=j.propertyName)}else if(h.transformationType===b.CLASS_TO_PLAIN||h.transformationType===b.CLASS_TO_CLASS){var j=U.findExposeMetadata(n,x);j&&j.options&&j.options.name&&(C=j.options.name)}}var A=void 0;h.transformationType===b.PLAIN_TO_CLASS?A=e[L]:e instanceof Map?A=e.get(L):e[L]instanceof Function?A=e[L]():A=e[L];var B=void 0,Y=A instanceof Map;if(n&&u)B=n;else if(n){var P=U.findTypeMetadata(n,D);if(P){var Kt={newObject:f,object:e,property:D},vt=P.typeFunction?P.typeFunction(Kt):P.reflectedType;P.options&&P.options.discriminator&&P.options.discriminator.property&&P.options.discriminator.subTypes?e[L]instanceof Array?B=P:(h.transformationType===b.PLAIN_TO_CLASS&&(B=P.options.discriminator.subTypes.find(function(J){if(A&&A instanceof Object&&P.options.discriminator.property in A)return J.name===A[P.options.discriminator.property]}),B===void 0?B=vt:B=B.value,P.options.keepDiscriminatorProperty||A&&A instanceof Object&&P.options.discriminator.property in A&&delete A[P.options.discriminator.property]),h.transformationType===b.CLASS_TO_CLASS&&(B=A.constructor),h.transformationType===b.CLASS_TO_PLAIN&&A&&(A[P.options.discriminator.property]=P.options.discriminator.subTypes.find(function(J){return J.value===A.constructor}).name)):B=vt,Y=Y||P.reflectedType===Map}else if(h.options.targetMaps)h.options.targetMaps.filter(function(J){return J.target===n&&!!J.properties[D]}).forEach(function(J){return B=J.properties[D]});else if(h.options.enableImplicitConversion&&h.transformationType===b.PLAIN_TO_CLASS){var mt=Reflect.getMetadata("design:type",n.prototype,D);mt&&(B=mt)}}var Z=Array.isArray(e[L])?h.getReflectedType(n,D):void 0,pt=t?t[L]:void 0;if(f.constructor.prototype){var it=Object.getOwnPropertyDescriptor(f.constructor.prototype,C);if((h.transformationType===b.PLAIN_TO_CLASS||h.transformationType===b.CLASS_TO_CLASS)&&(it&&!it.set||f[C]instanceof Function))return"continue"}if(!h.options.enableCircularCheck||!h.isCircular(A)){var nt=h.transformationType===b.PLAIN_TO_CLASS?C:x,T=void 0;h.transformationType===b.CLASS_TO_PLAIN?(T=e[nt],T=h.applyCustomTransformations(T,n,nt,e,h.transformationType),T=e[nt]===T?A:T,T=h.transform(pt,T,B,Z,Y,a+1)):A===void 0&&h.options.exposeDefaultValues?T=f[C]:(T=h.transform(pt,A,B,Z,Y,a+1),T=h.applyCustomTransformations(T,n,nt,e,h.transformationType)),(T!==void 0||h.options.exposeUnsetFields)&&(f instanceof Map?f.set(C,T):f[C]=T)}else if(h.transformationType===b.CLASS_TO_CLASS){var T=A;T=h.applyCustomTransformations(T,n,x,e,h.transformationType),(T!==void 0||h.options.exposeUnsetFields)&&(f instanceof Map?f.set(C,T):f[C]=T)}},h=this,O=0,R=g;O<R.length;O++){var m=R[O];_(m)}return this.options.enableCircularCheck&&this.recursionStack.delete(e),f}else return e}},r.prototype.applyCustomTransformations=function(t,e,n,i,u){var a=this,d=U.findTransformMetadatas(e,n,this.transformationType);return this.options.version!==void 0&&(d=d.filter(function(p){return p.options?a.checkVersion(p.options.since,p.options.until):!0})),this.options.groups&&this.options.groups.length?d=d.filter(function(p){return p.options?a.checkGroups(p.options.groups):!0}):d=d.filter(function(p){return!p.options||!p.options.groups||!p.options.groups.length}),d.forEach(function(p){t=p.transformFn({value:t,key:n,obj:i,type:u,options:a.options})}),t},r.prototype.isCircular=function(t){return this.recursionStack.has(t)},r.prototype.getReflectedType=function(t,e){if(t){var n=U.findTypeMetadata(t,e);return n?n.reflectedType:void 0}},r.prototype.getKeys=function(t,e,n){var i=this,u=U.getStrategy(t);u==="none"&&(u=this.options.strategy||"exposeAll");var a=[];if((u==="exposeAll"||n)&&(e instanceof Map?a=Array.from(e.keys()):a=Object.keys(e)),n)return a;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&t){var d=U.getExposedProperties(t,this.transformationType),p=U.getExcludedProperties(t,this.transformationType);a=le(le([],d,!0),p,!0)}if(!this.options.ignoreDecorators&&t){var d=U.getExposedProperties(t,this.transformationType);this.transformationType===b.PLAIN_TO_CLASS&&(d=d.map(function(_){var h=U.findExposeMetadata(t,_);return h&&h.options&&h.options.name?h.options.name:_})),this.options.excludeExtraneousValues?a=d:a=a.concat(d);var g=U.getExcludedProperties(t,this.transformationType);g.length>0&&(a=a.filter(function(_){return!g.includes(_)})),this.options.version!==void 0&&(a=a.filter(function(_){var h=U.findExposeMetadata(t,_);return!h||!h.options?!0:i.checkVersion(h.options.since,h.options.until)})),this.options.groups&&this.options.groups.length?a=a.filter(function(_){var h=U.findExposeMetadata(t,_);return!h||!h.options?!0:i.checkGroups(h.options.groups)}):a=a.filter(function(_){var h=U.findExposeMetadata(t,_);return!h||!h.options||!h.options.groups||!h.options.groups.length})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(a=a.filter(function(f){return i.options.excludePrefixes.every(function(_){return f.substr(0,_.length)!==_})})),a=a.filter(function(f,_,h){return h.indexOf(f)===_}),a},r.prototype.checkVersion=function(t,e){var n=!0;return n&&t&&(n=this.options.version>=t),n&&e&&(n=this.options.version<e),n},r.prototype.checkGroups=function(t){return t?this.options.groups.some(function(e){return t.includes(e)}):!0},r}(),ct={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},W=globalThis&&globalThis.__assign||function(){return W=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},W.apply(this,arguments)},qe=function(){function r(){}return r.prototype.instanceToPlain=function(t,e){var n=new at(b.CLASS_TO_PLAIN,W(W({},ct),e));return n.transform(void 0,t,void 0,void 0,void 0,void 0)},r.prototype.classToPlainFromExist=function(t,e,n){var i=new at(b.CLASS_TO_PLAIN,W(W({},ct),n));return i.transform(e,t,void 0,void 0,void 0,void 0)},r.prototype.plainToInstance=function(t,e,n){var i=new at(b.PLAIN_TO_CLASS,W(W({},ct),n));return i.transform(void 0,e,t,void 0,void 0,void 0)},r.prototype.plainToClassFromExist=function(t,e,n){var i=new at(b.PLAIN_TO_CLASS,W(W({},ct),n));return i.transform(t,e,void 0,void 0,void 0,void 0)},r.prototype.instanceToInstance=function(t,e){var n=new at(b.CLASS_TO_CLASS,W(W({},ct),e));return n.transform(void 0,t,void 0,void 0,void 0,void 0)},r.prototype.classToClassFromExist=function(t,e,n){var i=new at(b.CLASS_TO_CLASS,W(W({},ct),n));return i.transform(e,t,void 0,void 0,void 0,void 0)},r.prototype.serialize=function(t,e){return JSON.stringify(this.instanceToPlain(t,e))},r.prototype.deserialize=function(t,e,n){var i=JSON.parse(e);return this.plainToInstance(t,i,n)},r.prototype.deserializeArray=function(t,e,n){var i=JSON.parse(e);return this.plainToInstance(t,i,n)},r}();function Yt(r,t){return t===void 0&&(t={}),function(e,n){var i=Reflect.getMetadata("design:type",e,n);U.addTypeMetadata({target:e.constructor,propertyName:n,reflectedType:i,typeFunction:r,options:t})}}var fe=new qe;function Ye(r,t){return fe.instanceToPlain(r,t)}function He(r,t,e){return fe.plainToInstance(r,t,e)}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ge;(function(r){(function(t){var e=typeof ce=="object"?ce:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof e.Reflect>"u"?e.Reflect=r:n=i(e.Reflect,n),t(n);function i(u,a){return function(d,p){typeof u[d]!="function"&&Object.defineProperty(u,d,{configurable:!0,writable:!0,value:p}),a&&a(d,p)}}})(function(t){var e=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",u=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",d={__proto__:[]}instanceof Array,p=!a&&!d,g={create:a?function(){return Jt(Object.create(null))}:d?function(){return Jt({__proto__:null})}:function(){return Jt({})},has:p?function(s,o){return e.call(s,o)}:function(s,o){return o in s},get:p?function(s,o){return e.call(s,o)?s[o]:void 0}:function(s,o){return s[o]}},f=Object.getPrototypeOf(Function),_=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",h=!_&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:$e(),O=!_&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Fe(),R=!_&&typeof WeakMap=="function"?WeakMap:Ue(),m=new R;function x(s,o,c,l){if(k(c)){if(!se(s))throw new TypeError;if(!ie(o))throw new TypeError;return vt(s,o)}else{if(!se(s))throw new TypeError;if(!$(o))throw new TypeError;if(!$(l)&&!k(l)&&!ot(l))throw new TypeError;return ot(l)&&(l=void 0),c=X(c),mt(s,o,c,l)}}t("decorate",x);function L(s,o){function c(l,y){if(!$(l))throw new TypeError;if(!k(y)&&!Pe(y))throw new TypeError;J(s,o,l,y)}return c}t("metadata",L);function C(s,o,c,l){if(!$(c))throw new TypeError;return k(l)||(l=X(l)),J(s,o,c,l)}t("defineMetadata",C);function D(s,o,c){if(!$(o))throw new TypeError;return k(c)||(c=X(c)),pt(s,o,c)}t("hasMetadata",D);function j(s,o,c){if(!$(o))throw new TypeError;return k(c)||(c=X(c)),it(s,o,c)}t("hasOwnMetadata",j);function A(s,o,c){if(!$(o))throw new TypeError;return k(c)||(c=X(c)),nt(s,o,c)}t("getMetadata",A);function B(s,o,c){if(!$(o))throw new TypeError;return k(c)||(c=X(c)),T(s,o,c)}t("getOwnMetadata",B);function Y(s,o){if(!$(s))throw new TypeError;return k(o)||(o=X(o)),ee(s,o)}t("getMetadataKeys",Y);function P(s,o){if(!$(s))throw new TypeError;return k(o)||(o=X(o)),ne(s,o)}t("getOwnMetadataKeys",P);function Kt(s,o,c){if(!$(o))throw new TypeError;k(c)||(c=X(c));var l=Z(o,c,!1);if(k(l)||!l.delete(s))return!1;if(l.size>0)return!0;var y=m.get(o);return y.delete(c),y.size>0||m.delete(o),!0}t("deleteMetadata",Kt);function vt(s,o){for(var c=s.length-1;c>=0;--c){var l=s[c],y=l(o);if(!k(y)&&!ot(y)){if(!ie(y))throw new TypeError;o=y}}return o}function mt(s,o,c,l){for(var y=s.length-1;y>=0;--y){var V=s[y],w=V(o,c,l);if(!k(w)&&!ot(w)){if(!$(w))throw new TypeError;l=w}}return l}function Z(s,o,c){var l=m.get(s);if(k(l)){if(!c)return;l=new h,m.set(s,l)}var y=l.get(o);if(k(y)){if(!c)return;y=new h,l.set(o,y)}return y}function pt(s,o,c){var l=it(s,o,c);if(l)return!0;var y=zt(o);return ot(y)?!1:pt(s,y,c)}function it(s,o,c){var l=Z(o,c,!1);return k(l)?!1:Re(l.has(s))}function nt(s,o,c){var l=it(s,o,c);if(l)return T(s,o,c);var y=zt(o);if(!ot(y))return nt(s,y,c)}function T(s,o,c){var l=Z(o,c,!1);if(!k(l))return l.get(s)}function J(s,o,c,l){var y=Z(c,l,!0);y.set(s,o)}function ee(s,o){var c=ne(s,o),l=zt(s);if(l===null)return c;var y=ee(l,o);if(y.length<=0)return c;if(c.length<=0)return y;for(var V=new O,w=[],S=0,v=c;S<v.length;S++){var M=v[S],E=V.has(M);E||(V.add(M),w.push(M))}for(var tt=0,ae=y;tt<ae.length;tt++){var M=ae[tt],E=V.has(M);E||(V.add(M),w.push(M))}return w}function ne(s,o){var c=[],l=Z(s,o,!1);if(k(l))return c;for(var y=l.keys(),V=Ne(y),w=0;;){var S=je(V);if(!S)return c.length=w,c;var v=ke(S);try{c[w]=v}catch(M){try{Be(V)}finally{throw M}}w++}}function re(s){if(s===null)return 1;switch(typeof s){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return s===null?1:6;default:return 6}}function k(s){return s===void 0}function ot(s){return s===null}function Te(s){return typeof s=="symbol"}function $(s){return typeof s=="object"?s!==null:typeof s=="function"}function Ie(s,o){switch(re(s)){case 0:return s;case 1:return s;case 2:return s;case 3:return s;case 4:return s;case 5:return s}var c="string",l=oe(s,i);if(l!==void 0){var y=l.call(s,c);if($(y))throw new TypeError;return y}return Le(s)}function Le(s,o){var c,l;{var y=s.toString;if(_t(y)){var l=y.call(s);if(!$(l))return l}var c=s.valueOf;if(_t(c)){var l=c.call(s);if(!$(l))return l}}throw new TypeError}function Re(s){return!!s}function De(s){return""+s}function X(s){var o=Ie(s);return Te(o)?o:De(o)}function se(s){return Array.isArray?Array.isArray(s):s instanceof Object?s instanceof Array:Object.prototype.toString.call(s)==="[object Array]"}function _t(s){return typeof s=="function"}function ie(s){return typeof s=="function"}function Pe(s){switch(re(s)){case 3:return!0;case 4:return!0;default:return!1}}function oe(s,o){var c=s[o];if(c!=null){if(!_t(c))throw new TypeError;return c}}function Ne(s){var o=oe(s,u);if(!_t(o))throw new TypeError;var c=o.call(s);if(!$(c))throw new TypeError;return c}function ke(s){return s.value}function je(s){var o=s.next();return o.done?!1:o}function Be(s){var o=s.return;o&&o.call(s)}function zt(s){var o=Object.getPrototypeOf(s);if(typeof s!="function"||s===f||o!==f)return o;var c=s.prototype,l=c&&Object.getPrototypeOf(c);if(l==null||l===Object.prototype)return o;var y=l.constructor;return typeof y!="function"||y===s?o:y}function $e(){var s={},o=[],c=function(){function w(S,v,M){this._index=0,this._keys=S,this._values=v,this._selector=M}return w.prototype["@@iterator"]=function(){return this},w.prototype[u]=function(){return this},w.prototype.next=function(){var S=this._index;if(S>=0&&S<this._keys.length){var v=this._selector(this._keys[S],this._values[S]);return S+1>=this._keys.length?(this._index=-1,this._keys=o,this._values=o):this._index++,{value:v,done:!1}}return{value:void 0,done:!0}},w.prototype.throw=function(S){throw this._index>=0&&(this._index=-1,this._keys=o,this._values=o),S},w.prototype.return=function(S){return this._index>=0&&(this._index=-1,this._keys=o,this._values=o),{value:S,done:!0}},w}();return function(){function w(){this._keys=[],this._values=[],this._cacheKey=s,this._cacheIndex=-2}return Object.defineProperty(w.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),w.prototype.has=function(S){return this._find(S,!1)>=0},w.prototype.get=function(S){var v=this._find(S,!1);return v>=0?this._values[v]:void 0},w.prototype.set=function(S,v){var M=this._find(S,!0);return this._values[M]=v,this},w.prototype.delete=function(S){var v=this._find(S,!1);if(v>=0){for(var M=this._keys.length,E=v+1;E<M;E++)this._keys[E-1]=this._keys[E],this._values[E-1]=this._values[E];return this._keys.length--,this._values.length--,S===this._cacheKey&&(this._cacheKey=s,this._cacheIndex=-2),!0}return!1},w.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=s,this._cacheIndex=-2},w.prototype.keys=function(){return new c(this._keys,this._values,l)},w.prototype.values=function(){return new c(this._keys,this._values,y)},w.prototype.entries=function(){return new c(this._keys,this._values,V)},w.prototype["@@iterator"]=function(){return this.entries()},w.prototype[u]=function(){return this.entries()},w.prototype._find=function(S,v){return this._cacheKey!==S&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=S)),this._cacheIndex<0&&v&&(this._cacheIndex=this._keys.length,this._keys.push(S),this._values.push(void 0)),this._cacheIndex},w}();function l(w,S){return w}function y(w,S){return S}function V(w,S){return[w,S]}}function Fe(){return function(){function s(){this._map=new h}return Object.defineProperty(s.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),s.prototype.has=function(o){return this._map.has(o)},s.prototype.add=function(o){return this._map.set(o,o),this},s.prototype.delete=function(o){return this._map.delete(o)},s.prototype.clear=function(){this._map.clear()},s.prototype.keys=function(){return this._map.keys()},s.prototype.values=function(){return this._map.values()},s.prototype.entries=function(){return this._map.entries()},s.prototype["@@iterator"]=function(){return this.keys()},s.prototype[u]=function(){return this.keys()},s}()}function Ue(){var s=16,o=g.create(),c=l();return function(){function v(){this._key=l()}return v.prototype.has=function(M){var E=y(M,!1);return E!==void 0?g.has(E,this._key):!1},v.prototype.get=function(M){var E=y(M,!1);return E!==void 0?g.get(E,this._key):void 0},v.prototype.set=function(M,E){var tt=y(M,!0);return tt[this._key]=E,this},v.prototype.delete=function(M){var E=y(M,!1);return E!==void 0?delete E[this._key]:!1},v.prototype.clear=function(){this._key=l()},v}();function l(){var v;do v="@@WeakMap@@"+S();while(g.has(o,v));return o[v]=!0,v}function y(v,M){if(!e.call(v,c)){if(!M)return;Object.defineProperty(v,c,{value:g.create()})}return v[c]}function V(v,M){for(var E=0;E<M;++E)v[E]=Math.random()*255|0;return v}function w(v){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(v)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(v)):V(new Uint8Array(v),v):V(new Array(v),v)}function S(){var v=w(s);v[6]=v[6]&79|64,v[8]=v[8]&191|128;for(var M="",E=0;E<s;++E){var tt=v[E];(E===4||E===6||E===8)&&(M+="-"),tt<16&&(M+="0"),M+=tt.toString(16).toLowerCase()}return M}}function Jt(s){return s.__=void 0,delete s.__,s}})})(ge||(ge={}));var Xe=Object.defineProperty,Ht=(r,t,e,n)=>{for(var i=void 0,u=r.length-1,a;u>=0;u--)(a=r[u])&&(i=a(t,e,i)||i);return i&&Xe(t,e,i),i};const q=0,I=1,ye=4294967295,dt=3;class St{constructor(t){Object.assign(this,t)}update(){var t,e,n,i,u;(t=this.ScalarCmd)==null||t.forEach((a,d)=>a.Index=d),(e=this.RotateCmd)==null||e.forEach((a,d)=>a.Index=d),(n=this.LinearCmd)==null||n.forEach((a,d)=>a.Index=d),(i=this.SensorReadCmd)==null||i.forEach((a,d)=>a.Index=d),(u=this.SensorSubscribeCmd)==null||u.forEach((a,d)=>a.Index=d)}}var rt=(r=>(r.Unknown="Unknown",r.Vibrate="Vibrate",r.Rotate="Rotate",r.Oscillate="Oscillate",r.Constrict="Constrict",r.Inflate="Inflate",r.Position="Position",r))(rt||{}),Q=(r=>(r.Unknown="Unknown",r.Battery="Battery",r.RSSI="RSSI",r.Button="Button",r.Pressure="Pressure",r))(Q||{});class ve{constructor(t){this.Index=0,Object.assign(this,t)}}class me{constructor(t){this.Endpoints=t}}class _e{constructor(t){this.Index=0,Object.assign(this,t)}}class z{constructor(t){this.Id=t}get Type(){return this.constructor}toJSON(){return JSON.stringify(this.toProtocolFormat())}toProtocolFormat(){const t={};return t[this.constructor.Name]=Ye(this),t}update(){}}class K extends z{constructor(t,e){super(e),this.DeviceIndex=t,this.Id=e}}class st extends z{constructor(t=q){super(t),this.Id=t}}class ht extends st{constructor(t=I){super(t),this.Id=t}}ht.Name="Ok";class Xt extends z{constructor(t=I){super(t),this.Id=t}}Xt.Name="Ping";var G=(r=>(r[r.ERROR_UNKNOWN=0]="ERROR_UNKNOWN",r[r.ERROR_INIT=1]="ERROR_INIT",r[r.ERROR_PING=2]="ERROR_PING",r[r.ERROR_MSG=3]="ERROR_MSG",r[r.ERROR_DEVICE=4]="ERROR_DEVICE",r))(G||{});let H=class extends z{constructor(r,t=0,e=I){super(e),this.ErrorMessage=r,this.ErrorCode=t,this.Id=e}get Schemversion(){return 0}};H.Name="Error";class bt{constructor(t){Object.assign(this,t)}}Ht([Yt(()=>St)],bt.prototype,"DeviceMessages");class Ct extends z{constructor(t,e=I){super(e),this.Devices=t,this.Id=e}update(){for(const t of this.Devices)t.DeviceMessages.update()}}Ct.Name="DeviceList",Ht([Yt(()=>bt)],Ct.prototype,"Devices");class lt extends st{constructor(t){super(),Object.assign(this,t)}update(){this.DeviceMessages.update()}}lt.Name="DeviceAdded",Ht([Yt(()=>St)],lt.prototype,"DeviceMessages");class xt extends st{constructor(t){super(),this.DeviceIndex=t}}xt.Name="DeviceRemoved";class Mt extends z{constructor(t=I){super(t),this.Id=t}}Mt.Name="RequestDeviceList";class Et extends z{constructor(t=I){super(t),this.Id=t}}Et.Name="StartScanning";class At extends z{constructor(t=I){super(t),this.Id=t}}At.Name="StopScanning";class Ot extends st{constructor(){super()}}Ot.Name="ScanningFinished";class Tt extends z{constructor(t,e=0,n=I){super(n),this.ClientName=t,this.MessageVersion=e,this.Id=n}}Tt.Name="RequestServerInfo";class It extends st{constructor(t,e,n,i=I){super(),this.MessageVersion=t,this.MaxPingTime=e,this.ServerName=n,this.Id=i}}It.Name="ServerInfo";class Lt extends K{constructor(t=-1,e=I){super(t,e),this.DeviceIndex=t,this.Id=e}}Lt.Name="StopDeviceCmd";class Rt extends z{constructor(t=I){super(t),this.Id=t}}Rt.Name="StopAllDevices";class ft{constructor(t){this.Index=t}}class Dt extends ft{constructor(t,e,n){super(t),this.Scalar=e,this.ActuatorType=n}}class gt extends K{constructor(t,e=-1,n=I){super(e,n),this.Scalars=t,this.DeviceIndex=e,this.Id=n}}gt.Name="ScalarCmd";class Qt extends ft{constructor(t,e,n){super(t),this.Speed=e,this.Clockwise=n}}const we=class Ae extends K{constructor(t,e=-1,n=I){super(e,n),this.Rotations=t,this.DeviceIndex=e,this.Id=n}static Create(t,e){const n=new Array;let i=0;for(const[u,a]of e)n.push(new Qt(i,u,a)),++i;return new Ae(n,t)}};we.Name="RotateCmd";let Pt=we;class Zt extends ft{constructor(t,e,n){super(t),this.Position=e,this.Duration=n}}const Se=class Oe extends K{constructor(t,e=-1,n=I){super(e,n),this.Vectors=t,this.DeviceIndex=e,this.Id=n}static Create(t,e){const n=new Array;let i=0;for(const u of e)n.push(new Zt(i,u[0],u[1])),++i;return new Oe(n,t)}};Se.Name="LinearCmd";let Nt=Se;class kt extends K{constructor(t,e,n,i=I){super(t,i),this.DeviceIndex=t,this.SensorIndex=e,this.SensorType=n,this.Id=i}}kt.Name="SensorReadCmd";class jt extends K{constructor(t,e,n,i,u=I){super(t,u),this.DeviceIndex=t,this.SensorIndex=e,this.SensorType=n,this.Data=i,this.Id=u}}jt.Name="SensorReading";class Bt extends K{constructor(t,e,n,i,u=I){super(t,u),this.DeviceIndex=t,this.Endpoint=e,this.ExpectedLength=n,this.Timeout=i,this.Id=u}}Bt.Name="RawReadCmd";class $t extends K{constructor(t,e,n,i,u=I){super(t,u),this.DeviceIndex=t,this.Endpoint=e,this.Data=n,this.WriteWithResponse=i,this.Id=u}}$t.Name="RawWriteCmd";class Ft extends K{constructor(t,e,n=I){super(t,n),this.DeviceIndex=t,this.Endpoint=e,this.Id=n}}Ft.Name="RawSubscribeCmd";class Ut extends K{constructor(t,e,n=I){super(t,n),this.DeviceIndex=t,this.Endpoint=e,this.Id=n}}Ut.Name="RawUnsubscribeCmd";class Gt extends K{constructor(t,e,n,i=I){super(t,i),this.DeviceIndex=t,this.Endpoint=e,this.Data=n,this.Id=i}}Gt.Name="RawReading";const Qe=Object.freeze(Object.defineProperty({__proto__:null,ActuatorType:rt,ButtplugDeviceMessage:K,ButtplugMessage:z,ButtplugSystemMessage:st,DEFAULT_MESSAGE_ID:I,DeviceAdded:lt,DeviceInfo:bt,DeviceList:Ct,DeviceRemoved:xt,Error:H,ErrorClass:G,GenericDeviceMessageAttributes:ve,GenericMessageSubcommand:ft,LinearCmd:Nt,MAX_ID:ye,MESSAGE_SPEC_VERSION:dt,MessageAttributes:St,Ok:ht,Ping:Xt,RawDeviceMessageAttributes:me,RawReadCmd:Bt,RawReading:Gt,RawSubscribeCmd:Ft,RawUnsubscribeCmd:Ut,RawWriteCmd:$t,RequestDeviceList:Mt,RequestServerInfo:Tt,RotateCmd:Pt,RotateSubcommand:Qt,SYSTEM_MESSAGE_ID:q,ScalarCmd:gt,ScalarSubcommand:Dt,ScanningFinished:Ot,SensorDeviceMessageAttributes:_e,SensorReadCmd:kt,SensorReading:jt,SensorType:Q,ServerInfo:It,StartScanning:Et,StopAllDevices:Rt,StopDeviceCmd:Lt,StopScanning:At,VectorSubcommand:Zt},Symbol.toStringTag,{value:"Module"}));/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class F extends Error{constructor(t,e,n=q,i){super(t),this.errorClass=G.ERROR_UNKNOWN,this.errorClass=e,this.innerError=i,this.messageId=n}get ErrorClass(){return this.errorClass}get InnerError(){return this.innerError}get Id(){return this.messageId}get ErrorMessage(){return new H(this.message,this.ErrorClass,this.Id)}static LogAndError(t,e,n,i=q){return e.Error(n),new t(n,i)}static FromError(t){switch(t.ErrorCode){case G.ERROR_DEVICE:return new N(t.ErrorMessage,t.Id);case G.ERROR_INIT:return new Vt(t.ErrorMessage,t.Id);case G.ERROR_UNKNOWN:return new Ce(t.ErrorMessage,t.Id);case G.ERROR_PING:return new be(t.ErrorMessage,t.Id);case G.ERROR_MSG:return new ut(t.ErrorMessage,t.Id);default:throw new Error(`Message type ${t.ErrorCode} not handled`)}}}class Vt extends F{constructor(t,e=q){super(t,G.ERROR_INIT,e)}}class N extends F{constructor(t,e=q){super(t,G.ERROR_DEVICE,e)}}class ut extends F{constructor(t,e=q){super(t,G.ERROR_MSG,e)}}class be extends F{constructor(t,e=q){super(t,G.ERROR_PING,e)}}class Ce extends F{constructor(t,e=q){super(t,G.ERROR_UNKNOWN,e)}}function xe(r){for(const t of Object.values(Qe))if(typeof t=="function"&&"Name"in t&&t.Name===r)return t;return null}function et(r){return xe(Object.getPrototypeOf(r).constructor.Name)}function te(r){const t=JSON.parse(r),e=[];for(const n of Array.from(t)){const i=Object.getOwnPropertyNames(n)[0],u=xe(i);if(u){const a=He(u,n[i]);a.update(),e.push(a)}}return e}class yt extends wt{constructor(t,e){super(),this._deviceInfo=t,this._sendClosure=e,this.allowedMsgs=new Map,t.DeviceMessages.update()}get name(){return this._deviceInfo.DeviceName}get displayName(){return this._deviceInfo.DeviceDisplayName}get index(){return this._deviceInfo.DeviceIndex}get messageTimingGap(){return this._deviceInfo.DeviceMessageTimingGap}get messageAttributes(){return this._deviceInfo.DeviceMessages}static fromMsg(t,e){return new yt(t,e)}async send(t){return await this._sendClosure(this,t)}async sendExpectOk(t){const e=await this.send(t);switch(et(e)){case ht:return;case H:throw F.FromError(e);default:throw new ut(`Message type ${e.constructor} not handled by SendMsgExpectOk`)}}async scalar(t){Array.isArray(t)?await this.sendExpectOk(new gt(t,this.index)):await this.sendExpectOk(new gt([t],this.index))}async scalarCommandBuilder(t,e){var n;const i=(n=this.messageAttributes.ScalarCmd)==null?void 0:n.filter(a=>a.ActuatorType===e);if(!i||i.length===0)throw new N(`Device ${this.name} has no ${e} capabilities`);const u=[];if(typeof t=="number")i.forEach(a=>u.push(new Dt(a.Index,t,e)));else if(Array.isArray(t)){if(t.length>i.length)throw new N(`${t.length} commands send to a device with ${i.length} vibrators`);i.forEach((a,d)=>{u.push(new Dt(a.Index,t[d],e))})}else throw new N(`${e} can only take numbers or arrays of numbers.`);await this.scalar(u)}get vibrateAttributes(){var t;return((t=this.messageAttributes.ScalarCmd)==null?void 0:t.filter(e=>e.ActuatorType===rt.Vibrate))??[]}async vibrate(t){await this.scalarCommandBuilder(t,rt.Vibrate)}get oscillateAttributes(){var t;return((t=this.messageAttributes.ScalarCmd)==null?void 0:t.filter(e=>e.ActuatorType===rt.Oscillate))??[]}async oscillate(t){await this.scalarCommandBuilder(t,rt.Oscillate)}get rotateAttributes(){return this.messageAttributes.RotateCmd??[]}async rotate(t,e){const n=this.messageAttributes.RotateCmd;if(!n||n.length===0)throw new N(`Device ${this.name} has no Rotate capabilities`);let i;if(typeof t=="number")i=Pt.Create(this.index,new Array(n.length).fill([t,e]));else if(Array.isArray(t))i=Pt.Create(this.index,t);else throw new N("SendRotateCmd can only take a number and boolean, or an array of number/boolean tuples");await this.sendExpectOk(i)}get linearAttributes(){return this.messageAttributes.LinearCmd??[]}async linear(t,e){const n=this.messageAttributes.LinearCmd;if(!n||n.length===0)throw new N(`Device ${this.name} has no Linear capabilities`);let i;if(typeof t=="number")i=Nt.Create(this.index,new Array(n.length).fill([t,e]));else if(Array.isArray(t))i=Nt.Create(this.index,t);else throw new N("SendLinearCmd can only take a number and number, or an array of number/number tuples");await this.sendExpectOk(i)}async sensorRead(t,e){const n=await this.send(new kt(this.index,t,e));switch(et(n)){case jt:return n.Data;case H:throw F.FromError(n);default:throw new ut(`Message type ${n.constructor} not handled by sensorRead`)}}get hasBattery(){var t;const e=(t=this.messageAttributes.SensorReadCmd)==null?void 0:t.filter(n=>n.SensorType===Q.Battery);return e!==void 0&&e.length>0}async battery(){var t;if(!this.hasBattery)throw new N(`Device ${this.name} has no Battery capabilities`);const e=(t=this.messageAttributes.SensorReadCmd)==null?void 0:t.filter(n=>n.SensorType===Q.Battery);return(await this.sensorRead(e[0].Index,Q.Battery))[0]/100}get hasRssi(){var t;const e=(t=this.messageAttributes.SensorReadCmd)==null?void 0:t.filter(n=>n.SensorType===Q.RSSI);return e!==void 0&&e.length===0}async rssi(){var t;if(!this.hasRssi)throw new N(`Device ${this.name} has no RSSI capabilities`);const e=(t=this.messageAttributes.SensorReadCmd)==null?void 0:t.filter(n=>n.SensorType===Q.RSSI);return(await this.sensorRead(e[0].Index,Q.RSSI))[0]}async rawRead(t,e,n){if(!this.messageAttributes.RawReadCmd)throw new N(`Device ${this.name} has no raw read capabilities`);if(this.messageAttributes.RawReadCmd.Endpoints.indexOf(t)===-1)throw new N(`Device ${this.name} has no raw readable endpoint ${t}`);const i=await this.send(new Bt(this.index,t,e,n));switch(et(i)){case Gt:return new Uint8Array(i.Data);case H:throw F.FromError(i);default:throw new ut(`Message type ${i.constructor} not handled by rawRead`)}}async rawWrite(t,e,n){if(!this.messageAttributes.RawWriteCmd)throw new N(`Device ${this.name} has no raw write capabilities`);if(this.messageAttributes.RawWriteCmd.Endpoints.indexOf(t)===-1)throw new N(`Device ${this.name} has no raw writable endpoint ${t}`);await this.sendExpectOk(new $t(this.index,t,e,n))}async rawSubscribe(t){if(!this.messageAttributes.RawSubscribeCmd)throw new N(`Device ${this.name} has no raw subscribe capabilities`);if(this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(t)===-1)throw new N(`Device ${this.name} has no raw subscribable endpoint ${t}`);await this.sendExpectOk(new Ft(this.index,t))}async rawUnsubscribe(t){if(!this.messageAttributes.RawSubscribeCmd)throw new N(`Device ${this.name} has no raw unsubscribe capabilities`);if(this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(t)===-1)throw new N(`Device ${this.name} has no raw unsubscribable endpoint ${t}`);await this.sendExpectOk(new Ut(this.index,t))}async stop(){await this.sendExpectOk(new Lt(this.index))}emitDisconnected(){this.emit("deviceremoved")}}/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class Me{constructor(t){this._useCounter=t,this._counter=1,this._waitingMsgs=new Map}PrepareOutgoingMessage(t){this._useCounter&&(t.Id=this._counter,this._counter+=1);let e,n;const i=new Promise((u,a)=>{e=u,n=a});return this._waitingMsgs.set(t.Id,[e,n]),i}ParseIncomingMessages(t){const e=[];for(const n of t)if(n.Id!==q&&this._waitingMsgs.has(n.Id)){const[i,u]=this._waitingMsgs.get(n.Id);if(n.Type===H){u(F.FromError(n));continue}i(n);continue}else e.push(n);return e}}/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class Ee extends F{constructor(t){super(t,G.ERROR_UNKNOWN)}}class Ze extends wt{constructor(t="Generic Buttplug Client"){super(),this._pingTimer=null,this._connector=null,this._devices=new Map,this._logger=he.Logger,this._isScanning=!1,this._sorter=new Me(!0),this.connect=async e=>{this._logger.Info(`ButtplugClient: Connecting using ${e.constructor.name}`),await e.connect(),this._connector=e,this._connector.addListener("message",this.parseMessages),this._connector.addListener("disconnect",this.disconnectHandler),await this.initializeConnection()},this.disconnect=async()=>{this._logger.Debug("ButtplugClient: Disconnect called"),this.checkConnector(),await this.shutdownConnection(),await this._connector.disconnect()},this.startScanning=async()=>{this._logger.Debug("ButtplugClient: StartScanning called"),this._isScanning=!0,await this.sendMsgExpectOk(new Et)},this.stopScanning=async()=>{this._logger.Debug("ButtplugClient: StopScanning called"),this._isScanning=!1,await this.sendMsgExpectOk(new At)},this.stopAllDevices=async()=>{this._logger.Debug("ButtplugClient: StopAllDevices"),await this.sendMsgExpectOk(new Rt)},this.disconnectHandler=()=>{this._logger.Info("ButtplugClient: Disconnect event receieved."),this.emit("disconnect")},this.parseMessages=e=>{const n=this._sorter.ParseIncomingMessages(e);for(const i of n)switch(et(i)){case lt:{const u=i,a=yt.fromMsg(u,this.sendDeviceMessageClosure);this._devices.set(u.DeviceIndex,a),this.emit("deviceadded",a);break}case xt:{const u=i;if(this._devices.has(u.DeviceIndex)){const a=this._devices.get(u.DeviceIndex);a?.emitDisconnected(),this._devices.delete(u.DeviceIndex),this.emit("deviceremoved",a)}break}case Ot:this._isScanning=!1,this.emit("scanningfinished",i);break}},this.initializeConnection=async()=>{this.checkConnector();const e=await this.sendMessage(new Tt(this._clientName,dt));switch(et(e)){case It:{const n=e;if(this._logger.Info(`ButtplugClient: Connected to Server ${n.ServerName}`),n.MaxPingTime,n.MessageVersion<dt)throw await this._connector.disconnect(),F.LogAndError(Vt,this._logger,`Server protocol version ${n.MessageVersion} is older than client protocol version ${dt}. Please update server.`);return await this.requestDeviceList(),!0}case H:{await this._connector.disconnect();const n=e;throw F.LogAndError(Vt,this._logger,`Cannot connect to server. ${n.ErrorMessage}`)}}return!1},this.requestDeviceList=async()=>{this.checkConnector(),this._logger.Debug("ButtplugClient: ReceiveDeviceList called"),(await this.sendMessage(new Mt)).Devices.forEach(e=>{if(this._devices.has(e.DeviceIndex))this._logger.Debug(`ButtplugClient: Device already added: ${e}`);else{const n=yt.fromMsg(e,this.sendDeviceMessageClosure);this._logger.Debug(`ButtplugClient: Adding Device: ${n}`),this._devices.set(e.DeviceIndex,n),this.emit("deviceadded",n)}})},this.shutdownConnection=async()=>{await this.stopAllDevices(),this._pingTimer!==null&&(clearInterval(this._pingTimer),this._pingTimer=null)},this.sendMsgExpectOk=async e=>{const n=await this.sendMessage(e);switch(et(n)){case ht:return;case H:throw F.FromError(n);default:throw F.LogAndError(ut,this._logger,`Message type ${et(n).constructor} not handled by SendMsgExpectOk`)}},this.sendDeviceMessageClosure=async(e,n)=>await this.sendDeviceMessage(e,n),this._clientName=t,this._logger.Debug(`ButtplugClient: Client ${t} created.`)}get connected(){return this._connector!==null&&this._connector.Connected}get devices(){this.checkConnector();const t=[];return this._devices.forEach(e=>{t.push(e)}),t}get isScanning(){return this._isScanning}async sendDeviceMessage(t,e){if(this.checkConnector(),this._devices.get(t.index)===void 0)throw F.LogAndError(N,this._logger,`Device ${t.index} not available.`);return e.DeviceIndex=t.index,await this.sendMessage(e)}async sendMessage(t){this.checkConnector();const e=this._sorter.PrepareOutgoingMessage(t);return await this._connector.send(t),await e}checkConnector(){if(!this.connected)throw new Ee("ButtplugClient not connected")}}class tn extends wt{constructor(t){super(),this._url=t,this._websocketConstructor=null,this.connect=async()=>{const e=new(this._websocketConstructor??WebSocket)(this._url);let n,i;const u=new Promise((d,p)=>{n=d,i=p}),a=()=>i();return e.addEventListener("open",async()=>{this._ws=e;try{await this.initialize(),this._ws.addEventListener("message",d=>{this.parseIncomingMessage(d)}),this._ws.removeEventListener("close",a),this._ws.addEventListener("close",this.disconnect),n()}catch(d){console.log(d),i()}}),e.addEventListener("close",a),u},this.disconnect=async()=>{this.Connected&&(this._ws.close(),this._ws=void 0,this.emit("disconnect"))},this.initialize=async()=>Promise.resolve()}get Connected(){return this._ws!==void 0}sendMessage(t){if(!this.Connected)throw new Error("ButtplugBrowserWebsocketConnector not connected");this._ws.send("["+t.toJSON()+"]")}parseIncomingMessage(t){if(typeof t.data=="string"){const e=te(t.data);this.emit("message",e)}else t.data instanceof Blob}onReaderLoad(t){const e=te(t.target.result);this.emit("message",e)}}class en extends tn{constructor(){super(...arguments),this.send=t=>{if(!this.Connected)throw new Error("ButtplugClient not connected");this.sendMessage(t)}}}export{rt as ActuatorType,en as ButtplugBrowserWebsocketClientConnector,Ze as ButtplugClient,Ee as ButtplugClientConnectorException,yt as ButtplugClientDevice,N as ButtplugDeviceError,K as ButtplugDeviceMessage,F as ButtplugError,Vt as ButtplugInitError,qt as ButtplugLogLevel,he as ButtplugLogger,z as ButtplugMessage,ut as ButtplugMessageError,Me as ButtplugMessageSorter,be as ButtplugPingError,st as ButtplugSystemMessage,Ce as ButtplugUnknownError,I as DEFAULT_MESSAGE_ID,lt as DeviceAdded,bt as DeviceInfo,Ct as DeviceList,xt as DeviceRemoved,H as Error,G as ErrorClass,ve as GenericDeviceMessageAttributes,ft as GenericMessageSubcommand,Nt as LinearCmd,pe as LogMessage,ye as MAX_ID,dt as MESSAGE_SPEC_VERSION,St as MessageAttributes,ht as Ok,Xt as Ping,me as RawDeviceMessageAttributes,Bt as RawReadCmd,Gt as RawReading,Ft as RawSubscribeCmd,Ut as RawUnsubscribeCmd,$t as RawWriteCmd,Mt as RequestDeviceList,Tt as RequestServerInfo,Pt as RotateCmd,Qt as RotateSubcommand,q as SYSTEM_MESSAGE_ID,gt as ScalarCmd,Dt as ScalarSubcommand,Ot as ScanningFinished,_e as SensorDeviceMessageAttributes,kt as SensorReadCmd,jt as SensorReading,Q as SensorType,It as ServerInfo,Et as StartScanning,Rt as StopAllDevices,Lt as StopDeviceCmd,At as StopScanning,Zt as VectorSubcommand,te as fromJSON,et as getMessageClassFromMessage};
//# sourceMappingURL=buttplug-D_FgAKNY.js.map
